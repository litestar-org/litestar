<!DOCTYPE html>
<html lang="en" data-accent-color="amber" data-content_root="../../">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Built-in middleware - Litestar Framework</title><link rel="shortcut icon" href="../../_static/favicon.svg"/><link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" /><link rel="next" title="Creating Middleware" href="creating-middleware.html" /><link rel="prev" title="Using Middleware" href="using-middleware.html" /><script>
    function setColorMode(t){let e=document.documentElement;e.setAttribute("data-color-mode",t);let a=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,s=t;"auto"===t&&(s=a?"dark":"light"),"light"===s?(e.classList.remove("dark"),e.classList.add("light")):(e.classList.remove("light"),e.classList.add("dark"))}
    setColorMode(localStorage._theme||"auto");
  </script><link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=397bb51e" />
    <link rel="stylesheet" type="text/css" href="../../_static/shibuya.css?v=76b6f612" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx_paramlinks.css" />
    <link media="print" rel="stylesheet" type="text/css" href="../../_static/print.css?v=20ff2c19" />
    <link rel="stylesheet" type="text/css" href="../../_static/style.css?v=50ea2f63" />
    <link rel="stylesheet" type="text/css" href="../../_static/litestar-sphinx-theme.css?v=f8f74789" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --sy-f-text: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
  --sy-f-heading: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
}
</style>
    <meta property="og:type" content="website"/><meta property="og:title" content="Built-in middleware"/>
<meta name="twitter:card" content="summary"/>
<meta property="og:image" content="_static/logo-light.png"/>
  </head>
<body><div class="announcement">
    <div class="announcement-inner">
      <p>You are viewing the <bold>local</bold> version of the documentation. Click here to go to the latest version.</p>
      <button class="announcement-close" aria-label="Close announcement">
        <i class="i-lucide close"></i>
      </button>
    </div>
  </div><div class="sy-head">
  <div class="sy-head-blur"></div>
  <div class="sy-head-inner sy-container mx-auto">
    <a class="sy-head-brand" href="/">
      <img class="light-logo" src="../../_static/logo-light.png" alt="Litestar" height="28" loading="lazy" />
      <img class="dark-logo" src="../../_static/logo-dark.png" alt="Litestar" height="28" loading="lazy" />
      <strong>Litestar</strong>
    </a>
    <div class="sy-head-nav" id="head-nav">
      <nav class="sy-head-links"><ul><li class="link"><a href="../../index.html">Home</a></li>
      <li class="link"><button class="js-menu" type="button" id="nav-trigger-2" aria-controls="nav-children-2">
            <span>Community</span>
            <i class="i-lucide chevron-down"></i>
          </button>
        <ul id="nav-children-2" aria-labelledby="nav-trigger-2"><li><a href="../../contribution-guide.html">
                <span>Contributing</span>
                <small>Learn how to contribute to the Litestar project</small>
              </a></li><li><a href="https://github.com/litestar-org/.github?tab=coc-ov-file">
                <span>Code of Conduct</span>
                <small>Review the etiquette for interacting with the Litestar community</small>
              </a></li><li><a href="https://github.com/litestar-org/.github?tab=coc-ov-file#security-ov-file">
                <span>Security</span>
                <small>Overview of Litestar's security protocols</small>
              </a></li></ul>
      </li>
      <li class="link"><button class="js-menu" type="button" id="nav-trigger-3" aria-controls="nav-children-3">
            <span>About</span>
            <i class="i-lucide chevron-down"></i>
          </button>
        <ul id="nav-children-3" aria-labelledby="nav-trigger-3"><li><a href="https://litestar.dev/about/organization">
                <span>Litestar Organization</span>
                <small>Details about the Litestar organization</small>
              </a></li><li><a href="https://litestar.dev/about/litestar-releases">
                <span>Releases</span>
                <small>Explore the release process, versioning, and deprecation policy for Litestar</small>
              </a></li></ul>
      </li>
      <li class="link"><button class="js-menu" type="button" id="nav-trigger-4" aria-controls="nav-children-4">
            <span>Release notes</span>
            <i class="i-lucide chevron-down"></i>
          </button>
        <ul id="nav-children-4" aria-labelledby="nav-trigger-4"><li><a href="../../release-notes/whats-new-3.html">
                <span>What's new in 3.0</span>
                <small>Explore the new features in Litestar 3.0</small>
              </a></li><li><a href="../../release-notes/changelog.html">
                <span>3.x Changelog</span>
                <small>All changes in the 3.x series</small>
              </a></li><li><a href="https://docs.litestar.dev/2/release-notes/changelog.html">
                <span>2.x Changelog</span>
                <small>All changes in the 2.x series</small>
              </a></li></ul>
      </li>
      <li class="link"><button class="js-menu" type="button" id="nav-trigger-5" aria-controls="nav-children-5">
            <span>Help</span>
            <i class="i-lucide chevron-down"></i>
          </button>
        <ul id="nav-children-5" aria-labelledby="nav-trigger-5"><li><a href="https://discord.gg/litestar">
                <span>Discord Help Forum</span>
                <small>Dedicated Discord help forum</small>
              </a></li><li><a href="https://github.com/orgs/litestar-org/discussions">
                <span>GitHub Discussions</span>
                <small>GitHub Discussions</small>
              </a></li><li><a href="https://stackoverflow.com/questions/tagged/litestar">
                <span>Stack Overflow</span>
                <small>We monitor the <code><b>litestar</b></code> tag on Stack Overflow</small>
              </a></li></ul>
      </li><li class="link">
          <a href="https://github.com/sponsors/Litestar-Org">
            <span>Sponsor</span></a>
        </li></ul></nav>
      <div class="sy-head-extra flex items-center print:hidden"><form class="searchbox flex items-center" action="../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <kbd>/</kbd>
</form><div class="nav-versions">
    <button type="button" aria-label="Versions">
      <span class="md:hidden">Versions</span>
      <span class="hidden md:inline">main</span>
      <i class="i-lucide chevron-down"></i>
    </button>
    <div class="nav-versions-choices"><ul><li><a href="/latest">latest</a></li><li><a href="/main">v3 (development)</a></li><li><a href="/2">v2</a></li><li><a href="/1">v1</a></li></ul></div>
  </div><div class="sy-head-socials">
<a href="https://twitter.com/LitestarAPI" aria-label="X (Twitter)">
  <iconify-icon icon="prime:twitter"></iconify-icon>
</a>
  <a href="https://discord.gg/litestar" aria-label="Discord">
    <iconify-icon icon="simple-icons:discord"></iconify-icon>
  </a></div></div>
    </div>
    <div class="sy-head-actions flex items-center shrink-0 print:hidden"><button class="js-theme theme-switch flex items-center"
data-aria-auto="Switch to light color mode"
data-aria-light="Switch to dark color mode"
data-aria-dark="Switch to auto color mode">
<i class="i-lucide theme-icon"></i>
</button><button class="md:hidden flex items-center js-menu" aria-label="Menu" type="button" aria-controls="head-nav" aria-expanded="false">
        <div class="hamburger">
          <span class="hamburger_1"></span>
          <span class="hamburger_2 -translate-x-2"></span>
          <span class="hamburger_3 -translate-x-1"></span>
        </div>
      </button>
    </div>
  </div>
</div>
<div class="sy-page sy-container flex mx-auto">
  <aside id="lside" class="sy-lside md:w-72 md:shrink-0 print:hidden">
    <div class="sy-lside-inner md:sticky">
      <div class="sy-scrollbar p-6"><div class="sidebar-links">
  <ul>
    <li><a class="icon-link" href="https://github.com/orgs/litestar-org/discussions">
  <span class="icon">
    <svg viewBox="0 0 24 24" fill="none">
      <path fill="var(--accent-9)" fill-rule="evenodd" clip-rule="evenodd" d="M11 5a6 6 0 0 0-4.687 9.746c.215.27.315.62.231.954l-.514 2.058a1 1 0 0 0 1.485 1.1l2.848-1.71c.174-.104.374-.15.576-.148H13a6 6 0 0 0 0-12h-2Z"/>
      <circle fill="white" cx="12" cy="11" r="1"/>
      <circle fill="white" cx="9" cy="11" r="1"/>
      <circle fill="white" cx="15" cy="11" r="1"/>
    </svg>
  </span>
  <span class="text">Discussion</span>
</a></li>
  </ul>
</div>
        <div class="globaltoc" data-expand-depth="0"><p class="caption" role="heading" aria-level="3"><span class="caption-text">Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../getting-started.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Usage</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../applications.html">Applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../routing/index.html">Routing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../routing/overview.html">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../routing/handlers.html">Route handlers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../routing/parameters.html">Parameters</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../requests.html">Requests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../caching.html">Caching</a></li>
<li class="toctree-l2"><a class="reference internal" href="../channels.html">Channels</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cli.html">CLI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../databases/index.html">Databases</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../databases/sqlalchemy/index.html">SQLAlchemy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../databases/sqlalchemy/models_and_repository.html">SQLAlchemy Models &amp; Repository</a></li>
<li class="toctree-l4"><a class="reference internal" href="../databases/sqlalchemy/plugins/index.html">Plugins</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../databases/piccolo.html">Piccolo ORM</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../debugging.html">Debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dependency-injection.html">Dependency Injection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dto/index.html">Data Transfer Object (DTO)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../dto/0-basic-use.html">Basic Use</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dto/1-abstract-dto.html">AbstractDTO</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dto/2-creating-custom-dto-classes.html">Implementing Custom DTO Classes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../events.html">Events</a></li>
<li class="toctree-l2"><a class="reference internal" href="../exceptions.html">Exceptions and exception handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../file_systems.html">File Systems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../htmx.html">HTMX</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lifecycle-hooks.html">Life Cycle Hooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../logging.html">Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../metrics/index.html">Metrics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../metrics/open-telemetry.html">OpenTelemetry</a></li>
<li class="toctree-l3"><a class="reference internal" href="../metrics/prometheus.html">Prometheus</a></li>
</ul>
</li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Middleware</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="using-middleware.html">Using Middleware</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Built-in middleware</a></li>
<li class="toctree-l3"><a class="reference internal" href="creating-middleware.html">Creating Middleware</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../openapi/index.html">OpenAPI</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../openapi/schema_generation.html">Configuring schema generation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../openapi/schema_generation.html#configuring-schema-generation-on-a-route-handler">Configuring schema generation on a route handler</a></li>
<li class="toctree-l3"><a class="reference internal" href="../openapi/schema_generation.html#accessing-the-openapi-schema-in-code">Accessing the OpenAPI schema in code</a></li>
<li class="toctree-l3"><a class="reference internal" href="../openapi/schema_generation.html#customizing-pydantic-model-schemas">Customizing Pydantic model schemas</a></li>
<li class="toctree-l3"><a class="reference internal" href="../openapi/schema_generation.html#customizing-operation-class">Customizing <code class="docutils literal notranslate"><span class="pre">Operation</span></code> class</a></li>
<li class="toctree-l3"><a class="reference internal" href="../openapi/schema_generation.html#generating-examples">Generating examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../openapi/ui_plugins.html">OpenAPI UI Plugins</a></li>
<li class="toctree-l3"><a class="reference internal" href="../openapi/ui_plugins.html#using-openapi-ui-plugins">Using OpenAPI UI Plugins</a></li>
<li class="toctree-l3"><a class="reference internal" href="../openapi/ui_plugins.html#configuring-openapi-ui-plugins">Configuring OpenAPI UI Plugins</a></li>
<li class="toctree-l3"><a class="reference internal" href="../openapi/ui_plugins.html#configuring-the-openapi-root-path">Configuring the OpenAPI Root Path</a></li>
<li class="toctree-l3"><a class="reference internal" href="../openapi/ui_plugins.html#building-your-own-openapi-ui-plugin">Building your own OpenAPI UI Plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../openapi/ui_plugins.html#interacting-with-the-router">Interacting with the <code class="docutils literal notranslate"><span class="pre">Router</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../openapi/ui_plugins.html#oauth2-in-swagger-ui">OAuth2 in Swagger UI</a></li>
<li class="toctree-l3"><a class="reference internal" href="../openapi/ui_plugins.html#customizing-the-openapi-ui">Customizing the OpenAPI UI</a></li>
<li class="toctree-l3"><a class="reference internal" href="../openapi/ui_plugins.html#cdn-and-offline-file-support">CDN and offline file support</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plugins/index.html">Plugins</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plugins/flash_messages.html">Flash Messages</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/problem_details.html">Problem Details</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../responses.html">Responses</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security/index.html">Security</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../security/abstract-authentication-middleware.html">Implementing Custom Authentication</a></li>
<li class="toctree-l3"><a class="reference internal" href="../security/security-backends.html">Security Backends</a></li>
<li class="toctree-l3"><a class="reference internal" href="../security/guards.html">Guards</a></li>
<li class="toctree-l3"><a class="reference internal" href="../security/excluding-and-including-endpoints.html">Excluding and including endpoints</a></li>
<li class="toctree-l3"><a class="reference internal" href="../security/jwt.html">JWT Security Backends</a></li>
<li class="toctree-l3"><a class="reference internal" href="../security/secret-datastructures.html">Handling Secrets</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../static-files.html">Static files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../custom-types.html">Custom types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stores.html">Stores</a></li>
<li class="toctree-l2"><a class="reference internal" href="../templating.html">Templating</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing.html">Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../websockets.html">WebSockets</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/index.html">API reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../reference/app.html">app</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/background_tasks.html">background_tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/channels/index.html">channels</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/channels/plugin.html">plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/channels/subscriber.html">subscriber</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/channels/backends/index.html">backends</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference/channels/backends/base.html">base</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/channels/backends/memory.html">memory</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/channels/backends/redis.html">redis</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/channels/backends/psycopg.html">psycopg</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/channels/backends/asyncpg.html">asyncpg</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/cli.html">cli</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/config.html">config</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/connection.html">connection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/contrib/index.html">contrib</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/contrib/htmx.html">HTMX</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/contrib/jinja.html">jinja</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/contrib/mako.html">mako</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/contrib/opentelemetry.html">opentelemetry</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/contrib/piccolo.html">piccolo_orm</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/contrib/sqlalchemy/index.html">sqlalchemy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference/contrib/sqlalchemy/plugins.html">plugins</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/contrib/sqlalchemy/repository.html">repository</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/contrib/sqlalchemy/types.html">types</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/contrib/sqlalchemy/base.html">base</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/contrib/sqlalchemy/dto.html">DTO</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/controller.html">controller</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/concurrency.html">concurrency</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/data_extractors.html">data_extractors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/datastructures/index.html">datastructures</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/datastructures/secret_values.html">secret_values</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/di.html">di</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/dto/index.html">dto</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/dto/config.html">config</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/dto/data_structures.html">data_structures</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/dto/field.html">field</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/dto/types.html">types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/dto/base_dto.html">base_dto</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/dto/msgspec_dto.html">msgspec_dto</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/dto/dataclass_dto.html">dataclass_dto</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/enums.html">enums</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/events.html">events</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/exceptions.html">exceptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/file_system.html">file_system</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/handlers.html">handlers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/logging/index.html">logging</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/logging/config.html">config</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/logging/picologging.html">picologging</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/logging/standard.html">standard</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/middleware/index.html">middleware</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/middleware/allowed_hosts.html">allowed_hosts</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/middleware/authentication.html">authentication</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/middleware/compression.html">compression</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/middleware/csrf.html">csrf</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/middleware/logging.html">logging</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/middleware/rate_limit.html">rate_limit</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/middleware/session/index.html">session</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference/middleware/session/base.html">base</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/middleware/session/client_side.html">client_side</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/middleware/session/server_side.html">server_side</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/middleware/constraints.html">constraints</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/openapi/index.html">openapi</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/openapi/openapi.html">openapi</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/openapi/plugins.html">plugins</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/openapi/spec.html">spec</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/pagination.html">pagination</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/params.html">params</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/plugins/index.html">plugins</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/plugins/attrs.html">attrs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/plugins/flash_messages.html">flash</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/plugins/htmx.html">htmx</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/plugins/problem_details.html">problem details</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/plugins/prometheus.html">prometheus</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/plugins/pydantic.html">pydantic</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/plugins/structlog.html">structlog</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/plugins/sqlalchemy.html">sqlalchemy</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/repository/index.html">repository</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/repository/abc.html">abc</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/repository/filters.html">filters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/repository/exceptions.html">exceptions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/repository/testing.html">testing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/repository/handlers.html">handlers</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/response/index.html">response</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/response/base.html">base</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/response/file.html">file</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/response/redirect.html">redirect</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/response/streaming.html">streaming</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/response/sse.html">SSE (Server Sent Events)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/response/template.html">template</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/router.html">router</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/routes.html">routes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/security/index.html">security</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/security/jwt.html">jwt</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/security/session_auth.html">session_auth</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/serialization.html">serialization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/static_files.html">static_files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/status_codes.html">status_code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/stores/index.html">stores</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/stores/base.html">base</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/stores/file.html">file</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/stores/memory.html">memory</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/stores/redis.html">redis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/stores/registry.html">registry</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/stores/valkey.html">valkey</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/template.html">template</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/testing.html">testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/types.html">types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/typing.html">typing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../benchmarks.html">Benchmarks</a></li>
</ul>
<p class="caption" role="heading" aria-level="3"><span class="caption-text">Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../migration/index.html">Migrating to Litestar</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../migration/flask.html">From Flask</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../migration/fastapi.html">From Starlette / FastAPI</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../topics/index.html">Topics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../topics/sync-vs-async.html">Sync vs. Async</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../topics/deployment/index.html">Deployment</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../topics/deployment/nginx-unit.html">NGINX Unit</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../topics/deployment/manually-with-asgi-server.html">Manually with ASGI server</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../topics/deployment/docker.html">Docker</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../topics/deployment/supervisor.html">Supervisor (Linux)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/index.html">Tutorials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/todo-app/index.html">Developing a basic TODO application</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/todo-app/0-application-basics.html">Application basics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/todo-app/1-accessing-the-list.html">Accessing the list</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/todo-app/2-interacting-with-the-list.html">Making the list interactive</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/todo-app/3-assembling-the-app.html">Recap and assembling the final application</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/sqlalchemy/index.html">Improving the TODO app with SQLAlchemy</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/sqlalchemy/0-introduction.html">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/sqlalchemy/1-provide-session-with-di.html">Providing the session with DI</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/sqlalchemy/2-serialization-plugin.html">Using the serialization plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/sqlalchemy/3-init-plugin.html">Using the init plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/sqlalchemy/4-final-touches-and-recap.html">Final touches and recap</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/dto-tutorial/index.html">Data Transfer Object Tutorial</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/dto-tutorial/01-simple-dto-exclude.html">Our first DTO</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/dto-tutorial/02-nested-exclude.html">Excluding from nested models</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/dto-tutorial/03-nested-collection-exclude.html">Excluding from collections of nested models</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/dto-tutorial/04-max-nested-depth.html">Max nested depth</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/dto-tutorial/05-renaming-fields.html">Renaming fields</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/dto-tutorial/06-receiving-data.html">Receiving data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/dto-tutorial/07-read-only-fields.html">Read only fields</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/dto-tutorial/08-dto-data.html">Accessing the data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/dto-tutorial/09-updating.html">Updating instances</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/dto-tutorial/10-layered-dto-declarations.html">Declaring DTOs on app layers</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/repository-tutorial/index.html">SQLAlchemy Repository Tutorial</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/repository-tutorial/01-modelling-and-features.html">Introduction to Database Modelling and Repository Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/repository-tutorial/01-modelling-and-features.html#modelling">Modelling</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/repository-tutorial/01-modelling-and-features.html#full-code">Full Code</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/repository-tutorial/02-repository-introduction.html">Interacting with repositories</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/repository-tutorial/02-repository-introduction.html#working-with-bulk-data-operations">Working with Bulk Data Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/repository-tutorial/02-repository-introduction.html#full-code">Full Code</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/repository-tutorial/03-repository-controller.html">Working with Controllers and Repositories</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/repository-tutorial/03-repository-controller.html#full-code">Full Code</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/repository-tutorial/04-repository-other.html">Adding Additional Features to the Repository</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/repository-tutorial/04-repository-other.html#slug-fields">Slug Fields</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/repository-tutorial/04-repository-other.html#full-code">Full Code</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading" aria-level="3"><span class="caption-text">Contributing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contribution-guide.html">Contribution Guide</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/search?q=user%3Alitestar-org+state%3Aopen+label%3A%22good+first+issue%22+++no%3Aassignee+&amp;type=issues=">Available Issues</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/litestar-org/.github?tab=coc-ov-file#readme">Code of Conduct</a></li>
</ul>

        </div>
      </div>
    </div>
  </aside>
  <div class="lside-overlay js-menu" role="button" aria-label="Close left sidebar" aria-controls="lside" aria-expanded="false"></div>
  <aside id="rside" class="sy-rside pb-3 w-64 shrink-0 order-last">
    <button class="rside-close js-menu xl:hidden" aria-label="Close Table of Contents" type="button" aria-controls="rside" aria-expanded="false">
      <i class="i-lucide close"></i>
    </button>
    <div class="sy-scrollbar sy-rside-inner px-6 xl:top-16 xl:sticky xl:pl-0 pt-6 pb-4"><div class="localtoc"><h3>On this page</h3><ul>
<li><a class="reference internal" href="#cors">CORS</a></li>
<li><a class="reference internal" href="#csrf">CSRF</a></li>
<li><a class="reference internal" href="#allowed-hosts">Allowed Hosts</a></li>
<li><a class="reference internal" href="#compression">Compression</a><ul>
<li><a class="reference internal" href="#gzip">GZIP</a></li>
<li><a class="reference internal" href="#brotli">Brotli</a></li>
<li><a class="reference internal" href="#zstd">Zstd</a></li>
</ul>
</li>
<li><a class="reference internal" href="#rate-limit-middleware">Rate-Limit Middleware</a></li>
<li><a class="reference internal" href="#logging-middleware">Logging Middleware</a><ul>
<li><a class="reference internal" href="#obfuscating-logging-output">Obfuscating Logging Output</a></li>
<li><a class="reference internal" href="#compression-and-logging-of-response-body">Compression and Logging of Response Body</a></li>
</ul>
</li>
<li><a class="reference internal" href="#session-middleware">Session Middleware</a><ul>
<li><a class="reference internal" href="#setting-up-the-middleware">Setting up the middleware</a></li>
<li><a class="reference internal" href="#client-side-sessions">Client-side sessions</a></li>
<li><a class="reference internal" href="#server-side-sessions">Server-side sessions</a></li>
</ul>
</li>
</ul>
</div><a class="js-repo-stats repo-stats flex items-center" href="https://github.com/litestar-org/litestar"
  data-type="github" data-user="litestar-org" data-repo="litestar">
  <span class="w-8 flex items-center justify-around shrink-0 text-3xl">
    <iconify-icon icon="simple-icons:github"></iconify-icon>
  </span>
  <span class="flex-grow px-2 break-all">
    <span>litestar-org/litestar</span>
    <span class="flex text-sm repo-stats-count">
      <span class="flex items-center pr-3">
        <iconify-icon icon="lucide:star"></iconify-icon>
        <strong class="js-repo-stars ml-1">0</strong>
      </span>
      <span class="flex items-center">
        <iconify-icon icon="lucide:git-fork"></iconify-icon>
        <strong class="js-repo-forks ml-1">0</strong>
      </span>
    </span>
  </span>
</a><div class="edit-this-page">
  <a href="https://github.com/litestar-org/litestar/blob/main/docs/usage/middleware/builtin-middleware.rst">Edit this page</a>
</div><div id="ethical-ad-placement" data-ea-publisher="readthedocs"></div></div>
  </aside>
  <div class="rside-overlay js-menu" role="button" aria-label="Close Table of Contents" aria-controls="rside" aria-expanded="false"></div>
  <main class="sy-main w-full max-sm:max-w-full print:pt-6">
<div class="sy-breadcrumbs" role="navigation">
  <div class="sy-breadcrumbs-inner flex items-center">
    <div class="md:hidden mr-3">
      <button class="js-menu" aria-label="Menu" type="button" aria-controls="lside" aria-expanded="false">
        <i class="i-lucide menu"></i>
      </button>
    </div>
    <ol class="flex-1" itemscope itemtype="https://schema.org/BreadcrumbList"><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="../../index.html"><span itemprop="name">Litestar</span></a>
        <span>/</span>
        <meta itemprop="position" content="1" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="../index.html"><span itemprop="name">Usage</span></a>
        <span>/</span>
        <meta itemprop="position" content="2" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="index.html"><span itemprop="name">Middleware</span></a>
        <span>/</span>
        <meta itemprop="position" content="3" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <strong itemprop="name">Built-in middleware</strong>
        <meta itemprop="position" content="4" />
      </li></ol>
    <div class="xl:hidden ml-1">
      <button class="js-menu" aria-label="Show table of contents" type="button" aria-controls="rside"
        aria-expanded="false">
        <i class="i-lucide outdent"></i>
      </button>
    </div>
  </div>
</div><div class="flex flex-col break-words justify-between">
      <div class="min-w-0 max-w-6xl px-6 pb-6 pt-8 xl:px-12">
        <article class="yue" role="main">
          <section id="built-in-middleware">
<h1>Built-in middleware<a class="headerlink" href="#built-in-middleware" title="Link to this heading">¶</a></h1>
<section id="cors">
<h2>CORS<a class="headerlink" href="#cors" title="Link to this heading">¶</a></h2>
<p><a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS">CORS (Cross-Origin Resource Sharing)</a> is a common security
mechanism that is often implemented using middleware. To enable CORS in a litestar application simply pass an instance
of <a class="reference internal" href="../../reference/config.html#litestar.config.cors.CORSConfig" title="litestar.config.cors.CORSConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">CORSConfig</span></code></a> to <a class="reference internal" href="../../reference/app.html#litestar.app.Litestar" title="litestar.app.Litestar"><code class="xref py py-class docutils literal notranslate"><span class="pre">Litestar</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar</span><span class="w"> </span><span class="kn">import</span> <span class="n">Litestar</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.config.cors</span><span class="w"> </span><span class="kn">import</span> <span class="n">CORSConfig</span>
</span><span data-line="3">
</span><span data-line="4"><span class="n">cors_config</span> <span class="o">=</span> <span class="n">CORSConfig</span><span class="p">(</span><span class="n">allow_origins</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;https://www.example.com&quot;</span><span class="p">])</span>
</span><span data-line="5">
</span><span data-line="6"><span class="n">app</span> <span class="o">=</span> <span class="n">Litestar</span><span class="p">(</span><span class="n">route_handlers</span><span class="o">=</span><span class="p">[</span><span class="o">...</span><span class="p">],</span> <span class="n">cors_config</span><span class="o">=</span><span class="n">cors_config</span><span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="csrf">
<h2>CSRF<a class="headerlink" href="#csrf" title="Link to this heading">¶</a></h2>
<p><a class="reference external" href="https://owasp.org/www-community/attacks/csrf">CSRF (Cross-site request forgery)</a> is a type of attack where unauthorized commands are submitted from a user that the web
application trusts. This attack often uses social engineering that tricks the victim into clicking a URL that contains a
maliciously crafted, unauthorized request for a particular Web application. The user’s browser then sends this
maliciously crafted request to the targeted Web application. If the user is in an active session with the Web application,
the application treats this new request as an authorized request submitted by the user. Thus, the attacker can force the
user to perform an action the user didn’t intend, for example:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span><span data-line="1">POST /send-money HTTP/1.1
</span><span data-line="2">Host: target.web.app
</span><span data-line="3">Content-Type: application/x-www-form-urlencoded
</span><span data-line="4">
</span><span data-line="5">amount=1000usd&amp;to=attacker@evil.com
</span></pre></div>
</div>
<p>This middleware prevents CSRF attacks by doing the following:</p>
<ol class="arabic simple">
<li><p>On the first “safe” request (e.g GET) - set a cookie with a special token created by the server</p></li>
<li><dl class="simple">
<dt>On each subsequent “unsafe” request (e.g POST) - make sure the request contains either a</dt><dd><p>form field or an additional header that has this token (more on this below)</p>
</dd>
</dl>
</li>
</ol>
<p>To enable CSRF protection in a Litestar application simply pass an instance of
<a class="reference internal" href="../../reference/config.html#litestar.config.csrf.CSRFConfig" title="litestar.config.csrf.CSRFConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">CSRFConfig</span></code></a> to the Litestar constructor:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar</span><span class="w"> </span><span class="kn">import</span> <span class="n">Litestar</span><span class="p">,</span> <span class="n">get</span><span class="p">,</span> <span class="n">post</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.config.csrf</span><span class="w"> </span><span class="kn">import</span> <span class="n">CSRFConfig</span>
</span><span data-line="3">
</span><span data-line="4">
</span><span data-line="5"><span class="nd">@get</span><span class="p">()</span>
</span><span data-line="6"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_resource</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span data-line="7">    <span class="c1"># GET is one of the safe methods</span>
</span><span data-line="8">    <span class="k">return</span> <span class="s2">&quot;some_resource&quot;</span>
</span><span data-line="9">
</span><span data-line="10"><span class="nd">@post</span><span class="p">(</span><span class="s2">&quot;{id:int}&quot;</span><span class="p">)</span>
</span><span data-line="11"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">create_resource</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span data-line="12">    <span class="c1"># POST is one of the unsafe methods</span>
</span><span data-line="13">    <span class="k">return</span> <span class="kc">True</span>
</span><span data-line="14">
</span><span data-line="15"><span class="n">csrf_config</span> <span class="o">=</span> <span class="n">CSRFConfig</span><span class="p">(</span><span class="n">secret</span><span class="o">=</span><span class="s2">&quot;my-secret&quot;</span><span class="p">)</span>
</span><span data-line="16">
</span><span data-line="17"><span class="n">app</span> <span class="o">=</span> <span class="n">Litestar</span><span class="p">([</span><span class="n">get_resource</span><span class="p">,</span> <span class="n">create_resource</span><span class="p">],</span> <span class="n">csrf_config</span><span class="o">=</span><span class="n">csrf_config</span><span class="p">)</span>
</span></pre></div>
</div>
<p>The following snippet demonstrates how to change the cookie name to <code class="docutils literal notranslate"><span class="pre">&quot;some-cookie-name&quot;</span></code> and header name to <code class="docutils literal notranslate"><span class="pre">&quot;some-header-name&quot;</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">csrf_config</span> <span class="o">=</span> <span class="n">CSRFConfig</span><span class="p">(</span><span class="n">secret</span><span class="o">=</span><span class="s2">&quot;my-secret&quot;</span><span class="p">,</span> <span class="n">cookie_name</span><span class="o">=</span><span class="s1">&#39;some-cookie-name&#39;</span><span class="p">,</span> <span class="n">header_name</span><span class="o">=</span><span class="s1">&#39;some-header-name&#39;</span><span class="p">)</span>
</span></pre></div>
</div>
<p>A CSRF protected route can be accessed by any client that can make a request with either the header or form-data key.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The form-data key can not be currently configured. It should only be passed via the key <code class="docutils literal notranslate"><span class="pre">&quot;_csrf_token&quot;</span></code></p>
</div>
<p>In Python, any client such as <a class="reference external" href="https://github.com/psf/requests">requests</a> or <a class="reference external" href="https://github.com/encode/httpx">httpx</a> can be used.
The usage of clients or sessions is recommended due to the cookie persistence it offers across requests.
The following is an example using <a class="reference external" href="https://www.python-httpx.org/api/#client">httpx.Client</a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">import</span><span class="w"> </span><span class="nn">httpx</span>
</span><span data-line="2">
</span><span data-line="3">
</span><span data-line="4"><span class="k">with</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
</span><span data-line="5">    <span class="n">get_response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;http://localhost:8000/&quot;</span><span class="p">)</span>
</span><span data-line="6">
</span><span data-line="7">    <span class="c1"># &quot;csrftoken&quot; is the default cookie name</span>
</span><span data-line="8">    <span class="n">csrf</span> <span class="o">=</span> <span class="n">get_response</span><span class="o">.</span><span class="n">cookies</span><span class="p">[</span><span class="s2">&quot;csrftoken&quot;</span><span class="p">]</span>
</span><span data-line="9">
</span><span data-line="10">    <span class="c1"># &quot;x-csrftoken&quot; is the default header name</span>
</span><span data-line="11">    <span class="n">post_response_using_header</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;http://localhost:8000/1&quot;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;x-csrftoken&quot;</span><span class="p">:</span> <span class="n">csrf</span><span class="p">})</span>
</span><span data-line="12">    <span class="k">assert</span> <span class="n">post_response_using_header</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">201</span>
</span><span data-line="13">
</span><span data-line="14">    <span class="c1"># &quot;_csrf_token&quot; is the default *non* configurable form-data key</span>
</span><span data-line="15">    <span class="n">post_response_using_form_data</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;http://localhost:8000/1&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;_csrf_token&quot;</span><span class="p">:</span> <span class="n">csrf</span><span class="p">})</span>
</span><span data-line="16">    <span class="k">assert</span> <span class="n">post_response_using_form_data</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">201</span>
</span><span data-line="17">
</span><span data-line="18">    <span class="c1"># despite the header being passed, this request will fail as it does not have a cookie in its session</span>
</span><span data-line="19">    <span class="c1"># note the usage of ``httpx.post`` instead of ``client.post``</span>
</span><span data-line="20">    <span class="n">post_response_with_no_persisted_cookie</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;http://localhost:8000/1&quot;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;x-csrftoken&quot;</span><span class="p">:</span> <span class="n">csrf</span><span class="p">})</span>
</span><span data-line="21">    <span class="k">assert</span> <span class="n">post_response_with_no_persisted_cookie</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">403</span>
</span><span data-line="22">    <span class="k">assert</span> <span class="s2">&quot;CSRF token verification failed&quot;</span> <span class="ow">in</span> <span class="n">post_response_with_no_persisted_cookie</span><span class="o">.</span><span class="n">text</span>
</span></pre></div>
</div>
<p>Routes can be marked as being exempt from the protection offered by this middleware via
<a class="reference internal" href="../routing/handlers.html#handler-opts"><span class="std std-ref">handler opts</span></a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="nd">@post</span><span class="p">(</span><span class="s2">&quot;/post&quot;</span><span class="p">,</span> <span class="n">exclude_from_csrf</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span data-line="2"><span class="k">def</span><span class="w"> </span><span class="nf">handler</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>
</span></pre></div>
</div>
<p>If you need to exempt many routes at once you might want to consider using the
<a class="reference internal" href="../../reference/config.html#litestar.config.csrf.CSRFConfig.exclude" title="litestar.config.csrf.CSRFConfig.exclude"><code class="xref py py-attr docutils literal notranslate"><span class="pre">exclude</span></code></a> kwarg which accepts list of path
patterns to skip in the middleware.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<ul class="simple">
<li><p><a class="reference external" href="https://developer.mozilla.org/en-US/docs/Glossary/Safe/HTTP">Safe and Unsafe (HTTP Methods)</a></p></li>
<li><p><a class="reference external" href="https://www.python-httpx.org/advanced/clients">HTTPX Clients</a></p></li>
<li><p><a class="reference external" href="https://requests.readthedocs.io/en/latest/user/advanced">Requests Session</a></p></li>
</ul>
</div>
</section>
<section id="allowed-hosts">
<h2>Allowed Hosts<a class="headerlink" href="#allowed-hosts" title="Link to this heading">¶</a></h2>
<p>Another common security mechanism is to require that each incoming request has a <code class="docutils literal notranslate"><span class="pre">&quot;Host&quot;</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;X-Forwarded-Host&quot;</span></code> header,
and then to restrict hosts to a specific set of domains - what’s called “allowed hosts”.</p>
<p>Litestar includes an <a class="reference internal" href="../../reference/middleware/allowed_hosts.html#litestar.middleware.allowed_hosts.AllowedHostsMiddleware" title="litestar.middleware.allowed_hosts.AllowedHostsMiddleware"><code class="xref py py-class docutils literal notranslate"><span class="pre">AllowedHostsMiddleware</span></code></a> class that can be
easily enabled by either passing an instance of <a class="reference internal" href="../../reference/config.html#litestar.config.allowed_hosts.AllowedHostsConfig" title="litestar.config.allowed_hosts.AllowedHostsConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">AllowedHostsConfig</span></code></a> or a
list of domains to <a class="reference internal" href="../../reference/app.html#litestar.app.Litestar" title="litestar.app.Litestar"><code class="xref py py-class docutils literal notranslate"><span class="pre">Litestar</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar</span><span class="w"> </span><span class="kn">import</span> <span class="n">Litestar</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.config.allowed_hosts</span><span class="w"> </span><span class="kn">import</span> <span class="n">AllowedHostsConfig</span>
</span><span data-line="3">
</span><span data-line="4"><span class="n">app</span> <span class="o">=</span> <span class="n">Litestar</span><span class="p">(</span>
</span><span data-line="5">    <span class="n">route_handlers</span><span class="o">=</span><span class="p">[</span><span class="o">...</span><span class="p">],</span>
</span><span data-line="6">    <span class="n">allowed_hosts</span><span class="o">=</span><span class="n">AllowedHostsConfig</span><span class="p">(</span>
</span><span data-line="7">        <span class="n">allowed_hosts</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;*.example.com&quot;</span><span class="p">,</span> <span class="s2">&quot;www.wikipedia.org&quot;</span><span class="p">]</span>
</span><span data-line="8">    <span class="p">),</span>
</span><span data-line="9"><span class="p">)</span>
</span></pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can use wildcard prefixes (<code class="docutils literal notranslate"><span class="pre">*.</span></code>) in the beginning of a domain to match any combination of subdomains. Thus,
<code class="docutils literal notranslate"><span class="pre">*.example.com</span></code> will match <code class="docutils literal notranslate"><span class="pre">www.example.com</span></code> but also <code class="docutils literal notranslate"><span class="pre">x.y.z.example.com</span></code> etc. You can also simply put <code class="docutils literal notranslate"><span class="pre">*</span></code>
in trusted hosts, which means allow all. This is akin to turning the middleware off, so in this case it may be
better to not enable it in the first place. You should note that a wildcard can only be used only in the prefix of a
domain name, not in the middle or end. Doing so will result in a validation exception being raised.</p>
</div>
</section>
<section id="compression">
<h2>Compression<a class="headerlink" href="#compression" title="Link to this heading">¶</a></h2>
<p>HTML responses can optionally be compressed. Litestar has built in support for gzip, brotli, and zstd. Gzip support is provided
through the built-in Starlette classes. Brotli support can be added by installing the <code class="docutils literal notranslate"><span class="pre">brotli</span></code> extra, and Zstd support by installing the <code class="docutils literal notranslate"><span class="pre">zstd</span></code> extra.</p>
<p>You can enable either backend by passing an instance of
<a class="reference internal" href="../../reference/config.html#litestar.config.compression.CompressionConfig" title="litestar.config.compression.CompressionConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">CompressionConfig</span></code></a> to <code class="docutils literal notranslate"><span class="pre">compression_config</span></code> of
<a class="reference internal" href="../../reference/app.html#litestar.app.Litestar" title="litestar.app.Litestar"><code class="xref py py-class docutils literal notranslate"><span class="pre">Litestar</span></code></a>.</p>
<section id="gzip">
<h3>GZIP<a class="headerlink" href="#gzip" title="Link to this heading">¶</a></h3>
<p>You can enable gzip compression of responses by passing an instance of <a class="reference internal" href="../../reference/config.html#litestar.config.compression.CompressionConfig" title="litestar.config.compression.CompressionConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">CompressionConfig</span></code></a> with
the <code class="docutils literal notranslate"><span class="pre">backend</span></code> parameter set to <code class="docutils literal notranslate"><span class="pre">&quot;gzip&quot;</span></code>.</p>
<p>You can configure the following additional gzip-specific values:</p>
<ul class="simple">
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">minimum_size</span></code>: the minimum threshold for response size to enable compression. Smaller responses will not be</dt><dd><p>compressed. Defaults is <code class="docutils literal notranslate"><span class="pre">500</span></code>, i.e. half a kilobyte.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">gzip_compress_level</span></code>: a range between 0-9, see the <a class="reference external" href="https://docs.python.org/3/library/gzip.html">official python docs</a>.</dt><dd><p>Defaults to <code class="docutils literal notranslate"><span class="pre">9</span></code> , which is the maximum value.</p>
</dd>
</dl>
</li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar</span><span class="w"> </span><span class="kn">import</span> <span class="n">Litestar</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.config.compression</span><span class="w"> </span><span class="kn">import</span> <span class="n">CompressionConfig</span>
</span><span data-line="3">
</span><span data-line="4"><span class="n">app</span> <span class="o">=</span> <span class="n">Litestar</span><span class="p">(</span>
</span><span data-line="5">    <span class="n">route_handlers</span><span class="o">=</span><span class="p">[</span><span class="o">...</span><span class="p">],</span>
</span><span data-line="6">    <span class="n">compression_config</span><span class="o">=</span><span class="n">CompressionConfig</span><span class="p">(</span><span class="n">backend</span><span class="o">=</span><span class="s2">&quot;gzip&quot;</span><span class="p">,</span> <span class="n">gzip_compress_level</span><span class="o">=</span><span class="mi">9</span><span class="p">),</span>
</span><span data-line="7"><span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="brotli">
<h3>Brotli<a class="headerlink" href="#brotli" title="Link to this heading">¶</a></h3>
<p>The <a class="reference external" href="https://pypi.org/project/Brotli">Brotli</a> package is required to run this middleware. It is available as an extras to litestar with the <code class="docutils literal notranslate"><span class="pre">brotli</span></code>
extra (<code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">'litestar[brotli]'</span></code>).</p>
<p>You can enable brotli compression of responses by passing an instance of
<a class="reference internal" href="../../reference/config.html#litestar.config.compression.CompressionConfig" title="litestar.config.compression.CompressionConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">CompressionConfig</span></code></a> with the <code class="docutils literal notranslate"><span class="pre">backend</span></code> parameter set to <code class="docutils literal notranslate"><span class="pre">&quot;brotli&quot;</span></code>.</p>
<p>You can configure the following additional brotli-specific values:</p>
<ul class="simple">
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">minimum_size</span></code>: the minimum threshold for response size to enable compression. Smaller responses will not be</dt><dd><p>compressed. Default is 500, i.e. half a kilobyte</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">brotli_quality</span></code>: Range [0-11], Controls the compression-speed vs compression-density tradeoff. The higher the</dt><dd><p>quality, the slower the compression. Defaults to 5</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">brotli_mode</span></code>: The compression mode can be <code class="docutils literal notranslate"><span class="pre">&quot;generic&quot;</span></code> (for mixed content), <code class="docutils literal notranslate"><span class="pre">&quot;text&quot;</span></code> (for UTF-8 format text input), or</dt><dd><p><code class="docutils literal notranslate"><span class="pre">&quot;font&quot;</span></code> (for WOFF 2.0). Defaults to <code class="docutils literal notranslate"><span class="pre">&quot;text&quot;</span></code></p>
</dd>
</dl>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">brotli_lgwin</span></code>: Base 2 logarithm of size. Range [10-24]. Defaults to 22.</p></li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">brotli_lgblock</span></code>: Base 2 logarithm of the maximum input block size. Range [16-24]. If set to 0, the value will</dt><dd><p>be set based on the quality. Defaults to 0</p>
</dd>
</dl>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">brotli_gzip_fallback</span></code>: a boolean to indicate if gzip should be used if brotli is not supported</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar</span><span class="w"> </span><span class="kn">import</span> <span class="n">Litestar</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.config.compression</span><span class="w"> </span><span class="kn">import</span> <span class="n">CompressionConfig</span>
</span><span data-line="3">
</span><span data-line="4"><span class="n">app</span> <span class="o">=</span> <span class="n">Litestar</span><span class="p">(</span>
</span><span data-line="5">    <span class="n">route_handlers</span><span class="o">=</span><span class="p">[</span><span class="o">...</span><span class="p">],</span>
</span><span data-line="6">    <span class="n">compression_config</span><span class="o">=</span><span class="n">CompressionConfig</span><span class="p">(</span><span class="n">backend</span><span class="o">=</span><span class="s2">&quot;brotli&quot;</span><span class="p">,</span> <span class="n">brotli_gzip_fallback</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
</span><span data-line="7"><span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="zstd">
<h3>Zstd<a class="headerlink" href="#zstd" title="Link to this heading">¶</a></h3>
<p>The <a class="reference external" href="https://pypi.org/project/zstd">Zstd</a> package is required to run this middleware. It is available as an extra for Litestar via the <code class="docutils literal notranslate"><span class="pre">zstd</span></code> extra: (<code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">'litestar[zstd]'</span></code>).</p>
<p>You can enable zstd compression of responses by passing an instance of
<a class="reference internal" href="../../reference/config.html#litestar.config.compression.CompressionConfig" title="litestar.config.compression.CompressionConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">CompressionConfig</span></code></a> with the <code class="docutils literal notranslate"><span class="pre">backend</span></code> parameter set to <code class="docutils literal notranslate"><span class="pre">&quot;zstd&quot;</span></code>.</p>
<p>You can configure the following additional zstd-specific values:</p>
<ul class="simple">
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">minimum_size</span></code>: the minimum threshold for response size to enable compression. Smaller responses will not be</dt><dd><p>compressed. Default is 500, i.e. half a kilobyte.</p>
</dd>
</dl>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">zstd_level</span></code>: Range [0-22], Controls the compression level. Higher values increase compression ratio but are slower. Default is 3.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">zstd_gzip_fallback</span></code>: Boolean indicating whether to fall back to gzip if Zstd is not supported. Default is True.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar</span><span class="w"> </span><span class="kn">import</span> <span class="n">Litestar</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.config.compression</span><span class="w"> </span><span class="kn">import</span> <span class="n">CompressionConfig</span>
</span><span data-line="3">
</span><span data-line="4"><span class="n">app</span> <span class="o">=</span> <span class="n">Litestar</span><span class="p">(</span>
</span><span data-line="5">    <span class="n">route_handlers</span><span class="o">=</span><span class="p">[</span><span class="o">...</span><span class="p">],</span>
</span><span data-line="6">    <span class="n">compression_config</span><span class="o">=</span><span class="n">CompressionConfig</span><span class="p">(</span><span class="n">backend</span><span class="o">=</span><span class="s2">&quot;zstd&quot;</span><span class="p">,</span> <span class="n">zstd_gzip_fallback</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
</span><span data-line="7"><span class="p">)</span>
</span></pre></div>
</div>
</section>
</section>
<section id="rate-limit-middleware">
<h2>Rate-Limit Middleware<a class="headerlink" href="#rate-limit-middleware" title="Link to this heading">¶</a></h2>
<p>Litestar includes an optional <a class="reference internal" href="../../reference/middleware/rate_limit.html#litestar.middleware.rate_limit.RateLimitMiddleware" title="litestar.middleware.rate_limit.RateLimitMiddleware"><code class="xref py py-class docutils literal notranslate"><span class="pre">RateLimitMiddleware</span></code></a> that follows
the <a class="reference external" href="https://datatracker.ietf.org/doc/draft-ietf-httpapi-ratelimit-headers/">IETF RateLimit draft specification</a>.</p>
<p>To use the rate limit middleware, use the <a class="reference internal" href="../../reference/middleware/rate_limit.html#litestar.middleware.rate_limit.RateLimitConfig" title="litestar.middleware.rate_limit.RateLimitConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">RateLimitConfig</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar</span><span class="w"> </span><span class="kn">import</span> <span class="n">Litestar</span><span class="p">,</span> <span class="n">MediaType</span><span class="p">,</span> <span class="n">get</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.middleware.rate_limit</span><span class="w"> </span><span class="kn">import</span> <span class="n">RateLimitConfig</span>
</span><span data-line="3">
</span><span data-line="4"><span class="n">rate_limit_config</span> <span class="o">=</span> <span class="n">RateLimitConfig</span><span class="p">(</span><span class="n">rate_limit</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;minute&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">exclude</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;/schema&quot;</span><span class="p">])</span>
</span><span data-line="5">
</span><span data-line="6">
</span><span data-line="7"><span class="nd">@get</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">media_type</span><span class="o">=</span><span class="n">MediaType</span><span class="o">.</span><span class="n">TEXT</span><span class="p">,</span> <span class="n">sync_to_thread</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span data-line="8"><span class="k">def</span><span class="w"> </span><span class="nf">handler</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span data-line="9"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Handler which should not be accessed more than once per minute.&quot;&quot;&quot;</span>
</span><span data-line="10">    <span class="k">return</span> <span class="s2">&quot;ok&quot;</span>
</span><span data-line="11">
</span><span data-line="12">
</span><span data-line="13"><span class="n">app</span> <span class="o">=</span> <span class="n">Litestar</span><span class="p">(</span><span class="n">route_handlers</span><span class="o">=</span><span class="p">[</span><span class="n">handler</span><span class="p">],</span> <span class="n">middleware</span><span class="o">=</span><span class="p">[</span><span class="n">rate_limit_config</span><span class="o">.</span><span class="n">middleware</span><span class="p">])</span>
</span></pre></div>
</div>
<p>The only required configuration kwarg is <code class="docutils literal notranslate"><span class="pre">rate_limit</span></code>, which expects a tuple containing a time-unit (<code class="docutils literal notranslate"><span class="pre">&quot;second&quot;</span></code>,
<code class="docutils literal notranslate"><span class="pre">&quot;minute&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;hour&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;day&quot;</span></code>) and a value for the request quota (integer).</p>
</section>
<section id="logging-middleware">
<h2>Logging Middleware<a class="headerlink" href="#logging-middleware" title="Link to this heading">¶</a></h2>
<p>Litestar ships with a robust logging middleware that allows logging HTTP request and responses while building on
the Litestar’s <a class="reference internal" href="../logging.html#logging-usage"><span class="std std-ref">logging configuration</span></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar</span><span class="w"> </span><span class="kn">import</span> <span class="n">Litestar</span><span class="p">,</span> <span class="n">get</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.logging.config</span><span class="w"> </span><span class="kn">import</span> <span class="n">LoggingConfig</span>
</span><span data-line="3"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.middleware.logging</span><span class="w"> </span><span class="kn">import</span> <span class="n">LoggingMiddlewareConfig</span>
</span><span data-line="4">
</span><span data-line="5"><span class="n">logging_middleware_config</span> <span class="o">=</span> <span class="n">LoggingMiddlewareConfig</span><span class="p">()</span>
</span><span data-line="6">
</span><span data-line="7">
</span><span data-line="8"><span class="nd">@get</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">sync_to_thread</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span data-line="9"><span class="k">def</span><span class="w"> </span><span class="nf">my_handler</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span><span data-line="10">    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;hello&quot;</span><span class="p">:</span> <span class="s2">&quot;world&quot;</span><span class="p">}</span>
</span><span data-line="11">
</span><span data-line="12">
</span><span data-line="13"><span class="n">app</span> <span class="o">=</span> <span class="n">Litestar</span><span class="p">(</span>
</span><span data-line="14">    <span class="n">route_handlers</span><span class="o">=</span><span class="p">[</span><span class="n">my_handler</span><span class="p">],</span>
</span><span data-line="15">    <span class="n">logging_config</span><span class="o">=</span><span class="n">LoggingConfig</span><span class="p">(),</span>
</span><span data-line="16">    <span class="n">middleware</span><span class="o">=</span><span class="p">[</span><span class="n">logging_middleware_config</span><span class="o">.</span><span class="n">middleware</span><span class="p">],</span>
</span><span data-line="17"><span class="p">)</span>
</span></pre></div>
</div>
<p>The logging middleware uses the logger configuration defined on the application level, which allows for using any supported logging tool, depending on the configuration used
(see <a class="reference internal" href="../logging.html#logging-usage"><span class="std std-ref">logging configuration</span></a> for more details).</p>
<section id="obfuscating-logging-output">
<h3>Obfuscating Logging Output<a class="headerlink" href="#obfuscating-logging-output" title="Link to this heading">¶</a></h3>
<p>Sometimes certain data, e.g. request or response headers, needs to be obfuscated. This is supported by the middleware
configuration:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.middleware.logging</span><span class="w"> </span><span class="kn">import</span> <span class="n">LoggingMiddlewareConfig</span>
</span><span data-line="2">
</span><span data-line="3"><span class="n">logging_middleware_config</span> <span class="o">=</span> <span class="n">LoggingMiddlewareConfig</span><span class="p">(</span>
</span><span data-line="4">    <span class="n">request_cookies_to_obfuscate</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;my-custom-session-key&quot;</span><span class="p">},</span>
</span><span data-line="5">    <span class="n">response_cookies_to_obfuscate</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;my-custom-session-key&quot;</span><span class="p">},</span>
</span><span data-line="6">    <span class="n">request_headers_to_obfuscate</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;my-custom-header&quot;</span><span class="p">},</span>
</span><span data-line="7">    <span class="n">response_headers_to_obfuscate</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;my-custom-header&quot;</span><span class="p">},</span>
</span><span data-line="8"><span class="p">)</span>
</span></pre></div>
</div>
<p>The middleware will obfuscate the headers <code class="docutils literal notranslate"><span class="pre">Authorization</span></code> and <code class="docutils literal notranslate"><span class="pre">X-API-KEY</span></code> , and the cookie <code class="docutils literal notranslate"><span class="pre">session</span></code> by default.</p>
</section>
<section id="compression-and-logging-of-response-body">
<h3>Compression and Logging of Response Body<a class="headerlink" href="#compression-and-logging-of-response-body" title="Link to this heading">¶</a></h3>
<p>If both <a class="reference internal" href="../../reference/config.html#litestar.config.compression.CompressionConfig" title="litestar.config.compression.CompressionConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">CompressionConfig</span></code></a> and
<a class="reference internal" href="../../reference/middleware/logging.html#litestar.middleware.logging.LoggingMiddleware" title="litestar.middleware.logging.LoggingMiddleware"><code class="xref py py-class docutils literal notranslate"><span class="pre">LoggingMiddleware</span></code></a> have been defined for the application, the response
body will be omitted from response logging if it has been compressed, even if <code class="docutils literal notranslate"><span class="pre">&quot;body&quot;</span></code> has been included in
<a class="reference internal" href="../../reference/middleware/logging.html#litestar.middleware.logging.LoggingMiddlewareConfig.response_log_fields" title="litestar.middleware.logging.LoggingMiddlewareConfig.response_log_fields"><code class="xref py py-class docutils literal notranslate"><span class="pre">response_log_fields</span></code></a>. To force the body of
compressed responses to be logged, set
<a class="reference internal" href="../../reference/middleware/logging.html#litestar.middleware.logging.LoggingMiddlewareConfig.include_compressed_body" title="litestar.middleware.logging.LoggingMiddlewareConfig.include_compressed_body"><code class="xref py py-attr docutils literal notranslate"><span class="pre">include_compressed_body</span></code></a> to <code class="docutils literal notranslate"><span class="pre">True</span></code> , in
addition to including <code class="docutils literal notranslate"><span class="pre">&quot;body&quot;</span></code> in <code class="docutils literal notranslate"><span class="pre">response_log_fields</span></code>.</p>
</section>
</section>
<section id="session-middleware">
<h2>Session Middleware<a class="headerlink" href="#session-middleware" title="Link to this heading">¶</a></h2>
<p>Litestar includes a <a class="reference internal" href="../../reference/middleware/session/base.html#litestar.middleware.session.base.SessionMiddleware" title="litestar.middleware.session.base.SessionMiddleware"><code class="xref py py-class docutils literal notranslate"><span class="pre">SessionMiddleware</span></code></a>,
offering client- and server-side sessions. Server-side sessions are backed by Litestar’s
<a class="reference internal" href="../stores.html"><span class="doc">stores</span></a>, which offer support for:</p>
<ul class="simple">
<li><p>In memory sessions</p></li>
<li><p>File based sessions</p></li>
<li><p>Redis based sessions</p></li>
<li><p>Valkey based sessions</p></li>
<li><p>Database based <a class="reference external" href="https://docs.advanced-alchemy.litestar.dev/latest/usage/frameworks/litestar.html#session-middleware" title="(in advanced_alchemy)"><span>Session Middleware</span></a></p></li>
</ul>
<section id="setting-up-the-middleware">
<h3>Setting up the middleware<a class="headerlink" href="#setting-up-the-middleware" title="Link to this heading">¶</a></h3>
<p>To start using sessions in your application all you have to do is create an instance
of a <a class="reference internal" href="../../reference/middleware/session/base.html#litestar.middleware.session.base.BaseBackendConfig" title="litestar.middleware.session.base.BaseBackendConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">configuration</span></code></a> object and
add its middleware to your application’s middleware stack:</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">Hello World</span><a class="headerlink" href="#id3" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">os</span><span class="w"> </span><span class="kn">import</span> <span class="n">urandom</span>
</span><span data-line="2">
</span><span data-line="3"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar</span><span class="w"> </span><span class="kn">import</span> <span class="n">Litestar</span><span class="p">,</span> <span class="n">Request</span><span class="p">,</span> <span class="n">delete</span><span class="p">,</span> <span class="n">get</span><span class="p">,</span> <span class="n">post</span>
</span><span data-line="4"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.middleware.session.client_side</span><span class="w"> </span><span class="kn">import</span> <span class="n">CookieBackendConfig</span>
</span><span data-line="5">
</span><span data-line="6"><span class="c1"># we initialize to config with a 16 byte key, i.e. 128 a bit key.</span>
</span><span data-line="7"><span class="c1"># in real world usage we should inject the secret from the environment</span>
</span><span data-line="8"><span class="n">session_config</span> <span class="o">=</span> <span class="n">CookieBackendConfig</span><span class="p">(</span><span class="n">secret</span><span class="o">=</span><span class="n">urandom</span><span class="p">(</span><span class="mi">16</span><span class="p">))</span>  <span class="c1"># type: ignore[arg-type]</span>
</span><span data-line="9">
</span><span data-line="10">
</span><span data-line="11"><span class="nd">@get</span><span class="p">(</span><span class="s2">&quot;/session&quot;</span><span class="p">,</span> <span class="n">sync_to_thread</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span data-line="12"><span class="k">def</span><span class="w"> </span><span class="nf">check_session_handler</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span>
</span><span data-line="13"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Handler function that accesses request.session.&quot;&quot;&quot;</span>
</span><span data-line="14">    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;has_session&quot;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">session</span> <span class="o">!=</span> <span class="p">{}}</span>
</span><span data-line="15">
</span><span data-line="16">
</span><span data-line="17"><span class="nd">@post</span><span class="p">(</span><span class="s2">&quot;/session&quot;</span><span class="p">,</span> <span class="n">sync_to_thread</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span data-line="18"><span class="k">def</span><span class="w"> </span><span class="nf">create_session_handler</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="19"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Handler to set the session.&quot;&quot;&quot;</span>
</span><span data-line="20">    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">session</span><span class="p">:</span>
</span><span data-line="21">        <span class="c1"># value can be a dictionary or pydantic model</span>
</span><span data-line="22">        <span class="n">request</span><span class="o">.</span><span class="n">set_session</span><span class="p">({</span><span class="s2">&quot;username&quot;</span><span class="p">:</span> <span class="s2">&quot;moishezuchmir&quot;</span><span class="p">})</span>
</span><span data-line="23">
</span><span data-line="24">
</span><span data-line="25"><span class="nd">@delete</span><span class="p">(</span><span class="s2">&quot;/session&quot;</span><span class="p">,</span> <span class="n">sync_to_thread</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span data-line="26"><span class="k">def</span><span class="w"> </span><span class="nf">delete_session_handler</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="27"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Handler to clear the session.&quot;&quot;&quot;</span>
</span><span data-line="28">    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">session</span><span class="p">:</span>
</span><span data-line="29">        <span class="n">request</span><span class="o">.</span><span class="n">clear_session</span><span class="p">()</span>
</span><span data-line="30">
</span><span data-line="31">
</span><span data-line="32"><span class="n">app</span> <span class="o">=</span> <span class="n">Litestar</span><span class="p">(</span>
</span><span data-line="33">    <span class="n">route_handlers</span><span class="o">=</span><span class="p">[</span><span class="n">check_session_handler</span><span class="p">,</span> <span class="n">create_session_handler</span><span class="p">,</span> <span class="n">delete_session_handler</span><span class="p">],</span>
</span><span data-line="34">    <span class="n">middleware</span><span class="o">=</span><span class="p">[</span><span class="n">session_config</span><span class="o">.</span><span class="n">middleware</span><span class="p">],</span>
</span><span data-line="35"><span class="p">)</span>
</span></pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Since both client- and server-side sessions rely on cookies (one for storing the actual session
data, the other for storing the session ID), they share most of the cookie configuration.
A complete reference of the cookie configuration can be found at <a class="reference internal" href="../../reference/middleware/session/base.html#litestar.middleware.session.base.BaseBackendConfig" title="litestar.middleware.session.base.BaseBackendConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseBackendConfig</span></code></a>.</p>
</div>
</section>
<section id="client-side-sessions">
<h3>Client-side sessions<a class="headerlink" href="#client-side-sessions" title="Link to this heading">¶</a></h3>
<p>Client side sessions are available through the <a class="reference internal" href="../../reference/middleware/session/client_side.html#litestar.middleware.session.client_side.ClientSideSessionBackend" title="litestar.middleware.session.client_side.ClientSideSessionBackend"><code class="xref py py-class docutils literal notranslate"><span class="pre">ClientSideSessionBackend</span></code></a>,
which offers strong AES-CGM encryption security best practices while support cookie splitting.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p><code class="docutils literal notranslate"><span class="pre">ClientSideSessionBackend</span></code> requires the <a class="reference external" href="https://cryptography.io/en/latest/">cryptography</a> library,
which can be installed together with litestar as an extra using <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">'litestar[cryptography]'</span></code></p>
</div>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">cookie_backend.py</span></code></span><a class="headerlink" href="#id4" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">os</span><span class="w"> </span><span class="kn">import</span> <span class="n">urandom</span>
</span><span data-line="2">
</span><span data-line="3"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar</span><span class="w"> </span><span class="kn">import</span> <span class="n">Litestar</span>
</span><span data-line="4"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.middleware.session.client_side</span><span class="w"> </span><span class="kn">import</span> <span class="n">CookieBackendConfig</span>
</span><span data-line="5">
</span><span data-line="6"><span class="n">session_config</span> <span class="o">=</span> <span class="n">CookieBackendConfig</span><span class="p">(</span><span class="n">secret</span><span class="o">=</span><span class="n">urandom</span><span class="p">(</span><span class="mi">16</span><span class="p">))</span>  <span class="c1"># type: ignore</span>
</span><span data-line="7">
</span><span data-line="8"><span class="n">app</span> <span class="o">=</span> <span class="n">Litestar</span><span class="p">(</span><span class="n">middleware</span><span class="o">=</span><span class="p">[</span><span class="n">session_config</span><span class="o">.</span><span class="n">middleware</span><span class="p">])</span>
</span></pre></div>
</div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<ul class="simple">
<li><p><a class="reference internal" href="../../reference/middleware/session/client_side.html#litestar.middleware.session.client_side.CookieBackendConfig" title="litestar.middleware.session.client_side.CookieBackendConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">CookieBackendConfig</span></code></a></p></li>
</ul>
</div>
</section>
<section id="server-side-sessions">
<h3>Server-side sessions<a class="headerlink" href="#server-side-sessions" title="Link to this heading">¶</a></h3>
<p>Server side session store data - as the name suggests - on the server instead of the client.
They use a cookie containing a session ID which is a randomly generated string to identify a client
and load the appropriate data from the store</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span data-line="2">
</span><span data-line="3"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar</span><span class="w"> </span><span class="kn">import</span> <span class="n">Litestar</span>
</span><span data-line="4"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.middleware.session.server_side</span><span class="w"> </span><span class="kn">import</span> <span class="n">ServerSideSessionConfig</span>
</span><span data-line="5"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.stores.file</span><span class="w"> </span><span class="kn">import</span> <span class="n">FileStore</span>
</span><span data-line="6">
</span><span data-line="7"><span class="n">app</span> <span class="o">=</span> <span class="n">Litestar</span><span class="p">(</span>
</span><span data-line="8">    <span class="n">middleware</span><span class="o">=</span><span class="p">[</span><span class="n">ServerSideSessionConfig</span><span class="p">()</span><span class="o">.</span><span class="n">middleware</span><span class="p">],</span>
</span><span data-line="9">    <span class="n">stores</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;sessions&quot;</span><span class="p">:</span> <span class="n">FileStore</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;session_data&quot;</span><span class="p">))},</span>
</span><span data-line="10"><span class="p">)</span>
</span></pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<ul class="simple">
<li><p><a class="reference internal" href="../stores.html"><span class="doc">Stores</span></a></p></li>
<li><p><a class="reference internal" href="../../reference/middleware/session/server_side.html#litestar.middleware.session.server_side.ServerSideSessionConfig" title="litestar.middleware.session.server_side.ServerSideSessionConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">ServerSideSessionConfig</span></code></a></p></li>
</ul>
</div>
</section>
</section>
</section>

        </article><button class="back-to-top" type="button">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
  </svg>
  <span>Back to top</span>
</button><div class="navigation flex print:hidden"><div class="navigation-prev">
    <a href="using-middleware.html">
      <i class="i-lucide chevron-left"></i>
      <div class="page-info">
        <span>Previous</span><div class="title">Using Middleware</div></div>
    </a>
  </div><div class="navigation-next">
    <a href="creating-middleware.html">
      <div class="page-info">
        <span>Next</span>
        <div class="title">Creating Middleware</div>
      </div>
      <i class="i-lucide chevron-right"></i>
    </a>
  </div></div></div>
    </div>
  </main>
</div>
<footer class="sy-foot">
  <div class="sy-foot-inner sy-container mx-auto">
    <div class="sy-foot-reserved md:flex justify-between items-center">
      <div class="sy-foot-copyright"><p>2025, Litestar Organization</p>
  
  <p>
    Made with
    
    <a href="https://www.sphinx-doc.org/">Sphinx</a> and
    
    <a href="https://shibuya.lepture.com">Shibuya theme</a>.
  </p>
</div>
      <div class="sy-foot-socials">
<a href="https://twitter.com/LitestarAPI" aria-label="X (Twitter)">
  <iconify-icon icon="prime:twitter"></iconify-icon>
</a>
<a href="https://discord.gg/litestar" aria-label="Discord">
  <iconify-icon icon="simple-icons:discord"></iconify-icon>
</a>
<a href="https://www.reddit.com/r/LitestarAPI" aria-label="Reddit">
  <iconify-icon icon="simple-icons:reddit"></iconify-icon>
</a></div>
    </div>
  </div>
</footer>
      <script src="../../_static/documentation_options.js?v=ad404a94"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../_static/copybutton.js?v=f281be69"></script>
      <script src="../../_static/litestar-theme.js?v=ab2dcc9e"></script>
      <script>let toggleHintShow = 'Click to show';</script>
      <script>let toggleHintHide = 'Click to hide';</script>
      <script>let toggleOpenOnPrint = 'true';</script>
      <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
      <script src="../../_static/design-tabs.js?v=f930bc37"></script>
      <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
      <script src="../../_static/shibuya.js?v=c477d091"></script>
      <script src="../../_static/versioning.js?v=9ab184b9"></script></body>
</html>