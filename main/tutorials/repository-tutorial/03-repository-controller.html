<!DOCTYPE html>
<html lang="en" data-accent-color="amber" data-content_root="../../">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Working with Controllers and Repositories - Litestar Framework</title><link rel="shortcut icon" href="../../_static/favicon.svg"/><link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" /><link rel="next" title="Adding Additional Features to the Repository" href="04-repository-other.html" /><link rel="prev" title="Interacting with repositories" href="02-repository-introduction.html" /><script>
    function setColorMode(t){let e=document.documentElement;e.setAttribute("data-color-mode",t);let a=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,s=t;"auto"===t&&(s=a?"dark":"light"),"light"===s?(e.classList.remove("dark"),e.classList.add("light")):(e.classList.remove("light"),e.classList.add("dark"))}
    setColorMode(localStorage._theme||"auto");
  </script><link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=397bb51e" />
    <link rel="stylesheet" type="text/css" href="../../_static/shibuya.css?v=76b6f612" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx_paramlinks.css" />
    <link media="print" rel="stylesheet" type="text/css" href="../../_static/print.css?v=20ff2c19" />
    <link rel="stylesheet" type="text/css" href="../../_static/style.css?v=50ea2f63" />
    <link rel="stylesheet" type="text/css" href="../../_static/litestar-sphinx-theme.css?v=f8f74789" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --sy-f-text: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
  --sy-f-heading: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
}
</style>
    <meta property="og:type" content="website"/><meta property="og:title" content="Working with Controllers and Repositories"/>
<meta name="twitter:card" content="summary"/>
<meta property="og:image" content="_static/logo-light.png"/>
  </head>
<body><div class="announcement">
    <div class="announcement-inner">
      <p>You are viewing the <bold>local</bold> version of the documentation. Click here to go to the latest version.</p>
      <button class="announcement-close" aria-label="Close announcement">
        <i class="i-lucide close"></i>
      </button>
    </div>
  </div><div class="sy-head">
  <div class="sy-head-blur"></div>
  <div class="sy-head-inner sy-container mx-auto">
    <a class="sy-head-brand" href="/">
      <img class="light-logo" src="../../_static/logo-light.png" alt="Litestar" height="28" loading="lazy" />
      <img class="dark-logo" src="../../_static/logo-dark.png" alt="Litestar" height="28" loading="lazy" />
      <strong>Litestar</strong>
    </a>
    <div class="sy-head-nav" id="head-nav">
      <nav class="sy-head-links"><ul><li class="link"><a href="../../index.html">Home</a></li>
      <li class="link"><button class="js-menu" type="button" id="nav-trigger-2" aria-controls="nav-children-2">
            <span>Community</span>
            <i class="i-lucide chevron-down"></i>
          </button>
        <ul id="nav-children-2" aria-labelledby="nav-trigger-2"><li><a href="../../contribution-guide.html">
                <span>Contributing</span>
                <small>Learn how to contribute to the Litestar project</small>
              </a></li><li><a href="https://github.com/litestar-org/.github?tab=coc-ov-file">
                <span>Code of Conduct</span>
                <small>Review the etiquette for interacting with the Litestar community</small>
              </a></li><li><a href="https://github.com/litestar-org/.github?tab=coc-ov-file#security-ov-file">
                <span>Security</span>
                <small>Overview of Litestar's security protocols</small>
              </a></li></ul>
      </li>
      <li class="link"><button class="js-menu" type="button" id="nav-trigger-3" aria-controls="nav-children-3">
            <span>About</span>
            <i class="i-lucide chevron-down"></i>
          </button>
        <ul id="nav-children-3" aria-labelledby="nav-trigger-3"><li><a href="https://litestar.dev/about/organization">
                <span>Litestar Organization</span>
                <small>Details about the Litestar organization</small>
              </a></li><li><a href="https://litestar.dev/about/litestar-releases">
                <span>Releases</span>
                <small>Explore the release process, versioning, and deprecation policy for Litestar</small>
              </a></li></ul>
      </li>
      <li class="link"><button class="js-menu" type="button" id="nav-trigger-4" aria-controls="nav-children-4">
            <span>Release notes</span>
            <i class="i-lucide chevron-down"></i>
          </button>
        <ul id="nav-children-4" aria-labelledby="nav-trigger-4"><li><a href="../../release-notes/whats-new-3.html">
                <span>What's new in 3.0</span>
                <small>Explore the new features in Litestar 3.0</small>
              </a></li><li><a href="../../release-notes/changelog.html">
                <span>3.x Changelog</span>
                <small>All changes in the 3.x series</small>
              </a></li><li><a href="https://docs.litestar.dev/2/release-notes/changelog.html">
                <span>2.x Changelog</span>
                <small>All changes in the 2.x series</small>
              </a></li></ul>
      </li>
      <li class="link"><button class="js-menu" type="button" id="nav-trigger-5" aria-controls="nav-children-5">
            <span>Help</span>
            <i class="i-lucide chevron-down"></i>
          </button>
        <ul id="nav-children-5" aria-labelledby="nav-trigger-5"><li><a href="https://discord.gg/litestar">
                <span>Discord Help Forum</span>
                <small>Dedicated Discord help forum</small>
              </a></li><li><a href="https://github.com/orgs/litestar-org/discussions">
                <span>GitHub Discussions</span>
                <small>GitHub Discussions</small>
              </a></li><li><a href="https://stackoverflow.com/questions/tagged/litestar">
                <span>Stack Overflow</span>
                <small>We monitor the <code><b>litestar</b></code> tag on Stack Overflow</small>
              </a></li></ul>
      </li><li class="link">
          <a href="https://github.com/sponsors/Litestar-Org">
            <span>Sponsor</span></a>
        </li></ul></nav>
      <div class="sy-head-extra flex items-center print:hidden"><form class="searchbox flex items-center" action="../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <kbd>/</kbd>
</form><div class="nav-versions">
    <button type="button" aria-label="Versions">
      <span class="md:hidden">Versions</span>
      <span class="hidden md:inline">main</span>
      <i class="i-lucide chevron-down"></i>
    </button>
    <div class="nav-versions-choices"><ul><li><a href="/latest">latest</a></li><li><a href="/main">v3 (development)</a></li><li><a href="/2">v2</a></li><li><a href="/1">v1</a></li></ul></div>
  </div><div class="sy-head-socials">
<a href="https://twitter.com/LitestarAPI" aria-label="X (Twitter)">
  <iconify-icon icon="prime:twitter"></iconify-icon>
</a>
  <a href="https://discord.gg/litestar" aria-label="Discord">
    <iconify-icon icon="simple-icons:discord"></iconify-icon>
  </a></div></div>
    </div>
    <div class="sy-head-actions flex items-center shrink-0 print:hidden"><button class="js-theme theme-switch flex items-center"
data-aria-auto="Switch to light color mode"
data-aria-light="Switch to dark color mode"
data-aria-dark="Switch to auto color mode">
<i class="i-lucide theme-icon"></i>
</button><button class="md:hidden flex items-center js-menu" aria-label="Menu" type="button" aria-controls="head-nav" aria-expanded="false">
        <div class="hamburger">
          <span class="hamburger_1"></span>
          <span class="hamburger_2 -translate-x-2"></span>
          <span class="hamburger_3 -translate-x-1"></span>
        </div>
      </button>
    </div>
  </div>
</div>
<div class="sy-page sy-container flex mx-auto">
  <aside id="lside" class="sy-lside md:w-72 md:shrink-0 print:hidden">
    <div class="sy-lside-inner md:sticky">
      <div class="sy-scrollbar p-6"><div class="sidebar-links">
  <ul>
    <li><a class="icon-link" href="https://github.com/orgs/litestar-org/discussions">
  <span class="icon">
    <svg viewBox="0 0 24 24" fill="none">
      <path fill="var(--accent-9)" fill-rule="evenodd" clip-rule="evenodd" d="M11 5a6 6 0 0 0-4.687 9.746c.215.27.315.62.231.954l-.514 2.058a1 1 0 0 0 1.485 1.1l2.848-1.71c.174-.104.374-.15.576-.148H13a6 6 0 0 0 0-12h-2Z"/>
      <circle fill="white" cx="12" cy="11" r="1"/>
      <circle fill="white" cx="9" cy="11" r="1"/>
      <circle fill="white" cx="15" cy="11" r="1"/>
    </svg>
  </span>
  <span class="text">Discussion</span>
</a></li>
  </ul>
</div>
        <div class="globaltoc" data-expand-depth="0"><p class="caption" role="heading" aria-level="3"><span class="caption-text">Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage/index.html">Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../usage/applications.html">Applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/routing/index.html">Routing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../usage/routing/overview.html">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/routing/handlers.html">Route handlers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/routing/parameters.html">Parameters</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/requests.html">Requests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/caching.html">Caching</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/channels.html">Channels</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/cli.html">CLI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/databases/index.html">Databases</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../usage/databases/sqlalchemy/index.html">SQLAlchemy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../usage/databases/sqlalchemy/models_and_repository.html">SQLAlchemy Models &amp; Repository</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../usage/databases/sqlalchemy/plugins/index.html">Plugins</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/databases/piccolo.html">Piccolo ORM</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/debugging.html">Debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/dependency-injection.html">Dependency Injection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/dto/index.html">Data Transfer Object (DTO)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../usage/dto/0-basic-use.html">Basic Use</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/dto/1-abstract-dto.html">AbstractDTO</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/dto/2-creating-custom-dto-classes.html">Implementing Custom DTO Classes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/events.html">Events</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/exceptions.html">Exceptions and exception handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/file_systems.html">File Systems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/htmx.html">HTMX</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/lifecycle-hooks.html">Life Cycle Hooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/logging.html">Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/metrics/index.html">Metrics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../usage/metrics/open-telemetry.html">OpenTelemetry</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/metrics/prometheus.html">Prometheus</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/middleware/index.html">Middleware</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../usage/middleware/using-middleware.html">Using Middleware</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/middleware/builtin-middleware.html">Built-in middleware</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/middleware/creating-middleware.html">Creating Middleware</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/openapi/index.html">OpenAPI</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../usage/openapi/schema_generation.html">Configuring schema generation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/openapi/schema_generation.html#configuring-schema-generation-on-a-route-handler">Configuring schema generation on a route handler</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/openapi/schema_generation.html#accessing-the-openapi-schema-in-code">Accessing the OpenAPI schema in code</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/openapi/schema_generation.html#customizing-pydantic-model-schemas">Customizing Pydantic model schemas</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/openapi/schema_generation.html#customizing-operation-class">Customizing <code class="docutils literal notranslate"><span class="pre">Operation</span></code> class</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/openapi/schema_generation.html#generating-examples">Generating examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/openapi/ui_plugins.html">OpenAPI UI Plugins</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/openapi/ui_plugins.html#using-openapi-ui-plugins">Using OpenAPI UI Plugins</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/openapi/ui_plugins.html#configuring-openapi-ui-plugins">Configuring OpenAPI UI Plugins</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/openapi/ui_plugins.html#configuring-the-openapi-root-path">Configuring the OpenAPI Root Path</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/openapi/ui_plugins.html#building-your-own-openapi-ui-plugin">Building your own OpenAPI UI Plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/openapi/ui_plugins.html#interacting-with-the-router">Interacting with the <code class="docutils literal notranslate"><span class="pre">Router</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/openapi/ui_plugins.html#oauth2-in-swagger-ui">OAuth2 in Swagger UI</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/openapi/ui_plugins.html#customizing-the-openapi-ui">Customizing the OpenAPI UI</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/openapi/ui_plugins.html#cdn-and-offline-file-support">CDN and offline file support</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/plugins/index.html">Plugins</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../usage/plugins/flash_messages.html">Flash Messages</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/plugins/problem_details.html">Problem Details</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/responses.html">Responses</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/security/index.html">Security</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../usage/security/abstract-authentication-middleware.html">Implementing Custom Authentication</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/security/security-backends.html">Security Backends</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/security/guards.html">Guards</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/security/excluding-and-including-endpoints.html">Excluding and including endpoints</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/security/jwt.html">JWT Security Backends</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/security/secret-datastructures.html">Handling Secrets</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/static-files.html">Static files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/custom-types.html">Custom types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/stores.html">Stores</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/templating.html">Templating</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/testing.html">Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/websockets.html">WebSockets</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/index.html">API reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../reference/app.html">app</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/background_tasks.html">background_tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/channels/index.html">channels</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/channels/plugin.html">plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/channels/subscriber.html">subscriber</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/channels/backends/index.html">backends</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference/channels/backends/base.html">base</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/channels/backends/memory.html">memory</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/channels/backends/redis.html">redis</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/channels/backends/psycopg.html">psycopg</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/channels/backends/asyncpg.html">asyncpg</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/cli.html">cli</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/config.html">config</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/connection.html">connection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/contrib/index.html">contrib</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/contrib/jinja.html">jinja</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/contrib/mako.html">mako</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/contrib/opentelemetry.html">opentelemetry</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/controller.html">controller</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/concurrency.html">concurrency</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/data_extractors.html">data_extractors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/datastructures/index.html">datastructures</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/datastructures/secret_values.html">secret_values</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/di.html">di</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/dto/index.html">dto</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/dto/config.html">config</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/dto/data_structures.html">data_structures</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/dto/field.html">field</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/dto/types.html">types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/dto/base_dto.html">base_dto</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/dto/msgspec_dto.html">msgspec_dto</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/dto/dataclass_dto.html">dataclass_dto</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/enums.html">enums</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/events.html">events</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/exceptions.html">exceptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/file_system.html">file_system</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/handlers.html">handlers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/logging/index.html">logging</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/logging/config.html">config</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/logging/picologging.html">picologging</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/logging/standard.html">standard</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/middleware/index.html">middleware</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/middleware/allowed_hosts.html">allowed_hosts</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/middleware/authentication.html">authentication</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/middleware/compression.html">compression</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/middleware/csrf.html">csrf</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/middleware/logging.html">logging</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/middleware/rate_limit.html">rate_limit</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/middleware/session/index.html">session</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference/middleware/session/base.html">base</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/middleware/session/client_side.html">client_side</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/middleware/session/server_side.html">server_side</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/middleware/constraints.html">constraints</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/openapi/index.html">openapi</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/openapi/openapi.html">openapi</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/openapi/plugins.html">plugins</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/openapi/spec.html">spec</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/pagination.html">pagination</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/params.html">params</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/plugins/index.html">plugins</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/plugins/attrs.html">attrs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/plugins/flash_messages.html">flash</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/plugins/htmx.html">htmx</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/plugins/problem_details.html">problem details</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/plugins/prometheus.html">prometheus</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/plugins/pydantic.html">pydantic</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/plugins/structlog.html">structlog</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/repository/index.html">repository</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/repository/abc.html">abc</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/repository/filters.html">filters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/repository/exceptions.html">exceptions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/repository/testing.html">testing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/repository/handlers.html">handlers</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/response/index.html">response</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/response/base.html">base</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/response/file.html">file</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/response/redirect.html">redirect</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/response/streaming.html">streaming</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/response/sse.html">SSE (Server Sent Events)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/response/template.html">template</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/router.html">router</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/routes.html">routes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/security/index.html">security</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/security/jwt.html">jwt</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/security/session_auth.html">session_auth</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/serialization.html">serialization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/static_files.html">static_files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/status_codes.html">status_code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/stores/index.html">stores</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/stores/base.html">base</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/stores/file.html">file</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/stores/memory.html">memory</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/stores/redis.html">redis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/stores/registry.html">registry</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/stores/valkey.html">valkey</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/template.html">template</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/testing.html">testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/types.html">types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/typing.html">typing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../benchmarks.html">Benchmarks</a></li>
</ul>
<p class="caption" role="heading" aria-level="3"><span class="caption-text">Guides</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../migration/index.html">Migrating to Litestar</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../migration/flask.html">From Flask</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../migration/fastapi.html">From Starlette / FastAPI</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../topics/index.html">Topics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../topics/sync-vs-async.html">Sync vs. Async</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../topics/deployment/index.html">Deployment</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../topics/deployment/manually-with-asgi-server.html">Manually with ASGI server</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../topics/deployment/docker.html">Docker</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../topics/deployment/supervisor.html">Supervisor (Linux)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../todo-app/index.html">Developing a basic TODO application</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../todo-app/0-application-basics.html">Application basics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../todo-app/1-accessing-the-list.html">Accessing the list</a></li>
<li class="toctree-l3"><a class="reference internal" href="../todo-app/2-interacting-with-the-list.html">Making the list interactive</a></li>
<li class="toctree-l3"><a class="reference internal" href="../todo-app/3-assembling-the-app.html">Recap and assembling the final application</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../sqlalchemy/index.html">Improving the TODO app with SQLAlchemy</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../sqlalchemy/0-introduction.html">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sqlalchemy/1-provide-session-with-di.html">Providing the session with DI</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sqlalchemy/2-serialization-plugin.html">Using the serialization plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sqlalchemy/3-init-plugin.html">Using the init plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sqlalchemy/4-final-touches-and-recap.html">Final touches and recap</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../dto-tutorial/index.html">Data Transfer Object Tutorial</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../dto-tutorial/01-simple-dto-exclude.html">Our first DTO</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dto-tutorial/02-nested-exclude.html">Excluding from nested models</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dto-tutorial/03-nested-collection-exclude.html">Excluding from collections of nested models</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dto-tutorial/04-max-nested-depth.html">Max nested depth</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dto-tutorial/05-renaming-fields.html">Renaming fields</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dto-tutorial/06-receiving-data.html">Receiving data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dto-tutorial/07-read-only-fields.html">Read only fields</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dto-tutorial/08-dto-data.html">Accessing the data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dto-tutorial/09-updating.html">Updating instances</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dto-tutorial/10-layered-dto-declarations.html">Declaring DTOs on app layers</a></li>
</ul>
</li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">SQLAlchemy Repository Tutorial</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="01-modelling-and-features.html">Introduction to Database Modelling and Repository Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="01-modelling-and-features.html#modelling">Modelling</a></li>
<li class="toctree-l3"><a class="reference internal" href="01-modelling-and-features.html#full-code">Full Code</a></li>
<li class="toctree-l3"><a class="reference internal" href="02-repository-introduction.html">Interacting with repositories</a></li>
<li class="toctree-l3"><a class="reference internal" href="02-repository-introduction.html#working-with-bulk-data-operations">Working with Bulk Data Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="02-repository-introduction.html#full-code">Full Code</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Working with Controllers and Repositories</a></li>
<li class="toctree-l3"><a class="reference internal" href="#full-code">Full Code</a></li>
<li class="toctree-l3"><a class="reference internal" href="04-repository-other.html">Adding Additional Features to the Repository</a></li>
<li class="toctree-l3"><a class="reference internal" href="04-repository-other.html#slug-fields">Slug Fields</a></li>
<li class="toctree-l3"><a class="reference internal" href="04-repository-other.html#full-code">Full Code</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading" aria-level="3"><span class="caption-text">Contributing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contribution-guide.html">Contribution Guide</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/search?q=user%3Alitestar-org+state%3Aopen+label%3A%22good+first+issue%22+++no%3Aassignee+&amp;type=issues=">Available Issues</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/litestar-org/.github?tab=coc-ov-file#readme">Code of Conduct</a></li>
</ul>

        </div>
      </div>
    </div>
  </aside>
  <div class="lside-overlay js-menu" role="button" aria-label="Close left sidebar" aria-controls="lside" aria-expanded="false"></div>
  <aside id="rside" class="sy-rside pb-3 w-64 shrink-0 order-last">
    <button class="rside-close js-menu xl:hidden" aria-label="Close Table of Contents" type="button" aria-controls="rside" aria-expanded="false">
      <i class="i-lucide close"></i>
    </button>
    <div class="sy-scrollbar sy-rside-inner px-6 xl:top-16 xl:sticky xl:pl-0 pt-6 pb-4"><div class="localtoc"><h3>On this page</h3><ul>
<li><a class="reference internal" href="#">Working with Controllers and Repositories</a></li>
<li><a class="reference internal" href="#full-code">Full Code</a></li>
</ul>
</div><a class="js-repo-stats repo-stats flex items-center" href="https://github.com/litestar-org/litestar"
  data-type="github" data-user="litestar-org" data-repo="litestar">
  <span class="w-8 flex items-center justify-around shrink-0 text-3xl">
    <iconify-icon icon="simple-icons:github"></iconify-icon>
  </span>
  <span class="flex-grow px-2 break-all">
    <span>litestar-org/litestar</span>
    <span class="flex text-sm repo-stats-count">
      <span class="flex items-center pr-3">
        <iconify-icon icon="lucide:star"></iconify-icon>
        <strong class="js-repo-stars ml-1">0</strong>
      </span>
      <span class="flex items-center">
        <iconify-icon icon="lucide:git-fork"></iconify-icon>
        <strong class="js-repo-forks ml-1">0</strong>
      </span>
    </span>
  </span>
</a><div class="edit-this-page">
  <a href="https://github.com/litestar-org/litestar/blob/main/docs/tutorials/repository-tutorial/03-repository-controller.rst">Edit this page</a>
</div><div id="ethical-ad-placement" data-ea-publisher="readthedocs"></div></div>
  </aside>
  <div class="rside-overlay js-menu" role="button" aria-label="Close Table of Contents" aria-controls="rside" aria-expanded="false"></div>
  <main class="sy-main w-full max-sm:max-w-full print:pt-6">
<div class="sy-breadcrumbs" role="navigation">
  <div class="sy-breadcrumbs-inner flex items-center">
    <div class="md:hidden mr-3">
      <button class="js-menu" aria-label="Menu" type="button" aria-controls="lside" aria-expanded="false">
        <i class="i-lucide menu"></i>
      </button>
    </div>
    <ol class="flex-1" itemscope itemtype="https://schema.org/BreadcrumbList"><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="../../index.html"><span itemprop="name">Litestar</span></a>
        <span>/</span>
        <meta itemprop="position" content="1" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="../index.html"><span itemprop="name">Tutorials</span></a>
        <span>/</span>
        <meta itemprop="position" content="2" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="index.html"><span itemprop="name">SQLAlchemy Repository Tutorial</span></a>
        <span>/</span>
        <meta itemprop="position" content="3" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <strong itemprop="name">Working with Controllers and Repositories</strong>
        <meta itemprop="position" content="4" />
      </li></ol>
    <div class="xl:hidden ml-1">
      <button class="js-menu" aria-label="Show table of contents" type="button" aria-controls="rside"
        aria-expanded="false">
        <i class="i-lucide outdent"></i>
      </button>
    </div>
  </div>
</div><div class="flex flex-col break-words justify-between">
      <div class="min-w-0 max-w-6xl px-6 pb-6 pt-8 xl:px-12">
        <article class="yue" role="main">
          <section id="working-with-controllers-and-repositories">
<h1>Working with Controllers and Repositories<a class="headerlink" href="#working-with-controllers-and-repositories" title="Link to this heading">¶</a></h1>
<p>We’ve been working our way up the stack, starting with the database models, and now we
are ready to use the repository in an actual route.  Let’s see how we can use this in a
controller.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The full code for this tutorial can be found below in the <a class="reference internal" href="#repo-full-code"><span class="std std-ref">Full Code</span></a> section.</p>
</div>
<p>First, we create a simple function that returns an instance of <code class="docutils literal notranslate"><span class="pre">AuthorRepository</span></code>.
This function will be used to inject a repository instance into our controller routes.
Note that we are only passing in the database session in this example with no other
parameters.</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">app.py</span></code></span><a class="headerlink" href="#id1" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="linenos">1</span><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">provide_authors_repo</span><span class="p">(</span><span class="n">db_session</span><span class="p">:</span> <span class="n">AsyncSession</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AuthorRepository</span><span class="p">:</span>
</span><span data-line="2"><span class="linenos">2</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;This provides the default Authors repository.&quot;&quot;&quot;</span>
</span><span data-line="3"><span class="linenos">3</span>    <span class="k">return</span> <span class="n">AuthorRepository</span><span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="n">db_session</span><span class="p">)</span>
</span></pre></div>
</div>
</div>
<p>Because we’ll be using the SQLAlchemy plugin in Litestar, the session is automatically
configured as a dependency.</p>
<p>By default, the repository doesn’t add any additional query options to your base
statement, but provides the flexibility to override it, allowing you to pass your own
statement:</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">app.py</span></code></span><a class="headerlink" href="#id2" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="linenos">1</span><span class="c1"># we can optionally override the default `select` used for the repository to pass in</span>
</span><span data-line="2"><span class="linenos">2</span><span class="c1"># specific SQL options such as join details</span>
</span><span data-line="3"><span class="linenos">3</span><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">provide_author_details_repo</span><span class="p">(</span><span class="n">db_session</span><span class="p">:</span> <span class="n">AsyncSession</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AuthorRepository</span><span class="p">:</span>
</span><span data-line="4"><span class="linenos">4</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;This provides a simple example demonstrating how to override the join options for the repository.&quot;&quot;&quot;</span>
</span><span data-line="5"><span class="linenos">5</span>    <span class="k">return</span> <span class="n">AuthorRepository</span><span class="p">(</span>
</span><span data-line="6"><span class="linenos">6</span>        <span class="n">statement</span><span class="o">=</span><span class="n">select</span><span class="p">(</span><span class="n">AuthorModel</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">selectinload</span><span class="p">(</span><span class="n">AuthorModel</span><span class="o">.</span><span class="n">books</span><span class="p">)),</span>
</span><span data-line="7"><span class="linenos">7</span>        <span class="n">session</span><span class="o">=</span><span class="n">db_session</span><span class="p">,</span>
</span><span data-line="8"><span class="linenos">8</span>    <span class="p">)</span>
</span></pre></div>
</div>
</div>
<p>In this instance, we enhance the repository function by adding a <code class="docutils literal notranslate"><span class="pre">selectinload</span></code>
option. This option configures the specified relationship to load via
<cite>SELECT .. IN …</cite> loading pattern, optimizing the query execution.</p>
<p>Next, we define the <code class="docutils literal notranslate"><span class="pre">AuthorController</span></code>. This controller exposes five routes for
interacting with the <code class="docutils literal notranslate"><span class="pre">Author</span></code> model:</p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
<span class="sd-summary-text"><code class="docutils literal notranslate"><span class="pre">AuthorController</span></code> (click to toggle)</span><span class="sd-summary-state-marker sd-summary-chevron-right"><svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-right" viewBox="0 0 24 24" aria-hidden="true"><path d="M8.72 18.78a.75.75 0 0 1 0-1.06L14.44 12 8.72 6.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0Z"></path></svg></span></summary><div class="sd-summary-content sd-card-body docutils">
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">app.py</span></code></span><a class="headerlink" href="#id3" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="linenos"> 1</span><span class="k">class</span><span class="w"> </span><span class="nc">AuthorController</span><span class="p">(</span><span class="n">Controller</span><span class="p">):</span>
</span><span data-line="2"><span class="linenos"> 2</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Author CRUD&quot;&quot;&quot;</span>
</span><span data-line="3"><span class="linenos"> 3</span>
</span><span data-line="4"><span class="linenos"> 4</span>    <span class="n">dependencies</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;authors_repo&quot;</span><span class="p">:</span> <span class="n">Provide</span><span class="p">(</span><span class="n">provide_authors_repo</span><span class="p">)}</span>
</span><span data-line="5"><span class="linenos"> 5</span>
</span><span data-line="6"><span class="linenos"> 6</span>    <span class="nd">@get</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;/authors&quot;</span><span class="p">)</span>
</span><span data-line="7"><span class="linenos"> 7</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">list_authors</span><span class="p">(</span>
</span><span data-line="8"><span class="linenos"> 8</span>        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="9"><span class="linenos"> 9</span>        <span class="n">authors_repo</span><span class="p">:</span> <span class="n">AuthorRepository</span><span class="p">,</span>
</span><span data-line="10"><span class="linenos">10</span>        <span class="n">limit_offset</span><span class="p">:</span> <span class="n">filters</span><span class="o">.</span><span class="n">LimitOffset</span><span class="p">,</span>
</span><span data-line="11"><span class="linenos">11</span>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OffsetPagination</span><span class="p">[</span><span class="n">Author</span><span class="p">]:</span>
</span><span data-line="12"><span class="linenos">12</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;List authors.&quot;&quot;&quot;</span>
</span><span data-line="13"><span class="linenos">13</span>        <span class="n">results</span><span class="p">,</span> <span class="n">total</span> <span class="o">=</span> <span class="k">await</span> <span class="n">authors_repo</span><span class="o">.</span><span class="n">list_and_count</span><span class="p">(</span><span class="n">limit_offset</span><span class="p">)</span>
</span><span data-line="14"><span class="linenos">14</span>        <span class="n">type_adapter</span> <span class="o">=</span> <span class="n">TypeAdapter</span><span class="p">(</span><span class="nb">list</span><span class="p">[</span><span class="n">Author</span><span class="p">])</span>
</span><span data-line="15"><span class="linenos">15</span>        <span class="k">return</span> <span class="n">OffsetPagination</span><span class="p">[</span><span class="n">Author</span><span class="p">](</span>
</span><span data-line="16"><span class="linenos">16</span>            <span class="n">items</span><span class="o">=</span><span class="n">type_adapter</span><span class="o">.</span><span class="n">validate_python</span><span class="p">(</span><span class="n">results</span><span class="p">),</span>
</span><span data-line="17"><span class="linenos">17</span>            <span class="n">total</span><span class="o">=</span><span class="n">total</span><span class="p">,</span>
</span><span data-line="18"><span class="linenos">18</span>            <span class="n">limit</span><span class="o">=</span><span class="n">limit_offset</span><span class="o">.</span><span class="n">limit</span><span class="p">,</span>
</span><span data-line="19"><span class="linenos">19</span>            <span class="n">offset</span><span class="o">=</span><span class="n">limit_offset</span><span class="o">.</span><span class="n">offset</span><span class="p">,</span>
</span><span data-line="20"><span class="linenos">20</span>        <span class="p">)</span>
</span><span data-line="21"><span class="linenos">21</span>
</span><span data-line="22"><span class="linenos">22</span>    <span class="nd">@post</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;/authors&quot;</span><span class="p">)</span>
</span><span data-line="23"><span class="linenos">23</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">create_author</span><span class="p">(</span>
</span><span data-line="24"><span class="linenos">24</span>        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="25"><span class="linenos">25</span>        <span class="n">authors_repo</span><span class="p">:</span> <span class="n">AuthorRepository</span><span class="p">,</span>
</span><span data-line="26"><span class="linenos">26</span>        <span class="n">data</span><span class="p">:</span> <span class="n">AuthorCreate</span><span class="p">,</span>
</span><span data-line="27"><span class="linenos">27</span>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Author</span><span class="p">:</span>
</span><span data-line="28"><span class="linenos">28</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new author.&quot;&quot;&quot;</span>
</span><span data-line="29"><span class="linenos">29</span>        <span class="n">obj</span> <span class="o">=</span> <span class="k">await</span> <span class="n">authors_repo</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
</span><span data-line="30"><span class="linenos">30</span>            <span class="n">AuthorModel</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">exclude_unset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exclude_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)),</span>
</span><span data-line="31"><span class="linenos">31</span>        <span class="p">)</span>
</span><span data-line="32"><span class="linenos">32</span>        <span class="k">await</span> <span class="n">authors_repo</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span><span data-line="33"><span class="linenos">33</span>        <span class="k">return</span> <span class="n">Author</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</span><span data-line="34"><span class="linenos">34</span>
</span><span data-line="35"><span class="linenos">35</span>    <span class="c1"># we override the authors_repo to use the version that joins the Books in</span>
</span><span data-line="36"><span class="linenos">36</span>    <span class="nd">@get</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;/authors/{author_id:uuid}&quot;</span><span class="p">,</span> <span class="n">dependencies</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;authors_repo&quot;</span><span class="p">:</span> <span class="n">Provide</span><span class="p">(</span><span class="n">provide_author_details_repo</span><span class="p">)})</span>
</span><span data-line="37"><span class="linenos">37</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_author</span><span class="p">(</span>
</span><span data-line="38"><span class="linenos">38</span>        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="39"><span class="linenos">39</span>        <span class="n">authors_repo</span><span class="p">:</span> <span class="n">AuthorRepository</span><span class="p">,</span>
</span><span data-line="40"><span class="linenos">40</span>        <span class="n">author_id</span><span class="p">:</span> <span class="n">UUID</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span>
</span><span data-line="41"><span class="linenos">41</span>            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Author ID&quot;</span><span class="p">,</span>
</span><span data-line="42"><span class="linenos">42</span>            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The author to retrieve.&quot;</span><span class="p">,</span>
</span><span data-line="43"><span class="linenos">43</span>        <span class="p">),</span>
</span><span data-line="44"><span class="linenos">44</span>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Author</span><span class="p">:</span>
</span><span data-line="45"><span class="linenos">45</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get an existing author.&quot;&quot;&quot;</span>
</span><span data-line="46"><span class="linenos">46</span>        <span class="n">obj</span> <span class="o">=</span> <span class="k">await</span> <span class="n">authors_repo</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">author_id</span><span class="p">)</span>
</span><span data-line="47"><span class="linenos">47</span>        <span class="k">return</span> <span class="n">Author</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</span><span data-line="48"><span class="linenos">48</span>
</span><span data-line="49"><span class="linenos">49</span>    <span class="nd">@patch</span><span class="p">(</span>
</span><span data-line="50"><span class="linenos">50</span>        <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/authors/{author_id:uuid}&quot;</span><span class="p">,</span>
</span><span data-line="51"><span class="linenos">51</span>        <span class="n">dependencies</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;authors_repo&quot;</span><span class="p">:</span> <span class="n">Provide</span><span class="p">(</span><span class="n">provide_author_details_repo</span><span class="p">)},</span>
</span><span data-line="52"><span class="linenos">52</span>    <span class="p">)</span>
</span><span data-line="53"><span class="linenos">53</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">update_author</span><span class="p">(</span>
</span><span data-line="54"><span class="linenos">54</span>        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="55"><span class="linenos">55</span>        <span class="n">authors_repo</span><span class="p">:</span> <span class="n">AuthorRepository</span><span class="p">,</span>
</span><span data-line="56"><span class="linenos">56</span>        <span class="n">data</span><span class="p">:</span> <span class="n">AuthorUpdate</span><span class="p">,</span>
</span><span data-line="57"><span class="linenos">57</span>        <span class="n">author_id</span><span class="p">:</span> <span class="n">UUID</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span>
</span><span data-line="58"><span class="linenos">58</span>            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Author ID&quot;</span><span class="p">,</span>
</span><span data-line="59"><span class="linenos">59</span>            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The author to update.&quot;</span><span class="p">,</span>
</span><span data-line="60"><span class="linenos">60</span>        <span class="p">),</span>
</span><span data-line="61"><span class="linenos">61</span>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Author</span><span class="p">:</span>
</span><span data-line="62"><span class="linenos">62</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Update an author.&quot;&quot;&quot;</span>
</span><span data-line="63"><span class="linenos">63</span>        <span class="n">raw_obj</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">exclude_unset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exclude_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span data-line="64"><span class="linenos">64</span>        <span class="n">raw_obj</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">author_id</span><span class="p">})</span>
</span><span data-line="65"><span class="linenos">65</span>        <span class="n">obj</span> <span class="o">=</span> <span class="k">await</span> <span class="n">authors_repo</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">AuthorModel</span><span class="p">(</span><span class="o">**</span><span class="n">raw_obj</span><span class="p">))</span>
</span><span data-line="66"><span class="linenos">66</span>        <span class="k">await</span> <span class="n">authors_repo</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span><span data-line="67"><span class="linenos">67</span>        <span class="k">return</span> <span class="n">Author</span><span class="o">.</span><span class="n">from_orm</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</span><span data-line="68"><span class="linenos">68</span>
</span><span data-line="69"><span class="linenos">69</span>    <span class="nd">@delete</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;/authors/{author_id:uuid}&quot;</span><span class="p">)</span>
</span><span data-line="70"><span class="linenos">70</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">delete_author</span><span class="p">(</span>
</span><span data-line="71"><span class="linenos">71</span>        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="72"><span class="linenos">72</span>        <span class="n">authors_repo</span><span class="p">:</span> <span class="n">AuthorRepository</span><span class="p">,</span>
</span><span data-line="73"><span class="linenos">73</span>        <span class="n">author_id</span><span class="p">:</span> <span class="n">UUID</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span>
</span><span data-line="74"><span class="linenos">74</span>            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Author ID&quot;</span><span class="p">,</span>
</span><span data-line="75"><span class="linenos">75</span>            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The author to delete.&quot;</span><span class="p">,</span>
</span><span data-line="76"><span class="linenos">76</span>        <span class="p">),</span>
</span><span data-line="77"><span class="linenos">77</span>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="78"><span class="linenos">78</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete a author from the system.&quot;&quot;&quot;</span>
</span><span data-line="79"><span class="linenos">79</span>        <span class="n">_</span> <span class="o">=</span> <span class="k">await</span> <span class="n">authors_repo</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">author_id</span><span class="p">)</span>
</span><span data-line="80"><span class="linenos">80</span>        <span class="k">await</span> <span class="n">authors_repo</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span></pre></div>
</div>
</div>
</div>
</details><p>In our list detail endpoint, we use the pagination filter for limiting the amount of
data returned, allowing us to retrieve large datasets in smaller, more manageable chunks.</p>
<p>In the above examples, we’ve used the asynchronous repository implementation. However,
Litestar also supports synchronous database drivers with an identical implementation.
Here’s a corresponding synchronous version of the previous example:</p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
<span class="sd-summary-text">Synchronous Repository (click to toggle)</span><span class="sd-summary-state-marker sd-summary-chevron-right"><svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-right" viewBox="0 0 24 24" aria-hidden="true"><path d="M8.72 18.78a.75.75 0 0 1 0-1.06L14.44 12 8.72 6.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0Z"></path></svg></span></summary><div class="sd-summary-content sd-card-body docutils">
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">app.py</span></code></span><a class="headerlink" href="#id4" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="linenos">  1</span><span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">annotations</span>
</span><span data-line="2"><span class="linenos">  2</span>
</span><span data-line="3"><span class="linenos">  3</span><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">date</span>
</span><span data-line="4"><span class="linenos">  4</span><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">TYPE_CHECKING</span>
</span><span data-line="5"><span class="linenos">  5</span><span class="kn">from</span><span class="w"> </span><span class="nn">uuid</span><span class="w"> </span><span class="kn">import</span> <span class="n">UUID</span>
</span><span data-line="6"><span class="linenos">  6</span>
</span><span data-line="7"><span class="linenos">  7</span><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span> <span class="k">as</span> <span class="n">_BaseModel</span>
</span><span data-line="8"><span class="linenos">  8</span><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">TypeAdapter</span>
</span><span data-line="9"><span class="linenos">  9</span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">ForeignKey</span><span class="p">,</span> <span class="n">select</span>
</span><span data-line="10"><span class="linenos"> 10</span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">Mapped</span><span class="p">,</span> <span class="n">mapped_column</span><span class="p">,</span> <span class="n">relationship</span><span class="p">,</span> <span class="n">selectinload</span>
</span><span data-line="11"><span class="linenos"> 11</span>
</span><span data-line="12"><span class="linenos"> 12</span><span class="kn">from</span><span class="w"> </span><span class="nn">litestar</span><span class="w"> </span><span class="kn">import</span> <span class="n">Litestar</span><span class="p">,</span> <span class="n">get</span>
</span><span data-line="13"><span class="linenos"> 13</span><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.controller</span><span class="w"> </span><span class="kn">import</span> <span class="n">Controller</span>
</span><span data-line="14"><span class="linenos"> 14</span><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.di</span><span class="w"> </span><span class="kn">import</span> <span class="n">Provide</span>
</span><span data-line="15"><span class="linenos"> 15</span><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.handlers.http_handlers.decorators</span><span class="w"> </span><span class="kn">import</span> <span class="n">delete</span><span class="p">,</span> <span class="n">patch</span><span class="p">,</span> <span class="n">post</span>
</span><span data-line="16"><span class="linenos"> 16</span><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.pagination</span><span class="w"> </span><span class="kn">import</span> <span class="n">OffsetPagination</span>
</span><span data-line="17"><span class="linenos"> 17</span><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.params</span><span class="w"> </span><span class="kn">import</span> <span class="n">Parameter</span>
</span><span data-line="18"><span class="linenos"> 18</span><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.plugins.sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span data-line="19"><span class="linenos"> 19</span>    <span class="n">SQLAlchemyInitPlugin</span><span class="p">,</span>
</span><span data-line="20"><span class="linenos"> 20</span>    <span class="n">SQLAlchemySyncConfig</span><span class="p">,</span>
</span><span data-line="21"><span class="linenos"> 21</span>    <span class="n">base</span><span class="p">,</span>
</span><span data-line="22"><span class="linenos"> 22</span>    <span class="n">repository</span><span class="p">,</span>
</span><span data-line="23"><span class="linenos"> 23</span><span class="p">)</span>
</span><span data-line="24"><span class="linenos"> 24</span><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.repository.filters</span><span class="w"> </span><span class="kn">import</span> <span class="n">LimitOffset</span>
</span><span data-line="25"><span class="linenos"> 25</span>
</span><span data-line="26"><span class="linenos"> 26</span><span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span data-line="27"><span class="linenos"> 27</span>    <span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">Session</span>
</span><span data-line="28"><span class="linenos"> 28</span>
</span><span data-line="29"><span class="linenos"> 29</span>
</span><span data-line="30"><span class="linenos"> 30</span><span class="k">class</span><span class="w"> </span><span class="nc">BaseModel</span><span class="p">(</span><span class="n">_BaseModel</span><span class="p">):</span>
</span><span data-line="31"><span class="linenos"> 31</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Extend Pydantic&#39;s BaseModel to enable ORM mode&quot;&quot;&quot;</span>
</span><span data-line="32"><span class="linenos"> 32</span>
</span><span data-line="33"><span class="linenos"> 33</span>    <span class="n">model_config</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;from_attributes&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
</span><span data-line="34"><span class="linenos"> 34</span>
</span><span data-line="35"><span class="linenos"> 35</span>
</span><span data-line="36"><span class="linenos"> 36</span><span class="c1"># The SQLAlchemy base includes a declarative model for you to use in your models.</span>
</span><span data-line="37"><span class="linenos"> 37</span><span class="c1"># The `UUIDBase` class includes a `UUID` based primary key (`id`)</span>
</span><span data-line="38"><span class="linenos"> 38</span><span class="k">class</span><span class="w"> </span><span class="nc">AuthorModel</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">UUIDBase</span><span class="p">):</span>
</span><span data-line="39"><span class="linenos"> 39</span>    <span class="c1"># we can optionally provide the table name instead of auto-generating it</span>
</span><span data-line="40"><span class="linenos"> 40</span>    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;author&quot;</span>  <span class="c1">#  type: ignore[assignment]</span>
</span><span data-line="41"><span class="linenos"> 41</span>    <span class="n">name</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</span><span data-line="42"><span class="linenos"> 42</span>    <span class="n">dob</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">date</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]</span>
</span><span data-line="43"><span class="linenos"> 43</span>    <span class="n">books</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">BookModel</span><span class="p">]]</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="n">back_populates</span><span class="o">=</span><span class="s2">&quot;author&quot;</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="s2">&quot;noload&quot;</span><span class="p">)</span>
</span><span data-line="44"><span class="linenos"> 44</span>
</span><span data-line="45"><span class="linenos"> 45</span>
</span><span data-line="46"><span class="linenos"> 46</span><span class="c1"># The `UUIDAuditBase` class includes the same UUID` based primary key (`id`) and 2</span>
</span><span data-line="47"><span class="linenos"> 47</span><span class="c1"># additional columns: `created_at` and `updated_at`. `created_at` is a timestamp of when the</span>
</span><span data-line="48"><span class="linenos"> 48</span><span class="c1"># record created, and `updated_at` is the last time the record was modified.</span>
</span><span data-line="49"><span class="linenos"> 49</span><span class="k">class</span><span class="w"> </span><span class="nc">BookModel</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">UUIDAuditBase</span><span class="p">):</span>
</span><span data-line="50"><span class="linenos"> 50</span>    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;book&quot;</span>  <span class="c1">#  type: ignore[assignment]</span>
</span><span data-line="51"><span class="linenos"> 51</span>    <span class="n">title</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</span><span data-line="52"><span class="linenos"> 52</span>    <span class="n">author_id</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">UUID</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;author.id&quot;</span><span class="p">))</span>
</span><span data-line="53"><span class="linenos"> 53</span>    <span class="n">author</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">AuthorModel</span><span class="p">]</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="n">lazy</span><span class="o">=</span><span class="s2">&quot;joined&quot;</span><span class="p">,</span> <span class="n">innerjoin</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">viewonly</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span data-line="54"><span class="linenos"> 54</span>
</span><span data-line="55"><span class="linenos"> 55</span>
</span><span data-line="56"><span class="linenos"> 56</span><span class="c1"># we will explicitly define the schema instead of using DTO objects for clarity.</span>
</span><span data-line="57"><span class="linenos"> 57</span>
</span><span data-line="58"><span class="linenos"> 58</span>
</span><span data-line="59"><span class="linenos"> 59</span><span class="k">class</span><span class="w"> </span><span class="nc">Author</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
</span><span data-line="60"><span class="linenos"> 60</span>    <span class="nb">id</span><span class="p">:</span> <span class="n">UUID</span> <span class="o">|</span> <span class="kc">None</span>
</span><span data-line="61"><span class="linenos"> 61</span>    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
</span><span data-line="62"><span class="linenos"> 62</span>    <span class="n">dob</span><span class="p">:</span> <span class="n">date</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="63"><span class="linenos"> 63</span>
</span><span data-line="64"><span class="linenos"> 64</span>
</span><span data-line="65"><span class="linenos"> 65</span><span class="k">class</span><span class="w"> </span><span class="nc">AuthorCreate</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
</span><span data-line="66"><span class="linenos"> 66</span>    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
</span><span data-line="67"><span class="linenos"> 67</span>    <span class="n">dob</span><span class="p">:</span> <span class="n">date</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="68"><span class="linenos"> 68</span>
</span><span data-line="69"><span class="linenos"> 69</span>
</span><span data-line="70"><span class="linenos"> 70</span><span class="k">class</span><span class="w"> </span><span class="nc">AuthorUpdate</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
</span><span data-line="71"><span class="linenos"> 71</span>    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="72"><span class="linenos"> 72</span>    <span class="n">dob</span><span class="p">:</span> <span class="n">date</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="73"><span class="linenos"> 73</span>
</span><span data-line="74"><span class="linenos"> 74</span>
</span><span data-line="75"><span class="linenos"> 75</span><span class="k">class</span><span class="w"> </span><span class="nc">AuthorRepository</span><span class="p">(</span><span class="n">repository</span><span class="o">.</span><span class="n">SQLAlchemySyncRepository</span><span class="p">[</span><span class="n">AuthorModel</span><span class="p">]):</span>
</span><span data-line="76"><span class="linenos"> 76</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Author repository.&quot;&quot;&quot;</span>
</span><span data-line="77"><span class="linenos"> 77</span>
</span><span data-line="78"><span class="linenos"> 78</span>    <span class="n">model_type</span> <span class="o">=</span> <span class="n">AuthorModel</span>
</span><span data-line="79"><span class="linenos"> 79</span>
</span><span data-line="80"><span class="linenos"> 80</span>
</span><span data-line="81"><span class="linenos"> 81</span><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">provide_authors_repo</span><span class="p">(</span><span class="n">db_session</span><span class="p">:</span> <span class="n">Session</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AuthorRepository</span><span class="p">:</span>
</span><span data-line="82"><span class="linenos"> 82</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;This provides the default Authors repository.&quot;&quot;&quot;</span>
</span><span data-line="83"><span class="linenos"> 83</span>    <span class="k">return</span> <span class="n">AuthorRepository</span><span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="n">db_session</span><span class="p">)</span>
</span><span data-line="84"><span class="linenos"> 84</span>
</span><span data-line="85"><span class="linenos"> 85</span>
</span><span data-line="86"><span class="linenos"> 86</span><span class="c1"># we can optionally override the default `select` used for the repository to pass in</span>
</span><span data-line="87"><span class="linenos"> 87</span><span class="c1"># specific SQL options such as join details</span>
</span><span data-line="88"><span class="linenos"> 88</span><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">provide_author_details_repo</span><span class="p">(</span><span class="n">db_session</span><span class="p">:</span> <span class="n">Session</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AuthorRepository</span><span class="p">:</span>
</span><span data-line="89"><span class="linenos"> 89</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;This provides a simple example demonstrating how to override the join options</span>
</span><span data-line="90"><span class="linenos"> 90</span><span class="sd">    for the repository.&quot;&quot;&quot;</span>
</span><span data-line="91"><span class="linenos"> 91</span>    <span class="k">return</span> <span class="n">AuthorRepository</span><span class="p">(</span>
</span><span data-line="92"><span class="linenos"> 92</span>        <span class="n">statement</span><span class="o">=</span><span class="n">select</span><span class="p">(</span><span class="n">AuthorModel</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">selectinload</span><span class="p">(</span><span class="n">AuthorModel</span><span class="o">.</span><span class="n">books</span><span class="p">)),</span>
</span><span data-line="93"><span class="linenos"> 93</span>        <span class="n">session</span><span class="o">=</span><span class="n">db_session</span><span class="p">,</span>
</span><span data-line="94"><span class="linenos"> 94</span>    <span class="p">)</span>
</span><span data-line="95"><span class="linenos"> 95</span>
</span><span data-line="96"><span class="linenos"> 96</span>
</span><span data-line="97"><span class="linenos"> 97</span><span class="k">def</span><span class="w"> </span><span class="nf">provide_limit_offset_pagination</span><span class="p">(</span>
</span><span data-line="98"><span class="linenos"> 98</span>    <span class="n">current_page</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="s2">&quot;currentPage&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
</span><span data-line="99"><span class="linenos"> 99</span>    <span class="n">page_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span>
</span><span data-line="100"><span class="linenos">100</span>        <span class="n">query</span><span class="o">=</span><span class="s2">&quot;pageSize&quot;</span><span class="p">,</span>
</span><span data-line="101"><span class="linenos">101</span>        <span class="n">ge</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span data-line="102"><span class="linenos">102</span>        <span class="n">default</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
</span><span data-line="103"><span class="linenos">103</span>        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span data-line="104"><span class="linenos">104</span>    <span class="p">),</span>
</span><span data-line="105"><span class="linenos">105</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LimitOffset</span><span class="p">:</span>
</span><span data-line="106"><span class="linenos">106</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Add offset/limit pagination.</span>
</span><span data-line="107"><span class="linenos">107</span>
</span><span data-line="108"><span class="linenos">108</span><span class="sd">    Return type consumed by `Repository.apply_limit_offset_pagination()`.</span>
</span><span data-line="109"><span class="linenos">109</span>
</span><span data-line="110"><span class="linenos">110</span><span class="sd">    Parameters</span>
</span><span data-line="111"><span class="linenos">111</span><span class="sd">    ----------</span>
</span><span data-line="112"><span class="linenos">112</span><span class="sd">    current_page : int</span>
</span><span data-line="113"><span class="linenos">113</span><span class="sd">        LIMIT to apply to select.</span>
</span><span data-line="114"><span class="linenos">114</span><span class="sd">    page_size : int</span>
</span><span data-line="115"><span class="linenos">115</span><span class="sd">        OFFSET to apply to select.</span>
</span><span data-line="116"><span class="linenos">116</span><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="117"><span class="linenos">117</span>    <span class="k">return</span> <span class="n">LimitOffset</span><span class="p">(</span><span class="n">page_size</span><span class="p">,</span> <span class="n">page_size</span> <span class="o">*</span> <span class="p">(</span><span class="n">current_page</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
</span><span data-line="118"><span class="linenos">118</span>
</span><span data-line="119"><span class="linenos">119</span>
</span><span data-line="120"><span class="linenos">120</span><span class="k">class</span><span class="w"> </span><span class="nc">AuthorController</span><span class="p">(</span><span class="n">Controller</span><span class="p">):</span>
</span><span data-line="121"><span class="linenos">121</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Author CRUD&quot;&quot;&quot;</span>
</span><span data-line="122"><span class="linenos">122</span>
</span><span data-line="123"><span class="linenos">123</span>    <span class="n">dependencies</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;authors_repo&quot;</span><span class="p">:</span> <span class="n">Provide</span><span class="p">(</span><span class="n">provide_authors_repo</span><span class="p">,</span> <span class="n">sync_to_thread</span><span class="o">=</span><span class="kc">False</span><span class="p">)}</span>
</span><span data-line="124"><span class="linenos">124</span>
</span><span data-line="125"><span class="linenos">125</span>    <span class="nd">@get</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;/authors&quot;</span><span class="p">)</span>
</span><span data-line="126"><span class="linenos">126</span>    <span class="k">def</span><span class="w"> </span><span class="nf">list_authors</span><span class="p">(</span>
</span><span data-line="127"><span class="linenos">127</span>        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="128"><span class="linenos">128</span>        <span class="n">authors_repo</span><span class="p">:</span> <span class="n">AuthorRepository</span><span class="p">,</span>
</span><span data-line="129"><span class="linenos">129</span>        <span class="n">limit_offset</span><span class="p">:</span> <span class="n">LimitOffset</span><span class="p">,</span>
</span><span data-line="130"><span class="linenos">130</span>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OffsetPagination</span><span class="p">[</span><span class="n">Author</span><span class="p">]:</span>
</span><span data-line="131"><span class="linenos">131</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;List authors.&quot;&quot;&quot;</span>
</span><span data-line="132"><span class="linenos">132</span>        <span class="n">results</span><span class="p">,</span> <span class="n">total</span> <span class="o">=</span> <span class="n">authors_repo</span><span class="o">.</span><span class="n">list_and_count</span><span class="p">(</span><span class="n">limit_offset</span><span class="p">)</span>
</span><span data-line="133"><span class="linenos">133</span>        <span class="n">type_adapter</span> <span class="o">=</span> <span class="n">TypeAdapter</span><span class="p">(</span><span class="nb">list</span><span class="p">[</span><span class="n">Author</span><span class="p">])</span>
</span><span data-line="134"><span class="linenos">134</span>        <span class="k">return</span> <span class="n">OffsetPagination</span><span class="p">[</span><span class="n">Author</span><span class="p">](</span>
</span><span data-line="135"><span class="linenos">135</span>            <span class="n">items</span><span class="o">=</span><span class="n">type_adapter</span><span class="o">.</span><span class="n">validate_python</span><span class="p">(</span><span class="n">results</span><span class="p">),</span>
</span><span data-line="136"><span class="linenos">136</span>            <span class="n">total</span><span class="o">=</span><span class="n">total</span><span class="p">,</span>
</span><span data-line="137"><span class="linenos">137</span>            <span class="n">limit</span><span class="o">=</span><span class="n">limit_offset</span><span class="o">.</span><span class="n">limit</span><span class="p">,</span>
</span><span data-line="138"><span class="linenos">138</span>            <span class="n">offset</span><span class="o">=</span><span class="n">limit_offset</span><span class="o">.</span><span class="n">offset</span><span class="p">,</span>
</span><span data-line="139"><span class="linenos">139</span>        <span class="p">)</span>
</span><span data-line="140"><span class="linenos">140</span>
</span><span data-line="141"><span class="linenos">141</span>    <span class="nd">@post</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;/authors&quot;</span><span class="p">)</span>
</span><span data-line="142"><span class="linenos">142</span>    <span class="k">def</span><span class="w"> </span><span class="nf">create_author</span><span class="p">(</span>
</span><span data-line="143"><span class="linenos">143</span>        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="144"><span class="linenos">144</span>        <span class="n">authors_repo</span><span class="p">:</span> <span class="n">AuthorRepository</span><span class="p">,</span>
</span><span data-line="145"><span class="linenos">145</span>        <span class="n">data</span><span class="p">:</span> <span class="n">AuthorCreate</span><span class="p">,</span>
</span><span data-line="146"><span class="linenos">146</span>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Author</span><span class="p">:</span>
</span><span data-line="147"><span class="linenos">147</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new author.&quot;&quot;&quot;</span>
</span><span data-line="148"><span class="linenos">148</span>        <span class="n">obj</span> <span class="o">=</span> <span class="n">authors_repo</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
</span><span data-line="149"><span class="linenos">149</span>            <span class="n">AuthorModel</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">exclude_unset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exclude_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)),</span>
</span><span data-line="150"><span class="linenos">150</span>        <span class="p">)</span>
</span><span data-line="151"><span class="linenos">151</span>        <span class="n">authors_repo</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span><span data-line="152"><span class="linenos">152</span>        <span class="k">return</span> <span class="n">Author</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</span><span data-line="153"><span class="linenos">153</span>
</span><span data-line="154"><span class="linenos">154</span>    <span class="c1"># we override the authors_repo to use the version that joins the Books in</span>
</span><span data-line="155"><span class="linenos">155</span>    <span class="nd">@get</span><span class="p">(</span>
</span><span data-line="156"><span class="linenos">156</span>        <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/authors/{author_id:uuid}&quot;</span><span class="p">,</span>
</span><span data-line="157"><span class="linenos">157</span>        <span class="n">dependencies</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;authors_repo&quot;</span><span class="p">:</span> <span class="n">Provide</span><span class="p">(</span><span class="n">provide_author_details_repo</span><span class="p">,</span> <span class="n">sync_to_thread</span><span class="o">=</span><span class="kc">False</span><span class="p">)},</span>
</span><span data-line="158"><span class="linenos">158</span>    <span class="p">)</span>
</span><span data-line="159"><span class="linenos">159</span>    <span class="k">def</span><span class="w"> </span><span class="nf">get_author</span><span class="p">(</span>
</span><span data-line="160"><span class="linenos">160</span>        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="161"><span class="linenos">161</span>        <span class="n">authors_repo</span><span class="p">:</span> <span class="n">AuthorRepository</span><span class="p">,</span>
</span><span data-line="162"><span class="linenos">162</span>        <span class="n">author_id</span><span class="p">:</span> <span class="n">UUID</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span>
</span><span data-line="163"><span class="linenos">163</span>            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Author ID&quot;</span><span class="p">,</span>
</span><span data-line="164"><span class="linenos">164</span>            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The author to retrieve.&quot;</span><span class="p">,</span>
</span><span data-line="165"><span class="linenos">165</span>        <span class="p">),</span>
</span><span data-line="166"><span class="linenos">166</span>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Author</span><span class="p">:</span>
</span><span data-line="167"><span class="linenos">167</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get an existing author.&quot;&quot;&quot;</span>
</span><span data-line="168"><span class="linenos">168</span>        <span class="n">obj</span> <span class="o">=</span> <span class="n">authors_repo</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">author_id</span><span class="p">)</span>
</span><span data-line="169"><span class="linenos">169</span>        <span class="k">return</span> <span class="n">Author</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</span><span data-line="170"><span class="linenos">170</span>
</span><span data-line="171"><span class="linenos">171</span>    <span class="nd">@patch</span><span class="p">(</span>
</span><span data-line="172"><span class="linenos">172</span>        <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/authors/{author_id:uuid}&quot;</span><span class="p">,</span>
</span><span data-line="173"><span class="linenos">173</span>        <span class="n">dependencies</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;authors_repo&quot;</span><span class="p">:</span> <span class="n">Provide</span><span class="p">(</span><span class="n">provide_author_details_repo</span><span class="p">,</span> <span class="n">sync_to_thread</span><span class="o">=</span><span class="kc">False</span><span class="p">)},</span>
</span><span data-line="174"><span class="linenos">174</span>    <span class="p">)</span>
</span><span data-line="175"><span class="linenos">175</span>    <span class="k">def</span><span class="w"> </span><span class="nf">update_author</span><span class="p">(</span>
</span><span data-line="176"><span class="linenos">176</span>        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="177"><span class="linenos">177</span>        <span class="n">authors_repo</span><span class="p">:</span> <span class="n">AuthorRepository</span><span class="p">,</span>
</span><span data-line="178"><span class="linenos">178</span>        <span class="n">data</span><span class="p">:</span> <span class="n">AuthorUpdate</span><span class="p">,</span>
</span><span data-line="179"><span class="linenos">179</span>        <span class="n">author_id</span><span class="p">:</span> <span class="n">UUID</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span>
</span><span data-line="180"><span class="linenos">180</span>            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Author ID&quot;</span><span class="p">,</span>
</span><span data-line="181"><span class="linenos">181</span>            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The author to update.&quot;</span><span class="p">,</span>
</span><span data-line="182"><span class="linenos">182</span>        <span class="p">),</span>
</span><span data-line="183"><span class="linenos">183</span>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Author</span><span class="p">:</span>
</span><span data-line="184"><span class="linenos">184</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Update an author.&quot;&quot;&quot;</span>
</span><span data-line="185"><span class="linenos">185</span>        <span class="n">raw_obj</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">exclude_unset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exclude_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span data-line="186"><span class="linenos">186</span>        <span class="n">raw_obj</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">author_id</span><span class="p">})</span>
</span><span data-line="187"><span class="linenos">187</span>        <span class="n">obj</span> <span class="o">=</span> <span class="n">authors_repo</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">AuthorModel</span><span class="p">(</span><span class="o">**</span><span class="n">raw_obj</span><span class="p">))</span>
</span><span data-line="188"><span class="linenos">188</span>        <span class="n">authors_repo</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span><span data-line="189"><span class="linenos">189</span>        <span class="k">return</span> <span class="n">Author</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</span><span data-line="190"><span class="linenos">190</span>
</span><span data-line="191"><span class="linenos">191</span>    <span class="nd">@delete</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;/authors/{author_id:uuid}&quot;</span><span class="p">)</span>
</span><span data-line="192"><span class="linenos">192</span>    <span class="k">def</span><span class="w"> </span><span class="nf">delete_author</span><span class="p">(</span>
</span><span data-line="193"><span class="linenos">193</span>        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="194"><span class="linenos">194</span>        <span class="n">authors_repo</span><span class="p">:</span> <span class="n">AuthorRepository</span><span class="p">,</span>
</span><span data-line="195"><span class="linenos">195</span>        <span class="n">author_id</span><span class="p">:</span> <span class="n">UUID</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span>
</span><span data-line="196"><span class="linenos">196</span>            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Author ID&quot;</span><span class="p">,</span>
</span><span data-line="197"><span class="linenos">197</span>            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The author to delete.&quot;</span><span class="p">,</span>
</span><span data-line="198"><span class="linenos">198</span>        <span class="p">),</span>
</span><span data-line="199"><span class="linenos">199</span>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="200"><span class="linenos">200</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete a author from the system.&quot;&quot;&quot;</span>
</span><span data-line="201"><span class="linenos">201</span>        <span class="n">_</span> <span class="o">=</span> <span class="n">authors_repo</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">author_id</span><span class="p">)</span>
</span><span data-line="202"><span class="linenos">202</span>        <span class="n">authors_repo</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span><span data-line="203"><span class="linenos">203</span>
</span><span data-line="204"><span class="linenos">204</span>
</span><span data-line="205"><span class="linenos">205</span><span class="n">sqlalchemy_config</span> <span class="o">=</span> <span class="n">SQLAlchemySyncConfig</span><span class="p">(</span><span class="n">connection_string</span><span class="o">=</span><span class="s2">&quot;sqlite:///test.sqlite&quot;</span><span class="p">)</span>  <span class="c1"># Create &#39;db_session&#39; dependency.</span>
</span><span data-line="206"><span class="linenos">206</span><span class="n">sqlalchemy_plugin</span> <span class="o">=</span> <span class="n">SQLAlchemyInitPlugin</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">sqlalchemy_config</span><span class="p">)</span>
</span><span data-line="207"><span class="linenos">207</span>
</span><span data-line="208"><span class="linenos">208</span>
</span><span data-line="209"><span class="linenos">209</span><span class="k">def</span><span class="w"> </span><span class="nf">on_startup</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="210"><span class="linenos">210</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Initializes the database.&quot;&quot;&quot;</span>
</span><span data-line="211"><span class="linenos">211</span>    <span class="k">with</span> <span class="n">sqlalchemy_config</span><span class="o">.</span><span class="n">get_engine</span><span class="p">()</span><span class="o">.</span><span class="n">begin</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
</span><span data-line="212"><span class="linenos">212</span>        <span class="n">base</span><span class="o">.</span><span class="n">UUIDBase</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span>
</span><span data-line="213"><span class="linenos">213</span>
</span><span data-line="214"><span class="linenos">214</span>
</span><span data-line="215"><span class="linenos">215</span><span class="n">app</span> <span class="o">=</span> <span class="n">Litestar</span><span class="p">(</span>
</span><span data-line="216"><span class="linenos">216</span>    <span class="n">route_handlers</span><span class="o">=</span><span class="p">[</span><span class="n">AuthorController</span><span class="p">],</span>
</span><span data-line="217"><span class="linenos">217</span>    <span class="n">on_startup</span><span class="o">=</span><span class="p">[</span><span class="n">on_startup</span><span class="p">],</span>
</span><span data-line="218"><span class="linenos">218</span>    <span class="n">plugins</span><span class="o">=</span><span class="p">[</span><span class="n">SQLAlchemyInitPlugin</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">sqlalchemy_config</span><span class="p">)],</span>
</span><span data-line="219"><span class="linenos">219</span>    <span class="n">dependencies</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;limit_offset&quot;</span><span class="p">:</span> <span class="n">Provide</span><span class="p">(</span><span class="n">provide_limit_offset_pagination</span><span class="p">)},</span>
</span><span data-line="220"><span class="linenos">220</span><span class="p">)</span>
</span></pre></div>
</div>
</div>
</div>
</details><p>The examples above enable a feature-complete CRUD service that includes pagination! In
the next section, we’ll explore how to extend the built-in repository to add additional
functionality to our application.</p>
</section>
<section id="full-code">
<span id="repo-full-code"></span><h1>Full Code<a class="headerlink" href="#full-code" title="Link to this heading">¶</a></h1>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
<span class="sd-summary-text">Full Code (click to toggle)</span><span class="sd-summary-state-marker sd-summary-chevron-right"><svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-right" viewBox="0 0 24 24" aria-hidden="true"><path d="M8.72 18.78a.75.75 0 0 1 0-1.06L14.44 12 8.72 6.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0Z"></path></svg></span></summary><div class="sd-summary-content sd-card-body docutils">
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">app.py</span></code></span><a class="headerlink" href="#id5" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="linenos">  1</span><span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">annotations</span>
</span><span data-line="2"><span class="linenos">  2</span>
</span><span data-line="3"><span class="linenos">  3</span><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">date</span>
</span><span data-line="4"><span class="linenos">  4</span><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">TYPE_CHECKING</span>
</span><span data-line="5"><span class="linenos">  5</span><span class="kn">from</span><span class="w"> </span><span class="nn">uuid</span><span class="w"> </span><span class="kn">import</span> <span class="n">UUID</span>
</span><span data-line="6"><span class="linenos">  6</span>
</span><span data-line="7"><span class="linenos">  7</span><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span> <span class="k">as</span> <span class="n">_BaseModel</span>
</span><span data-line="8"><span class="linenos">  8</span><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">TypeAdapter</span>
</span><span data-line="9"><span class="linenos">  9</span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">ForeignKey</span><span class="p">,</span> <span class="n">select</span>
</span><span data-line="10"><span class="linenos"> 10</span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">Mapped</span><span class="p">,</span> <span class="n">mapped_column</span><span class="p">,</span> <span class="n">relationship</span><span class="p">,</span> <span class="n">selectinload</span>
</span><span data-line="11"><span class="linenos"> 11</span>
</span><span data-line="12"><span class="linenos"> 12</span><span class="kn">from</span><span class="w"> </span><span class="nn">litestar</span><span class="w"> </span><span class="kn">import</span> <span class="n">Litestar</span><span class="p">,</span> <span class="n">get</span>
</span><span data-line="13"><span class="linenos"> 13</span><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.controller</span><span class="w"> </span><span class="kn">import</span> <span class="n">Controller</span>
</span><span data-line="14"><span class="linenos"> 14</span><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.di</span><span class="w"> </span><span class="kn">import</span> <span class="n">Provide</span>
</span><span data-line="15"><span class="linenos"> 15</span><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.handlers.http_handlers.decorators</span><span class="w"> </span><span class="kn">import</span> <span class="n">delete</span><span class="p">,</span> <span class="n">patch</span><span class="p">,</span> <span class="n">post</span>
</span><span data-line="16"><span class="linenos"> 16</span><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.pagination</span><span class="w"> </span><span class="kn">import</span> <span class="n">OffsetPagination</span>
</span><span data-line="17"><span class="linenos"> 17</span><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.params</span><span class="w"> </span><span class="kn">import</span> <span class="n">Parameter</span>
</span><span data-line="18"><span class="linenos"> 18</span><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.plugins.sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span data-line="19"><span class="linenos"> 19</span>    <span class="n">AsyncSessionConfig</span><span class="p">,</span>
</span><span data-line="20"><span class="linenos"> 20</span>    <span class="n">SQLAlchemyAsyncConfig</span><span class="p">,</span>
</span><span data-line="21"><span class="linenos"> 21</span>    <span class="n">SQLAlchemyInitPlugin</span><span class="p">,</span>
</span><span data-line="22"><span class="linenos"> 22</span>    <span class="n">base</span><span class="p">,</span>
</span><span data-line="23"><span class="linenos"> 23</span>    <span class="n">filters</span><span class="p">,</span>
</span><span data-line="24"><span class="linenos"> 24</span>    <span class="n">repository</span><span class="p">,</span>
</span><span data-line="25"><span class="linenos"> 25</span><span class="p">)</span>
</span><span data-line="26"><span class="linenos"> 26</span>
</span><span data-line="27"><span class="linenos"> 27</span><span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span data-line="28"><span class="linenos"> 28</span>    <span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.ext.asyncio</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncSession</span>
</span><span data-line="29"><span class="linenos"> 29</span>
</span><span data-line="30"><span class="linenos"> 30</span>
</span><span data-line="31"><span class="linenos"> 31</span><span class="k">class</span><span class="w"> </span><span class="nc">BaseModel</span><span class="p">(</span><span class="n">_BaseModel</span><span class="p">):</span>
</span><span data-line="32"><span class="linenos"> 32</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Extend Pydantic&#39;s BaseModel to enable ORM mode&quot;&quot;&quot;</span>
</span><span data-line="33"><span class="linenos"> 33</span>
</span><span data-line="34"><span class="linenos"> 34</span>    <span class="n">model_config</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;from_attributes&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
</span><span data-line="35"><span class="linenos"> 35</span>
</span><span data-line="36"><span class="linenos"> 36</span>
</span><span data-line="37"><span class="linenos"> 37</span><span class="c1"># The SQLAlchemy base includes a declarative model for you to use in your models.</span>
</span><span data-line="38"><span class="linenos"> 38</span><span class="c1"># The `UUIDBase` class includes a `UUID` based primary key (`id`)</span>
</span><span data-line="39"><span class="linenos"> 39</span><span class="k">class</span><span class="w"> </span><span class="nc">AuthorModel</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">UUIDBase</span><span class="p">):</span>
</span><span data-line="40"><span class="linenos"> 40</span>    <span class="c1"># we can optionally provide the table name instead of auto-generating it</span>
</span><span data-line="41"><span class="linenos"> 41</span>    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;author&quot;</span>  <span class="c1">#  type: ignore[assignment]</span>
</span><span data-line="42"><span class="linenos"> 42</span>    <span class="n">name</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</span><span data-line="43"><span class="linenos"> 43</span>    <span class="n">dob</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">date</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]</span>
</span><span data-line="44"><span class="linenos"> 44</span>    <span class="n">books</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">BookModel</span><span class="p">]]</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="n">back_populates</span><span class="o">=</span><span class="s2">&quot;author&quot;</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="s2">&quot;noload&quot;</span><span class="p">)</span>
</span><span data-line="45"><span class="linenos"> 45</span>
</span><span data-line="46"><span class="linenos"> 46</span>
</span><span data-line="47"><span class="linenos"> 47</span><span class="c1"># The `UUIDAuditBase` class includes the same UUID` based primary key (`id`) and 2</span>
</span><span data-line="48"><span class="linenos"> 48</span><span class="c1"># additional columns: `created_at` and `updated_at`. `created_at` is a timestamp of when the</span>
</span><span data-line="49"><span class="linenos"> 49</span><span class="c1"># record created, and `updated_at` is the last time the record was modified.</span>
</span><span data-line="50"><span class="linenos"> 50</span><span class="k">class</span><span class="w"> </span><span class="nc">BookModel</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">UUIDAuditBase</span><span class="p">):</span>
</span><span data-line="51"><span class="linenos"> 51</span>    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;book&quot;</span>  <span class="c1">#  type: ignore[assignment]</span>
</span><span data-line="52"><span class="linenos"> 52</span>    <span class="n">title</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</span><span data-line="53"><span class="linenos"> 53</span>    <span class="n">author_id</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">UUID</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;author.id&quot;</span><span class="p">))</span>
</span><span data-line="54"><span class="linenos"> 54</span>    <span class="n">author</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">AuthorModel</span><span class="p">]</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="n">lazy</span><span class="o">=</span><span class="s2">&quot;joined&quot;</span><span class="p">,</span> <span class="n">innerjoin</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">viewonly</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span data-line="55"><span class="linenos"> 55</span>
</span><span data-line="56"><span class="linenos"> 56</span>
</span><span data-line="57"><span class="linenos"> 57</span><span class="c1"># we will explicitly define the schema instead of using DTO objects for clarity.</span>
</span><span data-line="58"><span class="linenos"> 58</span>
</span><span data-line="59"><span class="linenos"> 59</span>
</span><span data-line="60"><span class="linenos"> 60</span><span class="k">class</span><span class="w"> </span><span class="nc">Author</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
</span><span data-line="61"><span class="linenos"> 61</span>    <span class="nb">id</span><span class="p">:</span> <span class="n">UUID</span> <span class="o">|</span> <span class="kc">None</span>
</span><span data-line="62"><span class="linenos"> 62</span>    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
</span><span data-line="63"><span class="linenos"> 63</span>    <span class="n">dob</span><span class="p">:</span> <span class="n">date</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="64"><span class="linenos"> 64</span>
</span><span data-line="65"><span class="linenos"> 65</span>
</span><span data-line="66"><span class="linenos"> 66</span><span class="k">class</span><span class="w"> </span><span class="nc">AuthorCreate</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
</span><span data-line="67"><span class="linenos"> 67</span>    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
</span><span data-line="68"><span class="linenos"> 68</span>    <span class="n">dob</span><span class="p">:</span> <span class="n">date</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="69"><span class="linenos"> 69</span>
</span><span data-line="70"><span class="linenos"> 70</span>
</span><span data-line="71"><span class="linenos"> 71</span><span class="k">class</span><span class="w"> </span><span class="nc">AuthorUpdate</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
</span><span data-line="72"><span class="linenos"> 72</span>    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="73"><span class="linenos"> 73</span>    <span class="n">dob</span><span class="p">:</span> <span class="n">date</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="74"><span class="linenos"> 74</span>
</span><span data-line="75"><span class="linenos"> 75</span>
</span><span data-line="76"><span class="linenos"> 76</span><span class="k">class</span><span class="w"> </span><span class="nc">AuthorRepository</span><span class="p">(</span><span class="n">repository</span><span class="o">.</span><span class="n">SQLAlchemyAsyncRepository</span><span class="p">[</span><span class="n">AuthorModel</span><span class="p">]):</span>
</span><span data-line="77"><span class="linenos"> 77</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Author repository.&quot;&quot;&quot;</span>
</span><span data-line="78"><span class="linenos"> 78</span>
</span><span data-line="79"><span class="linenos"> 79</span>    <span class="n">model_type</span> <span class="o">=</span> <span class="n">AuthorModel</span>
</span><span data-line="80"><span class="linenos"> 80</span>
</span><span data-line="81"><span class="linenos"> 81</span>
</span><span data-line="82"><span class="hll"><span class="linenos"> 82</span><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">provide_authors_repo</span><span class="p">(</span><span class="n">db_session</span><span class="p">:</span> <span class="n">AsyncSession</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AuthorRepository</span><span class="p">:</span>
</span></span><span data-line="83"><span class="hll"><span class="linenos"> 83</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;This provides the default Authors repository.&quot;&quot;&quot;</span>
</span></span><span data-line="84"><span class="hll"><span class="linenos"> 84</span>    <span class="k">return</span> <span class="n">AuthorRepository</span><span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="n">db_session</span><span class="p">)</span>
</span></span><span data-line="85"><span class="linenos"> 85</span>
</span><span data-line="86"><span class="linenos"> 86</span>
</span><span data-line="87"><span class="hll"><span class="linenos"> 87</span><span class="c1"># we can optionally override the default `select` used for the repository to pass in</span>
</span></span><span data-line="88"><span class="hll"><span class="linenos"> 88</span><span class="c1"># specific SQL options such as join details</span>
</span></span><span data-line="89"><span class="hll"><span class="linenos"> 89</span><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">provide_author_details_repo</span><span class="p">(</span><span class="n">db_session</span><span class="p">:</span> <span class="n">AsyncSession</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AuthorRepository</span><span class="p">:</span>
</span></span><span data-line="90"><span class="hll"><span class="linenos"> 90</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;This provides a simple example demonstrating how to override the join options for the repository.&quot;&quot;&quot;</span>
</span></span><span data-line="91"><span class="hll"><span class="linenos"> 91</span>    <span class="k">return</span> <span class="n">AuthorRepository</span><span class="p">(</span>
</span></span><span data-line="92"><span class="hll"><span class="linenos"> 92</span>        <span class="n">statement</span><span class="o">=</span><span class="n">select</span><span class="p">(</span><span class="n">AuthorModel</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">selectinload</span><span class="p">(</span><span class="n">AuthorModel</span><span class="o">.</span><span class="n">books</span><span class="p">)),</span>
</span></span><span data-line="93"><span class="hll"><span class="linenos"> 93</span>        <span class="n">session</span><span class="o">=</span><span class="n">db_session</span><span class="p">,</span>
</span></span><span data-line="94"><span class="hll"><span class="linenos"> 94</span>    <span class="p">)</span>
</span></span><span data-line="95"><span class="linenos"> 95</span>
</span><span data-line="96"><span class="linenos"> 96</span>
</span><span data-line="97"><span class="linenos"> 97</span><span class="k">def</span><span class="w"> </span><span class="nf">provide_limit_offset_pagination</span><span class="p">(</span>
</span><span data-line="98"><span class="linenos"> 98</span>    <span class="n">current_page</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="s2">&quot;currentPage&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
</span><span data-line="99"><span class="linenos"> 99</span>    <span class="n">page_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span>
</span><span data-line="100"><span class="linenos">100</span>        <span class="n">query</span><span class="o">=</span><span class="s2">&quot;pageSize&quot;</span><span class="p">,</span>
</span><span data-line="101"><span class="linenos">101</span>        <span class="n">ge</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span data-line="102"><span class="linenos">102</span>        <span class="n">default</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
</span><span data-line="103"><span class="linenos">103</span>        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span data-line="104"><span class="linenos">104</span>    <span class="p">),</span>
</span><span data-line="105"><span class="linenos">105</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">filters</span><span class="o">.</span><span class="n">LimitOffset</span><span class="p">:</span>
</span><span data-line="106"><span class="linenos">106</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Add offset/limit pagination.</span>
</span><span data-line="107"><span class="linenos">107</span>
</span><span data-line="108"><span class="linenos">108</span><span class="sd">    Return type consumed by `Repository.apply_limit_offset_pagination()`.</span>
</span><span data-line="109"><span class="linenos">109</span>
</span><span data-line="110"><span class="linenos">110</span><span class="sd">    Parameters</span>
</span><span data-line="111"><span class="linenos">111</span><span class="sd">    ----------</span>
</span><span data-line="112"><span class="linenos">112</span><span class="sd">    current_page : int</span>
</span><span data-line="113"><span class="linenos">113</span><span class="sd">        LIMIT to apply to select.</span>
</span><span data-line="114"><span class="linenos">114</span><span class="sd">    page_size : int</span>
</span><span data-line="115"><span class="linenos">115</span><span class="sd">        OFFSET to apply to select.</span>
</span><span data-line="116"><span class="linenos">116</span><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="117"><span class="linenos">117</span>    <span class="k">return</span> <span class="n">filters</span><span class="o">.</span><span class="n">LimitOffset</span><span class="p">(</span><span class="n">page_size</span><span class="p">,</span> <span class="n">page_size</span> <span class="o">*</span> <span class="p">(</span><span class="n">current_page</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
</span><span data-line="118"><span class="linenos">118</span>
</span><span data-line="119"><span class="linenos">119</span>
</span><span data-line="120"><span class="hll"><span class="linenos">120</span><span class="k">class</span><span class="w"> </span><span class="nc">AuthorController</span><span class="p">(</span><span class="n">Controller</span><span class="p">):</span>
</span></span><span data-line="121"><span class="hll"><span class="linenos">121</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Author CRUD&quot;&quot;&quot;</span>
</span></span><span data-line="122"><span class="hll"><span class="linenos">122</span>
</span></span><span data-line="123"><span class="hll"><span class="linenos">123</span>    <span class="n">dependencies</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;authors_repo&quot;</span><span class="p">:</span> <span class="n">Provide</span><span class="p">(</span><span class="n">provide_authors_repo</span><span class="p">)}</span>
</span></span><span data-line="124"><span class="hll"><span class="linenos">124</span>
</span></span><span data-line="125"><span class="hll"><span class="linenos">125</span>    <span class="nd">@get</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;/authors&quot;</span><span class="p">)</span>
</span></span><span data-line="126"><span class="hll"><span class="linenos">126</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">list_authors</span><span class="p">(</span>
</span></span><span data-line="127"><span class="hll"><span class="linenos">127</span>        <span class="bp">self</span><span class="p">,</span>
</span></span><span data-line="128"><span class="hll"><span class="linenos">128</span>        <span class="n">authors_repo</span><span class="p">:</span> <span class="n">AuthorRepository</span><span class="p">,</span>
</span></span><span data-line="129"><span class="hll"><span class="linenos">129</span>        <span class="n">limit_offset</span><span class="p">:</span> <span class="n">filters</span><span class="o">.</span><span class="n">LimitOffset</span><span class="p">,</span>
</span></span><span data-line="130"><span class="hll"><span class="linenos">130</span>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OffsetPagination</span><span class="p">[</span><span class="n">Author</span><span class="p">]:</span>
</span></span><span data-line="131"><span class="hll"><span class="linenos">131</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;List authors.&quot;&quot;&quot;</span>
</span></span><span data-line="132"><span class="hll"><span class="linenos">132</span>        <span class="n">results</span><span class="p">,</span> <span class="n">total</span> <span class="o">=</span> <span class="k">await</span> <span class="n">authors_repo</span><span class="o">.</span><span class="n">list_and_count</span><span class="p">(</span><span class="n">limit_offset</span><span class="p">)</span>
</span></span><span data-line="133"><span class="hll"><span class="linenos">133</span>        <span class="n">type_adapter</span> <span class="o">=</span> <span class="n">TypeAdapter</span><span class="p">(</span><span class="nb">list</span><span class="p">[</span><span class="n">Author</span><span class="p">])</span>
</span></span><span data-line="134"><span class="hll"><span class="linenos">134</span>        <span class="k">return</span> <span class="n">OffsetPagination</span><span class="p">[</span><span class="n">Author</span><span class="p">](</span>
</span></span><span data-line="135"><span class="hll"><span class="linenos">135</span>            <span class="n">items</span><span class="o">=</span><span class="n">type_adapter</span><span class="o">.</span><span class="n">validate_python</span><span class="p">(</span><span class="n">results</span><span class="p">),</span>
</span></span><span data-line="136"><span class="hll"><span class="linenos">136</span>            <span class="n">total</span><span class="o">=</span><span class="n">total</span><span class="p">,</span>
</span></span><span data-line="137"><span class="hll"><span class="linenos">137</span>            <span class="n">limit</span><span class="o">=</span><span class="n">limit_offset</span><span class="o">.</span><span class="n">limit</span><span class="p">,</span>
</span></span><span data-line="138"><span class="hll"><span class="linenos">138</span>            <span class="n">offset</span><span class="o">=</span><span class="n">limit_offset</span><span class="o">.</span><span class="n">offset</span><span class="p">,</span>
</span></span><span data-line="139"><span class="hll"><span class="linenos">139</span>        <span class="p">)</span>
</span></span><span data-line="140"><span class="hll"><span class="linenos">140</span>
</span></span><span data-line="141"><span class="hll"><span class="linenos">141</span>    <span class="nd">@post</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;/authors&quot;</span><span class="p">)</span>
</span></span><span data-line="142"><span class="hll"><span class="linenos">142</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">create_author</span><span class="p">(</span>
</span></span><span data-line="143"><span class="hll"><span class="linenos">143</span>        <span class="bp">self</span><span class="p">,</span>
</span></span><span data-line="144"><span class="hll"><span class="linenos">144</span>        <span class="n">authors_repo</span><span class="p">:</span> <span class="n">AuthorRepository</span><span class="p">,</span>
</span></span><span data-line="145"><span class="hll"><span class="linenos">145</span>        <span class="n">data</span><span class="p">:</span> <span class="n">AuthorCreate</span><span class="p">,</span>
</span></span><span data-line="146"><span class="hll"><span class="linenos">146</span>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Author</span><span class="p">:</span>
</span></span><span data-line="147"><span class="hll"><span class="linenos">147</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new author.&quot;&quot;&quot;</span>
</span></span><span data-line="148"><span class="hll"><span class="linenos">148</span>        <span class="n">obj</span> <span class="o">=</span> <span class="k">await</span> <span class="n">authors_repo</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
</span></span><span data-line="149"><span class="hll"><span class="linenos">149</span>            <span class="n">AuthorModel</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">exclude_unset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exclude_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)),</span>
</span></span><span data-line="150"><span class="hll"><span class="linenos">150</span>        <span class="p">)</span>
</span></span><span data-line="151"><span class="hll"><span class="linenos">151</span>        <span class="k">await</span> <span class="n">authors_repo</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span></span><span data-line="152"><span class="hll"><span class="linenos">152</span>        <span class="k">return</span> <span class="n">Author</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</span></span><span data-line="153"><span class="hll"><span class="linenos">153</span>
</span></span><span data-line="154"><span class="hll"><span class="linenos">154</span>    <span class="c1"># we override the authors_repo to use the version that joins the Books in</span>
</span></span><span data-line="155"><span class="hll"><span class="linenos">155</span>    <span class="nd">@get</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;/authors/{author_id:uuid}&quot;</span><span class="p">,</span> <span class="n">dependencies</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;authors_repo&quot;</span><span class="p">:</span> <span class="n">Provide</span><span class="p">(</span><span class="n">provide_author_details_repo</span><span class="p">)})</span>
</span></span><span data-line="156"><span class="hll"><span class="linenos">156</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_author</span><span class="p">(</span>
</span></span><span data-line="157"><span class="hll"><span class="linenos">157</span>        <span class="bp">self</span><span class="p">,</span>
</span></span><span data-line="158"><span class="hll"><span class="linenos">158</span>        <span class="n">authors_repo</span><span class="p">:</span> <span class="n">AuthorRepository</span><span class="p">,</span>
</span></span><span data-line="159"><span class="hll"><span class="linenos">159</span>        <span class="n">author_id</span><span class="p">:</span> <span class="n">UUID</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span>
</span></span><span data-line="160"><span class="hll"><span class="linenos">160</span>            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Author ID&quot;</span><span class="p">,</span>
</span></span><span data-line="161"><span class="hll"><span class="linenos">161</span>            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The author to retrieve.&quot;</span><span class="p">,</span>
</span></span><span data-line="162"><span class="hll"><span class="linenos">162</span>        <span class="p">),</span>
</span></span><span data-line="163"><span class="hll"><span class="linenos">163</span>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Author</span><span class="p">:</span>
</span></span><span data-line="164"><span class="hll"><span class="linenos">164</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get an existing author.&quot;&quot;&quot;</span>
</span></span><span data-line="165"><span class="hll"><span class="linenos">165</span>        <span class="n">obj</span> <span class="o">=</span> <span class="k">await</span> <span class="n">authors_repo</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">author_id</span><span class="p">)</span>
</span></span><span data-line="166"><span class="hll"><span class="linenos">166</span>        <span class="k">return</span> <span class="n">Author</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</span></span><span data-line="167"><span class="hll"><span class="linenos">167</span>
</span></span><span data-line="168"><span class="hll"><span class="linenos">168</span>    <span class="nd">@patch</span><span class="p">(</span>
</span></span><span data-line="169"><span class="hll"><span class="linenos">169</span>        <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/authors/{author_id:uuid}&quot;</span><span class="p">,</span>
</span></span><span data-line="170"><span class="hll"><span class="linenos">170</span>        <span class="n">dependencies</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;authors_repo&quot;</span><span class="p">:</span> <span class="n">Provide</span><span class="p">(</span><span class="n">provide_author_details_repo</span><span class="p">)},</span>
</span></span><span data-line="171"><span class="hll"><span class="linenos">171</span>    <span class="p">)</span>
</span></span><span data-line="172"><span class="hll"><span class="linenos">172</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">update_author</span><span class="p">(</span>
</span></span><span data-line="173"><span class="hll"><span class="linenos">173</span>        <span class="bp">self</span><span class="p">,</span>
</span></span><span data-line="174"><span class="hll"><span class="linenos">174</span>        <span class="n">authors_repo</span><span class="p">:</span> <span class="n">AuthorRepository</span><span class="p">,</span>
</span></span><span data-line="175"><span class="hll"><span class="linenos">175</span>        <span class="n">data</span><span class="p">:</span> <span class="n">AuthorUpdate</span><span class="p">,</span>
</span></span><span data-line="176"><span class="hll"><span class="linenos">176</span>        <span class="n">author_id</span><span class="p">:</span> <span class="n">UUID</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span>
</span></span><span data-line="177"><span class="hll"><span class="linenos">177</span>            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Author ID&quot;</span><span class="p">,</span>
</span></span><span data-line="178"><span class="hll"><span class="linenos">178</span>            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The author to update.&quot;</span><span class="p">,</span>
</span></span><span data-line="179"><span class="hll"><span class="linenos">179</span>        <span class="p">),</span>
</span></span><span data-line="180"><span class="hll"><span class="linenos">180</span>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Author</span><span class="p">:</span>
</span></span><span data-line="181"><span class="hll"><span class="linenos">181</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Update an author.&quot;&quot;&quot;</span>
</span></span><span data-line="182"><span class="hll"><span class="linenos">182</span>        <span class="n">raw_obj</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">exclude_unset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exclude_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span data-line="183"><span class="hll"><span class="linenos">183</span>        <span class="n">raw_obj</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">author_id</span><span class="p">})</span>
</span></span><span data-line="184"><span class="hll"><span class="linenos">184</span>        <span class="n">obj</span> <span class="o">=</span> <span class="k">await</span> <span class="n">authors_repo</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">AuthorModel</span><span class="p">(</span><span class="o">**</span><span class="n">raw_obj</span><span class="p">))</span>
</span></span><span data-line="185"><span class="hll"><span class="linenos">185</span>        <span class="k">await</span> <span class="n">authors_repo</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span></span><span data-line="186"><span class="hll"><span class="linenos">186</span>        <span class="k">return</span> <span class="n">Author</span><span class="o">.</span><span class="n">from_orm</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</span></span><span data-line="187"><span class="hll"><span class="linenos">187</span>
</span></span><span data-line="188"><span class="hll"><span class="linenos">188</span>    <span class="nd">@delete</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;/authors/{author_id:uuid}&quot;</span><span class="p">)</span>
</span></span><span data-line="189"><span class="hll"><span class="linenos">189</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">delete_author</span><span class="p">(</span>
</span></span><span data-line="190"><span class="hll"><span class="linenos">190</span>        <span class="bp">self</span><span class="p">,</span>
</span></span><span data-line="191"><span class="hll"><span class="linenos">191</span>        <span class="n">authors_repo</span><span class="p">:</span> <span class="n">AuthorRepository</span><span class="p">,</span>
</span></span><span data-line="192"><span class="hll"><span class="linenos">192</span>        <span class="n">author_id</span><span class="p">:</span> <span class="n">UUID</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span>
</span></span><span data-line="193"><span class="hll"><span class="linenos">193</span>            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Author ID&quot;</span><span class="p">,</span>
</span></span><span data-line="194"><span class="hll"><span class="linenos">194</span>            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The author to delete.&quot;</span><span class="p">,</span>
</span></span><span data-line="195"><span class="hll"><span class="linenos">195</span>        <span class="p">),</span>
</span></span><span data-line="196"><span class="hll"><span class="linenos">196</span>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span data-line="197"><span class="hll"><span class="linenos">197</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete a author from the system.&quot;&quot;&quot;</span>
</span></span><span data-line="198"><span class="hll"><span class="linenos">198</span>        <span class="n">_</span> <span class="o">=</span> <span class="k">await</span> <span class="n">authors_repo</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">author_id</span><span class="p">)</span>
</span></span><span data-line="199"><span class="hll"><span class="linenos">199</span>        <span class="k">await</span> <span class="n">authors_repo</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span></span><span data-line="200"><span class="linenos">200</span>
</span><span data-line="201"><span class="linenos">201</span>
</span><span data-line="202"><span class="linenos">202</span><span class="n">session_config</span> <span class="o">=</span> <span class="n">AsyncSessionConfig</span><span class="p">(</span><span class="n">expire_on_commit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span data-line="203"><span class="linenos">203</span><span class="n">sqlalchemy_config</span> <span class="o">=</span> <span class="n">SQLAlchemyAsyncConfig</span><span class="p">(</span>
</span><span data-line="204"><span class="linenos">204</span>    <span class="n">connection_string</span><span class="o">=</span><span class="s2">&quot;sqlite+aiosqlite:///test.sqlite&quot;</span><span class="p">,</span> <span class="n">session_config</span><span class="o">=</span><span class="n">session_config</span>
</span><span data-line="205"><span class="linenos">205</span><span class="p">)</span>  <span class="c1"># Create &#39;db_session&#39; dependency.</span>
</span><span data-line="206"><span class="linenos">206</span><span class="n">sqlalchemy_plugin</span> <span class="o">=</span> <span class="n">SQLAlchemyInitPlugin</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">sqlalchemy_config</span><span class="p">)</span>
</span><span data-line="207"><span class="linenos">207</span>
</span><span data-line="208"><span class="linenos">208</span>
</span><span data-line="209"><span class="linenos">209</span><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">on_startup</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="210"><span class="linenos">210</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Initializes the database.&quot;&quot;&quot;</span>
</span><span data-line="211"><span class="linenos">211</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">sqlalchemy_config</span><span class="o">.</span><span class="n">get_engine</span><span class="p">()</span><span class="o">.</span><span class="n">begin</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
</span><span data-line="212"><span class="linenos">212</span>        <span class="k">await</span> <span class="n">conn</span><span class="o">.</span><span class="n">run_sync</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">UUIDBase</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">)</span>
</span><span data-line="213"><span class="linenos">213</span>
</span><span data-line="214"><span class="linenos">214</span>
</span><span data-line="215"><span class="linenos">215</span><span class="n">app</span> <span class="o">=</span> <span class="n">Litestar</span><span class="p">(</span>
</span><span data-line="216"><span class="linenos">216</span>    <span class="n">route_handlers</span><span class="o">=</span><span class="p">[</span><span class="n">AuthorController</span><span class="p">],</span>
</span><span data-line="217"><span class="linenos">217</span>    <span class="n">on_startup</span><span class="o">=</span><span class="p">[</span><span class="n">on_startup</span><span class="p">],</span>
</span><span data-line="218"><span class="linenos">218</span>    <span class="n">plugins</span><span class="o">=</span><span class="p">[</span><span class="n">SQLAlchemyInitPlugin</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">sqlalchemy_config</span><span class="p">)],</span>
</span><span data-line="219"><span class="linenos">219</span>    <span class="n">dependencies</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;limit_offset&quot;</span><span class="p">:</span> <span class="n">Provide</span><span class="p">(</span><span class="n">provide_limit_offset_pagination</span><span class="p">)},</span>
</span><span data-line="220"><span class="linenos">220</span><span class="p">)</span>
</span></pre></div>
</div>
</div>
</div>
</details></section>

        </article><button class="back-to-top" type="button">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
  </svg>
  <span>Back to top</span>
</button><div class="navigation flex print:hidden"><div class="navigation-prev">
    <a href="02-repository-introduction.html">
      <i class="i-lucide chevron-left"></i>
      <div class="page-info">
        <span>Previous</span><div class="title">Interacting with repositories</div></div>
    </a>
  </div><div class="navigation-next">
    <a href="04-repository-other.html">
      <div class="page-info">
        <span>Next</span>
        <div class="title">Adding Additional Features to the Repository</div>
      </div>
      <i class="i-lucide chevron-right"></i>
    </a>
  </div></div></div>
    </div>
  </main>
</div>
<footer class="sy-foot">
  <div class="sy-foot-inner sy-container mx-auto">
    <div class="sy-foot-reserved md:flex justify-between items-center">
      <div class="sy-foot-copyright"><p>2025, Litestar Organization</p>
  
  <p>
    Made with
    
    <a href="https://www.sphinx-doc.org/">Sphinx</a> and
    
    <a href="https://shibuya.lepture.com">Shibuya theme</a>.
  </p>
</div>
      <div class="sy-foot-socials">
<a href="https://twitter.com/LitestarAPI" aria-label="X (Twitter)">
  <iconify-icon icon="prime:twitter"></iconify-icon>
</a>
<a href="https://discord.gg/litestar" aria-label="Discord">
  <iconify-icon icon="simple-icons:discord"></iconify-icon>
</a>
<a href="https://www.reddit.com/r/LitestarAPI" aria-label="Reddit">
  <iconify-icon icon="simple-icons:reddit"></iconify-icon>
</a></div>
    </div>
  </div>
</footer>
      <script src="../../_static/documentation_options.js?v=ad404a94"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../_static/copybutton.js?v=f281be69"></script>
      <script src="../../_static/litestar-theme.js?v=ab2dcc9e"></script>
      <script>let toggleHintShow = 'Click to show';</script>
      <script>let toggleHintHide = 'Click to hide';</script>
      <script>let toggleOpenOnPrint = 'true';</script>
      <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
      <script src="../../_static/design-tabs.js?v=f930bc37"></script>
      <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
      <script src="../../_static/shibuya.js?v=c477d091"></script>
      <script src="../../_static/versioning.js?v=9ab184b9"></script></body>
</html>