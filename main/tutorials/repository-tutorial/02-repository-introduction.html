<!DOCTYPE html>
<html lang="en" data-accent-color="amber" data-content_root="../../">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Interacting with repositories - Litestar Framework</title><link rel="shortcut icon" href="../../_static/favicon.svg"/><link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" /><link rel="next" title="Working with Controllers and Repositories" href="03-repository-controller.html" /><link rel="prev" title="Introduction to Database Modelling and Repository Features" href="01-modelling-and-features.html" /><script>
    function setColorMode(t){let e=document.documentElement;e.setAttribute("data-color-mode",t);let a=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,s=t;"auto"===t&&(s=a?"dark":"light"),"light"===s?(e.classList.remove("dark"),e.classList.add("light")):(e.classList.remove("light"),e.classList.add("dark"))}
    setColorMode(localStorage._theme||"auto");
  </script><link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=397bb51e" />
    <link rel="stylesheet" type="text/css" href="../../_static/shibuya.css?v=76b6f612" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx_paramlinks.css" />
    <link media="print" rel="stylesheet" type="text/css" href="../../_static/print.css?v=20ff2c19" />
    <link rel="stylesheet" type="text/css" href="../../_static/style.css?v=50ea2f63" />
    <link rel="stylesheet" type="text/css" href="../../_static/litestar-sphinx-theme.css?v=f8f74789" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --sy-f-text: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
  --sy-f-heading: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
}
</style>
    <meta property="og:type" content="website"/><meta property="og:title" content="Interacting with repositories"/>
<meta name="twitter:card" content="summary"/>
<meta property="og:image" content="_static/logo-light.png"/>
  </head>
<body><div class="announcement">
    <div class="announcement-inner">
      <p>You are viewing the <bold>local</bold> version of the documentation. Click here to go to the latest version.</p>
      <button class="announcement-close" aria-label="Close announcement">
        <i class="i-lucide close"></i>
      </button>
    </div>
  </div><div class="sy-head">
  <div class="sy-head-blur"></div>
  <div class="sy-head-inner sy-container mx-auto">
    <a class="sy-head-brand" href="/">
      <img class="light-logo" src="../../_static/logo-light.png" alt="Litestar" height="28" loading="lazy" />
      <img class="dark-logo" src="../../_static/logo-dark.png" alt="Litestar" height="28" loading="lazy" />
      <strong>Litestar</strong>
    </a>
    <div class="sy-head-nav" id="head-nav">
      <nav class="sy-head-links"><ul><li class="link"><a href="../../index.html">Home</a></li>
      <li class="link"><button class="js-menu" type="button" id="nav-trigger-2" aria-controls="nav-children-2">
            <span>Community</span>
            <i class="i-lucide chevron-down"></i>
          </button>
        <ul id="nav-children-2" aria-labelledby="nav-trigger-2"><li><a href="../../contribution-guide.html">
                <span>Contributing</span>
                <small>Learn how to contribute to the Litestar project</small>
              </a></li><li><a href="https://github.com/litestar-org/.github?tab=coc-ov-file">
                <span>Code of Conduct</span>
                <small>Review the etiquette for interacting with the Litestar community</small>
              </a></li><li><a href="https://github.com/litestar-org/.github?tab=coc-ov-file#security-ov-file">
                <span>Security</span>
                <small>Overview of Litestar's security protocols</small>
              </a></li></ul>
      </li>
      <li class="link"><button class="js-menu" type="button" id="nav-trigger-3" aria-controls="nav-children-3">
            <span>About</span>
            <i class="i-lucide chevron-down"></i>
          </button>
        <ul id="nav-children-3" aria-labelledby="nav-trigger-3"><li><a href="https://litestar.dev/about/organization">
                <span>Litestar Organization</span>
                <small>Details about the Litestar organization</small>
              </a></li><li><a href="https://litestar.dev/about/litestar-releases">
                <span>Releases</span>
                <small>Explore the release process, versioning, and deprecation policy for Litestar</small>
              </a></li></ul>
      </li>
      <li class="link"><button class="js-menu" type="button" id="nav-trigger-4" aria-controls="nav-children-4">
            <span>Release notes</span>
            <i class="i-lucide chevron-down"></i>
          </button>
        <ul id="nav-children-4" aria-labelledby="nav-trigger-4"><li><a href="../../release-notes/whats-new-3.html">
                <span>What's new in 3.0</span>
                <small>Explore the new features in Litestar 3.0</small>
              </a></li><li><a href="../../release-notes/changelog.html">
                <span>3.x Changelog</span>
                <small>All changes in the 3.x series</small>
              </a></li><li><a href="https://docs.litestar.dev/2/release-notes/changelog.html">
                <span>2.x Changelog</span>
                <small>All changes in the 2.x series</small>
              </a></li></ul>
      </li>
      <li class="link"><button class="js-menu" type="button" id="nav-trigger-5" aria-controls="nav-children-5">
            <span>Help</span>
            <i class="i-lucide chevron-down"></i>
          </button>
        <ul id="nav-children-5" aria-labelledby="nav-trigger-5"><li><a href="https://discord.gg/litestar">
                <span>Discord Help Forum</span>
                <small>Dedicated Discord help forum</small>
              </a></li><li><a href="https://github.com/orgs/litestar-org/discussions">
                <span>GitHub Discussions</span>
                <small>GitHub Discussions</small>
              </a></li><li><a href="https://stackoverflow.com/questions/tagged/litestar">
                <span>Stack Overflow</span>
                <small>We monitor the <code><b>litestar</b></code> tag on Stack Overflow</small>
              </a></li></ul>
      </li><li class="link">
          <a href="https://github.com/sponsors/Litestar-Org">
            <span>Sponsor</span></a>
        </li></ul></nav>
      <div class="sy-head-extra flex items-center print:hidden"><form class="searchbox flex items-center" action="../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <kbd>/</kbd>
</form><div class="nav-versions">
    <button type="button" aria-label="Versions">
      <span class="md:hidden">Versions</span>
      <span class="hidden md:inline">main</span>
      <i class="i-lucide chevron-down"></i>
    </button>
    <div class="nav-versions-choices"><ul><li><a href="/latest">latest</a></li><li><a href="/main">v3 (development)</a></li><li><a href="/2">v2</a></li><li><a href="/1">v1</a></li></ul></div>
  </div><div class="sy-head-socials">
<a href="https://twitter.com/LitestarAPI" aria-label="X (Twitter)">
  <iconify-icon icon="prime:twitter"></iconify-icon>
</a>
  <a href="https://discord.gg/litestar" aria-label="Discord">
    <iconify-icon icon="simple-icons:discord"></iconify-icon>
  </a></div></div>
    </div>
    <div class="sy-head-actions flex items-center shrink-0 print:hidden"><button class="js-theme theme-switch flex items-center"
data-aria-auto="Switch to light color mode"
data-aria-light="Switch to dark color mode"
data-aria-dark="Switch to auto color mode">
<i class="i-lucide theme-icon"></i>
</button><button class="md:hidden flex items-center js-menu" aria-label="Menu" type="button" aria-controls="head-nav" aria-expanded="false">
        <div class="hamburger">
          <span class="hamburger_1"></span>
          <span class="hamburger_2 -translate-x-2"></span>
          <span class="hamburger_3 -translate-x-1"></span>
        </div>
      </button>
    </div>
  </div>
</div>
<div class="sy-page sy-container flex mx-auto">
  <aside id="lside" class="sy-lside md:w-72 md:shrink-0 print:hidden">
    <div class="sy-lside-inner md:sticky">
      <div class="sy-scrollbar p-6"><div class="sidebar-links">
  <ul>
    <li><a class="icon-link" href="https://github.com/orgs/litestar-org/discussions">
  <span class="icon">
    <svg viewBox="0 0 24 24" fill="none">
      <path fill="var(--accent-9)" fill-rule="evenodd" clip-rule="evenodd" d="M11 5a6 6 0 0 0-4.687 9.746c.215.27.315.62.231.954l-.514 2.058a1 1 0 0 0 1.485 1.1l2.848-1.71c.174-.104.374-.15.576-.148H13a6 6 0 0 0 0-12h-2Z"/>
      <circle fill="white" cx="12" cy="11" r="1"/>
      <circle fill="white" cx="9" cy="11" r="1"/>
      <circle fill="white" cx="15" cy="11" r="1"/>
    </svg>
  </span>
  <span class="text">Discussion</span>
</a></li>
  </ul>
</div>
        <div class="globaltoc" data-expand-depth="0"><p class="caption" role="heading" aria-level="3"><span class="caption-text">Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage/index.html">Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../usage/applications.html">Applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/routing/index.html">Routing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../usage/routing/overview.html">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/routing/handlers.html">Route handlers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/routing/parameters.html">Parameters</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/requests.html">Requests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/caching.html">Caching</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/channels.html">Channels</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/cli.html">CLI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/databases/index.html">Databases</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../usage/databases/sqlalchemy/index.html">SQLAlchemy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../usage/databases/sqlalchemy/models_and_repository.html">SQLAlchemy Models &amp; Repository</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../usage/databases/sqlalchemy/plugins/index.html">Plugins</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/databases/piccolo.html">Piccolo ORM</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/debugging.html">Debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/dependency-injection.html">Dependency Injection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/dto/index.html">Data Transfer Object (DTO)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../usage/dto/0-basic-use.html">Basic Use</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/dto/1-abstract-dto.html">AbstractDTO</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/dto/2-creating-custom-dto-classes.html">Implementing Custom DTO Classes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/events.html">Events</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/exceptions.html">Exceptions and exception handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/file_systems.html">File Systems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/htmx.html">HTMX</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/lifecycle-hooks.html">Life Cycle Hooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/logging.html">Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/metrics/index.html">Metrics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../usage/metrics/open-telemetry.html">OpenTelemetry</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/metrics/prometheus.html">Prometheus</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/middleware/index.html">Middleware</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../usage/middleware/using-middleware.html">Using Middleware</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/middleware/builtin-middleware.html">Built-in middleware</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/middleware/creating-middleware.html">Creating Middleware</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/openapi/index.html">OpenAPI</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../usage/openapi/schema_generation.html">Configuring schema generation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/openapi/schema_generation.html#configuring-schema-generation-on-a-route-handler">Configuring schema generation on a route handler</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/openapi/schema_generation.html#accessing-the-openapi-schema-in-code">Accessing the OpenAPI schema in code</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/openapi/schema_generation.html#customizing-pydantic-model-schemas">Customizing Pydantic model schemas</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/openapi/schema_generation.html#customizing-operation-class">Customizing <code class="docutils literal notranslate"><span class="pre">Operation</span></code> class</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/openapi/schema_generation.html#generating-examples">Generating examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/openapi/ui_plugins.html">OpenAPI UI Plugins</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/openapi/ui_plugins.html#using-openapi-ui-plugins">Using OpenAPI UI Plugins</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/openapi/ui_plugins.html#configuring-openapi-ui-plugins">Configuring OpenAPI UI Plugins</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/openapi/ui_plugins.html#configuring-the-openapi-root-path">Configuring the OpenAPI Root Path</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/openapi/ui_plugins.html#building-your-own-openapi-ui-plugin">Building your own OpenAPI UI Plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/openapi/ui_plugins.html#interacting-with-the-router">Interacting with the <code class="docutils literal notranslate"><span class="pre">Router</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/openapi/ui_plugins.html#oauth2-in-swagger-ui">OAuth2 in Swagger UI</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/openapi/ui_plugins.html#customizing-the-openapi-ui">Customizing the OpenAPI UI</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/openapi/ui_plugins.html#cdn-and-offline-file-support">CDN and offline file support</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/plugins/index.html">Plugins</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../usage/plugins/flash_messages.html">Flash Messages</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/plugins/problem_details.html">Problem Details</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/responses.html">Responses</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/security/index.html">Security</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../usage/security/abstract-authentication-middleware.html">Implementing Custom Authentication</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/security/security-backends.html">Security Backends</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/security/guards.html">Guards</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/security/excluding-and-including-endpoints.html">Excluding and including endpoints</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/security/jwt.html">JWT Security Backends</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/security/secret-datastructures.html">Handling Secrets</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/static-files.html">Static files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/custom-types.html">Custom types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/stores.html">Stores</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/templating.html">Templating</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/testing.html">Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/websockets.html">WebSockets</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/index.html">API reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../reference/app.html">app</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/background_tasks.html">background_tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/channels/index.html">channels</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/channels/plugin.html">plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/channels/subscriber.html">subscriber</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/channels/backends/index.html">backends</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference/channels/backends/base.html">base</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/channels/backends/memory.html">memory</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/channels/backends/redis.html">redis</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/channels/backends/psycopg.html">psycopg</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/channels/backends/asyncpg.html">asyncpg</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/cli.html">cli</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/config.html">config</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/connection.html">connection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/contrib/index.html">contrib</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/contrib/jinja.html">jinja</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/contrib/mako.html">mako</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/contrib/opentelemetry.html">opentelemetry</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/controller.html">controller</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/concurrency.html">concurrency</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/data_extractors.html">data_extractors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/datastructures/index.html">datastructures</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/datastructures/secret_values.html">secret_values</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/di.html">di</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/dto/index.html">dto</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/dto/config.html">config</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/dto/data_structures.html">data_structures</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/dto/field.html">field</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/dto/types.html">types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/dto/base_dto.html">base_dto</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/dto/msgspec_dto.html">msgspec_dto</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/dto/dataclass_dto.html">dataclass_dto</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/enums.html">enums</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/events.html">events</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/exceptions.html">exceptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/file_system.html">file_system</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/handlers.html">handlers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/logging/index.html">logging</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/logging/config.html">config</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/logging/picologging.html">picologging</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/logging/standard.html">standard</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/middleware/index.html">middleware</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/middleware/allowed_hosts.html">allowed_hosts</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/middleware/authentication.html">authentication</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/middleware/compression.html">compression</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/middleware/csrf.html">csrf</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/middleware/logging.html">logging</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/middleware/rate_limit.html">rate_limit</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/middleware/session/index.html">session</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference/middleware/session/base.html">base</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/middleware/session/client_side.html">client_side</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/middleware/session/server_side.html">server_side</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/middleware/constraints.html">constraints</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/openapi/index.html">openapi</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/openapi/openapi.html">openapi</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/openapi/plugins.html">plugins</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/openapi/spec.html">spec</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/pagination.html">pagination</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/params.html">params</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/plugins/index.html">plugins</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/plugins/attrs.html">attrs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/plugins/flash_messages.html">flash</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/plugins/htmx.html">htmx</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/plugins/problem_details.html">problem details</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/plugins/prometheus.html">prometheus</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/plugins/pydantic.html">pydantic</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/plugins/structlog.html">structlog</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/repository/index.html">repository</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/repository/abc.html">abc</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/repository/filters.html">filters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/repository/exceptions.html">exceptions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/repository/testing.html">testing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/repository/handlers.html">handlers</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/response/index.html">response</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/response/base.html">base</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/response/file.html">file</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/response/redirect.html">redirect</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/response/streaming.html">streaming</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/response/sse.html">SSE (Server Sent Events)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/response/template.html">template</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/router.html">router</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/routes.html">routes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/security/index.html">security</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/security/jwt.html">jwt</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/security/session_auth.html">session_auth</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/serialization.html">serialization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/static_files.html">static_files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/status_codes.html">status_code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/stores/index.html">stores</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/stores/base.html">base</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/stores/file.html">file</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/stores/memory.html">memory</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/stores/redis.html">redis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/stores/registry.html">registry</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/stores/valkey.html">valkey</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/template.html">template</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/testing.html">testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/types.html">types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/typing.html">typing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../benchmarks.html">Benchmarks</a></li>
</ul>
<p class="caption" role="heading" aria-level="3"><span class="caption-text">Guides</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../migration/index.html">Migrating to Litestar</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../migration/flask.html">From Flask</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../migration/fastapi.html">From Starlette / FastAPI</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../topics/index.html">Topics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../topics/sync-vs-async.html">Sync vs. Async</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../topics/deployment/index.html">Deployment</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../topics/deployment/nginx-unit.html">NGINX Unit</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../topics/deployment/manually-with-asgi-server.html">Manually with ASGI server</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../topics/deployment/docker.html">Docker</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../topics/deployment/supervisor.html">Supervisor (Linux)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../todo-app/index.html">Developing a basic TODO application</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../todo-app/0-application-basics.html">Application basics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../todo-app/1-accessing-the-list.html">Accessing the list</a></li>
<li class="toctree-l3"><a class="reference internal" href="../todo-app/2-interacting-with-the-list.html">Making the list interactive</a></li>
<li class="toctree-l3"><a class="reference internal" href="../todo-app/3-assembling-the-app.html">Recap and assembling the final application</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../sqlalchemy/index.html">Improving the TODO app with SQLAlchemy</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../sqlalchemy/0-introduction.html">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sqlalchemy/1-provide-session-with-di.html">Providing the session with DI</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sqlalchemy/2-serialization-plugin.html">Using the serialization plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sqlalchemy/3-init-plugin.html">Using the init plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sqlalchemy/4-final-touches-and-recap.html">Final touches and recap</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../dto-tutorial/index.html">Data Transfer Object Tutorial</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../dto-tutorial/01-simple-dto-exclude.html">Our first DTO</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dto-tutorial/02-nested-exclude.html">Excluding from nested models</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dto-tutorial/03-nested-collection-exclude.html">Excluding from collections of nested models</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dto-tutorial/04-max-nested-depth.html">Max nested depth</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dto-tutorial/05-renaming-fields.html">Renaming fields</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dto-tutorial/06-receiving-data.html">Receiving data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dto-tutorial/07-read-only-fields.html">Read only fields</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dto-tutorial/08-dto-data.html">Accessing the data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dto-tutorial/09-updating.html">Updating instances</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dto-tutorial/10-layered-dto-declarations.html">Declaring DTOs on app layers</a></li>
</ul>
</li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">SQLAlchemy Repository Tutorial</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="01-modelling-and-features.html">Introduction to Database Modelling and Repository Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="01-modelling-and-features.html#modelling">Modelling</a></li>
<li class="toctree-l3"><a class="reference internal" href="01-modelling-and-features.html#full-code">Full Code</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Interacting with repositories</a></li>
<li class="toctree-l3"><a class="reference internal" href="#working-with-bulk-data-operations">Working with Bulk Data Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#full-code">Full Code</a></li>
<li class="toctree-l3"><a class="reference internal" href="03-repository-controller.html">Working with Controllers and Repositories</a></li>
<li class="toctree-l3"><a class="reference internal" href="03-repository-controller.html#full-code">Full Code</a></li>
<li class="toctree-l3"><a class="reference internal" href="04-repository-other.html">Adding Additional Features to the Repository</a></li>
<li class="toctree-l3"><a class="reference internal" href="04-repository-other.html#slug-fields">Slug Fields</a></li>
<li class="toctree-l3"><a class="reference internal" href="04-repository-other.html#full-code">Full Code</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading" aria-level="3"><span class="caption-text">Contributing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contribution-guide.html">Contribution Guide</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/search?q=user%3Alitestar-org+state%3Aopen+label%3A%22good+first+issue%22+++no%3Aassignee+&amp;type=issues=">Available Issues</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/litestar-org/.github?tab=coc-ov-file#readme">Code of Conduct</a></li>
</ul>

        </div>
      </div>
    </div>
  </aside>
  <div class="lside-overlay js-menu" role="button" aria-label="Close left sidebar" aria-controls="lside" aria-expanded="false"></div>
  <aside id="rside" class="sy-rside pb-3 w-64 shrink-0 order-last">
    <button class="rside-close js-menu xl:hidden" aria-label="Close Table of Contents" type="button" aria-controls="rside" aria-expanded="false">
      <i class="i-lucide close"></i>
    </button>
    <div class="sy-scrollbar sy-rside-inner px-6 xl:top-16 xl:sticky xl:pl-0 pt-6 pb-4"><div class="localtoc"><h3>On this page</h3><ul>
<li><a class="reference internal" href="#">Interacting with repositories</a><ul>
<li><a class="reference internal" href="#model-repository">Model Repository</a></li>
<li><a class="reference internal" href="#repository-context-manager">Repository Context Manager</a></li>
<li><a class="reference internal" href="#creating-updating-and-removing-data">Creating, Updating and Removing Data</a></li>
</ul>
</li>
<li><a class="reference internal" href="#working-with-bulk-data-operations">Working with Bulk Data Operations</a><ul>
<li><a class="reference internal" href="#fixture-data-loading">Fixture Data Loading</a></li>
<li><a class="reference internal" href="#bulk-insert">Bulk Insert</a></li>
<li><a class="reference internal" href="#paginated-data-selection">Paginated Data Selection</a></li>
<li><a class="reference internal" href="#bulk-delete">Bulk Delete</a></li>
<li><a class="reference internal" href="#counts">Counts</a></li>
</ul>
</li>
<li><a class="reference internal" href="#full-code">Full Code</a></li>
</ul>
</div><a class="js-repo-stats repo-stats flex items-center" href="https://github.com/litestar-org/litestar"
  data-type="github" data-user="litestar-org" data-repo="litestar">
  <span class="w-8 flex items-center justify-around shrink-0 text-3xl">
    <iconify-icon icon="simple-icons:github"></iconify-icon>
  </span>
  <span class="flex-grow px-2 break-all">
    <span>litestar-org/litestar</span>
    <span class="flex text-sm repo-stats-count">
      <span class="flex items-center pr-3">
        <iconify-icon icon="lucide:star"></iconify-icon>
        <strong class="js-repo-stars ml-1">0</strong>
      </span>
      <span class="flex items-center">
        <iconify-icon icon="lucide:git-fork"></iconify-icon>
        <strong class="js-repo-forks ml-1">0</strong>
      </span>
    </span>
  </span>
</a><div class="edit-this-page">
  <a href="https://github.com/litestar-org/litestar/blob/main/docs/tutorials/repository-tutorial/02-repository-introduction.rst">Edit this page</a>
</div><div id="ethical-ad-placement" data-ea-publisher="readthedocs"></div></div>
  </aside>
  <div class="rside-overlay js-menu" role="button" aria-label="Close Table of Contents" aria-controls="rside" aria-expanded="false"></div>
  <main class="sy-main w-full max-sm:max-w-full print:pt-6">
<div class="sy-breadcrumbs" role="navigation">
  <div class="sy-breadcrumbs-inner flex items-center">
    <div class="md:hidden mr-3">
      <button class="js-menu" aria-label="Menu" type="button" aria-controls="lside" aria-expanded="false">
        <i class="i-lucide menu"></i>
      </button>
    </div>
    <ol class="flex-1" itemscope itemtype="https://schema.org/BreadcrumbList"><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="../../index.html"><span itemprop="name">Litestar</span></a>
        <span>/</span>
        <meta itemprop="position" content="1" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="../index.html"><span itemprop="name">Tutorials</span></a>
        <span>/</span>
        <meta itemprop="position" content="2" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="index.html"><span itemprop="name">SQLAlchemy Repository Tutorial</span></a>
        <span>/</span>
        <meta itemprop="position" content="3" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <strong itemprop="name">Interacting with repositories</strong>
        <meta itemprop="position" content="4" />
      </li></ol>
    <div class="xl:hidden ml-1">
      <button class="js-menu" aria-label="Show table of contents" type="button" aria-controls="rside"
        aria-expanded="false">
        <i class="i-lucide outdent"></i>
      </button>
    </div>
  </div>
</div><div class="flex flex-col break-words justify-between">
      <div class="min-w-0 max-w-6xl px-6 pb-6 pt-8 xl:px-12">
        <article class="yue" role="main">
          <section id="interacting-with-repositories">
<h1>Interacting with repositories<a class="headerlink" href="#interacting-with-repositories" title="Link to this heading">¶</a></h1>
<p>Now that we’ve covered the modelling basics, we are able to create our first repository
class.  The repository classes include all of the standard CRUD operations as well as a
few advanced features such as pagination, filtering and bulk operations.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The full code for this tutorial can be found below in the <a class="reference internal" href="#repo-full-code"><span class="std std-ref">Full Code</span></a> section.</p>
</div>
<p>Before we jump in to the code, let’s take a look at the available functions available in
the the synchronous and asynchronous repositories.</p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
<span class="sd-summary-text">Available Functions in the Repositories</span><span class="sd-summary-state-marker sd-summary-chevron-right"><svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-right" viewBox="0 0 24 24" aria-hidden="true"><path d="M8.72 18.78a.75.75 0 0 1 0-1.06L14.44 12 8.72 6.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0Z"></path></svg></span></summary><div class="sd-summary-content sd-card-body docutils">
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p class="sd-card-text">Function</p></th>
<th class="head"><p class="sd-card-text">Category</p></th>
<th class="head"><p class="sd-card-text">Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p class="sd-card-text"><code class="docutils literal notranslate"><span class="pre">get</span></code></p></td>
<td><p class="sd-card-text">Selecting Data</p></td>
<td><p class="sd-card-text">Select a single record by primary key. Raises an exception when no record is found.</p></td>
</tr>
<tr class="row-odd"><td><p class="sd-card-text"><code class="docutils literal notranslate"><span class="pre">get_one</span></code></p></td>
<td><p class="sd-card-text">Selecting Data</p></td>
<td><p class="sd-card-text">Select a single record specified by the <code class="docutils literal notranslate"><span class="pre">kwargs</span></code> parameters. Raises an exception when no record is found.</p></td>
</tr>
<tr class="row-even"><td><p class="sd-card-text"><code class="docutils literal notranslate"><span class="pre">get_one_or_none</span></code></p></td>
<td><p class="sd-card-text">Selecting Data</p></td>
<td><p class="sd-card-text">Select a single record specified by the <code class="docutils literal notranslate"><span class="pre">kwargs</span></code> parameters. Returns <code class="docutils literal notranslate"><span class="pre">None</span></code> when no record is found.</p></td>
</tr>
<tr class="row-odd"><td><p class="sd-card-text"><code class="docutils literal notranslate"><span class="pre">list</span></code></p></td>
<td><p class="sd-card-text">Selecting Data</p></td>
<td><p class="sd-card-text">Select a list of records specified by the <code class="docutils literal notranslate"><span class="pre">kwargs</span></code> parameters. Optionally it can be filtered by the included <code class="docutils literal notranslate"><span class="pre">FilterTypes</span></code> args.</p></td>
</tr>
<tr class="row-even"><td><p class="sd-card-text"><code class="docutils literal notranslate"><span class="pre">list_and_count</span></code></p></td>
<td><p class="sd-card-text">Selecting Data</p></td>
<td><p class="sd-card-text">Select a list of records specified by the <code class="docutils literal notranslate"><span class="pre">kwargs</span></code> parameters. Optionally it can be filtered by the included <code class="docutils literal notranslate"><span class="pre">FilterTypes</span></code> args. Results are returned as a 2 value tuple that includes the rows selected and the total count of records.</p></td>
</tr>
<tr class="row-odd"><td><p class="sd-card-text"><code class="docutils literal notranslate"><span class="pre">get_or_create</span></code></p></td>
<td><p class="sd-card-text">Creating Data</p></td>
<td><p class="sd-card-text">Select a single record specified by the the <code class="docutils literal notranslate"><span class="pre">kwargs</span></code> parameters.  If no record is found, one is created with the given values.  There’s an optional attribute to filter on a subset of the supplied parameters and to merge updates.</p></td>
</tr>
<tr class="row-even"><td><p class="sd-card-text"><code class="docutils literal notranslate"><span class="pre">create</span></code></p></td>
<td><p class="sd-card-text">Creating Data</p></td>
<td><p class="sd-card-text">Create a new record in the database.</p></td>
</tr>
<tr class="row-odd"><td><p class="sd-card-text"><code class="docutils literal notranslate"><span class="pre">create_many</span></code></p></td>
<td><p class="sd-card-text">Creating Data</p></td>
<td><p class="sd-card-text">Create one or more rows in the database.</p></td>
</tr>
<tr class="row-even"><td><p class="sd-card-text"><code class="docutils literal notranslate"><span class="pre">update</span></code></p></td>
<td><p class="sd-card-text">Updating Data</p></td>
<td><p class="sd-card-text">Update an existing record in the database.</p></td>
</tr>
<tr class="row-odd"><td><p class="sd-card-text"><code class="docutils literal notranslate"><span class="pre">update_many</span></code></p></td>
<td><p class="sd-card-text">Updating Data</p></td>
<td><p class="sd-card-text">Update one or more rows in the database.</p></td>
</tr>
<tr class="row-even"><td><p class="sd-card-text"><code class="docutils literal notranslate"><span class="pre">upsert</span></code></p></td>
<td><p class="sd-card-text">Updating Data</p></td>
<td><p class="sd-card-text">A single operation that updates or inserts a record based whether or not the primary key value on the model object is populated.</p></td>
</tr>
<tr class="row-odd"><td><p class="sd-card-text"><code class="docutils literal notranslate"><span class="pre">upsert_many</span></code></p></td>
<td><p class="sd-card-text">Updating Data</p></td>
<td><p class="sd-card-text">Updates or inserts multiple records based whether or not the primary key value on the model object is populated.</p></td>
</tr>
<tr class="row-even"><td><p class="sd-card-text"><code class="docutils literal notranslate"><span class="pre">remove</span></code></p></td>
<td><p class="sd-card-text">Removing Data</p></td>
<td><p class="sd-card-text">Remove a single record from the database.</p></td>
</tr>
<tr class="row-odd"><td><p class="sd-card-text"><code class="docutils literal notranslate"><span class="pre">remove_many</span></code></p></td>
<td><p class="sd-card-text">Removing Data</p></td>
<td><p class="sd-card-text">Remove one or more records from the database.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</details><div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>All three of the bulk DML operations will leverage dialect-specific enhancements
to be as efficient as possible. In addition to using efficient bulk inserts binds,
the repository will optionally leverage the multi-row <code class="docutils literal notranslate"><span class="pre">RETURNING</span></code> support where
possible. The repository will automatically detect this support from the
SQLAlchemy driver, so no additional interaction is required to enable this.</p></li>
<li><p>SQL engines generally have a limit to the number of elements that can be appended
into an <cite>IN</cite> clause. The repository operations will automatically break lists that
exceed this limit into multiple queries that are concatenated together before
return. You do not need to account for this in your own code.</p></li>
</ul>
</div>
<p>In the following examples, we’ll cover a few ways that you can use the repository within
your applications.</p>
<section id="model-repository">
<h2>Model Repository<a class="headerlink" href="#model-repository" title="Link to this heading">¶</a></h2>
<p>Here we import the
<code class="xref py py-class docutils literal notranslate"><span class="pre">SQLAlchemyAsyncRepository</span></code>
class and create an <code class="docutils literal notranslate"><span class="pre">AuthorRepository</span></code> repository class. This is all that’s required
to include all of the integrated repository features.</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">app.py</span></code></span><a class="headerlink" href="#id1" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="linenos"> 1</span><span class="kn">from</span><span class="w"> </span><span class="nn">rich</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_console</span>
</span><span data-line="2"><span class="linenos"> 2</span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">Mapped</span>
</span><span data-line="3"><span class="linenos"> 3</span>
</span><span data-line="4"><span class="linenos"> 4</span><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.plugins.sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">base</span><span class="p">,</span> <span class="n">repository</span>
</span><span data-line="5"><span class="linenos"> 5</span>
</span><span data-line="6"><span class="linenos"> 6</span><span class="n">console</span> <span class="o">=</span> <span class="n">get_console</span><span class="p">()</span>
</span><span data-line="7"><span class="linenos"> 7</span>
</span><span data-line="8"><span class="linenos"> 8</span>
</span><span data-line="9"><span class="linenos"> 9</span><span class="c1"># the SQLAlchemy base includes a declarative model for you to use in your models.</span>
</span><span data-line="10"><span class="linenos">10</span><span class="c1"># The `Base` class includes a `UUID` based primary key (`id`)</span>
</span><span data-line="11"><span class="linenos">11</span><span class="k">class</span><span class="w"> </span><span class="nc">Author</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">UUIDBase</span><span class="p">):</span>
</span><span data-line="12"><span class="linenos">12</span>    <span class="n">name</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</span><span data-line="13"><span class="linenos">13</span>    <span class="n">dob</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">date</span><span class="p">]</span>
</span><span data-line="14"><span class="linenos">14</span>    <span class="n">dod</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">date</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]</span>
</span><span data-line="15"><span class="linenos">15</span>
</span><span data-line="16"><span class="linenos">16</span>
</span><span data-line="17"><span class="linenos">17</span><span class="k">class</span><span class="w"> </span><span class="nc">AuthorRepository</span><span class="p">(</span><span class="n">repository</span><span class="o">.</span><span class="n">SQLAlchemyAsyncRepository</span><span class="p">[</span><span class="n">Author</span><span class="p">]):</span>
</span><span data-line="18"><span class="linenos">18</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Author repository.&quot;&quot;&quot;</span>
</span><span data-line="19"><span class="linenos">19</span>
</span><span data-line="20"><span class="linenos">20</span>    <span class="n">model_type</span> <span class="o">=</span> <span class="n">Author</span>
</span></pre></div>
</div>
</div>
</section>
<section id="repository-context-manager">
<h2>Repository Context Manager<a class="headerlink" href="#repository-context-manager" title="Link to this heading">¶</a></h2>
<p>Since we’ll be using the repository outside of a Litestar application in this script,
we’ll make a simple context manager to automatically handle the creation (and cleanup)
of our Author repository.</p>
<dl class="simple">
<dt>The <code class="docutils literal notranslate"><span class="pre">repository_factory</span></code> method will do the following for us:</dt><dd><ul class="simple">
<li><p>Automatically create a new DB session from the SQLAlchemy configuration.</p></li>
<li><p>Rollback session when any exception occurs.</p></li>
<li><p>Automatically commit after function call completes.</p></li>
</ul>
</dd>
</dl>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">app.py</span></code></span><a class="headerlink" href="#id2" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="linenos">1</span><span class="c1"># let&#39;s make a simple context manager as an example here.</span>
</span><span data-line="2"><span class="linenos">2</span><span class="nd">@asynccontextmanager</span>
</span><span data-line="3"><span class="linenos">3</span><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">repository_factory</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">AuthorRepository</span><span class="p">]:</span>
</span><span data-line="4"><span class="linenos">4</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">session_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">db_session</span><span class="p">:</span>
</span><span data-line="5"><span class="linenos">5</span>        <span class="k">try</span><span class="p">:</span>
</span><span data-line="6"><span class="linenos">6</span>            <span class="k">yield</span> <span class="n">AuthorRepository</span><span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="n">db_session</span><span class="p">)</span>
</span><span data-line="7"><span class="linenos">7</span>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>  <span class="c1"># noqa: BLE001</span>
</span><span data-line="8"><span class="linenos">8</span>            <span class="k">await</span> <span class="n">db_session</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
</span><span data-line="9"><span class="linenos">9</span>        <span class="k">else</span><span class="p">:</span>
</span></pre></div>
</div>
</div>
</section>
<section id="creating-updating-and-removing-data">
<h2>Creating, Updating and Removing Data<a class="headerlink" href="#creating-updating-and-removing-data" title="Link to this heading">¶</a></h2>
<p>To illustrate a few ways you can manipulate data in your database, we’ll go through the
various CRUD operations:</p>
<p>Creating Data: Here’s a simple insert operation to populate our new Author table:</p>
<blockquote>
<div><div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">app.py</span></code></span><a class="headerlink" href="#id3" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="linenos">1</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">repository_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">repo</span><span class="p">:</span>
</span><span data-line="2"><span class="linenos">2</span>        <span class="n">obj</span> <span class="o">=</span> <span class="k">await</span> <span class="n">repo</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
</span><span data-line="3"><span class="linenos">3</span>            <span class="n">Author</span><span class="p">(</span>
</span><span data-line="4"><span class="linenos">4</span>                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;F. Scott Fitzgerald&quot;</span><span class="p">,</span>
</span><span data-line="5"><span class="linenos">5</span>                <span class="n">dob</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s2">&quot;1896-09-24&quot;</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">(),</span>
</span><span data-line="6"><span class="linenos">6</span>            <span class="p">)</span>
</span><span data-line="7"><span class="linenos">7</span>        <span class="p">)</span>
</span><span data-line="8"><span class="linenos">8</span>        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created Author record for </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> with primary key </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</span><span data-line="9"><span class="linenos">9</span>        <span class="k">return</span> <span class="n">obj</span>
</span></pre></div>
</div>
</div>
</div></blockquote>
<p>Updating Data: The <code class="docutils literal notranslate"><span class="pre">update</span></code> method will ensure any updates made to the model object are executed on the database:</p>
<blockquote>
<div><div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">app.py</span></code></span><a class="headerlink" href="#id4" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="linenos">1</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">repository_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">repo</span><span class="p">:</span>
</span><span data-line="2"><span class="linenos">2</span>        <span class="n">obj</span> <span class="o">=</span> <span class="k">await</span> <span class="n">repo</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</span><span data-line="3"><span class="linenos">3</span>        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updated Author record for </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> with primary key </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</span><span data-line="4"><span class="linenos">4</span>        <span class="k">return</span> <span class="n">obj</span>
</span></pre></div>
</div>
</div>
</div></blockquote>
<p>Removing Data: The <code class="docutils literal notranslate"><span class="pre">remove</span></code> method accepts the primary key of the row you want to delete:</p>
<blockquote>
<div><div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">app.py</span></code></span><a class="headerlink" href="#id5" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="linenos">1</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">repository_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">repo</span><span class="p">:</span>
</span><span data-line="2"><span class="linenos">2</span>        <span class="n">obj</span> <span class="o">=</span> <span class="k">await</span> <span class="n">repo</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
</span><span data-line="3"><span class="linenos">3</span>        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Deleted Author record for </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> with primary key </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</span><span data-line="4"><span class="linenos">4</span>        <span class="k">return</span> <span class="n">obj</span>
</span></pre></div>
</div>
</div>
</div></blockquote>
<p>Now that we’ve seen how to do single-row operations, let’s look at the bulk methods we
can use.</p>
</section>
</section>
<section id="working-with-bulk-data-operations">
<h1>Working with Bulk Data Operations<a class="headerlink" href="#working-with-bulk-data-operations" title="Link to this heading">¶</a></h1>
<p>In this section, we delve into the powerful capabilities of the repository classes for
handling bulk data operations. Our example illustrates how we can efficiently manage
data in our database. Specifically, we’ll use a JSON file containing information about
US states and their abbreviations.</p>
<p>Here’s what we’re going to cover:</p>
<section id="fixture-data-loading">
<h2>Fixture Data Loading<a class="headerlink" href="#fixture-data-loading" title="Link to this heading">¶</a></h2>
<p>We will introduce a method for loading fixture data. Fixture data is sample data that
populates your database and helps test the behavior of your application under realistic
conditions. This pattern can be extended and adjusted to meet your needs.</p>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">app.py</span></code></span><a class="headerlink" href="#id6" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="linenos"> 1</span><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
</span><span data-line="2"><span class="linenos"> 2</span><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span data-line="3"><span class="linenos"> 3</span><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span>
</span><span data-line="4"><span class="linenos"> 4</span>
</span><span data-line="5"><span class="linenos"> 5</span>
</span><span data-line="6"><span class="linenos"> 6</span><span class="k">def</span><span class="w"> </span><span class="nf">open_fixture</span><span class="p">(</span><span class="n">fixtures_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">fixture_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span data-line="7"><span class="linenos"> 7</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Loads JSON file with the specified fixture name</span>
</span><span data-line="8"><span class="linenos"> 8</span>
</span><span data-line="9"><span class="linenos"> 9</span><span class="sd">    Args:</span>
</span><span data-line="10"><span class="linenos">10</span><span class="sd">        fixtures_path (Path): The path to look for fixtures</span>
</span><span data-line="11"><span class="linenos">11</span><span class="sd">        fixture_name (str): The fixture name to load.</span>
</span><span data-line="12"><span class="linenos">12</span>
</span><span data-line="13"><span class="linenos">13</span><span class="sd">    Raises:</span>
</span><span data-line="14"><span class="linenos">14</span><span class="sd">        FileNotFoundError: Fixtures not found.</span>
</span><span data-line="15"><span class="linenos">15</span>
</span><span data-line="16"><span class="linenos">16</span><span class="sd">    Returns:</span>
</span><span data-line="17"><span class="linenos">17</span><span class="sd">        Any: The parsed JSON data</span>
</span><span data-line="18"><span class="linenos">18</span><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="19"><span class="linenos">19</span>    <span class="n">fixture</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">fixtures_path</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fixture_name</span><span class="si">}</span><span class="s2">.json&quot;</span><span class="p">)</span>
</span><span data-line="20"><span class="linenos">20</span>    <span class="k">if</span> <span class="n">fixture</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span data-line="21"><span class="linenos">21</span>        <span class="k">with</span> <span class="n">fixture</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span data-line="22"><span class="linenos">22</span>            <span class="n">f_data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span data-line="23"><span class="linenos">23</span>        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">f_data</span><span class="p">)</span>
</span><span data-line="24"><span class="linenos">24</span>    <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find the </span><span class="si">{</span><span class="n">fixture_name</span><span class="si">}</span><span class="s2"> fixture&quot;</span><span class="p">)</span>
</span></pre></div>
</div>
</div>
<p>You can review the JSON source file here:</p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
<span class="sd-summary-text">US State Lookup JSON</span><span class="sd-summary-state-marker sd-summary-chevron-right"><svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-right" viewBox="0 0 24 24" aria-hidden="true"><path d="M8.72 18.78a.75.75 0 0 1 0-1.06L14.44 12 8.72 6.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0Z"></path></svg></span></summary><div class="sd-summary-content sd-card-body docutils">
<p class="sd-card-text">You can download it: <a class="reference download internal" download="" href="../../_downloads/e2818f594bbd64275770c0d94766d1e0/us_state_lookup.json"><code class="xref download docutils literal notranslate"><span class="pre">/examples/sqla/us_state_lookup.json</span></code></a>
or view below:</p>
<div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">us_state_lookup.json</span></code></span><a class="headerlink" href="#id7" title="Link to this code">¶</a></div>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="p">[</span>
</span><span data-line="2"><span class="w">  </span><span class="p">{</span>
</span><span data-line="3"><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Alabama&quot;</span><span class="p">,</span>
</span><span data-line="4"><span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AL&quot;</span>
</span><span data-line="5"><span class="w">  </span><span class="p">},</span>
</span><span data-line="6"><span class="w">  </span><span class="p">{</span>
</span><span data-line="7"><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Alaska&quot;</span><span class="p">,</span>
</span><span data-line="8"><span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AK&quot;</span>
</span><span data-line="9"><span class="w">  </span><span class="p">},</span>
</span><span data-line="10"><span class="w">  </span><span class="p">{</span>
</span><span data-line="11"><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Arizona&quot;</span><span class="p">,</span>
</span><span data-line="12"><span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AZ&quot;</span>
</span><span data-line="13"><span class="w">  </span><span class="p">},</span>
</span><span data-line="14"><span class="w">  </span><span class="p">{</span>
</span><span data-line="15"><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Arkansas&quot;</span><span class="p">,</span>
</span><span data-line="16"><span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AR&quot;</span>
</span><span data-line="17"><span class="w">  </span><span class="p">},</span>
</span><span data-line="18"><span class="w">  </span><span class="p">{</span>
</span><span data-line="19"><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;California&quot;</span><span class="p">,</span>
</span><span data-line="20"><span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;CA&quot;</span>
</span><span data-line="21"><span class="w">  </span><span class="p">},</span>
</span><span data-line="22"><span class="w">  </span><span class="p">{</span>
</span><span data-line="23"><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Colorado&quot;</span><span class="p">,</span>
</span><span data-line="24"><span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;CO&quot;</span>
</span><span data-line="25"><span class="w">  </span><span class="p">},</span>
</span><span data-line="26"><span class="w">  </span><span class="p">{</span>
</span><span data-line="27"><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Connecticut&quot;</span><span class="p">,</span>
</span><span data-line="28"><span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;CT&quot;</span>
</span><span data-line="29"><span class="w">  </span><span class="p">},</span>
</span><span data-line="30"><span class="w">  </span><span class="p">{</span>
</span><span data-line="31"><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Delaware&quot;</span><span class="p">,</span>
</span><span data-line="32"><span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;DE&quot;</span>
</span><span data-line="33"><span class="w">  </span><span class="p">},</span>
</span><span data-line="34"><span class="w">  </span><span class="p">{</span>
</span><span data-line="35"><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;District Of Columbia&quot;</span><span class="p">,</span>
</span><span data-line="36"><span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;DC&quot;</span>
</span><span data-line="37"><span class="w">  </span><span class="p">},</span>
</span><span data-line="38"><span class="w">  </span><span class="p">{</span>
</span><span data-line="39"><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Florida&quot;</span><span class="p">,</span>
</span><span data-line="40"><span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;FL&quot;</span>
</span><span data-line="41"><span class="w">  </span><span class="p">},</span>
</span><span data-line="42"><span class="w">  </span><span class="p">{</span>
</span><span data-line="43"><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Georgia&quot;</span><span class="p">,</span>
</span><span data-line="44"><span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GA&quot;</span>
</span><span data-line="45"><span class="w">  </span><span class="p">},</span>
</span><span data-line="46"><span class="w">  </span><span class="p">{</span>
</span><span data-line="47"><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Guam&quot;</span><span class="p">,</span>
</span><span data-line="48"><span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GU&quot;</span>
</span><span data-line="49"><span class="w">  </span><span class="p">},</span>
</span><span data-line="50"><span class="w">  </span><span class="p">{</span>
</span><span data-line="51"><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Hawaii&quot;</span><span class="p">,</span>
</span><span data-line="52"><span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;HI&quot;</span>
</span><span data-line="53"><span class="w">  </span><span class="p">},</span>
</span><span data-line="54"><span class="w">  </span><span class="p">{</span>
</span><span data-line="55"><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Idaho&quot;</span><span class="p">,</span>
</span><span data-line="56"><span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ID&quot;</span>
</span><span data-line="57"><span class="w">  </span><span class="p">},</span>
</span><span data-line="58"><span class="w">  </span><span class="p">{</span>
</span><span data-line="59"><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Illinois&quot;</span><span class="p">,</span>
</span><span data-line="60"><span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;IL&quot;</span>
</span><span data-line="61"><span class="w">  </span><span class="p">},</span>
</span><span data-line="62"><span class="w">  </span><span class="p">{</span>
</span><span data-line="63"><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Indiana&quot;</span><span class="p">,</span>
</span><span data-line="64"><span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;IN&quot;</span>
</span><span data-line="65"><span class="w">  </span><span class="p">},</span>
</span><span data-line="66"><span class="w">  </span><span class="p">{</span>
</span><span data-line="67"><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Iowa&quot;</span><span class="p">,</span>
</span><span data-line="68"><span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;IA&quot;</span>
</span><span data-line="69"><span class="w">  </span><span class="p">},</span>
</span><span data-line="70"><span class="w">  </span><span class="p">{</span>
</span><span data-line="71"><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Kansas&quot;</span><span class="p">,</span>
</span><span data-line="72"><span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;KS&quot;</span>
</span><span data-line="73"><span class="w">  </span><span class="p">},</span>
</span><span data-line="74"><span class="w">  </span><span class="p">{</span>
</span><span data-line="75"><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Kentucky&quot;</span><span class="p">,</span>
</span><span data-line="76"><span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;KY&quot;</span>
</span><span data-line="77"><span class="w">  </span><span class="p">},</span>
</span><span data-line="78"><span class="w">  </span><span class="p">{</span>
</span><span data-line="79"><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Louisiana&quot;</span><span class="p">,</span>
</span><span data-line="80"><span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;LA&quot;</span>
</span><span data-line="81"><span class="w">  </span><span class="p">},</span>
</span><span data-line="82"><span class="w">  </span><span class="p">{</span>
</span><span data-line="83"><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Maine&quot;</span><span class="p">,</span>
</span><span data-line="84"><span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ME&quot;</span>
</span><span data-line="85"><span class="w">  </span><span class="p">},</span>
</span><span data-line="86"><span class="w">  </span><span class="p">{</span>
</span><span data-line="87"><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Maryland&quot;</span><span class="p">,</span>
</span><span data-line="88"><span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;MD&quot;</span>
</span><span data-line="89"><span class="w">  </span><span class="p">},</span>
</span><span data-line="90"><span class="w">  </span><span class="p">{</span>
</span><span data-line="91"><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Massachusetts&quot;</span><span class="p">,</span>
</span><span data-line="92"><span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;MA&quot;</span>
</span><span data-line="93"><span class="w">  </span><span class="p">},</span>
</span><span data-line="94"><span class="w">  </span><span class="p">{</span>
</span><span data-line="95"><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Michigan&quot;</span><span class="p">,</span>
</span><span data-line="96"><span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;MI&quot;</span>
</span><span data-line="97"><span class="w">  </span><span class="p">},</span>
</span><span data-line="98"><span class="w">  </span><span class="p">{</span>
</span><span data-line="99"><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Minnesota&quot;</span><span class="p">,</span>
</span><span data-line="100"><span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;MN&quot;</span>
</span><span data-line="101"><span class="w">  </span><span class="p">},</span>
</span><span data-line="102"><span class="w">  </span><span class="p">{</span>
</span><span data-line="103"><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Mississippi&quot;</span><span class="p">,</span>
</span><span data-line="104"><span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;MS&quot;</span>
</span><span data-line="105"><span class="w">  </span><span class="p">},</span>
</span><span data-line="106"><span class="w">  </span><span class="p">{</span>
</span><span data-line="107"><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Missouri&quot;</span><span class="p">,</span>
</span><span data-line="108"><span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;MO&quot;</span>
</span><span data-line="109"><span class="w">  </span><span class="p">},</span>
</span><span data-line="110"><span class="w">  </span><span class="p">{</span>
</span><span data-line="111"><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Montana&quot;</span><span class="p">,</span>
</span><span data-line="112"><span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;MT&quot;</span>
</span><span data-line="113"><span class="w">  </span><span class="p">},</span>
</span><span data-line="114"><span class="w">  </span><span class="p">{</span>
</span><span data-line="115"><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Nebraska&quot;</span><span class="p">,</span>
</span><span data-line="116"><span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;NE&quot;</span>
</span><span data-line="117"><span class="w">  </span><span class="p">},</span>
</span><span data-line="118"><span class="w">  </span><span class="p">{</span>
</span><span data-line="119"><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Nevada&quot;</span><span class="p">,</span>
</span><span data-line="120"><span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;NV&quot;</span>
</span><span data-line="121"><span class="w">  </span><span class="p">},</span>
</span><span data-line="122"><span class="w">  </span><span class="p">{</span>
</span><span data-line="123"><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;New Hampshire&quot;</span><span class="p">,</span>
</span><span data-line="124"><span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;NH&quot;</span>
</span><span data-line="125"><span class="w">  </span><span class="p">},</span>
</span><span data-line="126"><span class="w">  </span><span class="p">{</span>
</span><span data-line="127"><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;New Jersey&quot;</span><span class="p">,</span>
</span><span data-line="128"><span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;NJ&quot;</span>
</span><span data-line="129"><span class="w">  </span><span class="p">},</span>
</span><span data-line="130"><span class="w">  </span><span class="p">{</span>
</span><span data-line="131"><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;New Mexico&quot;</span><span class="p">,</span>
</span><span data-line="132"><span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;NM&quot;</span>
</span><span data-line="133"><span class="w">  </span><span class="p">},</span>
</span><span data-line="134"><span class="w">  </span><span class="p">{</span>
</span><span data-line="135"><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;New York&quot;</span><span class="p">,</span>
</span><span data-line="136"><span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;NY&quot;</span>
</span><span data-line="137"><span class="w">  </span><span class="p">},</span>
</span><span data-line="138"><span class="w">  </span><span class="p">{</span>
</span><span data-line="139"><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;North Carolina&quot;</span><span class="p">,</span>
</span><span data-line="140"><span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;NC&quot;</span>
</span><span data-line="141"><span class="w">  </span><span class="p">},</span>
</span><span data-line="142"><span class="w">  </span><span class="p">{</span>
</span><span data-line="143"><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;North Dakota&quot;</span><span class="p">,</span>
</span><span data-line="144"><span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ND&quot;</span>
</span><span data-line="145"><span class="w">  </span><span class="p">},</span>
</span><span data-line="146"><span class="w">  </span><span class="p">{</span>
</span><span data-line="147"><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Ohio&quot;</span><span class="p">,</span>
</span><span data-line="148"><span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;OH&quot;</span>
</span><span data-line="149"><span class="w">  </span><span class="p">},</span>
</span><span data-line="150"><span class="w">  </span><span class="p">{</span>
</span><span data-line="151"><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Oklahoma&quot;</span><span class="p">,</span>
</span><span data-line="152"><span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;OK&quot;</span>
</span><span data-line="153"><span class="w">  </span><span class="p">},</span>
</span><span data-line="154"><span class="w">  </span><span class="p">{</span>
</span><span data-line="155"><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Oregon&quot;</span><span class="p">,</span>
</span><span data-line="156"><span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;OR&quot;</span>
</span><span data-line="157"><span class="w">  </span><span class="p">},</span>
</span><span data-line="158"><span class="w">  </span><span class="p">{</span>
</span><span data-line="159"><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Palau&quot;</span><span class="p">,</span>
</span><span data-line="160"><span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;PW&quot;</span>
</span><span data-line="161"><span class="w">  </span><span class="p">},</span>
</span><span data-line="162"><span class="w">  </span><span class="p">{</span>
</span><span data-line="163"><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Pennsylvania&quot;</span><span class="p">,</span>
</span><span data-line="164"><span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;PA&quot;</span>
</span><span data-line="165"><span class="w">  </span><span class="p">},</span>
</span><span data-line="166"><span class="w">  </span><span class="p">{</span>
</span><span data-line="167"><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Puerto Rico&quot;</span><span class="p">,</span>
</span><span data-line="168"><span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;PR&quot;</span>
</span><span data-line="169"><span class="w">  </span><span class="p">},</span>
</span><span data-line="170"><span class="w">  </span><span class="p">{</span>
</span><span data-line="171"><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Rhode Island&quot;</span><span class="p">,</span>
</span><span data-line="172"><span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;RI&quot;</span>
</span><span data-line="173"><span class="w">  </span><span class="p">},</span>
</span><span data-line="174"><span class="w">  </span><span class="p">{</span>
</span><span data-line="175"><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;South Carolina&quot;</span><span class="p">,</span>
</span><span data-line="176"><span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;SC&quot;</span>
</span><span data-line="177"><span class="w">  </span><span class="p">},</span>
</span><span data-line="178"><span class="w">  </span><span class="p">{</span>
</span><span data-line="179"><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;South Dakota&quot;</span><span class="p">,</span>
</span><span data-line="180"><span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;SD&quot;</span>
</span><span data-line="181"><span class="w">  </span><span class="p">},</span>
</span><span data-line="182"><span class="w">  </span><span class="p">{</span>
</span><span data-line="183"><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Tennessee&quot;</span><span class="p">,</span>
</span><span data-line="184"><span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;TN&quot;</span>
</span><span data-line="185"><span class="w">  </span><span class="p">},</span>
</span><span data-line="186"><span class="w">  </span><span class="p">{</span>
</span><span data-line="187"><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Texas&quot;</span><span class="p">,</span>
</span><span data-line="188"><span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;TX&quot;</span>
</span><span data-line="189"><span class="w">  </span><span class="p">},</span>
</span><span data-line="190"><span class="w">  </span><span class="p">{</span>
</span><span data-line="191"><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Utah&quot;</span><span class="p">,</span>
</span><span data-line="192"><span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;UT&quot;</span>
</span><span data-line="193"><span class="w">  </span><span class="p">},</span>
</span><span data-line="194"><span class="w">  </span><span class="p">{</span>
</span><span data-line="195"><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Vermont&quot;</span><span class="p">,</span>
</span><span data-line="196"><span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;VT&quot;</span>
</span><span data-line="197"><span class="w">  </span><span class="p">},</span>
</span><span data-line="198"><span class="w">  </span><span class="p">{</span>
</span><span data-line="199"><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Virginia&quot;</span><span class="p">,</span>
</span><span data-line="200"><span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;VA&quot;</span>
</span><span data-line="201"><span class="w">  </span><span class="p">},</span>
</span><span data-line="202"><span class="w">  </span><span class="p">{</span>
</span><span data-line="203"><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Washington&quot;</span><span class="p">,</span>
</span><span data-line="204"><span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;WA&quot;</span>
</span><span data-line="205"><span class="w">  </span><span class="p">},</span>
</span><span data-line="206"><span class="w">  </span><span class="p">{</span>
</span><span data-line="207"><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;West Virginia&quot;</span><span class="p">,</span>
</span><span data-line="208"><span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;WV&quot;</span>
</span><span data-line="209"><span class="w">  </span><span class="p">},</span>
</span><span data-line="210"><span class="w">  </span><span class="p">{</span>
</span><span data-line="211"><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Wisconsin&quot;</span><span class="p">,</span>
</span><span data-line="212"><span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;WI&quot;</span>
</span><span data-line="213"><span class="w">  </span><span class="p">},</span>
</span><span data-line="214"><span class="w">  </span><span class="p">{</span>
</span><span data-line="215"><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Wyoming&quot;</span><span class="p">,</span>
</span><span data-line="216"><span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;WY&quot;</span>
</span><span data-line="217"><span class="w">  </span><span class="p">}</span>
</span><span data-line="218"><span class="p">]</span>
</span></pre></div>
</div>
</div>
</div>
</details></section>
<section id="bulk-insert">
<h2>Bulk Insert<a class="headerlink" href="#bulk-insert" title="Link to this heading">¶</a></h2>
<p>We’ll use our fixture data to demonstrate a bulk insert operation. This operation allows
you to add multiple records to your database in a single transaction, improving
performance when working with larger data sets.</p>
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">app.py</span></code></span><a class="headerlink" href="#id8" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="linenos"> 1</span><span class="kn">from</span><span class="w"> </span><span class="nn">rich</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_console</span>
</span><span data-line="2"><span class="linenos"> 2</span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_engine</span>
</span><span data-line="3"><span class="linenos"> 3</span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">Mapped</span><span class="p">,</span> <span class="n">Session</span><span class="p">,</span> <span class="n">sessionmaker</span>
</span><span data-line="4"><span class="linenos"> 4</span>
</span><span data-line="5"><span class="linenos"> 5</span><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.plugins.sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">base</span><span class="p">,</span> <span class="n">repository</span>
</span><span data-line="6"><span class="linenos"> 6</span>
</span><span data-line="7"><span class="linenos"> 7</span><span class="n">console</span> <span class="o">=</span> <span class="n">get_console</span><span class="p">()</span>
</span><span data-line="8"><span class="linenos"> 8</span>
</span><span data-line="9"><span class="linenos"> 9</span>
</span><span data-line="10"><span class="linenos">10</span><span class="k">class</span><span class="w"> </span><span class="nc">USState</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">UUIDBase</span><span class="p">):</span>
</span><span data-line="11"><span class="linenos">11</span>    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;us_state_lookup&quot;</span>  <span class="c1"># type: ignore[assignment]</span>
</span><span data-line="12"><span class="linenos">12</span>    <span class="n">abbreviation</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</span><span data-line="13"><span class="linenos">13</span>    <span class="n">name</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</span><span data-line="14"><span class="linenos">14</span>
</span><span data-line="15"><span class="linenos">15</span>
</span><span data-line="16"><span class="linenos">16</span><span class="k">class</span><span class="w"> </span><span class="nc">USStateRepository</span><span class="p">(</span><span class="n">repository</span><span class="o">.</span><span class="n">SQLAlchemySyncRepository</span><span class="p">[</span><span class="n">USState</span><span class="p">]):</span>
</span><span data-line="17"><span class="linenos">17</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;US State repository.&quot;&quot;&quot;</span>
</span><span data-line="18"><span class="linenos">18</span>
</span><span data-line="19"><span class="linenos">19</span>    <span class="n">model_type</span> <span class="o">=</span> <span class="n">USState</span>
</span><span data-line="20"><span class="linenos">20</span>
</span><span data-line="21"><span class="linenos">21</span>
</span><span data-line="22"><span class="linenos">22</span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span>
</span><span data-line="23"><span class="linenos">23</span>    <span class="s2">&quot;duckdb:///:memory:&quot;</span><span class="p">,</span>
</span><span data-line="24"><span class="linenos">24</span>    <span class="n">future</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="25"><span class="linenos">25</span><span class="p">)</span>
</span><span data-line="26"><span class="linenos">26</span><span class="n">session_factory</span><span class="p">:</span> <span class="n">sessionmaker</span><span class="p">[</span><span class="n">Session</span><span class="p">]</span> <span class="o">=</span> <span class="n">sessionmaker</span><span class="p">(</span><span class="n">engine</span><span class="p">,</span> <span class="n">expire_on_commit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span data-line="27"><span class="linenos">27</span>
</span><span data-line="28"><span class="linenos">28</span>
</span><span data-line="29"><span class="linenos">29</span><span class="k">def</span><span class="w"> </span><span class="nf">run_script</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="30"><span class="linenos">30</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Load data from a fixture.&quot;&quot;&quot;</span>
</span><span data-line="31"><span class="linenos">31</span>
</span><span data-line="32"><span class="linenos">32</span>    <span class="c1"># Initializes the database.</span>
</span><span data-line="33"><span class="linenos">33</span>    <span class="k">with</span> <span class="n">engine</span><span class="o">.</span><span class="n">begin</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
</span><span data-line="34"><span class="linenos">34</span>        <span class="n">USState</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span>
</span><span data-line="35"><span class="linenos">35</span>
</span><span data-line="36"><span class="linenos">36</span>    <span class="k">with</span> <span class="n">session_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">db_session</span><span class="p">:</span>
</span><span data-line="37"><span class="linenos">37</span>        <span class="c1"># 1) Load the JSON data into the US States table.</span>
</span><span data-line="38"><span class="linenos">38</span>        <span class="n">repo</span> <span class="o">=</span> <span class="n">USStateRepository</span><span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="n">db_session</span><span class="p">)</span>
</span><span data-line="39"><span class="linenos">39</span>        <span class="n">fixture</span> <span class="o">=</span> <span class="n">open_fixture</span><span class="p">(</span><span class="n">here</span><span class="p">,</span> <span class="n">USStateRepository</span><span class="o">.</span><span class="n">model_type</span><span class="o">.</span><span class="n">__tablename__</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span data-line="40"><span class="linenos">40</span>        <span class="n">objs</span> <span class="o">=</span> <span class="n">repo</span><span class="o">.</span><span class="n">add_many</span><span class="p">([</span><span class="n">USStateRepository</span><span class="o">.</span><span class="n">model_type</span><span class="p">(</span><span class="o">**</span><span class="n">raw_obj</span><span class="p">)</span> <span class="k">for</span> <span class="n">raw_obj</span> <span class="ow">in</span> <span class="n">fixture</span><span class="p">])</span>
</span><span data-line="41"><span class="linenos">41</span>        <span class="n">db_session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span><span data-line="42"><span class="linenos">42</span>        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">objs</span><span class="p">)</span><span class="si">}</span><span class="s2"> new objects.&quot;</span><span class="p">)</span>
</span></pre></div>
</div>
</div>
</section>
<section id="paginated-data-selection">
<h2>Paginated Data Selection<a class="headerlink" href="#paginated-data-selection" title="Link to this heading">¶</a></h2>
<p>Next, let’s explore how to select multiple records with pagination. This functionality
is useful for handling large amounts of data by breaking the data into manageable
‘pages’ or subsets.  <code class="docutils literal notranslate"><span class="pre">LimitOffset</span></code> is one of several filter types you can use with the
repository.</p>
<div class="literal-block-wrapper docutils container" id="id9">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">app.py</span></code></span><a class="headerlink" href="#id9" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="linenos">1</span><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.repository.filters</span><span class="w"> </span><span class="kn">import</span> <span class="n">LimitOffset</span>
</span><span data-line="2"><span class="linenos">2</span>
</span><span data-line="3"><span class="linenos">3</span>
</span><span data-line="4"><span class="linenos">4</span>        <span class="c1"># 2) Select paginated data and total row count.</span>
</span><span data-line="5"><span class="linenos">5</span>        <span class="n">created_objs</span><span class="p">,</span> <span class="n">total_objs</span> <span class="o">=</span> <span class="n">repo</span><span class="o">.</span><span class="n">list_and_count</span><span class="p">(</span><span class="n">LimitOffset</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
</span><span data-line="6"><span class="linenos">6</span>        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Selected </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">created_objs</span><span class="p">)</span><span class="si">}</span><span class="s2"> records out of a total of </span><span class="si">{</span><span class="n">total_objs</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</span></pre></div>
</div>
</div>
</section>
<section id="bulk-delete">
<h2>Bulk Delete<a class="headerlink" href="#bulk-delete" title="Link to this heading">¶</a></h2>
<p>Here we demonstrate how to perform a bulk delete operation. Just as with the bulk
insert, deleting multiple records with the batch record methods is more efficient than
executing row-by-row.</p>
<div class="literal-block-wrapper docutils container" id="id10">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">app.py</span></code></span><a class="headerlink" href="#id10" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="linenos">1</span>        <span class="c1"># 3) Let&#39;s remove the batch of records selected.</span>
</span><span data-line="2"><span class="linenos">2</span>        <span class="n">deleted_objs</span> <span class="o">=</span> <span class="n">repo</span><span class="o">.</span><span class="n">delete_many</span><span class="p">([</span><span class="n">new_obj</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">new_obj</span> <span class="ow">in</span> <span class="n">created_objs</span><span class="p">])</span>
</span><span data-line="3"><span class="linenos">3</span>        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removed </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">deleted_objs</span><span class="p">)</span><span class="si">}</span><span class="s2"> records out of a total of </span><span class="si">{</span><span class="n">total_objs</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</span></pre></div>
</div>
</div>
</section>
<section id="counts">
<h2>Counts<a class="headerlink" href="#counts" title="Link to this heading">¶</a></h2>
<p>Finally, we’ll demonstrate how to count the number of records remaining in the database.</p>
<div class="literal-block-wrapper docutils container" id="id11">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">app.py</span></code></span><a class="headerlink" href="#id11" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="linenos">1</span>        <span class="c1"># 4) Let&#39;s count the remaining rows</span>
</span><span data-line="2"><span class="linenos">2</span>        <span class="n">remaining_count</span> <span class="o">=</span> <span class="n">repo</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</span><span data-line="3"><span class="linenos">3</span>        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="n">remaining_count</span><span class="si">}</span><span class="s2"> remaining records after delete.&quot;</span><span class="p">)</span>
</span></pre></div>
</div>
</div>
<p>Now that we have demonstrated how to interact with the repository objects outside of a
Litestar application, our next example will use dependency injection to add this
functionality to a <a class="reference internal" href="../../reference/controller.html#litestar.controller.Controller" title="litestar.controller.Controller"><code class="xref py py-class docutils literal notranslate"><span class="pre">Controller</span></code></a>!</p>
</section>
</section>
<section id="full-code">
<span id="repo-full-code"></span><h1>Full Code<a class="headerlink" href="#full-code" title="Link to this heading">¶</a></h1>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
<span class="sd-summary-text">Full Code (click to toggle)</span><span class="sd-summary-state-marker sd-summary-chevron-right"><svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-right" viewBox="0 0 24 24" aria-hidden="true"><path d="M8.72 18.78a.75.75 0 0 1 0-1.06L14.44 12 8.72 6.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0Z"></path></svg></span></summary><div class="sd-summary-content sd-card-body docutils">
<div class="literal-block-wrapper docutils container" id="id12">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">app.py</span></code></span><a class="headerlink" href="#id12" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="linenos">  1</span><span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">annotations</span>
</span><span data-line="2"><span class="linenos">  2</span>
</span><span data-line="3"><span class="linenos">  3</span><span class="kn">from</span><span class="w"> </span><span class="nn">collections.abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncIterator</span>
</span><span data-line="4"><span class="linenos">  4</span><span class="kn">from</span><span class="w"> </span><span class="nn">contextlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">asynccontextmanager</span>
</span><span data-line="5"><span class="linenos">  5</span><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">date</span><span class="p">,</span> <span class="n">datetime</span>
</span><span data-line="6"><span class="linenos">  6</span><span class="kn">from</span><span class="w"> </span><span class="nn">uuid</span><span class="w"> </span><span class="kn">import</span> <span class="n">UUID</span>
</span><span data-line="7"><span class="linenos">  7</span>
</span><span data-line="8"><span class="linenos">  8</span><span class="kn">import</span><span class="w"> </span><span class="nn">anyio</span>
</span><span data-line="9"><span class="linenos">  9</span><span class="kn">from</span><span class="w"> </span><span class="nn">rich</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_console</span>
</span><span data-line="10"><span class="linenos"> 10</span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.ext.asyncio</span><span class="w"> </span><span class="kn">import</span> <span class="n">async_sessionmaker</span><span class="p">,</span> <span class="n">create_async_engine</span>
</span><span data-line="11"><span class="linenos"> 11</span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">Mapped</span>
</span><span data-line="12"><span class="linenos"> 12</span>
</span><span data-line="13"><span class="linenos"> 13</span><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.plugins.sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">base</span><span class="p">,</span> <span class="n">repository</span>
</span><span data-line="14"><span class="hll"><span class="linenos"> 14</span>
</span></span><span data-line="15"><span class="linenos"> 15</span><span class="n">console</span> <span class="o">=</span> <span class="n">get_console</span><span class="p">()</span>
</span><span data-line="16"><span class="linenos"> 16</span>
</span><span data-line="17"><span class="linenos"> 17</span>
</span><span data-line="18"><span class="linenos"> 18</span><span class="c1"># the SQLAlchemy base includes a declarative model for you to use in your models.</span>
</span><span data-line="19"><span class="linenos"> 19</span><span class="c1"># The `Base` class includes a `UUID` based primary key (`id`)</span>
</span><span data-line="20"><span class="linenos"> 20</span><span class="k">class</span><span class="w"> </span><span class="nc">Author</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">UUIDBase</span><span class="p">):</span>
</span><span data-line="21"><span class="linenos"> 21</span>    <span class="n">name</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</span><span data-line="22"><span class="linenos"> 22</span>    <span class="n">dob</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">date</span><span class="p">]</span>
</span><span data-line="23"><span class="linenos"> 23</span>    <span class="n">dod</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">date</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]</span>
</span><span data-line="24"><span class="linenos"> 24</span>
</span><span data-line="25"><span class="linenos"> 25</span>
</span><span data-line="26"><span class="linenos"> 26</span><span class="k">class</span><span class="w"> </span><span class="nc">AuthorRepository</span><span class="p">(</span><span class="n">repository</span><span class="o">.</span><span class="n">SQLAlchemyAsyncRepository</span><span class="p">[</span><span class="n">Author</span><span class="p">]):</span>
</span><span data-line="27"><span class="hll"><span class="linenos"> 27</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Author repository.&quot;&quot;&quot;</span>
</span></span><span data-line="28"><span class="hll"><span class="linenos"> 28</span>
</span></span><span data-line="29"><span class="hll"><span class="linenos"> 29</span>    <span class="n">model_type</span> <span class="o">=</span> <span class="n">Author</span>
</span></span><span data-line="30"><span class="hll"><span class="linenos"> 30</span>
</span></span><span data-line="31"><span class="linenos"> 31</span>
</span><span data-line="32"><span class="linenos"> 32</span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_async_engine</span><span class="p">(</span>
</span><span data-line="33"><span class="linenos"> 33</span>    <span class="s2">&quot;sqlite+aiosqlite:///test.sqlite&quot;</span><span class="p">,</span>
</span><span data-line="34"><span class="linenos"> 34</span>    <span class="n">future</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="35"><span class="linenos"> 35</span><span class="p">)</span>
</span><span data-line="36"><span class="linenos"> 36</span><span class="n">session_factory</span> <span class="o">=</span> <span class="n">async_sessionmaker</span><span class="p">(</span><span class="n">engine</span><span class="p">,</span> <span class="n">expire_on_commit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span data-line="37"><span class="hll"><span class="linenos"> 37</span>
</span></span><span data-line="38"><span class="hll"><span class="linenos"> 38</span>
</span></span><span data-line="39"><span class="hll"><span class="linenos"> 39</span><span class="c1"># let&#39;s make a simple context manager as an example here.</span>
</span></span><span data-line="40"><span class="hll"><span class="linenos"> 40</span><span class="nd">@asynccontextmanager</span>
</span></span><span data-line="41"><span class="hll"><span class="linenos"> 41</span><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">repository_factory</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">AuthorRepository</span><span class="p">]:</span>
</span></span><span data-line="42"><span class="hll"><span class="linenos"> 42</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">session_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">db_session</span><span class="p">:</span>
</span></span><span data-line="43"><span class="hll"><span class="linenos"> 43</span>        <span class="k">try</span><span class="p">:</span>
</span></span><span data-line="44"><span class="hll"><span class="linenos"> 44</span>            <span class="k">yield</span> <span class="n">AuthorRepository</span><span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="n">db_session</span><span class="p">)</span>
</span></span><span data-line="45"><span class="hll"><span class="linenos"> 45</span>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>  <span class="c1"># noqa: BLE001</span>
</span></span><span data-line="46"><span class="hll"><span class="linenos"> 46</span>            <span class="k">await</span> <span class="n">db_session</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
</span></span><span data-line="47"><span class="hll"><span class="linenos"> 47</span>        <span class="k">else</span><span class="p">:</span>
</span></span><span data-line="48"><span class="hll"><span class="linenos"> 48</span>            <span class="k">await</span> <span class="n">db_session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span></span><span data-line="49"><span class="hll"><span class="linenos"> 49</span>
</span></span><span data-line="50"><span class="hll"><span class="linenos"> 50</span>
</span></span><span data-line="51"><span class="hll"><span class="linenos"> 51</span><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">create_author</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Author</span><span class="p">:</span>
</span></span><span data-line="52"><span class="hll"><span class="linenos"> 52</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">repository_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">repo</span><span class="p">:</span>
</span></span><span data-line="53"><span class="hll"><span class="linenos"> 53</span>        <span class="n">obj</span> <span class="o">=</span> <span class="k">await</span> <span class="n">repo</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
</span></span><span data-line="54"><span class="hll"><span class="linenos"> 54</span>            <span class="n">Author</span><span class="p">(</span>
</span></span><span data-line="55"><span class="hll"><span class="linenos"> 55</span>                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;F. Scott Fitzgerald&quot;</span><span class="p">,</span>
</span></span><span data-line="56"><span class="linenos"> 56</span>                <span class="n">dob</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s2">&quot;1896-09-24&quot;</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">(),</span>
</span><span data-line="57"><span class="linenos"> 57</span>            <span class="p">)</span>
</span><span data-line="58"><span class="linenos"> 58</span>        <span class="p">)</span>
</span><span data-line="59"><span class="linenos"> 59</span>        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created Author record for </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> with primary key </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</span><span data-line="60"><span class="linenos"> 60</span>        <span class="k">return</span> <span class="n">obj</span>
</span><span data-line="61"><span class="hll"><span class="linenos"> 61</span>
</span></span><span data-line="62"><span class="linenos"> 62</span>
</span><span data-line="63"><span class="linenos"> 63</span><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">update_author</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">Author</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Author</span><span class="p">:</span>
</span><span data-line="64"><span class="hll"><span class="linenos"> 64</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">repository_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">repo</span><span class="p">:</span>
</span></span><span data-line="65"><span class="hll"><span class="linenos"> 65</span>        <span class="n">obj</span> <span class="o">=</span> <span class="k">await</span> <span class="n">repo</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</span></span><span data-line="66"><span class="hll"><span class="linenos"> 66</span>        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updated Author record for </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> with primary key </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</span></span><span data-line="67"><span class="hll"><span class="linenos"> 67</span>        <span class="k">return</span> <span class="n">obj</span>
</span></span><span data-line="68"><span class="hll"><span class="linenos"> 68</span>
</span></span><span data-line="69"><span class="hll"><span class="linenos"> 69</span>
</span></span><span data-line="70"><span class="hll"><span class="linenos"> 70</span><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">remove_author</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="n">UUID</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Author</span><span class="p">:</span>
</span></span><span data-line="71"><span class="hll"><span class="linenos"> 71</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">repository_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">repo</span><span class="p">:</span>
</span></span><span data-line="72"><span class="hll"><span class="linenos"> 72</span>        <span class="n">obj</span> <span class="o">=</span> <span class="k">await</span> <span class="n">repo</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
</span></span><span data-line="73"><span class="hll"><span class="linenos"> 73</span>        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Deleted Author record for </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> with primary key </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</span></span><span data-line="74"><span class="hll"><span class="linenos"> 74</span>        <span class="k">return</span> <span class="n">obj</span>
</span></span><span data-line="75"><span class="hll"><span class="linenos"> 75</span>
</span></span><span data-line="76"><span class="linenos"> 76</span>
</span><span data-line="77"><span class="hll"><span class="linenos"> 77</span><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_author_if_exists</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="n">UUID</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Author</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span data-line="78"><span class="hll"><span class="linenos"> 78</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">repository_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">repo</span><span class="p">:</span>
</span></span><span data-line="79"><span class="hll"><span class="linenos"> 79</span>        <span class="n">obj</span> <span class="o">=</span> <span class="k">await</span> <span class="n">repo</span><span class="o">.</span><span class="n">get_one_or_none</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span>
</span></span><span data-line="80"><span class="linenos"> 80</span>        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="81"><span class="hll"><span class="linenos"> 81</span>            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found Author record for </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> with primary key </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</span></span><span data-line="82"><span class="hll"><span class="linenos"> 82</span>        <span class="k">else</span><span class="p">:</span>
</span></span><span data-line="83"><span class="hll"><span class="linenos"> 83</span>            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find Author with primary key </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</span></span><span data-line="84"><span class="linenos"> 84</span>        <span class="k">return</span> <span class="n">obj</span>
</span><span data-line="85"><span class="linenos"> 85</span>
</span><span data-line="86"><span class="linenos"> 86</span>
</span><span data-line="87"><span class="linenos"> 87</span><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run_script</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="88"><span class="linenos"> 88</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Load data from a fixture.&quot;&quot;&quot;</span>
</span><span data-line="89"><span class="linenos"> 89</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">engine</span><span class="o">.</span><span class="n">begin</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
</span><span data-line="90"><span class="linenos"> 90</span>        <span class="k">await</span> <span class="n">conn</span><span class="o">.</span><span class="n">run_sync</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">UUIDBase</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">)</span>
</span><span data-line="91"><span class="linenos"> 91</span>
</span><span data-line="92"><span class="linenos"> 92</span>    <span class="c1"># 1) create a new Author record.</span>
</span><span data-line="93"><span class="linenos"> 93</span>    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;1) Adding a new record&quot;</span><span class="p">)</span>
</span><span data-line="94"><span class="linenos"> 94</span>    <span class="n">author</span> <span class="o">=</span> <span class="k">await</span> <span class="n">create_author</span><span class="p">()</span>
</span><span data-line="95"><span class="linenos"> 95</span>    <span class="n">author_id</span> <span class="o">=</span> <span class="n">author</span><span class="o">.</span><span class="n">id</span>
</span><span data-line="96"><span class="linenos"> 96</span>
</span><span data-line="97"><span class="linenos"> 97</span>    <span class="c1"># 2) Let&#39;s update the Author record.</span>
</span><span data-line="98"><span class="linenos"> 98</span>    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;2) Updating a record.&quot;</span><span class="p">)</span>
</span><span data-line="99"><span class="linenos"> 99</span>    <span class="n">author</span><span class="o">.</span><span class="n">dod</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s2">&quot;1940-12-21&quot;</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
</span><span data-line="100"><span class="linenos">100</span>    <span class="k">await</span> <span class="n">update_author</span><span class="p">(</span><span class="n">author</span><span class="p">)</span>
</span><span data-line="101"><span class="linenos">101</span>
</span><span data-line="102"><span class="linenos">102</span>    <span class="c1"># 3) Let&#39;s delete the record we just created.</span>
</span><span data-line="103"><span class="linenos">103</span>    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;3) Removing a record.&quot;</span><span class="p">)</span>
</span><span data-line="104"><span class="linenos">104</span>    <span class="k">await</span> <span class="n">remove_author</span><span class="p">(</span><span class="n">author_id</span><span class="p">)</span>
</span><span data-line="105"><span class="linenos">105</span>
</span><span data-line="106"><span class="linenos">106</span>    <span class="c1"># 4) Let&#39;s verify the record no longer exists.</span>
</span><span data-line="107"><span class="linenos">107</span>    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;4) Select one or none.&quot;</span><span class="p">)</span>
</span><span data-line="108"><span class="linenos">108</span>    <span class="n">_should_be_none</span> <span class="o">=</span> <span class="k">await</span> <span class="n">get_author_if_exists</span><span class="p">(</span><span class="n">author_id</span><span class="p">)</span>
</span><span data-line="109"><span class="linenos">109</span>
</span><span data-line="110"><span class="linenos">110</span>
</span><span data-line="111"><span class="linenos">111</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span data-line="112"><span class="linenos">112</span>    <span class="n">anyio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">run_script</span><span class="p">)</span>
</span></pre></div>
</div>
</div>
</div>
</details></section>

        </article><button class="back-to-top" type="button">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
  </svg>
  <span>Back to top</span>
</button><div class="navigation flex print:hidden"><div class="navigation-prev">
    <a href="01-modelling-and-features.html">
      <i class="i-lucide chevron-left"></i>
      <div class="page-info">
        <span>Previous</span><div class="title">Introduction to Database Modelling and Repository Features</div></div>
    </a>
  </div><div class="navigation-next">
    <a href="03-repository-controller.html">
      <div class="page-info">
        <span>Next</span>
        <div class="title">Working with Controllers and Repositories</div>
      </div>
      <i class="i-lucide chevron-right"></i>
    </a>
  </div></div></div>
    </div>
  </main>
</div>
<footer class="sy-foot">
  <div class="sy-foot-inner sy-container mx-auto">
    <div class="sy-foot-reserved md:flex justify-between items-center">
      <div class="sy-foot-copyright"><p>2025, Litestar Organization</p>
  
  <p>
    Made with
    
    <a href="https://www.sphinx-doc.org/">Sphinx</a> and
    
    <a href="https://shibuya.lepture.com">Shibuya theme</a>.
  </p>
</div>
      <div class="sy-foot-socials">
<a href="https://twitter.com/LitestarAPI" aria-label="X (Twitter)">
  <iconify-icon icon="prime:twitter"></iconify-icon>
</a>
<a href="https://discord.gg/litestar" aria-label="Discord">
  <iconify-icon icon="simple-icons:discord"></iconify-icon>
</a>
<a href="https://www.reddit.com/r/LitestarAPI" aria-label="Reddit">
  <iconify-icon icon="simple-icons:reddit"></iconify-icon>
</a></div>
    </div>
  </div>
</footer>
      <script src="../../_static/documentation_options.js?v=ad404a94"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../_static/copybutton.js?v=f281be69"></script>
      <script src="../../_static/litestar-theme.js?v=ab2dcc9e"></script>
      <script>let toggleHintShow = 'Click to show';</script>
      <script>let toggleHintHide = 'Click to hide';</script>
      <script>let toggleOpenOnPrint = 'true';</script>
      <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
      <script src="../../_static/design-tabs.js?v=f930bc37"></script>
      <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
      <script src="../../_static/shibuya.js?v=c477d091"></script>
      <script src="../../_static/versioning.js?v=9ab184b9"></script></body>
</html>