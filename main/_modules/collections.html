<!DOCTYPE html>
<html lang="en" data-accent-color="amber" data-content_root="../">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"><title>collections - Litestar Framework</title><link rel="shortcut icon" href="../_static/favicon.svg"/><link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><script>
    function setColorMode(t){let e=document.documentElement;e.setAttribute("data-color-mode",t);let a=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,s=t;"auto"===t&&(s=a?"dark":"light"),"light"===s?(e.classList.remove("dark"),e.classList.add("light")):(e.classList.remove("light"),e.classList.add("dark"))}
    setColorMode(localStorage._theme||"auto");
  </script><link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=397bb51e" />
    <link rel="stylesheet" type="text/css" href="../_static/shibuya.css?v=76b6f612" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx_paramlinks.css" />
    <link media="print" rel="stylesheet" type="text/css" href="../_static/print.css?v=20ff2c19" />
    <link rel="stylesheet" type="text/css" href="../_static/style.css?v=50ea2f63" />
    <link rel="stylesheet" type="text/css" href="../_static/litestar-sphinx-theme.css?v=f8f74789" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --sy-f-text: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
  --sy-f-heading: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
}
</style>
    <meta property="og:type" content="website"/><meta property="og:title" content="collections"/>
<meta name="twitter:card" content="summary"/>
<meta property="og:image" content="_static/logo-light.png"/>
  </head>
<body><div class="announcement">
    <div class="announcement-inner">
      <p>You are viewing the <bold>local</bold> version of the documentation. Click here to go to the latest version.</p>
      <button class="announcement-close" aria-label="Close announcement">
        <i class="i-lucide close"></i>
      </button>
    </div>
  </div><div class="sy-head">
  <div class="sy-head-blur"></div>
  <div class="sy-head-inner sy-container mx-auto">
    <a class="sy-head-brand" href="/">
      <img class="light-logo" src="../_static/logo-light.png" alt="Litestar" height="28" loading="lazy" />
      <img class="dark-logo" src="../_static/logo-dark.png" alt="Litestar" height="28" loading="lazy" />
      <strong>Litestar</strong>
    </a>
    <div class="sy-head-nav" id="head-nav">
      <nav class="sy-head-links"><ul><li class="link"><a href="../index.html">Home</a></li>
      <li class="link"><button class="js-menu" type="button" id="nav-trigger-2" aria-controls="nav-children-2">
            <span>Community</span>
            <i class="i-lucide chevron-down"></i>
          </button>
        <ul id="nav-children-2" aria-labelledby="nav-trigger-2"><li><a href="../contribution-guide.html">
                <span>Contributing</span>
                <small>Learn how to contribute to the Litestar project</small>
              </a></li><li><a href="https://github.com/litestar-org/.github?tab=coc-ov-file">
                <span>Code of Conduct</span>
                <small>Review the etiquette for interacting with the Litestar community</small>
              </a></li><li><a href="https://github.com/litestar-org/.github?tab=coc-ov-file#security-ov-file">
                <span>Security</span>
                <small>Overview of Litestar's security protocols</small>
              </a></li></ul>
      </li>
      <li class="link"><button class="js-menu" type="button" id="nav-trigger-3" aria-controls="nav-children-3">
            <span>About</span>
            <i class="i-lucide chevron-down"></i>
          </button>
        <ul id="nav-children-3" aria-labelledby="nav-trigger-3"><li><a href="https://litestar.dev/about/organization">
                <span>Litestar Organization</span>
                <small>Details about the Litestar organization</small>
              </a></li><li><a href="https://litestar.dev/about/litestar-releases">
                <span>Releases</span>
                <small>Explore the release process, versioning, and deprecation policy for Litestar</small>
              </a></li></ul>
      </li>
      <li class="link"><button class="js-menu" type="button" id="nav-trigger-4" aria-controls="nav-children-4">
            <span>Release notes</span>
            <i class="i-lucide chevron-down"></i>
          </button>
        <ul id="nav-children-4" aria-labelledby="nav-trigger-4"><li><a href="../release-notes/whats-new-3.html">
                <span>What's new in 3.0</span>
                <small>Explore the new features in Litestar 3.0</small>
              </a></li><li><a href="../release-notes/changelog.html">
                <span>3.x Changelog</span>
                <small>All changes in the 3.x series</small>
              </a></li><li><a href="https://docs.litestar.dev/2/release-notes/changelog.html">
                <span>2.x Changelog</span>
                <small>All changes in the 2.x series</small>
              </a></li></ul>
      </li>
      <li class="link"><button class="js-menu" type="button" id="nav-trigger-5" aria-controls="nav-children-5">
            <span>Help</span>
            <i class="i-lucide chevron-down"></i>
          </button>
        <ul id="nav-children-5" aria-labelledby="nav-trigger-5"><li><a href="https://discord.gg/litestar">
                <span>Discord Help Forum</span>
                <small>Dedicated Discord help forum</small>
              </a></li><li><a href="https://github.com/orgs/litestar-org/discussions">
                <span>GitHub Discussions</span>
                <small>GitHub Discussions</small>
              </a></li><li><a href="https://stackoverflow.com/questions/tagged/litestar">
                <span>Stack Overflow</span>
                <small>We monitor the <code><b>litestar</b></code> tag on Stack Overflow</small>
              </a></li></ul>
      </li><li class="link">
          <a href="https://github.com/sponsors/Litestar-Org">
            <span>Sponsor</span></a>
        </li></ul></nav>
      <div class="sy-head-extra flex items-center print:hidden"><form class="searchbox flex items-center" action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <kbd>/</kbd>
</form><div class="nav-versions">
    <button type="button" aria-label="Versions">
      <span class="md:hidden">Versions</span>
      <span class="hidden md:inline">main</span>
      <i class="i-lucide chevron-down"></i>
    </button>
    <div class="nav-versions-choices"><ul><li><a href="/latest">latest</a></li><li><a href="/main">v3 (development)</a></li><li><a href="/2">v2</a></li><li><a href="/1">v1</a></li></ul></div>
  </div><div class="sy-head-socials">
<a href="https://twitter.com/LitestarAPI" aria-label="X (Twitter)">
  <iconify-icon icon="prime:twitter"></iconify-icon>
</a>
  <a href="https://discord.gg/litestar" aria-label="Discord">
    <iconify-icon icon="simple-icons:discord"></iconify-icon>
  </a></div></div>
    </div>
    <div class="sy-head-actions flex items-center shrink-0 print:hidden"><button class="js-theme theme-switch flex items-center"
data-aria-auto="Switch to light color mode"
data-aria-light="Switch to dark color mode"
data-aria-dark="Switch to auto color mode">
<i class="i-lucide theme-icon"></i>
</button><button class="md:hidden flex items-center js-menu" aria-label="Menu" type="button" aria-controls="head-nav" aria-expanded="false">
        <div class="hamburger">
          <span class="hamburger_1"></span>
          <span class="hamburger_2 -translate-x-2"></span>
          <span class="hamburger_3 -translate-x-1"></span>
        </div>
      </button>
    </div>
  </div>
</div>
<div class="sy-page sy-container flex mx-auto">
  <aside id="lside" class="sy-lside md:w-72 md:shrink-0 print:hidden">
    <div class="sy-lside-inner md:sticky">
      <div class="sy-scrollbar p-6"><div class="sidebar-links">
  <ul>
    <li><a class="icon-link" href="https://github.com/orgs/litestar-org/discussions">
  <span class="icon">
    <svg viewBox="0 0 24 24" fill="none">
      <path fill="var(--accent-9)" fill-rule="evenodd" clip-rule="evenodd" d="M11 5a6 6 0 0 0-4.687 9.746c.215.27.315.62.231.954l-.514 2.058a1 1 0 0 0 1.485 1.1l2.848-1.71c.174-.104.374-.15.576-.148H13a6 6 0 0 0 0-12h-2Z"/>
      <circle fill="white" cx="12" cy="11" r="1"/>
      <circle fill="white" cx="9" cy="11" r="1"/>
      <circle fill="white" cx="15" cy="11" r="1"/>
    </svg>
  </span>
  <span class="text">Discussion</span>
</a></li>
  </ul>
</div>
        <div class="globaltoc" data-expand-depth="0"><p class="caption" role="heading" aria-level="3"><span class="caption-text">Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting-started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/index.html">Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../usage/applications.html">Applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/routing/index.html">Routing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../usage/routing/overview.html">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../usage/routing/handlers.html">Route handlers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../usage/routing/parameters.html">Parameters</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../usage/requests.html">Requests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/caching.html">Caching</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/channels.html">Channels</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/cli.html">CLI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/databases/index.html">Databases</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../usage/databases/sqlalchemy/index.html">SQLAlchemy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../usage/databases/sqlalchemy/models_and_repository.html">SQLAlchemy Models &amp; Repository</a></li>
<li class="toctree-l4"><a class="reference internal" href="../usage/databases/sqlalchemy/plugins/index.html">Plugins</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../usage/databases/piccolo.html">Piccolo ORM</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../usage/debugging.html">Debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/dependency-injection.html">Dependency Injection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/dto/index.html">Data Transfer Object (DTO)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../usage/dto/0-basic-use.html">Basic Use</a></li>
<li class="toctree-l3"><a class="reference internal" href="../usage/dto/1-abstract-dto.html">AbstractDTO</a></li>
<li class="toctree-l3"><a class="reference internal" href="../usage/dto/2-creating-custom-dto-classes.html">Implementing Custom DTO Classes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../usage/events.html">Events</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/exceptions.html">Exceptions and exception handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/file_systems.html">File Systems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/htmx.html">HTMX</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/lifecycle-hooks.html">Life Cycle Hooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/logging.html">Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/metrics/index.html">Metrics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../usage/metrics/open-telemetry.html">OpenTelemetry</a></li>
<li class="toctree-l3"><a class="reference internal" href="../usage/metrics/prometheus.html">Prometheus</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../usage/middleware/index.html">Middleware</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../usage/middleware/using-middleware.html">Using Middleware</a></li>
<li class="toctree-l3"><a class="reference internal" href="../usage/middleware/builtin-middleware.html">Built-in middleware</a></li>
<li class="toctree-l3"><a class="reference internal" href="../usage/middleware/creating-middleware.html">Creating Middleware</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../usage/openapi/index.html">OpenAPI</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../usage/openapi/schema_generation.html">Configuring schema generation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../usage/openapi/schema_generation.html#configuring-schema-generation-on-a-route-handler">Configuring schema generation on a route handler</a></li>
<li class="toctree-l3"><a class="reference internal" href="../usage/openapi/schema_generation.html#accessing-the-openapi-schema-in-code">Accessing the OpenAPI schema in code</a></li>
<li class="toctree-l3"><a class="reference internal" href="../usage/openapi/schema_generation.html#customizing-pydantic-model-schemas">Customizing Pydantic model schemas</a></li>
<li class="toctree-l3"><a class="reference internal" href="../usage/openapi/schema_generation.html#customizing-operation-class">Customizing <code class="docutils literal notranslate"><span class="pre">Operation</span></code> class</a></li>
<li class="toctree-l3"><a class="reference internal" href="../usage/openapi/schema_generation.html#generating-examples">Generating examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../usage/openapi/ui_plugins.html">OpenAPI UI Plugins</a></li>
<li class="toctree-l3"><a class="reference internal" href="../usage/openapi/ui_plugins.html#using-openapi-ui-plugins">Using OpenAPI UI Plugins</a></li>
<li class="toctree-l3"><a class="reference internal" href="../usage/openapi/ui_plugins.html#configuring-openapi-ui-plugins">Configuring OpenAPI UI Plugins</a></li>
<li class="toctree-l3"><a class="reference internal" href="../usage/openapi/ui_plugins.html#configuring-the-openapi-root-path">Configuring the OpenAPI Root Path</a></li>
<li class="toctree-l3"><a class="reference internal" href="../usage/openapi/ui_plugins.html#building-your-own-openapi-ui-plugin">Building your own OpenAPI UI Plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../usage/openapi/ui_plugins.html#interacting-with-the-router">Interacting with the <code class="docutils literal notranslate"><span class="pre">Router</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../usage/openapi/ui_plugins.html#oauth2-in-swagger-ui">OAuth2 in Swagger UI</a></li>
<li class="toctree-l3"><a class="reference internal" href="../usage/openapi/ui_plugins.html#customizing-the-openapi-ui">Customizing the OpenAPI UI</a></li>
<li class="toctree-l3"><a class="reference internal" href="../usage/openapi/ui_plugins.html#cdn-and-offline-file-support">CDN and offline file support</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../usage/plugins/index.html">Plugins</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../usage/plugins/flash_messages.html">Flash Messages</a></li>
<li class="toctree-l3"><a class="reference internal" href="../usage/plugins/problem_details.html">Problem Details</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../usage/responses.html">Responses</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/security/index.html">Security</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../usage/security/abstract-authentication-middleware.html">Implementing Custom Authentication</a></li>
<li class="toctree-l3"><a class="reference internal" href="../usage/security/security-backends.html">Security Backends</a></li>
<li class="toctree-l3"><a class="reference internal" href="../usage/security/guards.html">Guards</a></li>
<li class="toctree-l3"><a class="reference internal" href="../usage/security/excluding-and-including-endpoints.html">Excluding and including endpoints</a></li>
<li class="toctree-l3"><a class="reference internal" href="../usage/security/jwt.html">JWT Security Backends</a></li>
<li class="toctree-l3"><a class="reference internal" href="../usage/security/secret-datastructures.html">Handling Secrets</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../usage/static-files.html">Static files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/custom-types.html">Custom types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/stores.html">Stores</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/templating.html">Templating</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/testing.html">Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/websockets.html">WebSockets</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">API reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../reference/app.html">app</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/background_tasks.html">background_tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/channels/index.html">channels</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/channels/plugin.html">plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/channels/subscriber.html">subscriber</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/channels/backends/index.html">backends</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/channels/backends/base.html">base</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/channels/backends/memory.html">memory</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/channels/backends/redis.html">redis</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/channels/backends/psycopg.html">psycopg</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/channels/backends/asyncpg.html">asyncpg</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../reference/cli.html">cli</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/config.html">config</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/connection.html">connection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/contrib/index.html">contrib</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/contrib/jinja.html">jinja</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/contrib/mako.html">mako</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/contrib/opentelemetry.html">opentelemetry</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/contrib/sqlalchemy/index.html">sqlalchemy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/contrib/sqlalchemy/plugins.html">plugins</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/contrib/sqlalchemy/repository.html">repository</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/contrib/sqlalchemy/types.html">types</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/contrib/sqlalchemy/base.html">base</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/contrib/sqlalchemy/dto.html">DTO</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../reference/controller.html">controller</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/concurrency.html">concurrency</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/data_extractors.html">data_extractors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/datastructures/index.html">datastructures</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/datastructures/secret_values.html">secret_values</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../reference/di.html">di</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/dto/index.html">dto</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/dto/config.html">config</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/dto/data_structures.html">data_structures</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/dto/field.html">field</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/dto/types.html">types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/dto/base_dto.html">base_dto</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/dto/msgspec_dto.html">msgspec_dto</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/dto/dataclass_dto.html">dataclass_dto</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../reference/enums.html">enums</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/events.html">events</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/exceptions.html">exceptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/file_system.html">file_system</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/handlers.html">handlers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/logging/index.html">logging</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/logging/config.html">config</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/logging/picologging.html">picologging</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/logging/standard.html">standard</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../reference/middleware/index.html">middleware</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/middleware/allowed_hosts.html">allowed_hosts</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/middleware/authentication.html">authentication</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/middleware/compression.html">compression</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/middleware/csrf.html">csrf</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/middleware/logging.html">logging</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/middleware/rate_limit.html">rate_limit</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/middleware/session/index.html">session</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/middleware/session/base.html">base</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/middleware/session/client_side.html">client_side</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/middleware/session/server_side.html">server_side</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/middleware/constraints.html">constraints</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../reference/openapi/index.html">openapi</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/openapi/openapi.html">openapi</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/openapi/plugins.html">plugins</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/openapi/spec.html">spec</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../reference/pagination.html">pagination</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/params.html">params</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/plugins/index.html">plugins</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/plugins/attrs.html">attrs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/plugins/flash_messages.html">flash</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/plugins/htmx.html">htmx</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/plugins/problem_details.html">problem details</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/plugins/prometheus.html">prometheus</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/plugins/pydantic.html">pydantic</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/plugins/structlog.html">structlog</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/plugins/sqlalchemy.html">sqlalchemy</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../reference/repository/index.html">repository</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/repository/abc.html">abc</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/repository/filters.html">filters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/repository/exceptions.html">exceptions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/repository/testing.html">testing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/repository/handlers.html">handlers</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../reference/response/index.html">response</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/response/base.html">base</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/response/file.html">file</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/response/redirect.html">redirect</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/response/streaming.html">streaming</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/response/sse.html">SSE (Server Sent Events)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/response/template.html">template</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../reference/router.html">router</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/routes.html">routes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/security/index.html">security</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/security/jwt.html">jwt</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/security/session_auth.html">session_auth</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../reference/serialization.html">serialization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/static_files.html">static_files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/status_codes.html">status_code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/stores/index.html">stores</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/stores/base.html">base</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/stores/file.html">file</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/stores/memory.html">memory</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/stores/redis.html">redis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/stores/registry.html">registry</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/stores/valkey.html">valkey</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../reference/template.html">template</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/testing.html">testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/types.html">types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/typing.html">typing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../benchmarks.html">Benchmarks</a></li>
</ul>
<p class="caption" role="heading" aria-level="3"><span class="caption-text">Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../migration/index.html">Migrating to Litestar</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../migration/flask.html">From Flask</a></li>
<li class="toctree-l2"><a class="reference internal" href="../migration/fastapi.html">From Starlette / FastAPI</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../topics/index.html">Topics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../topics/sync-vs-async.html">Sync vs. Async</a></li>
<li class="toctree-l2"><a class="reference internal" href="../topics/deployment/index.html">Deployment</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../topics/deployment/nginx-unit.html">NGINX Unit</a></li>
<li class="toctree-l3"><a class="reference internal" href="../topics/deployment/manually-with-asgi-server.html">Manually with ASGI server</a></li>
<li class="toctree-l3"><a class="reference internal" href="../topics/deployment/docker.html">Docker</a></li>
<li class="toctree-l3"><a class="reference internal" href="../topics/deployment/supervisor.html">Supervisor (Linux)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">Tutorials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/todo-app/index.html">Developing a basic TODO application</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/todo-app/0-application-basics.html">Application basics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/todo-app/1-accessing-the-list.html">Accessing the list</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/todo-app/2-interacting-with-the-list.html">Making the list interactive</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/todo-app/3-assembling-the-app.html">Recap and assembling the final application</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/sqlalchemy/index.html">Improving the TODO app with SQLAlchemy</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/sqlalchemy/0-introduction.html">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/sqlalchemy/1-provide-session-with-di.html">Providing the session with DI</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/sqlalchemy/2-serialization-plugin.html">Using the serialization plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/sqlalchemy/3-init-plugin.html">Using the init plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/sqlalchemy/4-final-touches-and-recap.html">Final touches and recap</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/dto-tutorial/index.html">Data Transfer Object Tutorial</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/dto-tutorial/01-simple-dto-exclude.html">Our first DTO</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/dto-tutorial/02-nested-exclude.html">Excluding from nested models</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/dto-tutorial/03-nested-collection-exclude.html">Excluding from collections of nested models</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/dto-tutorial/04-max-nested-depth.html">Max nested depth</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/dto-tutorial/05-renaming-fields.html">Renaming fields</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/dto-tutorial/06-receiving-data.html">Receiving data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/dto-tutorial/07-read-only-fields.html">Read only fields</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/dto-tutorial/08-dto-data.html">Accessing the data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/dto-tutorial/09-updating.html">Updating instances</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/dto-tutorial/10-layered-dto-declarations.html">Declaring DTOs on app layers</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/repository-tutorial/index.html">SQLAlchemy Repository Tutorial</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/repository-tutorial/01-modelling-and-features.html">Introduction to Database Modelling and Repository Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/repository-tutorial/01-modelling-and-features.html#modelling">Modelling</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/repository-tutorial/01-modelling-and-features.html#full-code">Full Code</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/repository-tutorial/02-repository-introduction.html">Interacting with repositories</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/repository-tutorial/02-repository-introduction.html#working-with-bulk-data-operations">Working with Bulk Data Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/repository-tutorial/02-repository-introduction.html#full-code">Full Code</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/repository-tutorial/03-repository-controller.html">Working with Controllers and Repositories</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/repository-tutorial/03-repository-controller.html#full-code">Full Code</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/repository-tutorial/04-repository-other.html">Adding Additional Features to the Repository</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/repository-tutorial/04-repository-other.html#slug-fields">Slug Fields</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/repository-tutorial/04-repository-other.html#full-code">Full Code</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading" aria-level="3"><span class="caption-text">Contributing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../contribution-guide.html">Contribution Guide</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/search?q=user%3Alitestar-org+state%3Aopen+label%3A%22good+first+issue%22+++no%3Aassignee+&amp;type=issues=">Available Issues</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/litestar-org/.github?tab=coc-ov-file#readme">Code of Conduct</a></li>
</ul>

        </div>
      </div>
    </div>
  </aside>
  <div class="lside-overlay js-menu" role="button" aria-label="Close left sidebar" aria-controls="lside" aria-expanded="false"></div>
  <aside id="rside" class="sy-rside pb-3 w-64 shrink-0 order-last">
    <button class="rside-close js-menu xl:hidden" aria-label="Close Table of Contents" type="button" aria-controls="rside" aria-expanded="false">
      <i class="i-lucide close"></i>
    </button>
    <div class="sy-scrollbar sy-rside-inner px-6 xl:top-16 xl:sticky xl:pl-0 pt-6 pb-4"><a class="js-repo-stats repo-stats flex items-center" href="https://github.com/litestar-org/litestar"
  data-type="github" data-user="litestar-org" data-repo="litestar">
  <span class="w-8 flex items-center justify-around shrink-0 text-3xl">
    <iconify-icon icon="simple-icons:github"></iconify-icon>
  </span>
  <span class="flex-grow px-2 break-all">
    <span>litestar-org/litestar</span>
    <span class="flex text-sm repo-stats-count">
      <span class="flex items-center pr-3">
        <iconify-icon icon="lucide:star"></iconify-icon>
        <strong class="js-repo-stars ml-1">0</strong>
      </span>
      <span class="flex items-center">
        <iconify-icon icon="lucide:git-fork"></iconify-icon>
        <strong class="js-repo-forks ml-1">0</strong>
      </span>
    </span>
  </span>
</a><div id="ethical-ad-placement" data-ea-publisher="readthedocs"></div></div>
  </aside>
  <div class="rside-overlay js-menu" role="button" aria-label="Close Table of Contents" aria-controls="rside" aria-expanded="false"></div>
  <main class="sy-main w-full max-sm:max-w-full print:pt-6">
<div class="sy-breadcrumbs" role="navigation">
  <div class="sy-breadcrumbs-inner flex items-center">
    <div class="md:hidden mr-3">
      <button class="js-menu" aria-label="Menu" type="button" aria-controls="lside" aria-expanded="false">
        <i class="i-lucide menu"></i>
      </button>
    </div>
    <ol class="flex-1" itemscope itemtype="https://schema.org/BreadcrumbList"><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="../index.html"><span itemprop="name">Litestar</span></a>
        <span>/</span>
        <meta itemprop="position" content="1" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="index.html"><span itemprop="name">Module code</span></a>
        <span>/</span>
        <meta itemprop="position" content="2" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <strong itemprop="name">collections</strong>
        <meta itemprop="position" content="3" />
      </li></ol>
    <div class="xl:hidden ml-1">
      <button class="js-menu" aria-label="Show table of contents" type="button" aria-controls="rside"
        aria-expanded="false">
        <i class="i-lucide outdent"></i>
      </button>
    </div>
  </div>
</div><div class="flex flex-col break-words justify-between">
      <div class="min-w-0 max-w-6xl px-6 pb-6 pt-8 xl:px-12">
        <article class="yue" role="main">
          <h1>Source code for collections</h1><div class="highlight"><pre>
<span></span><span data-line="1"><span class="sd">&#39;&#39;&#39;This module implements specialized container datatypes providing</span>
</span><span data-line="2"><span class="sd">alternatives to Python&#39;s general purpose built-in containers, dict,</span>
</span><span data-line="3"><span class="sd">list, set, and tuple.</span>
</span><span data-line="4">
</span><span data-line="5"><span class="sd">* namedtuple   factory function for creating tuple subclasses with named fields</span>
</span><span data-line="6"><span class="sd">* deque        list-like container with fast appends and pops on either end</span>
</span><span data-line="7"><span class="sd">* ChainMap     dict-like class for creating a single view of multiple mappings</span>
</span><span data-line="8"><span class="sd">* Counter      dict subclass for counting hashable objects</span>
</span><span data-line="9"><span class="sd">* OrderedDict  dict subclass that remembers the order entries were added</span>
</span><span data-line="10"><span class="sd">* defaultdict  dict subclass that calls a factory function to supply missing values</span>
</span><span data-line="11"><span class="sd">* UserDict     wrapper around dictionary objects for easier dict subclassing</span>
</span><span data-line="12"><span class="sd">* UserList     wrapper around list objects for easier list subclassing</span>
</span><span data-line="13"><span class="sd">* UserString   wrapper around string objects for easier string subclassing</span>
</span><span data-line="14">
</span><span data-line="15"><span class="sd">&#39;&#39;&#39;</span>
</span><span data-line="16">
</span><span data-line="17"><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
</span><span data-line="18">    <span class="s1">&#39;ChainMap&#39;</span><span class="p">,</span>
</span><span data-line="19">    <span class="s1">&#39;Counter&#39;</span><span class="p">,</span>
</span><span data-line="20">    <span class="s1">&#39;OrderedDict&#39;</span><span class="p">,</span>
</span><span data-line="21">    <span class="s1">&#39;UserDict&#39;</span><span class="p">,</span>
</span><span data-line="22">    <span class="s1">&#39;UserList&#39;</span><span class="p">,</span>
</span><span data-line="23">    <span class="s1">&#39;UserString&#39;</span><span class="p">,</span>
</span><span data-line="24">    <span class="s1">&#39;defaultdict&#39;</span><span class="p">,</span>
</span><span data-line="25">    <span class="s1">&#39;deque&#39;</span><span class="p">,</span>
</span><span data-line="26">    <span class="s1">&#39;namedtuple&#39;</span><span class="p">,</span>
</span><span data-line="27"><span class="p">]</span>
</span><span data-line="28">
</span><span data-line="29"><span class="kn">import</span><span class="w"> </span><span class="nn">_collections_abc</span>
</span><span data-line="30"><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">_sys</span>
</span><span data-line="31">
</span><span data-line="32"><span class="kn">from</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="kn">import</span> <span class="n">chain</span> <span class="k">as</span> <span class="n">_chain</span>
</span><span data-line="33"><span class="kn">from</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="kn">import</span> <span class="n">repeat</span> <span class="k">as</span> <span class="n">_repeat</span>
</span><span data-line="34"><span class="kn">from</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="kn">import</span> <span class="n">starmap</span> <span class="k">as</span> <span class="n">_starmap</span>
</span><span data-line="35"><span class="kn">from</span><span class="w"> </span><span class="nn">keyword</span><span class="w"> </span><span class="kn">import</span> <span class="n">iskeyword</span> <span class="k">as</span> <span class="n">_iskeyword</span>
</span><span data-line="36"><span class="kn">from</span><span class="w"> </span><span class="nn">operator</span><span class="w"> </span><span class="kn">import</span> <span class="n">eq</span> <span class="k">as</span> <span class="n">_eq</span>
</span><span data-line="37"><span class="kn">from</span><span class="w"> </span><span class="nn">operator</span><span class="w"> </span><span class="kn">import</span> <span class="n">itemgetter</span> <span class="k">as</span> <span class="n">_itemgetter</span>
</span><span data-line="38"><span class="kn">from</span><span class="w"> </span><span class="nn">reprlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">recursive_repr</span> <span class="k">as</span> <span class="n">_recursive_repr</span>
</span><span data-line="39"><span class="kn">from</span><span class="w"> </span><span class="nn">_weakref</span><span class="w"> </span><span class="kn">import</span> <span class="n">proxy</span> <span class="k">as</span> <span class="n">_proxy</span>
</span><span data-line="40">
</span><span data-line="41"><span class="k">try</span><span class="p">:</span>
</span><span data-line="42">    <span class="kn">from</span><span class="w"> </span><span class="nn">_collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">deque</span>
</span><span data-line="43"><span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
</span><span data-line="44">    <span class="k">pass</span>
</span><span data-line="45"><span class="k">else</span><span class="p">:</span>
</span><span data-line="46">    <span class="n">_collections_abc</span><span class="o">.</span><span class="n">MutableSequence</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">deque</span><span class="p">)</span>
</span><span data-line="47">
</span><span data-line="48"><span class="k">try</span><span class="p">:</span>
</span><span data-line="49">    <span class="kn">from</span><span class="w"> </span><span class="nn">_collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">_deque_iterator</span>
</span><span data-line="50"><span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
</span><span data-line="51">    <span class="k">pass</span>
</span><span data-line="52">
</span><span data-line="53"><span class="k">try</span><span class="p">:</span>
</span><span data-line="54">    <span class="kn">from</span><span class="w"> </span><span class="nn">_collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">defaultdict</span>
</span><span data-line="55"><span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
</span><span data-line="56">    <span class="k">pass</span>
</span><span data-line="57">
</span><span data-line="58">
</span><span data-line="59"><span class="c1">################################################################################</span>
</span><span data-line="60"><span class="c1">### OrderedDict</span>
</span><span data-line="61"><span class="c1">################################################################################</span>
</span><span data-line="62">
</span><span data-line="63"><span class="k">class</span><span class="w"> </span><span class="nc">_OrderedDictKeysView</span><span class="p">(</span><span class="n">_collections_abc</span><span class="o">.</span><span class="n">KeysView</span><span class="p">):</span>
</span><span data-line="64">
</span><span data-line="65">    <span class="k">def</span><span class="w"> </span><span class="fm">__reversed__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="66">        <span class="k">yield from</span> <span class="nb">reversed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mapping</span><span class="p">)</span>
</span><span data-line="67">
</span><span data-line="68"><span class="k">class</span><span class="w"> </span><span class="nc">_OrderedDictItemsView</span><span class="p">(</span><span class="n">_collections_abc</span><span class="o">.</span><span class="n">ItemsView</span><span class="p">):</span>
</span><span data-line="69">
</span><span data-line="70">    <span class="k">def</span><span class="w"> </span><span class="fm">__reversed__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="71">        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mapping</span><span class="p">):</span>
</span><span data-line="72">            <span class="k">yield</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mapping</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
</span><span data-line="73">
</span><span data-line="74"><span class="k">class</span><span class="w"> </span><span class="nc">_OrderedDictValuesView</span><span class="p">(</span><span class="n">_collections_abc</span><span class="o">.</span><span class="n">ValuesView</span><span class="p">):</span>
</span><span data-line="75">
</span><span data-line="76">    <span class="k">def</span><span class="w"> </span><span class="fm">__reversed__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="77">        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mapping</span><span class="p">):</span>
</span><span data-line="78">            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mapping</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</span><span data-line="79">
</span><span data-line="80"><span class="k">class</span><span class="w"> </span><span class="nc">_Link</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span data-line="81">    <span class="vm">__slots__</span> <span class="o">=</span> <span class="s1">&#39;prev&#39;</span><span class="p">,</span> <span class="s1">&#39;next&#39;</span><span class="p">,</span> <span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;__weakref__&#39;</span>
</span><span data-line="82">
</span><span data-line="83"><span class="k">class</span><span class="w"> </span><span class="nc">OrderedDict</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
</span><span data-line="84">    <span class="s1">&#39;Dictionary that remembers insertion order&#39;</span>
</span><span data-line="85">    <span class="c1"># An inherited dict maps keys to values.</span>
</span><span data-line="86">    <span class="c1"># The inherited dict provides __getitem__, __len__, __contains__, and get.</span>
</span><span data-line="87">    <span class="c1"># The remaining methods are order-aware.</span>
</span><span data-line="88">    <span class="c1"># Big-O running times for all methods are the same as regular dictionaries.</span>
</span><span data-line="89">
</span><span data-line="90">    <span class="c1"># The internal self.__map dict maps keys to links in a doubly linked list.</span>
</span><span data-line="91">    <span class="c1"># The circular doubly linked list starts and ends with a sentinel element.</span>
</span><span data-line="92">    <span class="c1"># The sentinel element never gets deleted (this simplifies the algorithm).</span>
</span><span data-line="93">    <span class="c1"># The sentinel is in self.__hardroot with a weakref proxy in self.__root.</span>
</span><span data-line="94">    <span class="c1"># The prev links are weakref proxies (to prevent circular references).</span>
</span><span data-line="95">    <span class="c1"># Individual links are kept alive by the hard reference in self.__map.</span>
</span><span data-line="96">    <span class="c1"># Those hard references disappear when a key is deleted from an OrderedDict.</span>
</span><span data-line="97">
</span><span data-line="98">    <span class="k">def</span><span class="w"> </span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
</span><span data-line="99">        <span class="s2">&quot;Create the ordered dict object and set up the underlying structures.&quot;</span>
</span><span data-line="100">        <span class="bp">self</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
</span><span data-line="101">        <span class="bp">self</span><span class="o">.</span><span class="n">__hardroot</span> <span class="o">=</span> <span class="n">_Link</span><span class="p">()</span>
</span><span data-line="102">        <span class="bp">self</span><span class="o">.</span><span class="n">__root</span> <span class="o">=</span> <span class="n">root</span> <span class="o">=</span> <span class="n">_proxy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__hardroot</span><span class="p">)</span>
</span><span data-line="103">        <span class="n">root</span><span class="o">.</span><span class="n">prev</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="n">root</span>
</span><span data-line="104">        <span class="bp">self</span><span class="o">.</span><span class="n">__map</span> <span class="o">=</span> <span class="p">{}</span>
</span><span data-line="105">        <span class="k">return</span> <span class="bp">self</span>
</span><span data-line="106">
</span><span data-line="107">    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="p">(),</span> <span class="o">/</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
</span><span data-line="108"><span class="w">        </span><span class="sd">&#39;&#39;&#39;Initialize an ordered dictionary.  The signature is the same as</span>
</span><span data-line="109"><span class="sd">        regular dictionaries.  Keyword argument order is preserved.</span>
</span><span data-line="110"><span class="sd">        &#39;&#39;&#39;</span>
</span><span data-line="111">        <span class="bp">self</span><span class="o">.</span><span class="n">__update</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
</span><span data-line="112">
</span><span data-line="113">    <span class="k">def</span><span class="w"> </span><span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span>
</span><span data-line="114">                    <span class="n">dict_setitem</span><span class="o">=</span><span class="nb">dict</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">,</span> <span class="n">proxy</span><span class="o">=</span><span class="n">_proxy</span><span class="p">,</span> <span class="n">Link</span><span class="o">=</span><span class="n">_Link</span><span class="p">):</span>
</span><span data-line="115">        <span class="s1">&#39;od.__setitem__(i, y) &lt;==&gt; od[i]=y&#39;</span>
</span><span data-line="116">        <span class="c1"># Setting a new item creates a new link at the end of the linked list,</span>
</span><span data-line="117">        <span class="c1"># and the inherited dictionary is updated with the new key/value pair.</span>
</span><span data-line="118">        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</span><span data-line="119">            <span class="bp">self</span><span class="o">.</span><span class="n">__map</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">link</span> <span class="o">=</span> <span class="n">Link</span><span class="p">()</span>
</span><span data-line="120">            <span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__root</span>
</span><span data-line="121">            <span class="n">last</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">prev</span>
</span><span data-line="122">            <span class="n">link</span><span class="o">.</span><span class="n">prev</span><span class="p">,</span> <span class="n">link</span><span class="o">.</span><span class="n">next</span><span class="p">,</span> <span class="n">link</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">last</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">key</span>
</span><span data-line="123">            <span class="n">last</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="n">link</span>
</span><span data-line="124">            <span class="n">root</span><span class="o">.</span><span class="n">prev</span> <span class="o">=</span> <span class="n">proxy</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>
</span><span data-line="125">        <span class="n">dict_setitem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span><span data-line="126">
</span><span data-line="127">    <span class="k">def</span><span class="w"> </span><span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">dict_delitem</span><span class="o">=</span><span class="nb">dict</span><span class="o">.</span><span class="fm">__delitem__</span><span class="p">):</span>
</span><span data-line="128">        <span class="s1">&#39;od.__delitem__(y) &lt;==&gt; del od[y]&#39;</span>
</span><span data-line="129">        <span class="c1"># Deleting an existing item uses self.__map to find the link which gets</span>
</span><span data-line="130">        <span class="c1"># removed by updating the links in the predecessor and successor nodes.</span>
</span><span data-line="131">        <span class="n">dict_delitem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
</span><span data-line="132">        <span class="n">link</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__map</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span data-line="133">        <span class="n">link_prev</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">prev</span>
</span><span data-line="134">        <span class="n">link_next</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">next</span>
</span><span data-line="135">        <span class="n">link_prev</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="n">link_next</span>
</span><span data-line="136">        <span class="n">link_next</span><span class="o">.</span><span class="n">prev</span> <span class="o">=</span> <span class="n">link_prev</span>
</span><span data-line="137">        <span class="n">link</span><span class="o">.</span><span class="n">prev</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="138">        <span class="n">link</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="139">
</span><span data-line="140">    <span class="k">def</span><span class="w"> </span><span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="141">        <span class="s1">&#39;od.__iter__() &lt;==&gt; iter(od)&#39;</span>
</span><span data-line="142">        <span class="c1"># Traverse the linked list in order.</span>
</span><span data-line="143">        <span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__root</span>
</span><span data-line="144">        <span class="n">curr</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">next</span>
</span><span data-line="145">        <span class="k">while</span> <span class="n">curr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">root</span><span class="p">:</span>
</span><span data-line="146">            <span class="k">yield</span> <span class="n">curr</span><span class="o">.</span><span class="n">key</span>
</span><span data-line="147">            <span class="n">curr</span> <span class="o">=</span> <span class="n">curr</span><span class="o">.</span><span class="n">next</span>
</span><span data-line="148">
</span><span data-line="149">    <span class="k">def</span><span class="w"> </span><span class="fm">__reversed__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="150">        <span class="s1">&#39;od.__reversed__() &lt;==&gt; reversed(od)&#39;</span>
</span><span data-line="151">        <span class="c1"># Traverse the linked list in reverse order.</span>
</span><span data-line="152">        <span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__root</span>
</span><span data-line="153">        <span class="n">curr</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">prev</span>
</span><span data-line="154">        <span class="k">while</span> <span class="n">curr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">root</span><span class="p">:</span>
</span><span data-line="155">            <span class="k">yield</span> <span class="n">curr</span><span class="o">.</span><span class="n">key</span>
</span><span data-line="156">            <span class="n">curr</span> <span class="o">=</span> <span class="n">curr</span><span class="o">.</span><span class="n">prev</span>
</span><span data-line="157">
</span><span data-line="158">    <span class="k">def</span><span class="w"> </span><span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="159">        <span class="s1">&#39;od.clear() -&gt; None.  Remove all items from od.&#39;</span>
</span><span data-line="160">        <span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__root</span>
</span><span data-line="161">        <span class="n">root</span><span class="o">.</span><span class="n">prev</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="n">root</span>
</span><span data-line="162">        <span class="bp">self</span><span class="o">.</span><span class="n">__map</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span data-line="163">        <span class="nb">dict</span><span class="o">.</span><span class="n">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span data-line="164">
</span><span data-line="165">    <span class="k">def</span><span class="w"> </span><span class="nf">popitem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">last</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span data-line="166"><span class="w">        </span><span class="sd">&#39;&#39;&#39;Remove and return a (key, value) pair from the dictionary.</span>
</span><span data-line="167">
</span><span data-line="168"><span class="sd">        Pairs are returned in LIFO order if last is true or FIFO order if false.</span>
</span><span data-line="169"><span class="sd">        &#39;&#39;&#39;</span>
</span><span data-line="170">        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">:</span>
</span><span data-line="171">            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s1">&#39;dictionary is empty&#39;</span><span class="p">)</span>
</span><span data-line="172">        <span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__root</span>
</span><span data-line="173">        <span class="k">if</span> <span class="n">last</span><span class="p">:</span>
</span><span data-line="174">            <span class="n">link</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">prev</span>
</span><span data-line="175">            <span class="n">link_prev</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">prev</span>
</span><span data-line="176">            <span class="n">link_prev</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="n">root</span>
</span><span data-line="177">            <span class="n">root</span><span class="o">.</span><span class="n">prev</span> <span class="o">=</span> <span class="n">link_prev</span>
</span><span data-line="178">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="179">            <span class="n">link</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">next</span>
</span><span data-line="180">            <span class="n">link_next</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">next</span>
</span><span data-line="181">            <span class="n">root</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="n">link_next</span>
</span><span data-line="182">            <span class="n">link_next</span><span class="o">.</span><span class="n">prev</span> <span class="o">=</span> <span class="n">root</span>
</span><span data-line="183">        <span class="n">key</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">key</span>
</span><span data-line="184">        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">__map</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</span><span data-line="185">        <span class="n">value</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
</span><span data-line="186">        <span class="k">return</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span>
</span><span data-line="187">
</span><span data-line="188">    <span class="k">def</span><span class="w"> </span><span class="nf">move_to_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">last</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span data-line="189"><span class="w">        </span><span class="sd">&#39;&#39;&#39;Move an existing element to the end (or beginning if last is false).</span>
</span><span data-line="190">
</span><span data-line="191"><span class="sd">        Raise KeyError if the element does not exist.</span>
</span><span data-line="192"><span class="sd">        &#39;&#39;&#39;</span>
</span><span data-line="193">        <span class="n">link</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__map</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</span><span data-line="194">        <span class="n">link_prev</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">prev</span>
</span><span data-line="195">        <span class="n">link_next</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">next</span>
</span><span data-line="196">        <span class="n">soft_link</span> <span class="o">=</span> <span class="n">link_next</span><span class="o">.</span><span class="n">prev</span>
</span><span data-line="197">        <span class="n">link_prev</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="n">link_next</span>
</span><span data-line="198">        <span class="n">link_next</span><span class="o">.</span><span class="n">prev</span> <span class="o">=</span> <span class="n">link_prev</span>
</span><span data-line="199">        <span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__root</span>
</span><span data-line="200">        <span class="k">if</span> <span class="n">last</span><span class="p">:</span>
</span><span data-line="201">            <span class="n">last</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">prev</span>
</span><span data-line="202">            <span class="n">link</span><span class="o">.</span><span class="n">prev</span> <span class="o">=</span> <span class="n">last</span>
</span><span data-line="203">            <span class="n">link</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="n">root</span>
</span><span data-line="204">            <span class="n">root</span><span class="o">.</span><span class="n">prev</span> <span class="o">=</span> <span class="n">soft_link</span>
</span><span data-line="205">            <span class="n">last</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="n">link</span>
</span><span data-line="206">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="207">            <span class="n">first</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">next</span>
</span><span data-line="208">            <span class="n">link</span><span class="o">.</span><span class="n">prev</span> <span class="o">=</span> <span class="n">root</span>
</span><span data-line="209">            <span class="n">link</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="n">first</span>
</span><span data-line="210">            <span class="n">first</span><span class="o">.</span><span class="n">prev</span> <span class="o">=</span> <span class="n">soft_link</span>
</span><span data-line="211">            <span class="n">root</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="n">link</span>
</span><span data-line="212">
</span><span data-line="213">    <span class="k">def</span><span class="w"> </span><span class="nf">__sizeof__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="214">        <span class="n">sizeof</span> <span class="o">=</span> <span class="n">_sys</span><span class="o">.</span><span class="n">getsizeof</span>
</span><span data-line="215">        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>                       <span class="c1"># number of links including root</span>
</span><span data-line="216">        <span class="n">size</span> <span class="o">=</span> <span class="n">sizeof</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>            <span class="c1"># instance dictionary</span>
</span><span data-line="217">        <span class="n">size</span> <span class="o">+=</span> <span class="n">sizeof</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__map</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span>          <span class="c1"># internal dict and inherited dict</span>
</span><span data-line="218">        <span class="n">size</span> <span class="o">+=</span> <span class="n">sizeof</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__hardroot</span><span class="p">)</span> <span class="o">*</span> <span class="n">n</span>     <span class="c1"># link objects</span>
</span><span data-line="219">        <span class="n">size</span> <span class="o">+=</span> <span class="n">sizeof</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__root</span><span class="p">)</span> <span class="o">*</span> <span class="n">n</span>         <span class="c1"># proxy objects</span>
</span><span data-line="220">        <span class="k">return</span> <span class="n">size</span>
</span><span data-line="221">
</span><span data-line="222">    <span class="n">update</span> <span class="o">=</span> <span class="n">__update</span> <span class="o">=</span> <span class="n">_collections_abc</span><span class="o">.</span><span class="n">MutableMapping</span><span class="o">.</span><span class="n">update</span>
</span><span data-line="223">
</span><span data-line="224">    <span class="k">def</span><span class="w"> </span><span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="225">        <span class="s2">&quot;D.keys() -&gt; a set-like object providing a view on D&#39;s keys&quot;</span>
</span><span data-line="226">        <span class="k">return</span> <span class="n">_OrderedDictKeysView</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span data-line="227">
</span><span data-line="228">    <span class="k">def</span><span class="w"> </span><span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="229">        <span class="s2">&quot;D.items() -&gt; a set-like object providing a view on D&#39;s items&quot;</span>
</span><span data-line="230">        <span class="k">return</span> <span class="n">_OrderedDictItemsView</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span data-line="231">
</span><span data-line="232">    <span class="k">def</span><span class="w"> </span><span class="nf">values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="233">        <span class="s2">&quot;D.values() -&gt; an object providing a view on D&#39;s values&quot;</span>
</span><span data-line="234">        <span class="k">return</span> <span class="n">_OrderedDictValuesView</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span data-line="235">
</span><span data-line="236">    <span class="fm">__ne__</span> <span class="o">=</span> <span class="n">_collections_abc</span><span class="o">.</span><span class="n">MutableMapping</span><span class="o">.</span><span class="fm">__ne__</span>
</span><span data-line="237">
</span><span data-line="238">    <span class="n">__marker</span> <span class="o">=</span> <span class="nb">object</span><span class="p">()</span>
</span><span data-line="239">
</span><span data-line="240">    <span class="k">def</span><span class="w"> </span><span class="nf">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">__marker</span><span class="p">):</span>
</span><span data-line="241"><span class="w">        </span><span class="sd">&#39;&#39;&#39;od.pop(k[,d]) -&gt; v, remove specified key and return the corresponding</span>
</span><span data-line="242"><span class="sd">        value.  If key is not found, d is returned if given, otherwise KeyError</span>
</span><span data-line="243"><span class="sd">        is raised.</span>
</span><span data-line="244">
</span><span data-line="245"><span class="sd">        &#39;&#39;&#39;</span>
</span><span data-line="246">        <span class="n">marker</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__marker</span>
</span><span data-line="247">        <span class="n">result</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">marker</span><span class="p">)</span>
</span><span data-line="248">        <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">marker</span><span class="p">:</span>
</span><span data-line="249">            <span class="c1"># The same as in __delitem__().</span>
</span><span data-line="250">            <span class="n">link</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__map</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span data-line="251">            <span class="n">link_prev</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">prev</span>
</span><span data-line="252">            <span class="n">link_next</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">next</span>
</span><span data-line="253">            <span class="n">link_prev</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="n">link_next</span>
</span><span data-line="254">            <span class="n">link_next</span><span class="o">.</span><span class="n">prev</span> <span class="o">=</span> <span class="n">link_prev</span>
</span><span data-line="255">            <span class="n">link</span><span class="o">.</span><span class="n">prev</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="256">            <span class="n">link</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="257">            <span class="k">return</span> <span class="n">result</span>
</span><span data-line="258">        <span class="k">if</span> <span class="n">default</span> <span class="ow">is</span> <span class="n">marker</span><span class="p">:</span>
</span><span data-line="259">            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span data-line="260">        <span class="k">return</span> <span class="n">default</span>
</span><span data-line="261">
</span><span data-line="262">    <span class="k">def</span><span class="w"> </span><span class="nf">setdefault</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span data-line="263"><span class="w">        </span><span class="sd">&#39;&#39;&#39;Insert key with a value of default if key is not in the dictionary.</span>
</span><span data-line="264">
</span><span data-line="265"><span class="sd">        Return the value for key if key is in the dictionary, else default.</span>
</span><span data-line="266"><span class="sd">        &#39;&#39;&#39;</span>
</span><span data-line="267">        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</span><span data-line="268">            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</span><span data-line="269">        <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">default</span>
</span><span data-line="270">        <span class="k">return</span> <span class="n">default</span>
</span><span data-line="271">
</span><span data-line="272">    <span class="nd">@_recursive_repr</span><span class="p">()</span>
</span><span data-line="273">    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="274">        <span class="s1">&#39;od.__repr__() &lt;==&gt; repr(od)&#39;</span>
</span><span data-line="275">        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">:</span>
</span><span data-line="276">            <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">()&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,)</span>
</span><span data-line="277">        <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">(</span><span class="si">%r</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
</span><span data-line="278">
</span><span data-line="279">    <span class="k">def</span><span class="w"> </span><span class="nf">__reduce__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="280">        <span class="s1">&#39;Return state information for pickling&#39;</span>
</span><span data-line="281">        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getstate__</span><span class="p">()</span>
</span><span data-line="282">        <span class="k">if</span> <span class="n">state</span><span class="p">:</span>
</span><span data-line="283">            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
</span><span data-line="284">                <span class="n">state</span><span class="p">,</span> <span class="n">slots</span> <span class="o">=</span> <span class="n">state</span>
</span><span data-line="285">            <span class="k">else</span><span class="p">:</span>
</span><span data-line="286">                <span class="n">slots</span> <span class="o">=</span> <span class="p">{}</span>
</span><span data-line="287">            <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span data-line="288">            <span class="n">slots</span> <span class="o">=</span> <span class="n">slots</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span data-line="289">            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">(</span><span class="n">OrderedDict</span><span class="p">()):</span>
</span><span data-line="290">                <span class="n">state</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span data-line="291">                <span class="n">slots</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span data-line="292">            <span class="k">if</span> <span class="n">slots</span><span class="p">:</span>
</span><span data-line="293">                <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="p">,</span> <span class="n">slots</span>
</span><span data-line="294">            <span class="k">else</span><span class="p">:</span>
</span><span data-line="295">                <span class="n">state</span> <span class="o">=</span> <span class="n">state</span> <span class="ow">or</span> <span class="kc">None</span>
</span><span data-line="296">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="p">(),</span> <span class="n">state</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
</span><span data-line="297">
</span><span data-line="298">    <span class="k">def</span><span class="w"> </span><span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="299">        <span class="s1">&#39;od.copy() -&gt; a shallow copy of od&#39;</span>
</span><span data-line="300">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span data-line="301">
</span><span data-line="302">    <span class="nd">@classmethod</span>
</span><span data-line="303">    <span class="k">def</span><span class="w"> </span><span class="nf">fromkeys</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">iterable</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span data-line="304"><span class="w">        </span><span class="sd">&#39;&#39;&#39;Create a new ordered dictionary with keys from iterable and values set to value.</span>
</span><span data-line="305"><span class="sd">        &#39;&#39;&#39;</span>
</span><span data-line="306">        <span class="bp">self</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
</span><span data-line="307">        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">iterable</span><span class="p">:</span>
</span><span data-line="308">            <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span data-line="309">        <span class="k">return</span> <span class="bp">self</span>
</span><span data-line="310">
</span><span data-line="311">    <span class="k">def</span><span class="w"> </span><span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span data-line="312"><span class="w">        </span><span class="sd">&#39;&#39;&#39;od.__eq__(y) &lt;==&gt; od==y.  Comparison to another OD is order-sensitive</span>
</span><span data-line="313"><span class="sd">        while comparison to a regular mapping is order-insensitive.</span>
</span><span data-line="314">
</span><span data-line="315"><span class="sd">        &#39;&#39;&#39;</span>
</span><span data-line="316">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">OrderedDict</span><span class="p">):</span>
</span><span data-line="317">            <span class="k">return</span> <span class="nb">dict</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">_eq</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>
</span><span data-line="318">        <span class="k">return</span> <span class="nb">dict</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
</span><span data-line="319">
</span><span data-line="320">    <span class="k">def</span><span class="w"> </span><span class="fm">__ior__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span data-line="321">        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span data-line="322">        <span class="k">return</span> <span class="bp">self</span>
</span><span data-line="323">
</span><span data-line="324">    <span class="k">def</span><span class="w"> </span><span class="fm">__or__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span data-line="325">        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span data-line="326">            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span data-line="327">        <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span data-line="328">        <span class="n">new</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span data-line="329">        <span class="k">return</span> <span class="n">new</span>
</span><span data-line="330">
</span><span data-line="331">    <span class="k">def</span><span class="w"> </span><span class="fm">__ror__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span data-line="332">        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span data-line="333">            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span data-line="334">        <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span data-line="335">        <span class="n">new</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span data-line="336">        <span class="k">return</span> <span class="n">new</span>
</span><span data-line="337">
</span><span data-line="338">
</span><span data-line="339"><span class="k">try</span><span class="p">:</span>
</span><span data-line="340">    <span class="kn">from</span><span class="w"> </span><span class="nn">_collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">OrderedDict</span>
</span><span data-line="341"><span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
</span><span data-line="342">    <span class="c1"># Leave the pure Python version in place.</span>
</span><span data-line="343">    <span class="k">pass</span>
</span><span data-line="344">
</span><span data-line="345">
</span><span data-line="346"><span class="c1">################################################################################</span>
</span><span data-line="347"><span class="c1">### namedtuple</span>
</span><span data-line="348"><span class="c1">################################################################################</span>
</span><span data-line="349">
</span><span data-line="350"><span class="k">try</span><span class="p">:</span>
</span><span data-line="351">    <span class="kn">from</span><span class="w"> </span><span class="nn">_collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">_tuplegetter</span>
</span><span data-line="352"><span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
</span><span data-line="353">    <span class="n">_tuplegetter</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">index</span><span class="p">,</span> <span class="n">doc</span><span class="p">:</span> <span class="nb">property</span><span class="p">(</span><span class="n">_itemgetter</span><span class="p">(</span><span class="n">index</span><span class="p">),</span> <span class="n">doc</span><span class="o">=</span><span class="n">doc</span><span class="p">)</span>
</span><span data-line="354">
</span><span data-line="355"><span class="k">def</span><span class="w"> </span><span class="nf">namedtuple</span><span class="p">(</span><span class="n">typename</span><span class="p">,</span> <span class="n">field_names</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">rename</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">defaults</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">module</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span data-line="356"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a new subclass of tuple with named fields.</span>
</span><span data-line="357">
</span><span data-line="358"><span class="sd">    &gt;&gt;&gt; Point = namedtuple(&#39;Point&#39;, [&#39;x&#39;, &#39;y&#39;])</span>
</span><span data-line="359"><span class="sd">    &gt;&gt;&gt; Point.__doc__                   # docstring for the new class</span>
</span><span data-line="360"><span class="sd">    &#39;Point(x, y)&#39;</span>
</span><span data-line="361"><span class="sd">    &gt;&gt;&gt; p = Point(11, y=22)             # instantiate with positional args or keywords</span>
</span><span data-line="362"><span class="sd">    &gt;&gt;&gt; p[0] + p[1]                     # indexable like a plain tuple</span>
</span><span data-line="363"><span class="sd">    33</span>
</span><span data-line="364"><span class="sd">    &gt;&gt;&gt; x, y = p                        # unpack like a regular tuple</span>
</span><span data-line="365"><span class="sd">    &gt;&gt;&gt; x, y</span>
</span><span data-line="366"><span class="sd">    (11, 22)</span>
</span><span data-line="367"><span class="sd">    &gt;&gt;&gt; p.x + p.y                       # fields also accessible by name</span>
</span><span data-line="368"><span class="sd">    33</span>
</span><span data-line="369"><span class="sd">    &gt;&gt;&gt; d = p._asdict()                 # convert to a dictionary</span>
</span><span data-line="370"><span class="sd">    &gt;&gt;&gt; d[&#39;x&#39;]</span>
</span><span data-line="371"><span class="sd">    11</span>
</span><span data-line="372"><span class="sd">    &gt;&gt;&gt; Point(**d)                      # convert from a dictionary</span>
</span><span data-line="373"><span class="sd">    Point(x=11, y=22)</span>
</span><span data-line="374"><span class="sd">    &gt;&gt;&gt; p._replace(x=100)               # _replace() is like str.replace() but targets named fields</span>
</span><span data-line="375"><span class="sd">    Point(x=100, y=22)</span>
</span><span data-line="376">
</span><span data-line="377"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="378">
</span><span data-line="379">    <span class="c1"># Validate the field names.  At the user&#39;s option, either generate an error</span>
</span><span data-line="380">    <span class="c1"># message or automatically replace the field name with a valid name.</span>
</span><span data-line="381">    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field_names</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span data-line="382">        <span class="n">field_names</span> <span class="o">=</span> <span class="n">field_names</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
</span><span data-line="383">    <span class="n">field_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">field_names</span><span class="p">))</span>
</span><span data-line="384">    <span class="n">typename</span> <span class="o">=</span> <span class="n">_sys</span><span class="o">.</span><span class="n">intern</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">typename</span><span class="p">))</span>
</span><span data-line="385">
</span><span data-line="386">    <span class="k">if</span> <span class="n">rename</span><span class="p">:</span>
</span><span data-line="387">        <span class="n">seen</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span data-line="388">        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">field_names</span><span class="p">):</span>
</span><span data-line="389">            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">isidentifier</span><span class="p">()</span>
</span><span data-line="390">                <span class="ow">or</span> <span class="n">_iskeyword</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span><span data-line="391">                <span class="ow">or</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
</span><span data-line="392">                <span class="ow">or</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">):</span>
</span><span data-line="393">                <span class="n">field_names</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;_</span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span data-line="394">            <span class="n">seen</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span><span data-line="395">
</span><span data-line="396">    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="n">typename</span><span class="p">]</span> <span class="o">+</span> <span class="n">field_names</span><span class="p">:</span>
</span><span data-line="397">        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">:</span>
</span><span data-line="398">            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Type names and field names must be strings&#39;</span><span class="p">)</span>
</span><span data-line="399">        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">isidentifier</span><span class="p">():</span>
</span><span data-line="400">            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Type names and field names must be valid &#39;</span>
</span><span data-line="401">                             <span class="sa">f</span><span class="s1">&#39;identifiers: </span><span class="si">{</span><span class="n">name</span><span class="si">!r}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span data-line="402">        <span class="k">if</span> <span class="n">_iskeyword</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
</span><span data-line="403">            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Type names and field names cannot be a &#39;</span>
</span><span data-line="404">                             <span class="sa">f</span><span class="s1">&#39;keyword: </span><span class="si">{</span><span class="n">name</span><span class="si">!r}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span data-line="405">
</span><span data-line="406">    <span class="n">seen</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span data-line="407">    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">field_names</span><span class="p">:</span>
</span><span data-line="408">        <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">rename</span><span class="p">:</span>
</span><span data-line="409">            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Field names cannot start with an underscore: &#39;</span>
</span><span data-line="410">                             <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">!r}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span data-line="411">        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>
</span><span data-line="412">            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Encountered duplicate field name: </span><span class="si">{</span><span class="n">name</span><span class="si">!r}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span data-line="413">        <span class="n">seen</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span><span data-line="414">
</span><span data-line="415">    <span class="n">field_defaults</span> <span class="o">=</span> <span class="p">{}</span>
</span><span data-line="416">    <span class="k">if</span> <span class="n">defaults</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="417">        <span class="n">defaults</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">defaults</span><span class="p">)</span>
</span><span data-line="418">        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">defaults</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">field_names</span><span class="p">):</span>
</span><span data-line="419">            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Got more default values than field names&#39;</span><span class="p">)</span>
</span><span data-line="420">        <span class="n">field_defaults</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">field_names</span><span class="p">),</span>
</span><span data-line="421">                                                <span class="nb">reversed</span><span class="p">(</span><span class="n">defaults</span><span class="p">)))))</span>
</span><span data-line="422">
</span><span data-line="423">    <span class="c1"># Variables used in the methods and docstrings</span>
</span><span data-line="424">    <span class="n">field_names</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">_sys</span><span class="o">.</span><span class="n">intern</span><span class="p">,</span> <span class="n">field_names</span><span class="p">))</span>
</span><span data-line="425">    <span class="n">num_fields</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">field_names</span><span class="p">)</span>
</span><span data-line="426">    <span class="n">arg_list</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">field_names</span><span class="p">)</span>
</span><span data-line="427">    <span class="k">if</span> <span class="n">num_fields</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span data-line="428">        <span class="n">arg_list</span> <span class="o">+=</span> <span class="s1">&#39;,&#39;</span>
</span><span data-line="429">    <span class="n">repr_fmt</span> <span class="o">=</span> <span class="s1">&#39;(&#39;</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">=%r&#39;</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">field_names</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
</span><span data-line="430">    <span class="n">tuple_new</span> <span class="o">=</span> <span class="nb">tuple</span><span class="o">.</span><span class="fm">__new__</span>
</span><span data-line="431">    <span class="n">_dict</span><span class="p">,</span> <span class="n">_tuple</span><span class="p">,</span> <span class="n">_len</span><span class="p">,</span> <span class="n">_map</span><span class="p">,</span> <span class="n">_zip</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="nb">len</span><span class="p">,</span> <span class="nb">map</span><span class="p">,</span> <span class="nb">zip</span>
</span><span data-line="432">
</span><span data-line="433">    <span class="c1"># Create all the named tuple methods to be added to the class namespace</span>
</span><span data-line="434">
</span><span data-line="435">    <span class="n">namespace</span> <span class="o">=</span> <span class="p">{</span>
</span><span data-line="436">        <span class="s1">&#39;_tuple_new&#39;</span><span class="p">:</span> <span class="n">tuple_new</span><span class="p">,</span>
</span><span data-line="437">        <span class="s1">&#39;__builtins__&#39;</span><span class="p">:</span> <span class="p">{},</span>
</span><span data-line="438">        <span class="s1">&#39;__name__&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;namedtuple_</span><span class="si">{</span><span class="n">typename</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span data-line="439">    <span class="p">}</span>
</span><span data-line="440">    <span class="n">code</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;lambda _cls, </span><span class="si">{</span><span class="n">arg_list</span><span class="si">}</span><span class="s1">: _tuple_new(_cls, (</span><span class="si">{</span><span class="n">arg_list</span><span class="si">}</span><span class="s1">))&#39;</span>
</span><span data-line="441">    <span class="fm">__new__</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span>
</span><span data-line="442">    <span class="fm">__new__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="s1">&#39;__new__&#39;</span>
</span><span data-line="443">    <span class="fm">__new__</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Create new instance of </span><span class="si">{</span><span class="n">typename</span><span class="si">}</span><span class="s1">(</span><span class="si">{</span><span class="n">arg_list</span><span class="si">}</span><span class="s1">)&#39;</span>
</span><span data-line="444">    <span class="k">if</span> <span class="n">defaults</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="445">        <span class="fm">__new__</span><span class="o">.</span><span class="vm">__defaults__</span> <span class="o">=</span> <span class="n">defaults</span>
</span><span data-line="446">
</span><span data-line="447">    <span class="nd">@classmethod</span>
</span><span data-line="448">    <span class="k">def</span><span class="w"> </span><span class="nf">_make</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">iterable</span><span class="p">):</span>
</span><span data-line="449">        <span class="n">result</span> <span class="o">=</span> <span class="n">tuple_new</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">iterable</span><span class="p">)</span>
</span><span data-line="450">        <span class="k">if</span> <span class="n">_len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">!=</span> <span class="n">num_fields</span><span class="p">:</span>
</span><span data-line="451">            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Expected </span><span class="si">{</span><span class="n">num_fields</span><span class="si">}</span><span class="s1"> arguments, got </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span data-line="452">        <span class="k">return</span> <span class="n">result</span>
</span><span data-line="453">
</span><span data-line="454">    <span class="n">_make</span><span class="o">.</span><span class="vm">__func__</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Make a new </span><span class="si">{</span><span class="n">typename</span><span class="si">}</span><span class="s1"> object from a sequence &#39;</span>
</span><span data-line="455">                              <span class="s1">&#39;or iterable&#39;</span><span class="p">)</span>
</span><span data-line="456">
</span><span data-line="457">    <span class="k">def</span><span class="w"> </span><span class="nf">_replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
</span><span data-line="458">        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make</span><span class="p">(</span><span class="n">_map</span><span class="p">(</span><span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">,</span> <span class="n">field_names</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>
</span><span data-line="459">        <span class="k">if</span> <span class="n">kwds</span><span class="p">:</span>
</span><span data-line="460">            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Got unexpected field names: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">kwds</span><span class="p">)</span><span class="si">!r}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span data-line="461">        <span class="k">return</span> <span class="n">result</span>
</span><span data-line="462">
</span><span data-line="463">    <span class="n">_replace</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Return a new </span><span class="si">{</span><span class="n">typename</span><span class="si">}</span><span class="s1"> object replacing specified &#39;</span>
</span><span data-line="464">                        <span class="s1">&#39;fields with new values&#39;</span><span class="p">)</span>
</span><span data-line="465">
</span><span data-line="466">    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="467">        <span class="s1">&#39;Return a nicely formatted representation string&#39;</span>
</span><span data-line="468">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</span><span data-line="469">
</span><span data-line="470">    <span class="k">def</span><span class="w"> </span><span class="nf">_asdict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="471">        <span class="s1">&#39;Return a new dict which maps field names to their values.&#39;</span>
</span><span data-line="472">        <span class="k">return</span> <span class="n">_dict</span><span class="p">(</span><span class="n">_zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fields</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>
</span><span data-line="473">
</span><span data-line="474">    <span class="k">def</span><span class="w"> </span><span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="475">        <span class="s1">&#39;Return self as a plain tuple.  Used by copy and pickle.&#39;</span>
</span><span data-line="476">        <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span data-line="477">
</span><span data-line="478">    <span class="c1"># Modify function metadata to help with introspection and debugging</span>
</span><span data-line="479">    <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">(</span>
</span><span data-line="480">        <span class="fm">__new__</span><span class="p">,</span>
</span><span data-line="481">        <span class="n">_make</span><span class="o">.</span><span class="vm">__func__</span><span class="p">,</span>
</span><span data-line="482">        <span class="n">_replace</span><span class="p">,</span>
</span><span data-line="483">        <span class="fm">__repr__</span><span class="p">,</span>
</span><span data-line="484">        <span class="n">_asdict</span><span class="p">,</span>
</span><span data-line="485">        <span class="n">__getnewargs__</span><span class="p">,</span>
</span><span data-line="486">    <span class="p">):</span>
</span><span data-line="487">        <span class="n">method</span><span class="o">.</span><span class="vm">__qualname__</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">typename</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">method</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span data-line="488">
</span><span data-line="489">    <span class="c1"># Build-up the class namespace dictionary</span>
</span><span data-line="490">    <span class="c1"># and use type() to build the result class</span>
</span><span data-line="491">    <span class="n">class_namespace</span> <span class="o">=</span> <span class="p">{</span>
</span><span data-line="492">        <span class="s1">&#39;__doc__&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">typename</span><span class="si">}</span><span class="s1">(</span><span class="si">{</span><span class="n">arg_list</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,</span>
</span><span data-line="493">        <span class="s1">&#39;__slots__&#39;</span><span class="p">:</span> <span class="p">(),</span>
</span><span data-line="494">        <span class="s1">&#39;_fields&#39;</span><span class="p">:</span> <span class="n">field_names</span><span class="p">,</span>
</span><span data-line="495">        <span class="s1">&#39;_field_defaults&#39;</span><span class="p">:</span> <span class="n">field_defaults</span><span class="p">,</span>
</span><span data-line="496">        <span class="s1">&#39;__new__&#39;</span><span class="p">:</span> <span class="fm">__new__</span><span class="p">,</span>
</span><span data-line="497">        <span class="s1">&#39;_make&#39;</span><span class="p">:</span> <span class="n">_make</span><span class="p">,</span>
</span><span data-line="498">        <span class="s1">&#39;_replace&#39;</span><span class="p">:</span> <span class="n">_replace</span><span class="p">,</span>
</span><span data-line="499">        <span class="s1">&#39;__repr__&#39;</span><span class="p">:</span> <span class="fm">__repr__</span><span class="p">,</span>
</span><span data-line="500">        <span class="s1">&#39;_asdict&#39;</span><span class="p">:</span> <span class="n">_asdict</span><span class="p">,</span>
</span><span data-line="501">        <span class="s1">&#39;__getnewargs__&#39;</span><span class="p">:</span> <span class="n">__getnewargs__</span><span class="p">,</span>
</span><span data-line="502">        <span class="s1">&#39;__match_args__&#39;</span><span class="p">:</span> <span class="n">field_names</span><span class="p">,</span>
</span><span data-line="503">    <span class="p">}</span>
</span><span data-line="504">    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">field_names</span><span class="p">):</span>
</span><span data-line="505">        <span class="n">doc</span> <span class="o">=</span> <span class="n">_sys</span><span class="o">.</span><span class="n">intern</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Alias for field number </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span data-line="506">        <span class="n">class_namespace</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">_tuplegetter</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">doc</span><span class="p">)</span>
</span><span data-line="507">
</span><span data-line="508">    <span class="n">result</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">typename</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,),</span> <span class="n">class_namespace</span><span class="p">)</span>
</span><span data-line="509">
</span><span data-line="510">    <span class="c1"># For pickling to work, the __module__ variable needs to be set to the frame</span>
</span><span data-line="511">    <span class="c1"># where the named tuple is created.  Bypass this step in environments where</span>
</span><span data-line="512">    <span class="c1"># sys._getframe is not defined (Jython for example) or sys._getframe is not</span>
</span><span data-line="513">    <span class="c1"># defined for arguments greater than 0 (IronPython), or where the user has</span>
</span><span data-line="514">    <span class="c1"># specified a particular module.</span>
</span><span data-line="515">    <span class="k">if</span> <span class="n">module</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="516">        <span class="k">try</span><span class="p">:</span>
</span><span data-line="517">            <span class="n">module</span> <span class="o">=</span> <span class="n">_sys</span><span class="o">.</span><span class="n">_getframemodulename</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> <span class="s1">&#39;__main__&#39;</span>
</span><span data-line="518">        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
</span><span data-line="519">            <span class="k">try</span><span class="p">:</span>
</span><span data-line="520">                <span class="n">module</span> <span class="o">=</span> <span class="n">_sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">f_globals</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;__name__&#39;</span><span class="p">,</span> <span class="s1">&#39;__main__&#39;</span><span class="p">)</span>
</span><span data-line="521">            <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
</span><span data-line="522">                <span class="k">pass</span>
</span><span data-line="523">    <span class="k">if</span> <span class="n">module</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="524">        <span class="n">result</span><span class="o">.</span><span class="vm">__module__</span> <span class="o">=</span> <span class="n">module</span>
</span><span data-line="525">
</span><span data-line="526">    <span class="k">return</span> <span class="n">result</span>
</span><span data-line="527">
</span><span data-line="528">
</span><span data-line="529"><span class="c1">########################################################################</span>
</span><span data-line="530"><span class="c1">###  Counter</span>
</span><span data-line="531"><span class="c1">########################################################################</span>
</span><span data-line="532">
</span><span data-line="533"><span class="k">def</span><span class="w"> </span><span class="nf">_count_elements</span><span class="p">(</span><span class="n">mapping</span><span class="p">,</span> <span class="n">iterable</span><span class="p">):</span>
</span><span data-line="534">    <span class="s1">&#39;Tally elements from the iterable.&#39;</span>
</span><span data-line="535">    <span class="n">mapping_get</span> <span class="o">=</span> <span class="n">mapping</span><span class="o">.</span><span class="n">get</span>
</span><span data-line="536">    <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">iterable</span><span class="p">:</span>
</span><span data-line="537">        <span class="n">mapping</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapping_get</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</span><span data-line="538">
</span><span data-line="539"><span class="k">try</span><span class="p">:</span>                                    <span class="c1"># Load C helper function if available</span>
</span><span data-line="540">    <span class="kn">from</span><span class="w"> </span><span class="nn">_collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">_count_elements</span>
</span><span data-line="541"><span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
</span><span data-line="542">    <span class="k">pass</span>
</span><span data-line="543">
</span><span data-line="544"><span class="k">class</span><span class="w"> </span><span class="nc">Counter</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
</span><span data-line="545"><span class="w">    </span><span class="sd">&#39;&#39;&#39;Dict subclass for counting hashable items.  Sometimes called a bag</span>
</span><span data-line="546"><span class="sd">    or multiset.  Elements are stored as dictionary keys and their counts</span>
</span><span data-line="547"><span class="sd">    are stored as dictionary values.</span>
</span><span data-line="548">
</span><span data-line="549"><span class="sd">    &gt;&gt;&gt; c = Counter(&#39;abcdeabcdabcaba&#39;)  # count elements from a string</span>
</span><span data-line="550">
</span><span data-line="551"><span class="sd">    &gt;&gt;&gt; c.most_common(3)                # three most common elements</span>
</span><span data-line="552"><span class="sd">    [(&#39;a&#39;, 5), (&#39;b&#39;, 4), (&#39;c&#39;, 3)]</span>
</span><span data-line="553"><span class="sd">    &gt;&gt;&gt; sorted(c)                       # list all unique elements</span>
</span><span data-line="554"><span class="sd">    [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;e&#39;]</span>
</span><span data-line="555"><span class="sd">    &gt;&gt;&gt; &#39;&#39;.join(sorted(c.elements()))   # list elements with repetitions</span>
</span><span data-line="556"><span class="sd">    &#39;aaaaabbbbcccdde&#39;</span>
</span><span data-line="557"><span class="sd">    &gt;&gt;&gt; sum(c.values())                 # total of all counts</span>
</span><span data-line="558"><span class="sd">    15</span>
</span><span data-line="559">
</span><span data-line="560"><span class="sd">    &gt;&gt;&gt; c[&#39;a&#39;]                          # count of letter &#39;a&#39;</span>
</span><span data-line="561"><span class="sd">    5</span>
</span><span data-line="562"><span class="sd">    &gt;&gt;&gt; for elem in &#39;shazam&#39;:           # update counts from an iterable</span>
</span><span data-line="563"><span class="sd">    ...     c[elem] += 1                # by adding 1 to each element&#39;s count</span>
</span><span data-line="564"><span class="sd">    &gt;&gt;&gt; c[&#39;a&#39;]                          # now there are seven &#39;a&#39;</span>
</span><span data-line="565"><span class="sd">    7</span>
</span><span data-line="566"><span class="sd">    &gt;&gt;&gt; del c[&#39;b&#39;]                      # remove all &#39;b&#39;</span>
</span><span data-line="567"><span class="sd">    &gt;&gt;&gt; c[&#39;b&#39;]                          # now there are zero &#39;b&#39;</span>
</span><span data-line="568"><span class="sd">    0</span>
</span><span data-line="569">
</span><span data-line="570"><span class="sd">    &gt;&gt;&gt; d = Counter(&#39;simsalabim&#39;)       # make another counter</span>
</span><span data-line="571"><span class="sd">    &gt;&gt;&gt; c.update(d)                     # add in the second counter</span>
</span><span data-line="572"><span class="sd">    &gt;&gt;&gt; c[&#39;a&#39;]                          # now there are nine &#39;a&#39;</span>
</span><span data-line="573"><span class="sd">    9</span>
</span><span data-line="574">
</span><span data-line="575"><span class="sd">    &gt;&gt;&gt; c.clear()                       # empty the counter</span>
</span><span data-line="576"><span class="sd">    &gt;&gt;&gt; c</span>
</span><span data-line="577"><span class="sd">    Counter()</span>
</span><span data-line="578">
</span><span data-line="579"><span class="sd">    Note:  If a count is set to zero or reduced to zero, it will remain</span>
</span><span data-line="580"><span class="sd">    in the counter until the entry is deleted or the counter is cleared:</span>
</span><span data-line="581">
</span><span data-line="582"><span class="sd">    &gt;&gt;&gt; c = Counter(&#39;aaabbc&#39;)</span>
</span><span data-line="583"><span class="sd">    &gt;&gt;&gt; c[&#39;b&#39;] -= 2                     # reduce the count of &#39;b&#39; by two</span>
</span><span data-line="584"><span class="sd">    &gt;&gt;&gt; c.most_common()                 # &#39;b&#39; is still in, but its count is zero</span>
</span><span data-line="585"><span class="sd">    [(&#39;a&#39;, 3), (&#39;c&#39;, 1), (&#39;b&#39;, 0)]</span>
</span><span data-line="586">
</span><span data-line="587"><span class="sd">    &#39;&#39;&#39;</span>
</span><span data-line="588">    <span class="c1"># References:</span>
</span><span data-line="589">    <span class="c1">#   http://en.wikipedia.org/wiki/Multiset</span>
</span><span data-line="590">    <span class="c1">#   http://www.gnu.org/software/smalltalk/manual-base/html_node/Bag.html</span>
</span><span data-line="591">    <span class="c1">#   http://www.java2s.com/Tutorial/Cpp/0380__set-multiset/Catalog0380__set-multiset.htm</span>
</span><span data-line="592">    <span class="c1">#   http://code.activestate.com/recipes/259174/</span>
</span><span data-line="593">    <span class="c1">#   Knuth, TAOCP Vol. II section 4.6.3</span>
</span><span data-line="594">
</span><span data-line="595">    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iterable</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
</span><span data-line="596"><span class="w">        </span><span class="sd">&#39;&#39;&#39;Create a new, empty Counter object.  And if given, count elements</span>
</span><span data-line="597"><span class="sd">        from an input iterable.  Or, initialize the count from another mapping</span>
</span><span data-line="598"><span class="sd">        of elements to their counts.</span>
</span><span data-line="599">
</span><span data-line="600"><span class="sd">        &gt;&gt;&gt; c = Counter()                           # a new, empty counter</span>
</span><span data-line="601"><span class="sd">        &gt;&gt;&gt; c = Counter(&#39;gallahad&#39;)                 # a new counter from an iterable</span>
</span><span data-line="602"><span class="sd">        &gt;&gt;&gt; c = Counter({&#39;a&#39;: 4, &#39;b&#39;: 2})           # a new counter from a mapping</span>
</span><span data-line="603"><span class="sd">        &gt;&gt;&gt; c = Counter(a=4, b=2)                   # a new counter from keyword args</span>
</span><span data-line="604">
</span><span data-line="605"><span class="sd">        &#39;&#39;&#39;</span>
</span><span data-line="606">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span data-line="607">        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">iterable</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
</span><span data-line="608">
</span><span data-line="609">    <span class="k">def</span><span class="w"> </span><span class="fm">__missing__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
</span><span data-line="610">        <span class="s1">&#39;The count of elements not in the Counter is zero.&#39;</span>
</span><span data-line="611">        <span class="c1"># Needed so that self[missing_item] does not raise KeyError</span>
</span><span data-line="612">        <span class="k">return</span> <span class="mi">0</span>
</span><span data-line="613">
</span><span data-line="614">    <span class="k">def</span><span class="w"> </span><span class="nf">total</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="615">        <span class="s1">&#39;Sum of the counts&#39;</span>
</span><span data-line="616">        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span><span data-line="617">
</span><span data-line="618">    <span class="k">def</span><span class="w"> </span><span class="nf">most_common</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span data-line="619"><span class="w">        </span><span class="sd">&#39;&#39;&#39;List the n most common elements and their counts from the most</span>
</span><span data-line="620"><span class="sd">        common to the least.  If n is None, then list all element counts.</span>
</span><span data-line="621">
</span><span data-line="622"><span class="sd">        &gt;&gt;&gt; Counter(&#39;abracadabra&#39;).most_common(3)</span>
</span><span data-line="623"><span class="sd">        [(&#39;a&#39;, 5), (&#39;b&#39;, 2), (&#39;r&#39;, 2)]</span>
</span><span data-line="624">
</span><span data-line="625"><span class="sd">        &#39;&#39;&#39;</span>
</span><span data-line="626">        <span class="c1"># Emulate Bag.sortedByCount from Smalltalk</span>
</span><span data-line="627">        <span class="k">if</span> <span class="n">n</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="628">            <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="n">_itemgetter</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span data-line="629">
</span><span data-line="630">        <span class="c1"># Lazy import to speedup Python startup time</span>
</span><span data-line="631">        <span class="kn">import</span><span class="w"> </span><span class="nn">heapq</span>
</span><span data-line="632">        <span class="k">return</span> <span class="n">heapq</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="n">_itemgetter</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</span><span data-line="633">
</span><span data-line="634">    <span class="k">def</span><span class="w"> </span><span class="nf">elements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="635"><span class="w">        </span><span class="sd">&#39;&#39;&#39;Iterator over elements repeating each as many times as its count.</span>
</span><span data-line="636">
</span><span data-line="637"><span class="sd">        &gt;&gt;&gt; c = Counter(&#39;ABCABC&#39;)</span>
</span><span data-line="638"><span class="sd">        &gt;&gt;&gt; sorted(c.elements())</span>
</span><span data-line="639"><span class="sd">        [&#39;A&#39;, &#39;A&#39;, &#39;B&#39;, &#39;B&#39;, &#39;C&#39;, &#39;C&#39;]</span>
</span><span data-line="640">
</span><span data-line="641"><span class="sd">        Knuth&#39;s example for prime factors of 1836:  2**2 * 3**3 * 17**1</span>
</span><span data-line="642">
</span><span data-line="643"><span class="sd">        &gt;&gt;&gt; import math</span>
</span><span data-line="644"><span class="sd">        &gt;&gt;&gt; prime_factors = Counter({2: 2, 3: 3, 17: 1})</span>
</span><span data-line="645"><span class="sd">        &gt;&gt;&gt; math.prod(prime_factors.elements())</span>
</span><span data-line="646"><span class="sd">        1836</span>
</span><span data-line="647">
</span><span data-line="648"><span class="sd">        Note, if an element&#39;s count has been set to zero or is a negative</span>
</span><span data-line="649"><span class="sd">        number, elements() will ignore it.</span>
</span><span data-line="650">
</span><span data-line="651"><span class="sd">        &#39;&#39;&#39;</span>
</span><span data-line="652">        <span class="c1"># Emulate Bag.do from Smalltalk and Multiset.begin from C++.</span>
</span><span data-line="653">        <span class="k">return</span> <span class="n">_chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span><span class="n">_starmap</span><span class="p">(</span><span class="n">_repeat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
</span><span data-line="654">
</span><span data-line="655">    <span class="c1"># Override dict methods where necessary</span>
</span><span data-line="656">
</span><span data-line="657">    <span class="nd">@classmethod</span>
</span><span data-line="658">    <span class="k">def</span><span class="w"> </span><span class="nf">fromkeys</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">iterable</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span data-line="659">        <span class="c1"># There is no equivalent method for counters because the semantics</span>
</span><span data-line="660">        <span class="c1"># would be ambiguous in cases such as Counter.fromkeys(&#39;aaabbc&#39;, v=2).</span>
</span><span data-line="661">        <span class="c1"># Initializing counters to zero values isn&#39;t necessary because zero</span>
</span><span data-line="662">        <span class="c1"># is already the default value for counter lookups.  Initializing</span>
</span><span data-line="663">        <span class="c1"># to one is easily accomplished with Counter(set(iterable)).  For</span>
</span><span data-line="664">        <span class="c1"># more exotic cases, create a dictionary first using a dictionary</span>
</span><span data-line="665">        <span class="c1"># comprehension or dict.fromkeys().</span>
</span><span data-line="666">        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
</span><span data-line="667">            <span class="s1">&#39;Counter.fromkeys() is undefined.  Use Counter(iterable) instead.&#39;</span><span class="p">)</span>
</span><span data-line="668">
</span><span data-line="669">    <span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iterable</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
</span><span data-line="670"><span class="w">        </span><span class="sd">&#39;&#39;&#39;Like dict.update() but add counts instead of replacing them.</span>
</span><span data-line="671">
</span><span data-line="672"><span class="sd">        Source can be an iterable, a dictionary, or another Counter instance.</span>
</span><span data-line="673">
</span><span data-line="674"><span class="sd">        &gt;&gt;&gt; c = Counter(&#39;which&#39;)</span>
</span><span data-line="675"><span class="sd">        &gt;&gt;&gt; c.update(&#39;witch&#39;)           # add elements from another iterable</span>
</span><span data-line="676"><span class="sd">        &gt;&gt;&gt; d = Counter(&#39;watch&#39;)</span>
</span><span data-line="677"><span class="sd">        &gt;&gt;&gt; c.update(d)                 # add elements from another counter</span>
</span><span data-line="678"><span class="sd">        &gt;&gt;&gt; c[&#39;h&#39;]                      # four &#39;h&#39; in which, witch, and watch</span>
</span><span data-line="679"><span class="sd">        4</span>
</span><span data-line="680">
</span><span data-line="681"><span class="sd">        &#39;&#39;&#39;</span>
</span><span data-line="682">        <span class="c1"># The regular dict.update() operation makes no sense here because the</span>
</span><span data-line="683">        <span class="c1"># replace behavior results in some of the original untouched counts</span>
</span><span data-line="684">        <span class="c1"># being mixed-in with all of the other counts for a mismash that</span>
</span><span data-line="685">        <span class="c1"># doesn&#39;t have a straight-forward interpretation in most counting</span>
</span><span data-line="686">        <span class="c1"># contexts.  Instead, we implement straight-addition.  Both the inputs</span>
</span><span data-line="687">        <span class="c1"># and outputs are allowed to contain zero and negative counts.</span>
</span><span data-line="688">
</span><span data-line="689">        <span class="k">if</span> <span class="n">iterable</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="690">            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">iterable</span><span class="p">,</span> <span class="n">_collections_abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">):</span>
</span><span data-line="691">                <span class="k">if</span> <span class="bp">self</span><span class="p">:</span>
</span><span data-line="692">                    <span class="n">self_get</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span>
</span><span data-line="693">                    <span class="k">for</span> <span class="n">elem</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">iterable</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span data-line="694">                        <span class="bp">self</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="n">self_get</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span data-line="695">                <span class="k">else</span><span class="p">:</span>
</span><span data-line="696">                    <span class="c1"># fast path when counter is empty</span>
</span><span data-line="697">                    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">iterable</span><span class="p">)</span>
</span><span data-line="698">            <span class="k">else</span><span class="p">:</span>
</span><span data-line="699">                <span class="n">_count_elements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iterable</span><span class="p">)</span>
</span><span data-line="700">        <span class="k">if</span> <span class="n">kwds</span><span class="p">:</span>
</span><span data-line="701">            <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwds</span><span class="p">)</span>
</span><span data-line="702">
</span><span data-line="703">    <span class="k">def</span><span class="w"> </span><span class="nf">subtract</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iterable</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
</span><span data-line="704"><span class="w">        </span><span class="sd">&#39;&#39;&#39;Like dict.update() but subtracts counts instead of replacing them.</span>
</span><span data-line="705"><span class="sd">        Counts can be reduced below zero.  Both the inputs and outputs are</span>
</span><span data-line="706"><span class="sd">        allowed to contain zero and negative counts.</span>
</span><span data-line="707">
</span><span data-line="708"><span class="sd">        Source can be an iterable, a dictionary, or another Counter instance.</span>
</span><span data-line="709">
</span><span data-line="710"><span class="sd">        &gt;&gt;&gt; c = Counter(&#39;which&#39;)</span>
</span><span data-line="711"><span class="sd">        &gt;&gt;&gt; c.subtract(&#39;witch&#39;)             # subtract elements from another iterable</span>
</span><span data-line="712"><span class="sd">        &gt;&gt;&gt; c.subtract(Counter(&#39;watch&#39;))    # subtract elements from another counter</span>
</span><span data-line="713"><span class="sd">        &gt;&gt;&gt; c[&#39;h&#39;]                          # 2 in which, minus 1 in witch, minus 1 in watch</span>
</span><span data-line="714"><span class="sd">        0</span>
</span><span data-line="715"><span class="sd">        &gt;&gt;&gt; c[&#39;w&#39;]                          # 1 in which, minus 1 in witch, minus 1 in watch</span>
</span><span data-line="716"><span class="sd">        -1</span>
</span><span data-line="717">
</span><span data-line="718"><span class="sd">        &#39;&#39;&#39;</span>
</span><span data-line="719">        <span class="k">if</span> <span class="n">iterable</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="720">            <span class="n">self_get</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span>
</span><span data-line="721">            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">iterable</span><span class="p">,</span> <span class="n">_collections_abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">):</span>
</span><span data-line="722">                <span class="k">for</span> <span class="n">elem</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">iterable</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span data-line="723">                    <span class="bp">self</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span> <span class="o">=</span> <span class="n">self_get</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="n">count</span>
</span><span data-line="724">            <span class="k">else</span><span class="p">:</span>
</span><span data-line="725">                <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">iterable</span><span class="p">:</span>
</span><span data-line="726">                    <span class="bp">self</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span> <span class="o">=</span> <span class="n">self_get</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
</span><span data-line="727">        <span class="k">if</span> <span class="n">kwds</span><span class="p">:</span>
</span><span data-line="728">            <span class="bp">self</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">kwds</span><span class="p">)</span>
</span><span data-line="729">
</span><span data-line="730">    <span class="k">def</span><span class="w"> </span><span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="731">        <span class="s1">&#39;Return a shallow copy.&#39;</span>
</span><span data-line="732">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span data-line="733">
</span><span data-line="734">    <span class="k">def</span><span class="w"> </span><span class="nf">__reduce__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="735">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="p">),)</span>
</span><span data-line="736">
</span><span data-line="737">    <span class="k">def</span><span class="w"> </span><span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elem</span><span class="p">):</span>
</span><span data-line="738">        <span class="s1">&#39;Like dict.__delitem__() but does not raise KeyError for missing values.&#39;</span>
</span><span data-line="739">        <span class="k">if</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</span><span data-line="740">            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__delitem__</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
</span><span data-line="741">
</span><span data-line="742">    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="743">        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">:</span>
</span><span data-line="744">            <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">()&#39;</span>
</span><span data-line="745">        <span class="k">try</span><span class="p">:</span>
</span><span data-line="746">            <span class="c1"># dict() preserves the ordering returned by most_common()</span>
</span><span data-line="747">            <span class="n">d</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">most_common</span><span class="p">())</span>
</span><span data-line="748">        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
</span><span data-line="749">            <span class="c1"># handle case where values are not orderable</span>
</span><span data-line="750">            <span class="n">d</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span data-line="751">        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">(</span><span class="si">{</span><span class="n">d</span><span class="si">!r}</span><span class="s1">)&#39;</span>
</span><span data-line="752">
</span><span data-line="753">    <span class="c1"># Multiset-style mathematical operations discussed in:</span>
</span><span data-line="754">    <span class="c1">#       Knuth TAOCP Volume II section 4.6.3 exercise 19</span>
</span><span data-line="755">    <span class="c1">#       and at http://en.wikipedia.org/wiki/Multiset</span>
</span><span data-line="756">    <span class="c1">#</span>
</span><span data-line="757">    <span class="c1"># Outputs guaranteed to only include positive counts.</span>
</span><span data-line="758">    <span class="c1">#</span>
</span><span data-line="759">    <span class="c1"># To strip negative and zero counts, add-in an empty counter:</span>
</span><span data-line="760">    <span class="c1">#       c += Counter()</span>
</span><span data-line="761">    <span class="c1">#</span>
</span><span data-line="762">    <span class="c1"># Results are ordered according to when an element is first</span>
</span><span data-line="763">    <span class="c1"># encountered in the left operand and then by the order</span>
</span><span data-line="764">    <span class="c1"># encountered in the right operand.</span>
</span><span data-line="765">    <span class="c1">#</span>
</span><span data-line="766">    <span class="c1"># When the multiplicities are all zero or one, multiset operations</span>
</span><span data-line="767">    <span class="c1"># are guaranteed to be equivalent to the corresponding operations</span>
</span><span data-line="768">    <span class="c1"># for regular sets.</span>
</span><span data-line="769">    <span class="c1">#     Given counter multisets such as:</span>
</span><span data-line="770">    <span class="c1">#         cp = Counter(a=1, b=0, c=1)</span>
</span><span data-line="771">    <span class="c1">#         cq = Counter(c=1, d=0, e=1)</span>
</span><span data-line="772">    <span class="c1">#     The corresponding regular sets would be:</span>
</span><span data-line="773">    <span class="c1">#         sp = {&#39;a&#39;, &#39;c&#39;}</span>
</span><span data-line="774">    <span class="c1">#         sq = {&#39;c&#39;, &#39;e&#39;}</span>
</span><span data-line="775">    <span class="c1">#     All of the following relations would hold:</span>
</span><span data-line="776">    <span class="c1">#         set(cp + cq) == sp | sq</span>
</span><span data-line="777">    <span class="c1">#         set(cp - cq) == sp - sq</span>
</span><span data-line="778">    <span class="c1">#         set(cp | cq) == sp | sq</span>
</span><span data-line="779">    <span class="c1">#         set(cp &amp; cq) == sp &amp; sq</span>
</span><span data-line="780">    <span class="c1">#         (cp == cq) == (sp == sq)</span>
</span><span data-line="781">    <span class="c1">#         (cp != cq) == (sp != sq)</span>
</span><span data-line="782">    <span class="c1">#         (cp &lt;= cq) == (sp &lt;= sq)</span>
</span><span data-line="783">    <span class="c1">#         (cp &lt; cq) == (sp &lt; sq)</span>
</span><span data-line="784">    <span class="c1">#         (cp &gt;= cq) == (sp &gt;= sq)</span>
</span><span data-line="785">    <span class="c1">#         (cp &gt; cq) == (sp &gt; sq)</span>
</span><span data-line="786">
</span><span data-line="787">    <span class="k">def</span><span class="w"> </span><span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span data-line="788">        <span class="s1">&#39;True if all counts agree. Missing counts are treated as zero.&#39;</span>
</span><span data-line="789">        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Counter</span><span class="p">):</span>
</span><span data-line="790">            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span data-line="791">        <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="o">==</span> <span class="n">other</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">c</span><span class="p">)</span>
</span><span data-line="792">
</span><span data-line="793">    <span class="k">def</span><span class="w"> </span><span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span data-line="794">        <span class="s1">&#39;True if any counts disagree. Missing counts are treated as zero.&#39;</span>
</span><span data-line="795">        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Counter</span><span class="p">):</span>
</span><span data-line="796">            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span data-line="797">        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">other</span>
</span><span data-line="798">
</span><span data-line="799">    <span class="k">def</span><span class="w"> </span><span class="fm">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span data-line="800">        <span class="s1">&#39;True if all counts in self are a subset of those in other.&#39;</span>
</span><span data-line="801">        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Counter</span><span class="p">):</span>
</span><span data-line="802">            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span data-line="803">        <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">other</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">c</span><span class="p">)</span>
</span><span data-line="804">
</span><span data-line="805">    <span class="k">def</span><span class="w"> </span><span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span data-line="806">        <span class="s1">&#39;True if all counts in self are a proper subset of those in other.&#39;</span>
</span><span data-line="807">        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Counter</span><span class="p">):</span>
</span><span data-line="808">            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span data-line="809">        <span class="k">return</span> <span class="bp">self</span> <span class="o">&lt;=</span> <span class="n">other</span> <span class="ow">and</span> <span class="bp">self</span> <span class="o">!=</span> <span class="n">other</span>
</span><span data-line="810">
</span><span data-line="811">    <span class="k">def</span><span class="w"> </span><span class="fm">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span data-line="812">        <span class="s1">&#39;True if all counts in self are a superset of those in other.&#39;</span>
</span><span data-line="813">        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Counter</span><span class="p">):</span>
</span><span data-line="814">            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span data-line="815">        <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">other</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">c</span><span class="p">)</span>
</span><span data-line="816">
</span><span data-line="817">    <span class="k">def</span><span class="w"> </span><span class="fm">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span data-line="818">        <span class="s1">&#39;True if all counts in self are a proper superset of those in other.&#39;</span>
</span><span data-line="819">        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Counter</span><span class="p">):</span>
</span><span data-line="820">            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span data-line="821">        <span class="k">return</span> <span class="bp">self</span> <span class="o">&gt;=</span> <span class="n">other</span> <span class="ow">and</span> <span class="bp">self</span> <span class="o">!=</span> <span class="n">other</span>
</span><span data-line="822">
</span><span data-line="823">    <span class="k">def</span><span class="w"> </span><span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span data-line="824"><span class="w">        </span><span class="sd">&#39;&#39;&#39;Add counts from two counters.</span>
</span><span data-line="825">
</span><span data-line="826"><span class="sd">        &gt;&gt;&gt; Counter(&#39;abbb&#39;) + Counter(&#39;bcc&#39;)</span>
</span><span data-line="827"><span class="sd">        Counter({&#39;b&#39;: 4, &#39;c&#39;: 2, &#39;a&#39;: 1})</span>
</span><span data-line="828">
</span><span data-line="829"><span class="sd">        &#39;&#39;&#39;</span>
</span><span data-line="830">        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Counter</span><span class="p">):</span>
</span><span data-line="831">            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span data-line="832">        <span class="n">result</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
</span><span data-line="833">        <span class="k">for</span> <span class="n">elem</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span data-line="834">            <span class="n">newcount</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="n">other</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span>
</span><span data-line="835">            <span class="k">if</span> <span class="n">newcount</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span data-line="836">                <span class="n">result</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span> <span class="o">=</span> <span class="n">newcount</span>
</span><span data-line="837">        <span class="k">for</span> <span class="n">elem</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span data-line="838">            <span class="k">if</span> <span class="n">elem</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span> <span class="ow">and</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span data-line="839">                <span class="n">result</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span> <span class="o">=</span> <span class="n">count</span>
</span><span data-line="840">        <span class="k">return</span> <span class="n">result</span>
</span><span data-line="841">
</span><span data-line="842">    <span class="k">def</span><span class="w"> </span><span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span data-line="843"><span class="w">        </span><span class="sd">&#39;&#39;&#39; Subtract count, but keep only results with positive counts.</span>
</span><span data-line="844">
</span><span data-line="845"><span class="sd">        &gt;&gt;&gt; Counter(&#39;abbbc&#39;) - Counter(&#39;bccd&#39;)</span>
</span><span data-line="846"><span class="sd">        Counter({&#39;b&#39;: 2, &#39;a&#39;: 1})</span>
</span><span data-line="847">
</span><span data-line="848"><span class="sd">        &#39;&#39;&#39;</span>
</span><span data-line="849">        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Counter</span><span class="p">):</span>
</span><span data-line="850">            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span data-line="851">        <span class="n">result</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
</span><span data-line="852">        <span class="k">for</span> <span class="n">elem</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span data-line="853">            <span class="n">newcount</span> <span class="o">=</span> <span class="n">count</span> <span class="o">-</span> <span class="n">other</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span>
</span><span data-line="854">            <span class="k">if</span> <span class="n">newcount</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span data-line="855">                <span class="n">result</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span> <span class="o">=</span> <span class="n">newcount</span>
</span><span data-line="856">        <span class="k">for</span> <span class="n">elem</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span data-line="857">            <span class="k">if</span> <span class="n">elem</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span> <span class="ow">and</span> <span class="n">count</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span data-line="858">                <span class="n">result</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">-</span> <span class="n">count</span>
</span><span data-line="859">        <span class="k">return</span> <span class="n">result</span>
</span><span data-line="860">
</span><span data-line="861">    <span class="k">def</span><span class="w"> </span><span class="fm">__or__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span data-line="862"><span class="w">        </span><span class="sd">&#39;&#39;&#39;Union is the maximum of value in either of the input counters.</span>
</span><span data-line="863">
</span><span data-line="864"><span class="sd">        &gt;&gt;&gt; Counter(&#39;abbb&#39;) | Counter(&#39;bcc&#39;)</span>
</span><span data-line="865"><span class="sd">        Counter({&#39;b&#39;: 3, &#39;c&#39;: 2, &#39;a&#39;: 1})</span>
</span><span data-line="866">
</span><span data-line="867"><span class="sd">        &#39;&#39;&#39;</span>
</span><span data-line="868">        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Counter</span><span class="p">):</span>
</span><span data-line="869">            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span data-line="870">        <span class="n">result</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
</span><span data-line="871">        <span class="k">for</span> <span class="n">elem</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span data-line="872">            <span class="n">other_count</span> <span class="o">=</span> <span class="n">other</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span>
</span><span data-line="873">            <span class="n">newcount</span> <span class="o">=</span> <span class="n">other_count</span> <span class="k">if</span> <span class="n">count</span> <span class="o">&lt;</span> <span class="n">other_count</span> <span class="k">else</span> <span class="n">count</span>
</span><span data-line="874">            <span class="k">if</span> <span class="n">newcount</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span data-line="875">                <span class="n">result</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span> <span class="o">=</span> <span class="n">newcount</span>
</span><span data-line="876">        <span class="k">for</span> <span class="n">elem</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span data-line="877">            <span class="k">if</span> <span class="n">elem</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span> <span class="ow">and</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span data-line="878">                <span class="n">result</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span> <span class="o">=</span> <span class="n">count</span>
</span><span data-line="879">        <span class="k">return</span> <span class="n">result</span>
</span><span data-line="880">
</span><span data-line="881">    <span class="k">def</span><span class="w"> </span><span class="fm">__and__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span data-line="882"><span class="w">        </span><span class="sd">&#39;&#39;&#39; Intersection is the minimum of corresponding counts.</span>
</span><span data-line="883">
</span><span data-line="884"><span class="sd">        &gt;&gt;&gt; Counter(&#39;abbb&#39;) &amp; Counter(&#39;bcc&#39;)</span>
</span><span data-line="885"><span class="sd">        Counter({&#39;b&#39;: 1})</span>
</span><span data-line="886">
</span><span data-line="887"><span class="sd">        &#39;&#39;&#39;</span>
</span><span data-line="888">        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Counter</span><span class="p">):</span>
</span><span data-line="889">            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span data-line="890">        <span class="n">result</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
</span><span data-line="891">        <span class="k">for</span> <span class="n">elem</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span data-line="892">            <span class="n">other_count</span> <span class="o">=</span> <span class="n">other</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span>
</span><span data-line="893">            <span class="n">newcount</span> <span class="o">=</span> <span class="n">count</span> <span class="k">if</span> <span class="n">count</span> <span class="o">&lt;</span> <span class="n">other_count</span> <span class="k">else</span> <span class="n">other_count</span>
</span><span data-line="894">            <span class="k">if</span> <span class="n">newcount</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span data-line="895">                <span class="n">result</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span> <span class="o">=</span> <span class="n">newcount</span>
</span><span data-line="896">        <span class="k">return</span> <span class="n">result</span>
</span><span data-line="897">
</span><span data-line="898">    <span class="k">def</span><span class="w"> </span><span class="fm">__pos__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="899">        <span class="s1">&#39;Adds an empty counter, effectively stripping negative and zero counts&#39;</span>
</span><span data-line="900">        <span class="n">result</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
</span><span data-line="901">        <span class="k">for</span> <span class="n">elem</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span data-line="902">            <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span data-line="903">                <span class="n">result</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span> <span class="o">=</span> <span class="n">count</span>
</span><span data-line="904">        <span class="k">return</span> <span class="n">result</span>
</span><span data-line="905">
</span><span data-line="906">    <span class="k">def</span><span class="w"> </span><span class="fm">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="907"><span class="w">        </span><span class="sd">&#39;&#39;&#39;Subtracts from an empty counter.  Strips positive and zero counts,</span>
</span><span data-line="908"><span class="sd">        and flips the sign on negative counts.</span>
</span><span data-line="909">
</span><span data-line="910"><span class="sd">        &#39;&#39;&#39;</span>
</span><span data-line="911">        <span class="n">result</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
</span><span data-line="912">        <span class="k">for</span> <span class="n">elem</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span data-line="913">            <span class="k">if</span> <span class="n">count</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span data-line="914">                <span class="n">result</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">-</span> <span class="n">count</span>
</span><span data-line="915">        <span class="k">return</span> <span class="n">result</span>
</span><span data-line="916">
</span><span data-line="917">    <span class="k">def</span><span class="w"> </span><span class="nf">_keep_positive</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="918"><span class="w">        </span><span class="sd">&#39;&#39;&#39;Internal method to strip elements with a negative or zero count&#39;&#39;&#39;</span>
</span><span data-line="919">        <span class="n">nonpositive</span> <span class="o">=</span> <span class="p">[</span><span class="n">elem</span> <span class="k">for</span> <span class="n">elem</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
</span><span data-line="920">        <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">nonpositive</span><span class="p">:</span>
</span><span data-line="921">            <span class="k">del</span> <span class="bp">self</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span>
</span><span data-line="922">        <span class="k">return</span> <span class="bp">self</span>
</span><span data-line="923">
</span><span data-line="924">    <span class="k">def</span><span class="w"> </span><span class="fm">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span data-line="925"><span class="w">        </span><span class="sd">&#39;&#39;&#39;Inplace add from another counter, keeping only positive counts.</span>
</span><span data-line="926">
</span><span data-line="927"><span class="sd">        &gt;&gt;&gt; c = Counter(&#39;abbb&#39;)</span>
</span><span data-line="928"><span class="sd">        &gt;&gt;&gt; c += Counter(&#39;bcc&#39;)</span>
</span><span data-line="929"><span class="sd">        &gt;&gt;&gt; c</span>
</span><span data-line="930"><span class="sd">        Counter({&#39;b&#39;: 4, &#39;c&#39;: 2, &#39;a&#39;: 1})</span>
</span><span data-line="931">
</span><span data-line="932"><span class="sd">        &#39;&#39;&#39;</span>
</span><span data-line="933">        <span class="k">for</span> <span class="n">elem</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span data-line="934">            <span class="bp">self</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span> <span class="o">+=</span> <span class="n">count</span>
</span><span data-line="935">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_keep_positive</span><span class="p">()</span>
</span><span data-line="936">
</span><span data-line="937">    <span class="k">def</span><span class="w"> </span><span class="fm">__isub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span data-line="938"><span class="w">        </span><span class="sd">&#39;&#39;&#39;Inplace subtract counter, but keep only results with positive counts.</span>
</span><span data-line="939">
</span><span data-line="940"><span class="sd">        &gt;&gt;&gt; c = Counter(&#39;abbbc&#39;)</span>
</span><span data-line="941"><span class="sd">        &gt;&gt;&gt; c -= Counter(&#39;bccd&#39;)</span>
</span><span data-line="942"><span class="sd">        &gt;&gt;&gt; c</span>
</span><span data-line="943"><span class="sd">        Counter({&#39;b&#39;: 2, &#39;a&#39;: 1})</span>
</span><span data-line="944">
</span><span data-line="945"><span class="sd">        &#39;&#39;&#39;</span>
</span><span data-line="946">        <span class="k">for</span> <span class="n">elem</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span data-line="947">            <span class="bp">self</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span> <span class="o">-=</span> <span class="n">count</span>
</span><span data-line="948">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_keep_positive</span><span class="p">()</span>
</span><span data-line="949">
</span><span data-line="950">    <span class="k">def</span><span class="w"> </span><span class="fm">__ior__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span data-line="951"><span class="w">        </span><span class="sd">&#39;&#39;&#39;Inplace union is the maximum of value from either counter.</span>
</span><span data-line="952">
</span><span data-line="953"><span class="sd">        &gt;&gt;&gt; c = Counter(&#39;abbb&#39;)</span>
</span><span data-line="954"><span class="sd">        &gt;&gt;&gt; c |= Counter(&#39;bcc&#39;)</span>
</span><span data-line="955"><span class="sd">        &gt;&gt;&gt; c</span>
</span><span data-line="956"><span class="sd">        Counter({&#39;b&#39;: 3, &#39;c&#39;: 2, &#39;a&#39;: 1})</span>
</span><span data-line="957">
</span><span data-line="958"><span class="sd">        &#39;&#39;&#39;</span>
</span><span data-line="959">        <span class="k">for</span> <span class="n">elem</span><span class="p">,</span> <span class="n">other_count</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span data-line="960">            <span class="n">count</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span>
</span><span data-line="961">            <span class="k">if</span> <span class="n">other_count</span> <span class="o">&gt;</span> <span class="n">count</span><span class="p">:</span>
</span><span data-line="962">                <span class="bp">self</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span> <span class="o">=</span> <span class="n">other_count</span>
</span><span data-line="963">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_keep_positive</span><span class="p">()</span>
</span><span data-line="964">
</span><span data-line="965">    <span class="k">def</span><span class="w"> </span><span class="fm">__iand__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span data-line="966"><span class="w">        </span><span class="sd">&#39;&#39;&#39;Inplace intersection is the minimum of corresponding counts.</span>
</span><span data-line="967">
</span><span data-line="968"><span class="sd">        &gt;&gt;&gt; c = Counter(&#39;abbb&#39;)</span>
</span><span data-line="969"><span class="sd">        &gt;&gt;&gt; c &amp;= Counter(&#39;bcc&#39;)</span>
</span><span data-line="970"><span class="sd">        &gt;&gt;&gt; c</span>
</span><span data-line="971"><span class="sd">        Counter({&#39;b&#39;: 1})</span>
</span><span data-line="972">
</span><span data-line="973"><span class="sd">        &#39;&#39;&#39;</span>
</span><span data-line="974">        <span class="k">for</span> <span class="n">elem</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span data-line="975">            <span class="n">other_count</span> <span class="o">=</span> <span class="n">other</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span>
</span><span data-line="976">            <span class="k">if</span> <span class="n">other_count</span> <span class="o">&lt;</span> <span class="n">count</span><span class="p">:</span>
</span><span data-line="977">                <span class="bp">self</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span> <span class="o">=</span> <span class="n">other_count</span>
</span><span data-line="978">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_keep_positive</span><span class="p">()</span>
</span><span data-line="979">
</span><span data-line="980">
</span><span data-line="981"><span class="c1">########################################################################</span>
</span><span data-line="982"><span class="c1">###  ChainMap</span>
</span><span data-line="983"><span class="c1">########################################################################</span>
</span><span data-line="984">
</span><span data-line="985"><span class="k">class</span><span class="w"> </span><span class="nc">ChainMap</span><span class="p">(</span><span class="n">_collections_abc</span><span class="o">.</span><span class="n">MutableMapping</span><span class="p">):</span>
</span><span data-line="986"><span class="w">    </span><span class="sd">&#39;&#39;&#39; A ChainMap groups multiple dicts (or other mappings) together</span>
</span><span data-line="987"><span class="sd">    to create a single, updateable view.</span>
</span><span data-line="988">
</span><span data-line="989"><span class="sd">    The underlying mappings are stored in a list.  That list is public and can</span>
</span><span data-line="990"><span class="sd">    be accessed or updated using the *maps* attribute.  There is no other</span>
</span><span data-line="991"><span class="sd">    state.</span>
</span><span data-line="992">
</span><span data-line="993"><span class="sd">    Lookups search the underlying mappings successively until a key is found.</span>
</span><span data-line="994"><span class="sd">    In contrast, writes, updates, and deletions only operate on the first</span>
</span><span data-line="995"><span class="sd">    mapping.</span>
</span><span data-line="996">
</span><span data-line="997"><span class="sd">    &#39;&#39;&#39;</span>
</span><span data-line="998">
</span><span data-line="999">    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">maps</span><span class="p">):</span>
</span><span data-line="1000"><span class="w">        </span><span class="sd">&#39;&#39;&#39;Initialize a ChainMap by setting *maps* to the given mappings.</span>
</span><span data-line="1001"><span class="sd">        If no mappings are provided, a single empty dictionary is used.</span>
</span><span data-line="1002">
</span><span data-line="1003"><span class="sd">        &#39;&#39;&#39;</span>
</span><span data-line="1004">        <span class="bp">self</span><span class="o">.</span><span class="n">maps</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">maps</span><span class="p">)</span> <span class="ow">or</span> <span class="p">[{}]</span>          <span class="c1"># always at least one map</span>
</span><span data-line="1005">
</span><span data-line="1006">    <span class="k">def</span><span class="w"> </span><span class="fm">__missing__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
</span><span data-line="1007">        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span data-line="1008">
</span><span data-line="1009">    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
</span><span data-line="1010">        <span class="k">for</span> <span class="n">mapping</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">maps</span><span class="p">:</span>
</span><span data-line="1011">            <span class="k">try</span><span class="p">:</span>
</span><span data-line="1012">                <span class="k">return</span> <span class="n">mapping</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>             <span class="c1"># can&#39;t use &#39;key in mapping&#39; with defaultdict</span>
</span><span data-line="1013">            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span data-line="1014">                <span class="k">pass</span>
</span><span data-line="1015">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__missing__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>            <span class="c1"># support subclasses that define __missing__</span>
</span><span data-line="1016">
</span><span data-line="1017">    <span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span data-line="1018">        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">else</span> <span class="n">default</span>
</span><span data-line="1019">
</span><span data-line="1020">    <span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="1021">        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">()</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">maps</span><span class="p">))</span>     <span class="c1"># reuses stored hash values if possible</span>
</span><span data-line="1022">
</span><span data-line="1023">    <span class="k">def</span><span class="w"> </span><span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="1024">        <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
</span><span data-line="1025">        <span class="k">for</span> <span class="n">mapping</span> <span class="ow">in</span> <span class="nb">map</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">,</span> <span class="nb">reversed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maps</span><span class="p">)):</span>
</span><span data-line="1026">            <span class="n">d</span> <span class="o">|=</span> <span class="n">mapping</span>                        <span class="c1"># reuses stored hash values if possible</span>
</span><span data-line="1027">        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
</span><span data-line="1028">
</span><span data-line="1029">    <span class="k">def</span><span class="w"> </span><span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
</span><span data-line="1030">        <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">key</span> <span class="ow">in</span> <span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">maps</span><span class="p">)</span>
</span><span data-line="1031">
</span><span data-line="1032">    <span class="k">def</span><span class="w"> </span><span class="fm">__bool__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="1033">        <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maps</span><span class="p">)</span>
</span><span data-line="1034">
</span><span data-line="1035">    <span class="nd">@_recursive_repr</span><span class="p">()</span>
</span><span data-line="1036">    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="1037">        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">(</span><span class="si">{</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">repr</span><span class="p">,</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">maps</span><span class="p">))</span><span class="si">}</span><span class="s1">)&#39;</span>
</span><span data-line="1038">
</span><span data-line="1039">    <span class="nd">@classmethod</span>
</span><span data-line="1040">    <span class="k">def</span><span class="w"> </span><span class="nf">fromkeys</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">iterable</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span data-line="1041">        <span class="s1">&#39;Create a ChainMap with a single dict created from the iterable.&#39;</span>
</span><span data-line="1042">        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">iterable</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">))</span>
</span><span data-line="1043">
</span><span data-line="1044">    <span class="k">def</span><span class="w"> </span><span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="1045">        <span class="s1">&#39;New ChainMap or subclass with a new copy of maps[0] and refs to maps[1:]&#39;</span>
</span><span data-line="1046">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">maps</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span><span data-line="1047">
</span><span data-line="1048">    <span class="n">__copy__</span> <span class="o">=</span> <span class="n">copy</span>
</span><span data-line="1049">
</span><span data-line="1050">    <span class="k">def</span><span class="w"> </span><span class="nf">new_child</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>      <span class="c1"># like Django&#39;s Context.push()</span>
</span><span data-line="1051"><span class="w">        </span><span class="sd">&#39;&#39;&#39;New ChainMap with a new map followed by all previous maps.</span>
</span><span data-line="1052"><span class="sd">        If no map is provided, an empty dict is used.</span>
</span><span data-line="1053"><span class="sd">        Keyword arguments update the map or new empty dict.</span>
</span><span data-line="1054"><span class="sd">        &#39;&#39;&#39;</span>
</span><span data-line="1055">        <span class="k">if</span> <span class="n">m</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1056">            <span class="n">m</span> <span class="o">=</span> <span class="n">kwargs</span>
</span><span data-line="1057">        <span class="k">elif</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span data-line="1058">            <span class="n">m</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
</span><span data-line="1059">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">maps</span><span class="p">)</span>
</span><span data-line="1060">
</span><span data-line="1061">    <span class="nd">@property</span>
</span><span data-line="1062">    <span class="k">def</span><span class="w"> </span><span class="nf">parents</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>                          <span class="c1"># like Django&#39;s Context.pop()</span>
</span><span data-line="1063">        <span class="s1">&#39;New ChainMap from maps[1:].&#39;</span>
</span><span data-line="1064">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">maps</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span><span data-line="1065">
</span><span data-line="1066">    <span class="k">def</span><span class="w"> </span><span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span data-line="1067">        <span class="bp">self</span><span class="o">.</span><span class="n">maps</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span data-line="1068">
</span><span data-line="1069">    <span class="k">def</span><span class="w"> </span><span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
</span><span data-line="1070">        <span class="k">try</span><span class="p">:</span>
</span><span data-line="1071">            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">maps</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">key</span><span class="p">]</span>
</span><span data-line="1072">        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span data-line="1073">            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Key not found in the first mapping: </span><span class="si">{</span><span class="n">key</span><span class="si">!r}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span data-line="1074">
</span><span data-line="1075">    <span class="k">def</span><span class="w"> </span><span class="nf">popitem</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="1076">        <span class="s1">&#39;Remove and return an item pair from maps[0]. Raise KeyError is maps[0] is empty.&#39;</span>
</span><span data-line="1077">        <span class="k">try</span><span class="p">:</span>
</span><span data-line="1078">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">maps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">popitem</span><span class="p">()</span>
</span><span data-line="1079">        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span data-line="1080">            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s1">&#39;No keys found in the first mapping.&#39;</span><span class="p">)</span>
</span><span data-line="1081">
</span><span data-line="1082">    <span class="k">def</span><span class="w"> </span><span class="nf">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span data-line="1083">        <span class="s1">&#39;Remove *key* from maps[0] and return its value. Raise KeyError if *key* not in maps[0].&#39;</span>
</span><span data-line="1084">        <span class="k">try</span><span class="p">:</span>
</span><span data-line="1085">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">maps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span data-line="1086">        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span data-line="1087">            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Key not found in the first mapping: </span><span class="si">{</span><span class="n">key</span><span class="si">!r}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span data-line="1088">
</span><span data-line="1089">    <span class="k">def</span><span class="w"> </span><span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="1090">        <span class="s1">&#39;Clear maps[0], leaving maps[1:] intact.&#39;</span>
</span><span data-line="1091">        <span class="bp">self</span><span class="o">.</span><span class="n">maps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span data-line="1092">
</span><span data-line="1093">    <span class="k">def</span><span class="w"> </span><span class="fm">__ior__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span data-line="1094">        <span class="bp">self</span><span class="o">.</span><span class="n">maps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span data-line="1095">        <span class="k">return</span> <span class="bp">self</span>
</span><span data-line="1096">
</span><span data-line="1097">    <span class="k">def</span><span class="w"> </span><span class="fm">__or__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span data-line="1098">        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">_collections_abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">):</span>
</span><span data-line="1099">            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span data-line="1100">        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span data-line="1101">        <span class="n">m</span><span class="o">.</span><span class="n">maps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span data-line="1102">        <span class="k">return</span> <span class="n">m</span>
</span><span data-line="1103">
</span><span data-line="1104">    <span class="k">def</span><span class="w"> </span><span class="fm">__ror__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span data-line="1105">        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">_collections_abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">):</span>
</span><span data-line="1106">            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span data-line="1107">        <span class="n">m</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span data-line="1108">        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maps</span><span class="p">):</span>
</span><span data-line="1109">            <span class="n">m</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
</span><span data-line="1110">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</span><span data-line="1111">
</span><span data-line="1112">
</span><span data-line="1113"><span class="c1">################################################################################</span>
</span><span data-line="1114"><span class="c1">### UserDict</span>
</span><span data-line="1115"><span class="c1">################################################################################</span>
</span><span data-line="1116">
</span><span data-line="1117"><span class="k">class</span><span class="w"> </span><span class="nc">UserDict</span><span class="p">(</span><span class="n">_collections_abc</span><span class="o">.</span><span class="n">MutableMapping</span><span class="p">):</span>
</span><span data-line="1118">
</span><span data-line="1119">    <span class="c1"># Start by filling-out the abstract methods</span>
</span><span data-line="1120">    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">dict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span data-line="1121">        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
</span><span data-line="1122">        <span class="k">if</span> <span class="nb">dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1123">            <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
</span><span data-line="1124">        <span class="k">if</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span data-line="1125">            <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
</span><span data-line="1126">
</span><span data-line="1127">    <span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="1128">        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span><span data-line="1129">
</span><span data-line="1130">    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
</span><span data-line="1131">        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
</span><span data-line="1132">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</span><span data-line="1133">        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="s2">&quot;__missing__&quot;</span><span class="p">):</span>
</span><span data-line="1134">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="fm">__missing__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
</span><span data-line="1135">        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span data-line="1136">
</span><span data-line="1137">    <span class="k">def</span><span class="w"> </span><span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
</span><span data-line="1138">        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span>
</span><span data-line="1139">
</span><span data-line="1140">    <span class="k">def</span><span class="w"> </span><span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
</span><span data-line="1141">        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</span><span data-line="1142">
</span><span data-line="1143">    <span class="k">def</span><span class="w"> </span><span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="1144">        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span><span data-line="1145">
</span><span data-line="1146">    <span class="c1"># Modify __contains__ and get() to work like dict</span>
</span><span data-line="1147">    <span class="c1"># does when __missing__ is present.</span>
</span><span data-line="1148">    <span class="k">def</span><span class="w"> </span><span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
</span><span data-line="1149">        <span class="k">return</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
</span><span data-line="1150">
</span><span data-line="1151">    <span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span data-line="1152">        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</span><span data-line="1153">            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</span><span data-line="1154">        <span class="k">return</span> <span class="n">default</span>
</span><span data-line="1155">
</span><span data-line="1156">
</span><span data-line="1157">    <span class="c1"># Now, add the methods in dicts but not in MutableMapping</span>
</span><span data-line="1158">    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="1159">        <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span><span data-line="1160">
</span><span data-line="1161">    <span class="k">def</span><span class="w"> </span><span class="fm">__or__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span data-line="1162">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">UserDict</span><span class="p">):</span>
</span><span data-line="1163">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">|</span> <span class="n">other</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span><span data-line="1164">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span data-line="1165">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">|</span> <span class="n">other</span><span class="p">)</span>
</span><span data-line="1166">        <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span data-line="1167">
</span><span data-line="1168">    <span class="k">def</span><span class="w"> </span><span class="fm">__ror__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span data-line="1169">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">UserDict</span><span class="p">):</span>
</span><span data-line="1170">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">data</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span><span data-line="1171">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span data-line="1172">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">other</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span><span data-line="1173">        <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span data-line="1174">
</span><span data-line="1175">    <span class="k">def</span><span class="w"> </span><span class="fm">__ior__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span data-line="1176">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">UserDict</span><span class="p">):</span>
</span><span data-line="1177">            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">|=</span> <span class="n">other</span><span class="o">.</span><span class="n">data</span>
</span><span data-line="1178">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="1179">            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">|=</span> <span class="n">other</span>
</span><span data-line="1180">        <span class="k">return</span> <span class="bp">self</span>
</span><span data-line="1181">
</span><span data-line="1182">    <span class="k">def</span><span class="w"> </span><span class="nf">__copy__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="1183">        <span class="n">inst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>
</span><span data-line="1184">        <span class="n">inst</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>
</span><span data-line="1185">        <span class="c1"># Create a copy and avoid triggering descriptors</span>
</span><span data-line="1186">        <span class="n">inst</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span data-line="1187">        <span class="k">return</span> <span class="n">inst</span>
</span><span data-line="1188">
</span><span data-line="1189">    <span class="k">def</span><span class="w"> </span><span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="1190">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span> <span class="ow">is</span> <span class="n">UserDict</span><span class="p">:</span>
</span><span data-line="1191">            <span class="k">return</span> <span class="n">UserDict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
</span><span data-line="1192">        <span class="kn">import</span><span class="w"> </span><span class="nn">copy</span>
</span><span data-line="1193">        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
</span><span data-line="1194">        <span class="k">try</span><span class="p">:</span>
</span><span data-line="1195">            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
</span><span data-line="1196">            <span class="n">c</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span data-line="1197">        <span class="k">finally</span><span class="p">:</span>
</span><span data-line="1198">            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
</span><span data-line="1199">        <span class="n">c</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span data-line="1200">        <span class="k">return</span> <span class="n">c</span>
</span><span data-line="1201">
</span><span data-line="1202">    <span class="nd">@classmethod</span>
</span><span data-line="1203">    <span class="k">def</span><span class="w"> </span><span class="nf">fromkeys</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">iterable</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span data-line="1204">        <span class="n">d</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
</span><span data-line="1205">        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">iterable</span><span class="p">:</span>
</span><span data-line="1206">            <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span data-line="1207">        <span class="k">return</span> <span class="n">d</span>
</span><span data-line="1208">
</span><span data-line="1209">
</span><span data-line="1210"><span class="c1">################################################################################</span>
</span><span data-line="1211"><span class="c1">### UserList</span>
</span><span data-line="1212"><span class="c1">################################################################################</span>
</span><span data-line="1213">
</span><span data-line="1214"><span class="k">class</span><span class="w"> </span><span class="nc">UserList</span><span class="p">(</span><span class="n">_collections_abc</span><span class="o">.</span><span class="n">MutableSequence</span><span class="p">):</span>
</span><span data-line="1215"><span class="w">    </span><span class="sd">&quot;&quot;&quot;A more or less complete user-defined wrapper around list objects.&quot;&quot;&quot;</span>
</span><span data-line="1216">
</span><span data-line="1217">    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initlist</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span data-line="1218">        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
</span><span data-line="1219">        <span class="k">if</span> <span class="n">initlist</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1220">            <span class="c1"># XXX should this accept an arbitrary sequence?</span>
</span><span data-line="1221">            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">initlist</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">):</span>
</span><span data-line="1222">                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">initlist</span>
</span><span data-line="1223">            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">initlist</span><span class="p">,</span> <span class="n">UserList</span><span class="p">):</span>
</span><span data-line="1224">                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">initlist</span><span class="o">.</span><span class="n">data</span><span class="p">[:]</span>
</span><span data-line="1225">            <span class="k">else</span><span class="p">:</span>
</span><span data-line="1226">                <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">initlist</span><span class="p">)</span>
</span><span data-line="1227">
</span><span data-line="1228">    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="1229">        <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span><span data-line="1230">
</span><span data-line="1231">    <span class="k">def</span><span class="w"> </span><span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span data-line="1232">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">__cast</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span data-line="1233">
</span><span data-line="1234">    <span class="k">def</span><span class="w"> </span><span class="fm">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span data-line="1235">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__cast</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span data-line="1236">
</span><span data-line="1237">    <span class="k">def</span><span class="w"> </span><span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span data-line="1238">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">__cast</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span data-line="1239">
</span><span data-line="1240">    <span class="k">def</span><span class="w"> </span><span class="fm">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span data-line="1241">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">__cast</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span data-line="1242">
</span><span data-line="1243">    <span class="k">def</span><span class="w"> </span><span class="fm">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span data-line="1244">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__cast</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span data-line="1245">
</span><span data-line="1246">    <span class="k">def</span><span class="w"> </span><span class="nf">__cast</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span data-line="1247">        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">data</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">UserList</span><span class="p">)</span> <span class="k">else</span> <span class="n">other</span>
</span><span data-line="1248">
</span><span data-line="1249">    <span class="k">def</span><span class="w"> </span><span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
</span><span data-line="1250">        <span class="k">return</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
</span><span data-line="1251">
</span><span data-line="1252">    <span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="1253">        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span><span data-line="1254">
</span><span data-line="1255">    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
</span><span data-line="1256">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
</span><span data-line="1257">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span data-line="1258">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="1259">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span data-line="1260">
</span><span data-line="1261">    <span class="k">def</span><span class="w"> </span><span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
</span><span data-line="1262">        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span>
</span><span data-line="1263">
</span><span data-line="1264">    <span class="k">def</span><span class="w"> </span><span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
</span><span data-line="1265">        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span data-line="1266">
</span><span data-line="1267">    <span class="k">def</span><span class="w"> </span><span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span data-line="1268">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">UserList</span><span class="p">):</span>
</span><span data-line="1269">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span><span data-line="1270">        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)):</span>
</span><span data-line="1271">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">+</span> <span class="n">other</span><span class="p">)</span>
</span><span data-line="1272">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">other</span><span class="p">))</span>
</span><span data-line="1273">
</span><span data-line="1274">    <span class="k">def</span><span class="w"> </span><span class="fm">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span data-line="1275">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">UserList</span><span class="p">):</span>
</span><span data-line="1276">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">data</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span><span data-line="1277">        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)):</span>
</span><span data-line="1278">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">other</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span><span data-line="1279">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span><span data-line="1280">
</span><span data-line="1281">    <span class="k">def</span><span class="w"> </span><span class="fm">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span data-line="1282">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">UserList</span><span class="p">):</span>
</span><span data-line="1283">            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">+=</span> <span class="n">other</span><span class="o">.</span><span class="n">data</span>
</span><span data-line="1284">        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)):</span>
</span><span data-line="1285">            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">+=</span> <span class="n">other</span>
</span><span data-line="1286">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="1287">            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">+=</span> <span class="nb">list</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span data-line="1288">        <span class="k">return</span> <span class="bp">self</span>
</span><span data-line="1289">
</span><span data-line="1290">    <span class="k">def</span><span class="w"> </span><span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
</span><span data-line="1291">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">*</span> <span class="n">n</span><span class="p">)</span>
</span><span data-line="1292">
</span><span data-line="1293">    <span class="fm">__rmul__</span> <span class="o">=</span> <span class="fm">__mul__</span>
</span><span data-line="1294">
</span><span data-line="1295">    <span class="k">def</span><span class="w"> </span><span class="fm">__imul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
</span><span data-line="1296">        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">*=</span> <span class="n">n</span>
</span><span data-line="1297">        <span class="k">return</span> <span class="bp">self</span>
</span><span data-line="1298">
</span><span data-line="1299">    <span class="k">def</span><span class="w"> </span><span class="nf">__copy__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="1300">        <span class="n">inst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>
</span><span data-line="1301">        <span class="n">inst</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>
</span><span data-line="1302">        <span class="c1"># Create a copy and avoid triggering descriptors</span>
</span><span data-line="1303">        <span class="n">inst</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][:]</span>
</span><span data-line="1304">        <span class="k">return</span> <span class="n">inst</span>
</span><span data-line="1305">
</span><span data-line="1306">    <span class="k">def</span><span class="w"> </span><span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
</span><span data-line="1307">        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</span><span data-line="1308">
</span><span data-line="1309">    <span class="k">def</span><span class="w"> </span><span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
</span><span data-line="1310">        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
</span><span data-line="1311">
</span><span data-line="1312">    <span class="k">def</span><span class="w"> </span><span class="nf">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
</span><span data-line="1313">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span data-line="1314">
</span><span data-line="1315">    <span class="k">def</span><span class="w"> </span><span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
</span><span data-line="1316">        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</span><span data-line="1317">
</span><span data-line="1318">    <span class="k">def</span><span class="w"> </span><span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="1319">        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span data-line="1320">
</span><span data-line="1321">    <span class="k">def</span><span class="w"> </span><span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="1322">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span data-line="1323">
</span><span data-line="1324">    <span class="k">def</span><span class="w"> </span><span class="nf">count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
</span><span data-line="1325">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</span><span data-line="1326">
</span><span data-line="1327">    <span class="k">def</span><span class="w"> </span><span class="nf">index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span data-line="1328">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span data-line="1329">
</span><span data-line="1330">    <span class="k">def</span><span class="w"> </span><span class="nf">reverse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="1331">        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
</span><span data-line="1332">
</span><span data-line="1333">    <span class="k">def</span><span class="w"> </span><span class="nf">sort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
</span><span data-line="1334">        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
</span><span data-line="1335">
</span><span data-line="1336">    <span class="k">def</span><span class="w"> </span><span class="nf">extend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span data-line="1337">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">UserList</span><span class="p">):</span>
</span><span data-line="1338">            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span><span data-line="1339">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="1340">            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span data-line="1341">
</span><span data-line="1342">
</span><span data-line="1343"><span class="c1">################################################################################</span>
</span><span data-line="1344"><span class="c1">### UserString</span>
</span><span data-line="1345"><span class="c1">################################################################################</span>
</span><span data-line="1346">
</span><span data-line="1347"><span class="k">class</span><span class="w"> </span><span class="nc">UserString</span><span class="p">(</span><span class="n">_collections_abc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">):</span>
</span><span data-line="1348">
</span><span data-line="1349">    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seq</span><span class="p">):</span>
</span><span data-line="1350">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span data-line="1351">            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">seq</span>
</span><span data-line="1352">        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">UserString</span><span class="p">):</span>
</span><span data-line="1353">            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">seq</span><span class="o">.</span><span class="n">data</span><span class="p">[:]</span>
</span><span data-line="1354">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="1355">            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span>
</span><span data-line="1356">
</span><span data-line="1357">    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="1358">        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span><span data-line="1359">
</span><span data-line="1360">    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="1361">        <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span><span data-line="1362">
</span><span data-line="1363">    <span class="k">def</span><span class="w"> </span><span class="fm">__int__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="1364">        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span><span data-line="1365">
</span><span data-line="1366">    <span class="k">def</span><span class="w"> </span><span class="fm">__float__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="1367">        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span><span data-line="1368">
</span><span data-line="1369">    <span class="k">def</span><span class="w"> </span><span class="fm">__complex__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="1370">        <span class="k">return</span> <span class="nb">complex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span><span data-line="1371">
</span><span data-line="1372">    <span class="k">def</span><span class="w"> </span><span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="1373">        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span><span data-line="1374">
</span><span data-line="1375">    <span class="k">def</span><span class="w"> </span><span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="1376">        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:],)</span>
</span><span data-line="1377">
</span><span data-line="1378">    <span class="k">def</span><span class="w"> </span><span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="p">):</span>
</span><span data-line="1379">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">UserString</span><span class="p">):</span>
</span><span data-line="1380">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="n">string</span><span class="o">.</span><span class="n">data</span>
</span><span data-line="1381">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="n">string</span>
</span><span data-line="1382">
</span><span data-line="1383">    <span class="k">def</span><span class="w"> </span><span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="p">):</span>
</span><span data-line="1384">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">UserString</span><span class="p">):</span>
</span><span data-line="1385">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">&lt;</span> <span class="n">string</span><span class="o">.</span><span class="n">data</span>
</span><span data-line="1386">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">&lt;</span> <span class="n">string</span>
</span><span data-line="1387">
</span><span data-line="1388">    <span class="k">def</span><span class="w"> </span><span class="fm">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="p">):</span>
</span><span data-line="1389">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">UserString</span><span class="p">):</span>
</span><span data-line="1390">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">&lt;=</span> <span class="n">string</span><span class="o">.</span><span class="n">data</span>
</span><span data-line="1391">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">&lt;=</span> <span class="n">string</span>
</span><span data-line="1392">
</span><span data-line="1393">    <span class="k">def</span><span class="w"> </span><span class="fm">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="p">):</span>
</span><span data-line="1394">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">UserString</span><span class="p">):</span>
</span><span data-line="1395">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">&gt;</span> <span class="n">string</span><span class="o">.</span><span class="n">data</span>
</span><span data-line="1396">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">&gt;</span> <span class="n">string</span>
</span><span data-line="1397">
</span><span data-line="1398">    <span class="k">def</span><span class="w"> </span><span class="fm">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="p">):</span>
</span><span data-line="1399">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">UserString</span><span class="p">):</span>
</span><span data-line="1400">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">&gt;=</span> <span class="n">string</span><span class="o">.</span><span class="n">data</span>
</span><span data-line="1401">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">&gt;=</span> <span class="n">string</span>
</span><span data-line="1402">
</span><span data-line="1403">    <span class="k">def</span><span class="w"> </span><span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">char</span><span class="p">):</span>
</span><span data-line="1404">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">char</span><span class="p">,</span> <span class="n">UserString</span><span class="p">):</span>
</span><span data-line="1405">            <span class="n">char</span> <span class="o">=</span> <span class="n">char</span><span class="o">.</span><span class="n">data</span>
</span><span data-line="1406">        <span class="k">return</span> <span class="n">char</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
</span><span data-line="1407">
</span><span data-line="1408">    <span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="1409">        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span><span data-line="1410">
</span><span data-line="1411">    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
</span><span data-line="1412">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
</span><span data-line="1413">
</span><span data-line="1414">    <span class="k">def</span><span class="w"> </span><span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span data-line="1415">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">UserString</span><span class="p">):</span>
</span><span data-line="1416">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span><span data-line="1417">        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span data-line="1418">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">+</span> <span class="n">other</span><span class="p">)</span>
</span><span data-line="1419">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">other</span><span class="p">))</span>
</span><span data-line="1420">
</span><span data-line="1421">    <span class="k">def</span><span class="w"> </span><span class="fm">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span data-line="1422">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span data-line="1423">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">other</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span><span data-line="1424">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span><span data-line="1425">
</span><span data-line="1426">    <span class="k">def</span><span class="w"> </span><span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
</span><span data-line="1427">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">*</span> <span class="n">n</span><span class="p">)</span>
</span><span data-line="1428">
</span><span data-line="1429">    <span class="fm">__rmul__</span> <span class="o">=</span> <span class="fm">__mul__</span>
</span><span data-line="1430">
</span><span data-line="1431">    <span class="k">def</span><span class="w"> </span><span class="fm">__mod__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
</span><span data-line="1432">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">%</span> <span class="n">args</span><span class="p">)</span>
</span><span data-line="1433">
</span><span data-line="1434">    <span class="k">def</span><span class="w"> </span><span class="fm">__rmod__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template</span><span class="p">):</span>
</span><span data-line="1435">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">template</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="p">)</span>
</span><span data-line="1436">
</span><span data-line="1437">    <span class="c1"># the following methods are defined in alphabetical order:</span>
</span><span data-line="1438">    <span class="k">def</span><span class="w"> </span><span class="nf">capitalize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="1439">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">capitalize</span><span class="p">())</span>
</span><span data-line="1440">
</span><span data-line="1441">    <span class="k">def</span><span class="w"> </span><span class="nf">casefold</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="1442">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">casefold</span><span class="p">())</span>
</span><span data-line="1443">
</span><span data-line="1444">    <span class="k">def</span><span class="w"> </span><span class="nf">center</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span data-line="1445">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">))</span>
</span><span data-line="1446">
</span><span data-line="1447">    <span class="k">def</span><span class="w"> </span><span class="nf">count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sub</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">_sys</span><span class="o">.</span><span class="n">maxsize</span><span class="p">):</span>
</span><span data-line="1448">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">UserString</span><span class="p">):</span>
</span><span data-line="1449">            <span class="n">sub</span> <span class="o">=</span> <span class="n">sub</span><span class="o">.</span><span class="n">data</span>
</span><span data-line="1450">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
</span><span data-line="1451">
</span><span data-line="1452">    <span class="k">def</span><span class="w"> </span><span class="nf">removeprefix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="o">/</span><span class="p">):</span>
</span><span data-line="1453">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">UserString</span><span class="p">):</span>
</span><span data-line="1454">            <span class="n">prefix</span> <span class="o">=</span> <span class="n">prefix</span><span class="o">.</span><span class="n">data</span>
</span><span data-line="1455">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">removeprefix</span><span class="p">(</span><span class="n">prefix</span><span class="p">))</span>
</span><span data-line="1456">
</span><span data-line="1457">    <span class="k">def</span><span class="w"> </span><span class="nf">removesuffix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">suffix</span><span class="p">,</span> <span class="o">/</span><span class="p">):</span>
</span><span data-line="1458">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">suffix</span><span class="p">,</span> <span class="n">UserString</span><span class="p">):</span>
</span><span data-line="1459">            <span class="n">suffix</span> <span class="o">=</span> <span class="n">suffix</span><span class="o">.</span><span class="n">data</span>
</span><span data-line="1460">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">removesuffix</span><span class="p">(</span><span class="n">suffix</span><span class="p">))</span>
</span><span data-line="1461">
</span><span data-line="1462">    <span class="k">def</span><span class="w"> </span><span class="nf">encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;strict&#39;</span><span class="p">):</span>
</span><span data-line="1463">        <span class="n">encoding</span> <span class="o">=</span> <span class="s1">&#39;utf-8&#39;</span> <span class="k">if</span> <span class="n">encoding</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">encoding</span>
</span><span data-line="1464">        <span class="n">errors</span> <span class="o">=</span> <span class="s1">&#39;strict&#39;</span> <span class="k">if</span> <span class="n">errors</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">errors</span>
</span><span data-line="1465">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">encoding</span><span class="p">,</span> <span class="n">errors</span><span class="p">)</span>
</span><span data-line="1466">
</span><span data-line="1467">    <span class="k">def</span><span class="w"> </span><span class="nf">endswith</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">suffix</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">_sys</span><span class="o">.</span><span class="n">maxsize</span><span class="p">):</span>
</span><span data-line="1468">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">suffix</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
</span><span data-line="1469">
</span><span data-line="1470">    <span class="k">def</span><span class="w"> </span><span class="nf">expandtabs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tabsize</span><span class="o">=</span><span class="mi">8</span><span class="p">):</span>
</span><span data-line="1471">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">expandtabs</span><span class="p">(</span><span class="n">tabsize</span><span class="p">))</span>
</span><span data-line="1472">
</span><span data-line="1473">    <span class="k">def</span><span class="w"> </span><span class="nf">find</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sub</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">_sys</span><span class="o">.</span><span class="n">maxsize</span><span class="p">):</span>
</span><span data-line="1474">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">UserString</span><span class="p">):</span>
</span><span data-line="1475">            <span class="n">sub</span> <span class="o">=</span> <span class="n">sub</span><span class="o">.</span><span class="n">data</span>
</span><span data-line="1476">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
</span><span data-line="1477">
</span><span data-line="1478">    <span class="k">def</span><span class="w"> </span><span class="nf">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
</span><span data-line="1479">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
</span><span data-line="1480">
</span><span data-line="1481">    <span class="k">def</span><span class="w"> </span><span class="nf">format_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mapping</span><span class="p">):</span>
</span><span data-line="1482">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">format_map</span><span class="p">(</span><span class="n">mapping</span><span class="p">)</span>
</span><span data-line="1483">
</span><span data-line="1484">    <span class="k">def</span><span class="w"> </span><span class="nf">index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sub</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">_sys</span><span class="o">.</span><span class="n">maxsize</span><span class="p">):</span>
</span><span data-line="1485">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
</span><span data-line="1486">
</span><span data-line="1487">    <span class="k">def</span><span class="w"> </span><span class="nf">isalpha</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="1488">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">isalpha</span><span class="p">()</span>
</span><span data-line="1489">
</span><span data-line="1490">    <span class="k">def</span><span class="w"> </span><span class="nf">isalnum</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="1491">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">isalnum</span><span class="p">()</span>
</span><span data-line="1492">
</span><span data-line="1493">    <span class="k">def</span><span class="w"> </span><span class="nf">isascii</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="1494">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">isascii</span><span class="p">()</span>
</span><span data-line="1495">
</span><span data-line="1496">    <span class="k">def</span><span class="w"> </span><span class="nf">isdecimal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="1497">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">isdecimal</span><span class="p">()</span>
</span><span data-line="1498">
</span><span data-line="1499">    <span class="k">def</span><span class="w"> </span><span class="nf">isdigit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="1500">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span>
</span><span data-line="1501">
</span><span data-line="1502">    <span class="k">def</span><span class="w"> </span><span class="nf">isidentifier</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="1503">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">isidentifier</span><span class="p">()</span>
</span><span data-line="1504">
</span><span data-line="1505">    <span class="k">def</span><span class="w"> </span><span class="nf">islower</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="1506">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">islower</span><span class="p">()</span>
</span><span data-line="1507">
</span><span data-line="1508">    <span class="k">def</span><span class="w"> </span><span class="nf">isnumeric</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="1509">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">()</span>
</span><span data-line="1510">
</span><span data-line="1511">    <span class="k">def</span><span class="w"> </span><span class="nf">isprintable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="1512">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">isprintable</span><span class="p">()</span>
</span><span data-line="1513">
</span><span data-line="1514">    <span class="k">def</span><span class="w"> </span><span class="nf">isspace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="1515">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">isspace</span><span class="p">()</span>
</span><span data-line="1516">
</span><span data-line="1517">    <span class="k">def</span><span class="w"> </span><span class="nf">istitle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="1518">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">istitle</span><span class="p">()</span>
</span><span data-line="1519">
</span><span data-line="1520">    <span class="k">def</span><span class="w"> </span><span class="nf">isupper</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="1521">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">isupper</span><span class="p">()</span>
</span><span data-line="1522">
</span><span data-line="1523">    <span class="k">def</span><span class="w"> </span><span class="nf">join</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seq</span><span class="p">):</span>
</span><span data-line="1524">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span>
</span><span data-line="1525">
</span><span data-line="1526">    <span class="k">def</span><span class="w"> </span><span class="nf">ljust</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span data-line="1527">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">))</span>
</span><span data-line="1528">
</span><span data-line="1529">    <span class="k">def</span><span class="w"> </span><span class="nf">lower</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="1530">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
</span><span data-line="1531">
</span><span data-line="1532">    <span class="k">def</span><span class="w"> </span><span class="nf">lstrip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chars</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span data-line="1533">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="n">chars</span><span class="p">))</span>
</span><span data-line="1534">
</span><span data-line="1535">    <span class="n">maketrans</span> <span class="o">=</span> <span class="nb">str</span><span class="o">.</span><span class="n">maketrans</span>
</span><span data-line="1536">
</span><span data-line="1537">    <span class="k">def</span><span class="w"> </span><span class="nf">partition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sep</span><span class="p">):</span>
</span><span data-line="1538">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">partition</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span>
</span><span data-line="1539">
</span><span data-line="1540">    <span class="k">def</span><span class="w"> </span><span class="nf">replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">,</span> <span class="n">maxsplit</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
</span><span data-line="1541">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">UserString</span><span class="p">):</span>
</span><span data-line="1542">            <span class="n">old</span> <span class="o">=</span> <span class="n">old</span><span class="o">.</span><span class="n">data</span>
</span><span data-line="1543">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new</span><span class="p">,</span> <span class="n">UserString</span><span class="p">):</span>
</span><span data-line="1544">            <span class="n">new</span> <span class="o">=</span> <span class="n">new</span><span class="o">.</span><span class="n">data</span>
</span><span data-line="1545">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">,</span> <span class="n">maxsplit</span><span class="p">))</span>
</span><span data-line="1546">
</span><span data-line="1547">    <span class="k">def</span><span class="w"> </span><span class="nf">rfind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sub</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">_sys</span><span class="o">.</span><span class="n">maxsize</span><span class="p">):</span>
</span><span data-line="1548">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">UserString</span><span class="p">):</span>
</span><span data-line="1549">            <span class="n">sub</span> <span class="o">=</span> <span class="n">sub</span><span class="o">.</span><span class="n">data</span>
</span><span data-line="1550">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
</span><span data-line="1551">
</span><span data-line="1552">    <span class="k">def</span><span class="w"> </span><span class="nf">rindex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sub</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">_sys</span><span class="o">.</span><span class="n">maxsize</span><span class="p">):</span>
</span><span data-line="1553">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">rindex</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
</span><span data-line="1554">
</span><span data-line="1555">    <span class="k">def</span><span class="w"> </span><span class="nf">rjust</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span data-line="1556">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">))</span>
</span><span data-line="1557">
</span><span data-line="1558">    <span class="k">def</span><span class="w"> </span><span class="nf">rpartition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sep</span><span class="p">):</span>
</span><span data-line="1559">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">rpartition</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span>
</span><span data-line="1560">
</span><span data-line="1561">    <span class="k">def</span><span class="w"> </span><span class="nf">rstrip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chars</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span data-line="1562">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="n">chars</span><span class="p">))</span>
</span><span data-line="1563">
</span><span data-line="1564">    <span class="k">def</span><span class="w"> </span><span class="nf">split</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">maxsplit</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
</span><span data-line="1565">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">sep</span><span class="p">,</span> <span class="n">maxsplit</span><span class="p">)</span>
</span><span data-line="1566">
</span><span data-line="1567">    <span class="k">def</span><span class="w"> </span><span class="nf">rsplit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">maxsplit</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
</span><span data-line="1568">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="n">sep</span><span class="p">,</span> <span class="n">maxsplit</span><span class="p">)</span>
</span><span data-line="1569">
</span><span data-line="1570">    <span class="k">def</span><span class="w"> </span><span class="nf">splitlines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keepends</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span data-line="1571">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="p">)</span>
</span><span data-line="1572">
</span><span data-line="1573">    <span class="k">def</span><span class="w"> </span><span class="nf">startswith</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">_sys</span><span class="o">.</span><span class="n">maxsize</span><span class="p">):</span>
</span><span data-line="1574">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
</span><span data-line="1575">
</span><span data-line="1576">    <span class="k">def</span><span class="w"> </span><span class="nf">strip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chars</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span data-line="1577">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">chars</span><span class="p">))</span>
</span><span data-line="1578">
</span><span data-line="1579">    <span class="k">def</span><span class="w"> </span><span class="nf">swapcase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="1580">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">swapcase</span><span class="p">())</span>
</span><span data-line="1581">
</span><span data-line="1582">    <span class="k">def</span><span class="w"> </span><span class="nf">title</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="1583">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">title</span><span class="p">())</span>
</span><span data-line="1584">
</span><span data-line="1585">    <span class="k">def</span><span class="w"> </span><span class="nf">translate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span data-line="1586">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>
</span><span data-line="1587">
</span><span data-line="1588">    <span class="k">def</span><span class="w"> </span><span class="nf">upper</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="1589">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
</span><span data-line="1590">
</span><span data-line="1591">    <span class="k">def</span><span class="w"> </span><span class="nf">zfill</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">):</span>
</span><span data-line="1592">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="n">width</span><span class="p">))</span>
</span></pre></div>
        </article><button class="back-to-top" type="button">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
  </svg>
  <span>Back to top</span>
</button><div class="navigation flex print:hidden"></div></div>
    </div>
  </main>
</div>
<footer class="sy-foot">
  <div class="sy-foot-inner sy-container mx-auto">
    <div class="sy-foot-reserved md:flex justify-between items-center">
      <div class="sy-foot-copyright"><p>2025, Litestar Organization</p>
  
  <p>
    Made with
    
    <a href="https://www.sphinx-doc.org/">Sphinx</a> and
    
    <a href="https://shibuya.lepture.com">Shibuya theme</a>.
  </p>
</div>
      <div class="sy-foot-socials">
<a href="https://twitter.com/LitestarAPI" aria-label="X (Twitter)">
  <iconify-icon icon="prime:twitter"></iconify-icon>
</a>
<a href="https://discord.gg/litestar" aria-label="Discord">
  <iconify-icon icon="simple-icons:discord"></iconify-icon>
</a>
<a href="https://www.reddit.com/r/LitestarAPI" aria-label="Reddit">
  <iconify-icon icon="simple-icons:reddit"></iconify-icon>
</a></div>
    </div>
  </div>
</footer>
      <script src="../_static/documentation_options.js?v=ad404a94"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../_static/copybutton.js?v=f281be69"></script>
      <script src="../_static/litestar-theme.js?v=ab2dcc9e"></script>
      <script>let toggleHintShow = 'Click to show';</script>
      <script>let toggleHintHide = 'Click to hide';</script>
      <script>let toggleOpenOnPrint = 'true';</script>
      <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
      <script src="../_static/design-tabs.js?v=f930bc37"></script>
      <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
      <script src="../_static/shibuya.js?v=c477d091"></script>
      <script type="module" src="https://cdn.jsdelivr.net/npm/mermaid@11.2.0/dist/mermaid.esm.min.mjs"></script>
      <script type="module" src="https://cdn.jsdelivr.net/npm/@mermaid-js/layout-elk@0.1.4/dist/mermaid-layout-elk.esm.min.mjs"></script>
      <script type="module">import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@11.2.0/dist/mermaid.esm.min.mjs";import elkLayouts from "https://cdn.jsdelivr.net/npm/@mermaid-js/layout-elk@0.1.4/dist/mermaid-layout-elk.esm.min.mjs";mermaid.registerLayoutLoaders(elkLayouts);mermaid.initialize({startOnLoad:false});</script>
      <script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script>
      <script type="module">
import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@11.2.0/dist/mermaid.esm.min.mjs";
window.addEventListener("load", () => mermaid.run());
</script>
      <script src="../_static/versioning.js?v=9ab184b9"></script></body>
</html>