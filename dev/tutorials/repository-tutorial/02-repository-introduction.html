
<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Interacting with repositories &#8212; Litestar Framework</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=ac02cc09edc035673794" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=ac02cc09edc035673794" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=ac02cc09edc035673794" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=ac02cc09edc035673794" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
    <link rel="stylesheet" type="text/css" href="../../_static/style.css?v=1d4867fe" />
    <link rel="stylesheet" type="text/css" href="../../_static/litestar-sphinx-theme.css?v=db8d6e31" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=ac02cc09edc035673794" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=ac02cc09edc035673794" />
  <script src="../../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=ac02cc09edc035673794"></script>

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js?v=1dd72c66"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/litestar-theme.js?v=ab2dcc9e"></script>
    <script src="../../_static/design-tabs.js?v=36754332"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'tutorials/repository-tutorial/02-repository-introduction';</script>
    <script src="../../_static/versioning.js?v=68b42869"></script>
    <link rel="icon" href="../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Working with Controllers and Repositories" href="03-repository-controller.html" />
    <link rel="prev" title="Introduction to Database Modeling and Repository Features" href="01-modeling-and-features.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  
  <div class=" navbar-header-items__start">
    
      <div class="navbar-item">
   

<a class="navbar-brand logo" href="https://litestar.dev">
  
  
  
  
    
    
      
    
    
    <img src="../../_static/logo.svg" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../../_static/logo.svg" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
    
  </div>
  
  <div class=" navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">




    <nav class="hidden lg:flex lg:gap-x-4">
        
    
        
            <a href="../../index.html"
               class="text-sm font-semibold leading-6 text-gray-900 dark:text-gray-100 hover:!text-litestar-gold select-none cursor-pointer">Documentation</a>
        
    
        
            
    <div class="relative">
        <span type="button"
                class="flex items-center gap-x-1 text-sm font-semibold leading-6 text-gray-900 dark:text-gray-100 hover:!text-litestar-gold st-dropdown-toggle dropdown-closed select-none cursor-pointer"
                data-dropdown-state="closed"
                aria-expanded="false">
            Community
            <div class="menu-state-indicator flex">
                
    <svg class="h-5 w-5 flex-none text-gray-400" viewBox="0 0 20 20" fill="currentColor"
     aria-hidden="true">
    <path fill-rule="evenodd"
          d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"
          clip-rule="evenodd"/>
</svg>

            </div>
        </span>

        <div class="
            absolute -left-8 top-full z-10 mt-3
            w-max max-w-md
            overflow-hidden rounded-3xl
            bg-white shadow-lg dark:!bg-zinc-700 ring-1 ring-gray-900/5
            hidden
            st-dropdown-menu">
            <div class="p-4">
                
                    
    
        <div class="group relative flex items-center gap-x-6 rounded-lg p-4 text-sm leading-6 hover:bg-gray-50 dark:hover:bg-zinc-800">
            <div class="
            h-11 w-11 flex flex-none items-center justify-center
            rounded-lg
            bg-gray-50 group-hover:bg-white dark:bg-zinc-900 dark:group-hover:bg-zinc-700
            text-gray-600 dark:text-gray-300 group-hover:text-litestar-gold">
                
    <svg class="h-6 w-6" fill="none"
     viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
    <path stroke-linecap="round" stroke-linejoin="round"
          d="M10.5 6a7.5 7.5 0 107.5 7.5h-7.5V6z"/>
    <path stroke-linecap="round" stroke-linejoin="round"
          d="M13.5 10.5H21A7.5 7.5 0 0013.5 3v7.5z"/>
</svg>

            </div>
            <div class="flex-auto">
                
    <a href="https://docs.litestar.dev/2/contribution-guide.html"
       class="block font-semibold text-gray-900 dark:text-gray-200 hover:text-litestar-gold dark:hover:text-litestar-gold !no-underline select-none cursor-pointer">
        Contributing
        <span class="absolute inset-0"></span>
    </a>

                <div class="mt-1 text-gray-600 dark:text-gray-300">Learn how to contribute to the Litestar project</div>
            </div>
        </div>
    

                
                    
    
        <div class="group relative flex items-center gap-x-6 rounded-lg p-4 text-sm leading-6 hover:bg-gray-50 dark:hover:bg-zinc-800">
            <div class="
            h-11 w-11 flex flex-none items-center justify-center
            rounded-lg
            bg-gray-50 group-hover:bg-white dark:bg-zinc-900 dark:group-hover:bg-zinc-700
            text-gray-600 dark:text-gray-300 group-hover:text-litestar-gold">
                
    <svg class="h-6 w-6" fill="none"
     viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
    <path stroke-linecap="round" stroke-linejoin="round"
          d="M15.042 21.672L13.684 16.6m0 0l-2.51 2.225.569-9.47 5.227 7.917-3.286-.672zM12 2.25V4.5m5.834.166l-1.591 1.591M20.25 10.5H18M7.757 14.743l-1.59 1.59M6 10.5H3.75m4.007-4.243l-1.59-1.59"/>
</svg>

            </div>
            <div class="flex-auto">
                
    <a href="https://github.com/litestar-org/.github/blob/main/CODE_OF_CONDUCT.md"
       class="block font-semibold text-gray-900 dark:text-gray-200 hover:text-litestar-gold dark:hover:text-litestar-gold !no-underline select-none cursor-pointer">
        Code of Conduct
        <span class="absolute inset-0"></span>
    </a>

                <div class="mt-1 text-gray-600 dark:text-gray-300">Review the etiquette for interacting with the Litestar community</div>
            </div>
        </div>
    

                
            </div>
        </div>
    </div>

        
    
        
            
    <div class="relative">
        <span type="button"
                class="flex items-center gap-x-1 text-sm font-semibold leading-6 text-gray-900 dark:text-gray-100 hover:!text-litestar-gold st-dropdown-toggle dropdown-closed select-none cursor-pointer"
                data-dropdown-state="closed"
                aria-expanded="false">
            About
            <div class="menu-state-indicator flex">
                
    <svg class="h-5 w-5 flex-none text-gray-400" viewBox="0 0 20 20" fill="currentColor"
     aria-hidden="true">
    <path fill-rule="evenodd"
          d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"
          clip-rule="evenodd"/>
</svg>

            </div>
        </span>

        <div class="
            absolute -left-8 top-full z-10 mt-3
            w-max max-w-md
            overflow-hidden rounded-3xl
            bg-white shadow-lg dark:!bg-zinc-700 ring-1 ring-gray-900/5
            hidden
            st-dropdown-menu">
            <div class="p-4">
                
                    
    
        <div class="group relative flex items-center gap-x-6 rounded-lg p-4 text-sm leading-6 hover:bg-gray-50 dark:hover:bg-zinc-800">
            <div class="
            h-11 w-11 flex flex-none items-center justify-center
            rounded-lg
            bg-gray-50 group-hover:bg-white dark:bg-zinc-900 dark:group-hover:bg-zinc-700
            text-gray-600 dark:text-gray-300 group-hover:text-litestar-gold">
                
    <svg class="h-6 w-6" aria-hidden="true"
     fill="none" stroke="currentColor" stroke-width="1.5"
     viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path d="M18 18.72a9.094 9.094 0 003.741-.479 3 3 0 00-4.682-2.72m.94 3.198l.001.031c0 .225-.012.447-.037.666A11.944 11.944 0 0112 21c-2.17 0-4.207-.576-5.963-1.584A6.062 6.062 0 016 18.719m12 0a5.971 5.971 0 00-.941-3.197m0 0A5.995 5.995 0 0012 12.75a5.995 5.995 0 00-5.058 2.772m0 0a3 3 0 00-4.681 2.72 8.986 8.986 0 003.74.477m.94-3.197a5.971 5.971 0 00-.94 3.197M15 6.75a3 3 0 11-6 0 3 3 0 016 0zm6 3a2.25 2.25 0 11-4.5 0 2.25 2.25 0 014.5 0zm-13.5 0a2.25 2.25 0 11-4.5 0 2.25 2.25 0 014.5 0z"
          stroke-linecap="round" stroke-linejoin="round"></path>
</svg>

            </div>
            <div class="flex-auto">
                
    <a href="https://litestar.dev/about/organization"
       class="block font-semibold text-gray-900 dark:text-gray-200 hover:text-litestar-gold dark:hover:text-litestar-gold !no-underline select-none cursor-pointer">
        Litestar Organization
        <span class="absolute inset-0"></span>
    </a>

                <div class="mt-1 text-gray-600 dark:text-gray-300">Details about the Litestar organization</div>
            </div>
        </div>
    

                
                    
    
        <div class="group relative flex items-center gap-x-6 rounded-lg p-4 text-sm leading-6 hover:bg-gray-50 dark:hover:bg-zinc-800">
            <div class="
            h-11 w-11 flex flex-none items-center justify-center
            rounded-lg
            bg-gray-50 group-hover:bg-white dark:bg-zinc-900 dark:group-hover:bg-zinc-700
            text-gray-600 dark:text-gray-300 group-hover:text-litestar-gold">
                
    <svg class="h-6 w-6" aria-hidden="true"
     fill="none" stroke="currentColor" stroke-width="1.5"
     viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path d="M9 12.75l3 3m0 0l3-3m-3 3v-7.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
          stroke-linecap="round" stroke-linejoin="round"></path>
</svg>

            </div>
            <div class="flex-auto">
                
    <a href="https://litestar.dev/about/litestar-releases"
       class="block font-semibold text-gray-900 dark:text-gray-200 hover:text-litestar-gold dark:hover:text-litestar-gold !no-underline select-none cursor-pointer">
        Releases
        <span class="absolute inset-0"></span>
    </a>

                <div class="mt-1 text-gray-600 dark:text-gray-300">Details about the Litestar release process</div>
            </div>
        </div>
    

                
            </div>
        </div>
    </div>

        
    
        
            
    <div class="relative">
        <span type="button"
                class="flex items-center gap-x-1 text-sm font-semibold leading-6 text-gray-900 dark:text-gray-100 hover:!text-litestar-gold st-dropdown-toggle dropdown-closed select-none cursor-pointer"
                data-dropdown-state="closed"
                aria-expanded="false">
            Release notes
            <div class="menu-state-indicator flex">
                
    <svg class="h-5 w-5 flex-none text-gray-400" viewBox="0 0 20 20" fill="currentColor"
     aria-hidden="true">
    <path fill-rule="evenodd"
          d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"
          clip-rule="evenodd"/>
</svg>

            </div>
        </span>

        <div class="
            absolute -left-8 top-full z-10 mt-3
            w-max max-w-md
            overflow-hidden rounded-3xl
            bg-white shadow-lg dark:!bg-zinc-700 ring-1 ring-gray-900/5
            hidden
            st-dropdown-menu">
            <div class="p-4">
                
                    
    
        <div class="group relative rounded-lg p-2 text-sm hover:bg-gray-50 dark:hover:bg-zinc-800">
            
    <a href="../../release-notes/whats-new-2.html"
       class="block font-semibold text-gray-900 dark:text-gray-200 hover:text-litestar-gold dark:hover:text-litestar-gold !no-underline select-none cursor-pointer">
        What's new in 2.0
        <span class="absolute inset-0"></span>
    </a>

        </div>
    

                
                    
    
        <div class="group relative rounded-lg p-2 text-sm hover:bg-gray-50 dark:hover:bg-zinc-800">
            
    <a href="https://docs.litestar.dev/2/release-notes/changelog.html"
       class="block font-semibold text-gray-900 dark:text-gray-200 hover:text-litestar-gold dark:hover:text-litestar-gold !no-underline select-none cursor-pointer">
        2.x Changelog
        <span class="absolute inset-0"></span>
    </a>

        </div>
    

                
                    
    
        <div class="group relative rounded-lg p-2 text-sm hover:bg-gray-50 dark:hover:bg-zinc-800">
            
    <a href="https://docs.litestar.dev/1/release-notes/changelog.html"
       class="block font-semibold text-gray-900 dark:text-gray-200 hover:text-litestar-gold dark:hover:text-litestar-gold !no-underline select-none cursor-pointer">
        1.x Changelog
        <span class="absolute inset-0"></span>
    </a>

        </div>
    

                
            </div>
        </div>
    </div>

        
    
        
            <a href="https://github.com/orgs/litestar-org/discussions"
               class="text-sm font-semibold leading-6 text-gray-900 dark:text-gray-100 hover:!text-litestar-gold select-none cursor-pointer">Help</a>
        
    

    </nav>
</div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
        </div>
      
        <div class="navbar-item navbar-persistent--container">
          
<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>
        </div>
      
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/litestar-org/litestar" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://discord.gg/X3FJqy8d2j" title="Discord" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-discord fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">Discord</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
    </div>
  
    <div class="navbar-persistent--mobile">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary" tabindex="0">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item">




    <nav class="hidden lg:flex lg:gap-x-4">
        
    
        
            <a href="../../index.html"
               class="text-sm font-semibold leading-6 text-gray-900 dark:text-gray-100 hover:!text-litestar-gold select-none cursor-pointer">Documentation</a>
        
    
        
            
    <div class="relative">
        <span type="button"
                class="flex items-center gap-x-1 text-sm font-semibold leading-6 text-gray-900 dark:text-gray-100 hover:!text-litestar-gold st-dropdown-toggle dropdown-closed select-none cursor-pointer"
                data-dropdown-state="closed"
                aria-expanded="false">
            Community
            <div class="menu-state-indicator flex">
                
    <svg class="h-5 w-5 flex-none text-gray-400" viewBox="0 0 20 20" fill="currentColor"
     aria-hidden="true">
    <path fill-rule="evenodd"
          d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"
          clip-rule="evenodd"/>
</svg>

            </div>
        </span>

        <div class="
            absolute -left-8 top-full z-10 mt-3
            w-max max-w-md
            overflow-hidden rounded-3xl
            bg-white shadow-lg dark:!bg-zinc-700 ring-1 ring-gray-900/5
            hidden
            st-dropdown-menu">
            <div class="p-4">
                
                    
    
        <div class="group relative flex items-center gap-x-6 rounded-lg p-4 text-sm leading-6 hover:bg-gray-50 dark:hover:bg-zinc-800">
            <div class="
            h-11 w-11 flex flex-none items-center justify-center
            rounded-lg
            bg-gray-50 group-hover:bg-white dark:bg-zinc-900 dark:group-hover:bg-zinc-700
            text-gray-600 dark:text-gray-300 group-hover:text-litestar-gold">
                
    <svg class="h-6 w-6" fill="none"
     viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
    <path stroke-linecap="round" stroke-linejoin="round"
          d="M10.5 6a7.5 7.5 0 107.5 7.5h-7.5V6z"/>
    <path stroke-linecap="round" stroke-linejoin="round"
          d="M13.5 10.5H21A7.5 7.5 0 0013.5 3v7.5z"/>
</svg>

            </div>
            <div class="flex-auto">
                
    <a href="https://docs.litestar.dev/2/contribution-guide.html"
       class="block font-semibold text-gray-900 dark:text-gray-200 hover:text-litestar-gold dark:hover:text-litestar-gold !no-underline select-none cursor-pointer">
        Contributing
        <span class="absolute inset-0"></span>
    </a>

                <div class="mt-1 text-gray-600 dark:text-gray-300">Learn how to contribute to the Litestar project</div>
            </div>
        </div>
    

                
                    
    
        <div class="group relative flex items-center gap-x-6 rounded-lg p-4 text-sm leading-6 hover:bg-gray-50 dark:hover:bg-zinc-800">
            <div class="
            h-11 w-11 flex flex-none items-center justify-center
            rounded-lg
            bg-gray-50 group-hover:bg-white dark:bg-zinc-900 dark:group-hover:bg-zinc-700
            text-gray-600 dark:text-gray-300 group-hover:text-litestar-gold">
                
    <svg class="h-6 w-6" fill="none"
     viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
    <path stroke-linecap="round" stroke-linejoin="round"
          d="M15.042 21.672L13.684 16.6m0 0l-2.51 2.225.569-9.47 5.227 7.917-3.286-.672zM12 2.25V4.5m5.834.166l-1.591 1.591M20.25 10.5H18M7.757 14.743l-1.59 1.59M6 10.5H3.75m4.007-4.243l-1.59-1.59"/>
</svg>

            </div>
            <div class="flex-auto">
                
    <a href="https://github.com/litestar-org/.github/blob/main/CODE_OF_CONDUCT.md"
       class="block font-semibold text-gray-900 dark:text-gray-200 hover:text-litestar-gold dark:hover:text-litestar-gold !no-underline select-none cursor-pointer">
        Code of Conduct
        <span class="absolute inset-0"></span>
    </a>

                <div class="mt-1 text-gray-600 dark:text-gray-300">Review the etiquette for interacting with the Litestar community</div>
            </div>
        </div>
    

                
            </div>
        </div>
    </div>

        
    
        
            
    <div class="relative">
        <span type="button"
                class="flex items-center gap-x-1 text-sm font-semibold leading-6 text-gray-900 dark:text-gray-100 hover:!text-litestar-gold st-dropdown-toggle dropdown-closed select-none cursor-pointer"
                data-dropdown-state="closed"
                aria-expanded="false">
            About
            <div class="menu-state-indicator flex">
                
    <svg class="h-5 w-5 flex-none text-gray-400" viewBox="0 0 20 20" fill="currentColor"
     aria-hidden="true">
    <path fill-rule="evenodd"
          d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"
          clip-rule="evenodd"/>
</svg>

            </div>
        </span>

        <div class="
            absolute -left-8 top-full z-10 mt-3
            w-max max-w-md
            overflow-hidden rounded-3xl
            bg-white shadow-lg dark:!bg-zinc-700 ring-1 ring-gray-900/5
            hidden
            st-dropdown-menu">
            <div class="p-4">
                
                    
    
        <div class="group relative flex items-center gap-x-6 rounded-lg p-4 text-sm leading-6 hover:bg-gray-50 dark:hover:bg-zinc-800">
            <div class="
            h-11 w-11 flex flex-none items-center justify-center
            rounded-lg
            bg-gray-50 group-hover:bg-white dark:bg-zinc-900 dark:group-hover:bg-zinc-700
            text-gray-600 dark:text-gray-300 group-hover:text-litestar-gold">
                
    <svg class="h-6 w-6" aria-hidden="true"
     fill="none" stroke="currentColor" stroke-width="1.5"
     viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path d="M18 18.72a9.094 9.094 0 003.741-.479 3 3 0 00-4.682-2.72m.94 3.198l.001.031c0 .225-.012.447-.037.666A11.944 11.944 0 0112 21c-2.17 0-4.207-.576-5.963-1.584A6.062 6.062 0 016 18.719m12 0a5.971 5.971 0 00-.941-3.197m0 0A5.995 5.995 0 0012 12.75a5.995 5.995 0 00-5.058 2.772m0 0a3 3 0 00-4.681 2.72 8.986 8.986 0 003.74.477m.94-3.197a5.971 5.971 0 00-.94 3.197M15 6.75a3 3 0 11-6 0 3 3 0 016 0zm6 3a2.25 2.25 0 11-4.5 0 2.25 2.25 0 014.5 0zm-13.5 0a2.25 2.25 0 11-4.5 0 2.25 2.25 0 014.5 0z"
          stroke-linecap="round" stroke-linejoin="round"></path>
</svg>

            </div>
            <div class="flex-auto">
                
    <a href="https://litestar.dev/about/organization"
       class="block font-semibold text-gray-900 dark:text-gray-200 hover:text-litestar-gold dark:hover:text-litestar-gold !no-underline select-none cursor-pointer">
        Litestar Organization
        <span class="absolute inset-0"></span>
    </a>

                <div class="mt-1 text-gray-600 dark:text-gray-300">Details about the Litestar organization</div>
            </div>
        </div>
    

                
                    
    
        <div class="group relative flex items-center gap-x-6 rounded-lg p-4 text-sm leading-6 hover:bg-gray-50 dark:hover:bg-zinc-800">
            <div class="
            h-11 w-11 flex flex-none items-center justify-center
            rounded-lg
            bg-gray-50 group-hover:bg-white dark:bg-zinc-900 dark:group-hover:bg-zinc-700
            text-gray-600 dark:text-gray-300 group-hover:text-litestar-gold">
                
    <svg class="h-6 w-6" aria-hidden="true"
     fill="none" stroke="currentColor" stroke-width="1.5"
     viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path d="M9 12.75l3 3m0 0l3-3m-3 3v-7.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
          stroke-linecap="round" stroke-linejoin="round"></path>
</svg>

            </div>
            <div class="flex-auto">
                
    <a href="https://litestar.dev/about/litestar-releases"
       class="block font-semibold text-gray-900 dark:text-gray-200 hover:text-litestar-gold dark:hover:text-litestar-gold !no-underline select-none cursor-pointer">
        Releases
        <span class="absolute inset-0"></span>
    </a>

                <div class="mt-1 text-gray-600 dark:text-gray-300">Details about the Litestar release process</div>
            </div>
        </div>
    

                
            </div>
        </div>
    </div>

        
    
        
            
    <div class="relative">
        <span type="button"
                class="flex items-center gap-x-1 text-sm font-semibold leading-6 text-gray-900 dark:text-gray-100 hover:!text-litestar-gold st-dropdown-toggle dropdown-closed select-none cursor-pointer"
                data-dropdown-state="closed"
                aria-expanded="false">
            Release notes
            <div class="menu-state-indicator flex">
                
    <svg class="h-5 w-5 flex-none text-gray-400" viewBox="0 0 20 20" fill="currentColor"
     aria-hidden="true">
    <path fill-rule="evenodd"
          d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"
          clip-rule="evenodd"/>
</svg>

            </div>
        </span>

        <div class="
            absolute -left-8 top-full z-10 mt-3
            w-max max-w-md
            overflow-hidden rounded-3xl
            bg-white shadow-lg dark:!bg-zinc-700 ring-1 ring-gray-900/5
            hidden
            st-dropdown-menu">
            <div class="p-4">
                
                    
    
        <div class="group relative rounded-lg p-2 text-sm hover:bg-gray-50 dark:hover:bg-zinc-800">
            
    <a href="../../release-notes/whats-new-2.html"
       class="block font-semibold text-gray-900 dark:text-gray-200 hover:text-litestar-gold dark:hover:text-litestar-gold !no-underline select-none cursor-pointer">
        What's new in 2.0
        <span class="absolute inset-0"></span>
    </a>

        </div>
    

                
                    
    
        <div class="group relative rounded-lg p-2 text-sm hover:bg-gray-50 dark:hover:bg-zinc-800">
            
    <a href="https://docs.litestar.dev/2/release-notes/changelog.html"
       class="block font-semibold text-gray-900 dark:text-gray-200 hover:text-litestar-gold dark:hover:text-litestar-gold !no-underline select-none cursor-pointer">
        2.x Changelog
        <span class="absolute inset-0"></span>
    </a>

        </div>
    

                
                    
    
        <div class="group relative rounded-lg p-2 text-sm hover:bg-gray-50 dark:hover:bg-zinc-800">
            
    <a href="https://docs.litestar.dev/1/release-notes/changelog.html"
       class="block font-semibold text-gray-900 dark:text-gray-200 hover:text-litestar-gold dark:hover:text-litestar-gold !no-underline select-none cursor-pointer">
        1.x Changelog
        <span class="absolute inset-0"></span>
    </a>

        </div>
    

                
            </div>
        </div>
    </div>

        
    
        
            <a href="https://github.com/orgs/litestar-org/discussions"
               class="text-sm font-semibold leading-6 text-gray-900 dark:text-gray-100 hover:!text-litestar-gold select-none cursor-pointer">Help</a>
        
    

    </nav>
</div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/litestar-org/litestar" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://discord.gg/X3FJqy8d2j" title="Discord" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-discord fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">Discord</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item"><nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><p aria-level="2" class="caption" role="heading"><span class="caption-text">Documentation</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../index.html">Tutorials</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2 has-children"><a class="reference internal" href="../todo-app/index.html">Developing a basic TODO application</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../todo-app/0-application-basics.html">Application basics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../todo-app/1-accessing-the-list.html">Accessing the list</a></li>
<li class="toctree-l3"><a class="reference internal" href="../todo-app/2-interacting-with-the-list.html">Making the list interactive</a></li>
<li class="toctree-l3"><a class="reference internal" href="../todo-app/3-assembling-the-app.html">Recap and assembling the final application</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../sqlalchemy/index.html">Improving the TODO app with SQLAlchemy</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../sqlalchemy/0-introduction.html">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sqlalchemy/1-provide-session-with-di.html">Providing the session with DI</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sqlalchemy/2-serialization-plugin.html">Using the serialization plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sqlalchemy/3-init-plugin.html">Using the init plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sqlalchemy/4-final-touches-and-recap.html">Final touches and recap</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../dto-tutorial/index.html">Data Transfer Object Tutorial</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../dto-tutorial/01-simple-dto-exclude.html">Our first DTO</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dto-tutorial/02-nested-exclude.html">Excluding from nested models</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dto-tutorial/03-nested-collection-exclude.html">Excluding from collections of nested models</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dto-tutorial/04-max-nested-depth.html">Max nested depth</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dto-tutorial/05-renaming-fields.html">Renaming fields</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dto-tutorial/06-receiving-data.html">Receiving data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dto-tutorial/07-read-only-fields.html">Read only fields</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dto-tutorial/08-dto-data.html">Accessing the data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dto-tutorial/09-updating.html">Updating instances</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dto-tutorial/10-layered-dto-declarations.html">Declaring DTOs on app layers</a></li>
</ul>
</li>
<li class="toctree-l2 current active has-children"><a class="reference internal" href="index.html">SQLAlchemy Repository Tutorial</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="01-modeling-and-features.html">Introduction to Database Modeling and Repository Features</a></li>
<li class="toctree-l3 current active"><a class="current reference internal" href="#">Interacting with repositories</a></li>

<li class="toctree-l3"><a class="reference internal" href="03-repository-controller.html">Working with Controllers and Repositories</a></li>
<li class="toctree-l3"><a class="reference internal" href="04-repository-other.html">Adding Additional Features to the Repository</a></li>

</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../usage/index.html">Usage</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../usage/applications.html">Applications</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../usage/routing/index.html">Routing</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../usage/routing/overview.html">Routing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/routing/handlers.html">Route handlers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/routing/parameters.html">Parameters</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/requests.html">Requests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/responses.html">Responses</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/dependency-injection.html">Dependency Injection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/websockets.html">WebSockets</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../usage/dto/index.html">Data Transfer Object (DTO)</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../usage/dto/0-basic-use.html">Basic Use</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/dto/1-abstract-dto.html">AbstractDTO</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/dto/2-creating-custom-dto-classes.html">Implementing Custom DTO Classes</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../usage/middleware/index.html">Middleware</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../usage/middleware/using-middleware.html">Using Middleware</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/middleware/builtin-middleware.html">Built-in middleware</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/middleware/creating-middleware.html">Creating Middleware</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/plugins.html">Plugins</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../usage/security/index.html">Security</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-10"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../usage/security/abstract-authentication-middleware.html">AbstractAuthenticationMiddleware</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/security/security-backends.html">Security Backends</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/security/guards.html">Guards</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/security/jwt.html">JWT Security Backends</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/channels.html">Channels</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../usage/databases/index.html">Databases</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-11"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../usage/databases/sqlalchemy/index.html">SQLAlchemy</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-12"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../usage/databases/sqlalchemy/models_and_repository.html">SQLAlchemy Models &amp; Repository</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../usage/databases/sqlalchemy/plugins/index.html">Plugins</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/databases/piccolo.html">Piccolo ORM</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/exceptions.html">Exceptions and exception handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/stores.html">Stores</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/openapi.html">OpenAPI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/lifecycle-hooks.html">Life Cycle Hooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/caching.html">Caching</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/templating.html">Templating</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/events.html">Events</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/logging.html">Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/static-files.html">Static Files</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../usage/metrics/index.html">Metrics</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-13"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../usage/metrics/open-telemetry.html">OpenTelemetry</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/metrics/prometheus.html">Prometheus</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/htmx.html">HTMX</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/cli.html">CLI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/testing.html">Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/debugging.html">Debugging</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../reference/index.html">API reference</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-14"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../reference/app.html">app</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/background_tasks.html">background_tasks</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../reference/channels/index.html">channels</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-15"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/channels/plugin.html">plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/channels/subscriber.html">subscriber</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../reference/channels/backends/index.html">backends</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-16"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference/channels/backends/base.html">base</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/channels/backends/memory.html">memory</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/channels/backends/redis.html">redis</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/cli.html">cli</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/config.html">config</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/connection.html">connection</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../reference/contrib/index.html">contrib</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-17"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/contrib/htmx.html">HTMX</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/contrib/jinja.html">jinja</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/contrib/jwt.html">jwt</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/contrib/mako.html">mako</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/contrib/opentelemetry.html">opentelemetry</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/contrib/piccolo.html">piccolo_orm</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/contrib/pydantic.html">pydantic</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../reference/contrib/sqlalchemy/index.html">sqlalchemy</a><input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-18"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference/contrib/sqlalchemy/plugins.html">plugins</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/contrib/sqlalchemy/repository.html">repository</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/contrib/sqlalchemy/types.html">types</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/contrib/sqlalchemy/base.html">base</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/contrib/sqlalchemy/dto.html">DTO</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/controller.html">controller</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/data_extractors.html">data_extractors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/datastructures.html">datastructures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/di.html">di</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../reference/dto/index.html">dto</a><input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-19"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/dto/config.html">config</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/dto/data_structures.html">data_structures</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/dto/field.html">field</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/dto/types.html">types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/dto/base_dto.html">base_dto</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/dto/msgspec_dto.html">msgspec_dto</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/dto/dataclass_dto.html">dataclass_dto</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/enums.html">enums</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/events.html">events</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/exceptions.html">exceptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/handlers.html">handlers</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../reference/logging/index.html">logging</a><input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-20"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/logging/config.html">config</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/logging/picologging.html">picologging</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/logging/standard.html">standard</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../reference/middleware/index.html">middleware</a><input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-21"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/middleware/allowed_hosts.html">allowed_hosts</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/middleware/authentication.html">authentication</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/middleware/compression.html">compression</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/middleware/cors.html">cors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/middleware/csrf.html">csrf</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/middleware/logging.html">logging</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/middleware/rate_limit.html">rate_limit</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../reference/middleware/session/index.html">session</a><input class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-22"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference/middleware/session/base.html">base</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/middleware/session/client_side.html">client_side</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/middleware/session/server_side.html">server_side</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../reference/openapi/index.html">openapi</a><input class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-23"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/openapi/openapi.html">openapi</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/openapi/spec.html">spec</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/pagination.html">pagination</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/params.html">params</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/plugins.html">plugins</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../reference/response/index.html">response</a><input class="toctree-checkbox" id="toctree-checkbox-24" name="toctree-checkbox-24" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-24"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/response/base.html">base</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/response/file.html">file</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/response/redirect.html">redirect</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/response/streaming.html">streaming</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/response/sse.html">SSE (Server Sent Events)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/response/template.html">template</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/router.html">router</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/routes.html">routes</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../reference/security/index.html">security</a><input class="toctree-checkbox" id="toctree-checkbox-25" name="toctree-checkbox-25" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-25"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/security/session_auth.html">session_auth</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/serialization.html">serialization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/static_files.html">static_files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/status_codes.html">status_code</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../reference/stores/index.html">stores</a><input class="toctree-checkbox" id="toctree-checkbox-26" name="toctree-checkbox-26" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-26"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/stores/base.html">base</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/stores/file.html">file</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/stores/memory.html">memory</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/stores/redis.html">redis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/stores/registry.html">registry</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../reference/repository/index.html">repository</a><input class="toctree-checkbox" id="toctree-checkbox-27" name="toctree-checkbox-27" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-27"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/repository/abc.html">abc</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/repository/filters.html">filters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/repository/exceptions.html">exceptions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/repository/testing.html">testing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/repository/handlers.html">handlers</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/template.html">template</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/testing.html">testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/types.html">types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/typing.html">typing</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../topics/index.html">Topics</a><input class="toctree-checkbox" id="toctree-checkbox-28" name="toctree-checkbox-28" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-28"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../topics/sync-vs-async.html">Sync vs. Async</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../migration/index.html">Migrating to Litestar</a><input class="toctree-checkbox" id="toctree-checkbox-29" name="toctree-checkbox-29" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-29"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../migration/flask.html">From Flask</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../migration/fastapi.html">From Starlette / FastAPI</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../benchmarks.html">Benchmarks</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../index.html" class="nav-link">Tutorials</a></li>
    
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">SQLAlchemy Repository Tutorial</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">Interacting...</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="interacting-with-repositories">
<h1>Interacting with repositories<a class="headerlink" href="#interacting-with-repositories" title="Permalink to this heading">#</a></h1>
<p>Now that weve covered the modeling basics, we are able to create our first repository
class.  The repository classes include all of the standard CRUD operations as well as a
few advanced features such as pagination, filtering and bulk operations.</p>
<p>Before we jump in to the code, lets take a look at the available functions available in
the the synchronous and asynchronous repositories.</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Function</p></th>
<th class="head"><p>Category</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">get</span></code></p></td>
<td><p>Selecting Data</p></td>
<td><p>Select a single record by primary key. Raises an exception when no record is found.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">get_one</span></code></p></td>
<td><p>Selecting Data</p></td>
<td><p>Select a single record specified by the <code class="docutils literal notranslate"><span class="pre">kwargs</span></code> parameters. Raises an exception when no record is found.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">get_one_or_none</span></code></p></td>
<td><p>Selecting Data</p></td>
<td><p>Select a single record specified by the <code class="docutils literal notranslate"><span class="pre">kwargs</span></code> parameters. Returns <code class="docutils literal notranslate"><span class="pre">None</span></code> when no record is found.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">list</span></code></p></td>
<td><p>Selecting Data</p></td>
<td><p>Select a list of records specified by the <code class="docutils literal notranslate"><span class="pre">kwargs</span></code> parameters. Optionally it can be filtered by the included <code class="docutils literal notranslate"><span class="pre">FilterTypes</span></code> args.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">list_and_count</span></code></p></td>
<td><p>Selecting Data</p></td>
<td><p>Select a list of records specified by the <code class="docutils literal notranslate"><span class="pre">kwargs</span></code> parameters. Optionally it can be filtered by the included <code class="docutils literal notranslate"><span class="pre">FilterTypes</span></code> args. Results are returned as a 2 value tuple that includes the rows selected and the total count of records.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">get_or_create</span></code></p></td>
<td><p>Creating Data</p></td>
<td><p>Select a single record specified by the the <code class="docutils literal notranslate"><span class="pre">kwargs</span></code> parameters.  If no record is found, one is created with the given values.  Theres an optional attribute to filter on a subset of the supplied parameters and to merge updates.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">create</span></code></p></td>
<td><p>Creating Data</p></td>
<td><p>Create a new record in the database.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">create_many</span></code></p></td>
<td><p>Creating Data</p></td>
<td><p>Create one or more rows in the database.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">update</span></code></p></td>
<td><p>Updating Data</p></td>
<td><p>Update an existing record in the database.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">update_many</span></code></p></td>
<td><p>Updating Data</p></td>
<td><p>Update one or more rows in the database.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">upsert</span></code></p></td>
<td><p>Updating Data</p></td>
<td><p>A single operation that updates or inserts a record based whether or not the primary key value on the model object is populated.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">upsert_many</span></code></p></td>
<td><p>Updating Data</p></td>
<td><p>Updates or inserts multiple records based whether or not the primary key value on the model object is populated.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">remove</span></code></p></td>
<td><p>Removing Data</p></td>
<td><p>Remove a single record from the database.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">remove_many</span></code></p></td>
<td><p>Removing Data</p></td>
<td><p>Remove one or more records from the database.</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>All three of the bulk DML operations will leverage dialect-specific enhancements
to be as efficient as possible. In addition to using efficient bulk inserts binds,
the repository will optionally leverage the multi-row <code class="docutils literal notranslate"><span class="pre">RETURNING</span></code> support where
possible. The repository will automatically detect this support from the
SQLAlchemy driver, so no additional interaction is required to enable this.</p></li>
<li><p>SQL engines generally have a limit to the number of elements that can be appended
into an <cite>IN</cite> clause. The repository operations will automatically break lists that
exceed this limit into multiple queries that are concatenated together before
return. You do not need to account for this in your own code.</p></li>
</ul>
</div>
<p>In the following examples, well cover a few ways that you can use the repository within
your applications.</p>
<section id="model-repository">
<h2>Model Repository<a class="headerlink" href="#model-repository" title="Permalink to this heading">#</a></h2>
<p>Here we import the
<a class="reference external" href="https://docs.advanced-alchemy.jolt.rs/latest/reference/repository.html#advanced_alchemy.repository.SQLAlchemyAsyncRepository" title="(in advanced_alchemy v0.3.4)"><code class="xref py py-class docutils literal notranslate"><span class="pre">SQLAlchemyAsyncRepository</span></code></a>
class and create an <code class="docutils literal notranslate"><span class="pre">AuthorRepository</span></code> repository class. This is all thats required
to include all of the integrated repository features.</p>
<div class="sd-tab-set docutils">
<input id="sd-tab-item-0" name="sd-tab-set-0" type="radio">
</input><label class="sd-tab-label" data-sync-id="3.8" for="sd-tab-item-0">
Python 3.8+</label><div class="sd-tab-content docutils">
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">app.py</span><a class="headerlink" href="#id1" title="Permalink to this code">#</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
<span class="linenos">  2</span>
<span class="linenos">  3</span><span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">asynccontextmanager</span>
<span class="linenos">  4</span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span><span class="p">,</span> <span class="n">datetime</span>
<span class="linenos">  5</span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">AsyncIterator</span>
<span class="linenos">  6</span><span class="kn">from</span> <span class="nn">uuid</span> <span class="kn">import</span> <span class="n">UUID</span>
<span class="linenos">  7</span>
<span class="linenos">  8</span><span class="kn">import</span> <span class="nn">anyio</span>
<span class="linenos">  9</span><span class="kn">from</span> <span class="nn">rich</span> <span class="kn">import</span> <span class="n">get_console</span>
<span class="linenos"> 10</span><span class="kn">from</span> <span class="nn">sqlalchemy.ext.asyncio</span> <span class="kn">import</span> <span class="n">async_sessionmaker</span><span class="p">,</span> <span class="n">create_async_engine</span>
<span class="linenos"> 11</span><span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">Mapped</span>
<span class="linenos"> 12</span>
<span class="linenos"> 13</span><span class="kn">from</span> <span class="nn">litestar.contrib.sqlalchemy.base</span> <span class="kn">import</span> <span class="n">UUIDBase</span>
<span class="hll"><span class="linenos"> 14</span><span class="kn">from</span> <span class="nn">litestar.contrib.sqlalchemy.repository</span> <span class="kn">import</span> <span class="n">SQLAlchemyAsyncRepository</span>
</span><span class="linenos"> 15</span>
<span class="linenos"> 16</span><span class="n">console</span> <span class="o">=</span> <span class="n">get_console</span><span class="p">()</span>
<span class="linenos"> 17</span>
<span class="linenos"> 18</span>
<span class="linenos"> 19</span><span class="c1"># the SQLAlchemy base includes a declarative model for you to use in your models.</span>
<span class="linenos"> 20</span><span class="c1"># The `Base` class includes a `UUID` based primary key (`id`)</span>
<span class="linenos"> 21</span><span class="k">class</span> <span class="nc">Author</span><span class="p">(</span><span class="n">UUIDBase</span><span class="p">):</span>
<span class="linenos"> 22</span>    <span class="n">name</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
<span class="linenos"> 23</span>    <span class="n">dob</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">date</span><span class="p">]</span>
<span class="linenos"> 24</span>    <span class="n">dod</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">date</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]</span>
<span class="linenos"> 25</span>
<span class="linenos"> 26</span>
<span class="hll"><span class="linenos"> 27</span><span class="k">class</span> <span class="nc">AuthorRepository</span><span class="p">(</span><span class="n">SQLAlchemyAsyncRepository</span><span class="p">[</span><span class="n">Author</span><span class="p">]):</span>
</span><span class="hll"><span class="linenos"> 28</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Author repository.&quot;&quot;&quot;</span>
</span><span class="hll"><span class="linenos"> 29</span>
</span><span class="hll"><span class="linenos"> 30</span>    <span class="n">model_type</span> <span class="o">=</span> <span class="n">Author</span>
</span><span class="linenos"> 31</span>
<span class="linenos"> 32</span>
<span class="linenos"> 33</span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_async_engine</span><span class="p">(</span>
<span class="linenos"> 34</span>    <span class="s2">&quot;sqlite+aiosqlite:///test.sqlite&quot;</span><span class="p">,</span>
<span class="linenos"> 35</span>    <span class="n">future</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="linenos"> 36</span><span class="p">)</span>
<span class="linenos"> 37</span><span class="n">session_factory</span> <span class="o">=</span> <span class="n">async_sessionmaker</span><span class="p">(</span><span class="n">engine</span><span class="p">,</span> <span class="n">expire_on_commit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="linenos"> 38</span>
<span class="linenos"> 39</span>
<span class="linenos"> 40</span><span class="c1"># let&#39;s make a simple context manager as an example here.</span>
<span class="linenos"> 41</span><span class="nd">@asynccontextmanager</span>
<span class="linenos"> 42</span><span class="k">async</span> <span class="k">def</span> <span class="nf">repository_factory</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">AuthorRepository</span><span class="p">]:</span>
<span class="linenos"> 43</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">session_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">db_session</span><span class="p">:</span>
<span class="linenos"> 44</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos"> 45</span>            <span class="k">yield</span> <span class="n">AuthorRepository</span><span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="n">db_session</span><span class="p">)</span>
<span class="linenos"> 46</span>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>  <span class="c1"># noqa: BLE001</span>
<span class="linenos"> 47</span>            <span class="k">await</span> <span class="n">db_session</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
<span class="linenos"> 48</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 49</span>            <span class="k">await</span> <span class="n">db_session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="linenos"> 50</span>
<span class="linenos"> 51</span>
<span class="linenos"> 52</span><span class="k">async</span> <span class="k">def</span> <span class="nf">create_author</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Author</span><span class="p">:</span>
<span class="linenos"> 53</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">repository_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">repo</span><span class="p">:</span>
<span class="linenos"> 54</span>        <span class="n">obj</span> <span class="o">=</span> <span class="k">await</span> <span class="n">repo</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
<span class="linenos"> 55</span>            <span class="n">Author</span><span class="p">(</span>
<span class="linenos"> 56</span>                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;F. Scott Fitzgerald&quot;</span><span class="p">,</span>
<span class="linenos"> 57</span>                <span class="n">dob</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s2">&quot;1896-09-24&quot;</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">(),</span>
<span class="linenos"> 58</span>            <span class="p">)</span>
<span class="linenos"> 59</span>        <span class="p">)</span>
<span class="linenos"> 60</span>        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created Author record for </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> with primary key </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="linenos"> 61</span>        <span class="k">return</span> <span class="n">obj</span>
<span class="linenos"> 62</span>
<span class="linenos"> 63</span>
<span class="linenos"> 64</span><span class="k">async</span> <span class="k">def</span> <span class="nf">update_author</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">Author</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Author</span><span class="p">:</span>
<span class="linenos"> 65</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">repository_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">repo</span><span class="p">:</span>
<span class="linenos"> 66</span>        <span class="n">obj</span> <span class="o">=</span> <span class="k">await</span> <span class="n">repo</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="linenos"> 67</span>        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updated Author record for </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> with primary key </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="linenos"> 68</span>        <span class="k">return</span> <span class="n">obj</span>
<span class="linenos"> 69</span>
<span class="linenos"> 70</span>
<span class="linenos"> 71</span><span class="k">async</span> <span class="k">def</span> <span class="nf">remove_author</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="n">UUID</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Author</span><span class="p">:</span>
<span class="linenos"> 72</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">repository_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">repo</span><span class="p">:</span>
<span class="linenos"> 73</span>        <span class="n">obj</span> <span class="o">=</span> <span class="k">await</span> <span class="n">repo</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
<span class="linenos"> 74</span>        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Deleted Author record for </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> with primary key </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="linenos"> 75</span>        <span class="k">return</span> <span class="n">obj</span>
<span class="linenos"> 76</span>
<span class="linenos"> 77</span>
<span class="linenos"> 78</span><span class="k">async</span> <span class="k">def</span> <span class="nf">get_author_if_exists</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="n">UUID</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Author</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 79</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">repository_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">repo</span><span class="p">:</span>
<span class="linenos"> 80</span>        <span class="n">obj</span> <span class="o">=</span> <span class="k">await</span> <span class="n">repo</span><span class="o">.</span><span class="n">get_one_or_none</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span>
<span class="linenos"> 81</span>        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 82</span>            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found Author record for </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> with primary key </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="linenos"> 83</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 84</span>            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find Author with primary key </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="linenos"> 85</span>        <span class="k">return</span> <span class="n">obj</span>
<span class="linenos"> 86</span>
<span class="linenos"> 87</span>
<span class="linenos"> 88</span><span class="k">async</span> <span class="k">def</span> <span class="nf">run_script</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 89</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Load data from a fixture.&quot;&quot;&quot;</span>
<span class="linenos"> 90</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">engine</span><span class="o">.</span><span class="n">begin</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
<span class="linenos"> 91</span>        <span class="k">await</span> <span class="n">conn</span><span class="o">.</span><span class="n">run_sync</span><span class="p">(</span><span class="n">UUIDBase</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">)</span>
<span class="linenos"> 92</span>
<span class="linenos"> 93</span>    <span class="c1"># 1) create a new Author record.</span>
<span class="linenos"> 94</span>    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;1) Adding a new record&quot;</span><span class="p">)</span>
<span class="linenos"> 95</span>    <span class="n">author</span> <span class="o">=</span> <span class="k">await</span> <span class="n">create_author</span><span class="p">()</span>
<span class="linenos"> 96</span>    <span class="n">author_id</span> <span class="o">=</span> <span class="n">author</span><span class="o">.</span><span class="n">id</span>
<span class="linenos"> 97</span>
<span class="linenos"> 98</span>    <span class="c1"># 2) Let&#39;s update the Author record.</span>
<span class="linenos"> 99</span>    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;2) Updating a record.&quot;</span><span class="p">)</span>
<span class="linenos">100</span>    <span class="n">author</span><span class="o">.</span><span class="n">dod</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s2">&quot;1940-12-21&quot;</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
<span class="linenos">101</span>    <span class="k">await</span> <span class="n">update_author</span><span class="p">(</span><span class="n">author</span><span class="p">)</span>
<span class="linenos">102</span>
<span class="linenos">103</span>    <span class="c1"># 3) Let&#39;s delete the record we just created.</span>
<span class="linenos">104</span>    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;3) Removing a record.&quot;</span><span class="p">)</span>
<span class="linenos">105</span>    <span class="k">await</span> <span class="n">remove_author</span><span class="p">(</span><span class="n">author_id</span><span class="p">)</span>
<span class="linenos">106</span>
<span class="linenos">107</span>    <span class="c1"># 4) Let&#39;s verify the record no longer exists.</span>
<span class="linenos">108</span>    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;4) Select one or none.&quot;</span><span class="p">)</span>
<span class="linenos">109</span>    <span class="n">_should_be_none</span> <span class="o">=</span> <span class="k">await</span> <span class="n">get_author_if_exists</span><span class="p">(</span><span class="n">author_id</span><span class="p">)</span>
<span class="linenos">110</span>
<span class="linenos">111</span>
<span class="linenos">112</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<span class="linenos">113</span>    <span class="n">anyio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">run_script</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<input checked="checked" id="sd-tab-item-1" name="sd-tab-set-0" type="radio">
</input><label class="sd-tab-label" data-sync-id="3.9" for="sd-tab-item-1">
Python 3.9+</label><div class="sd-tab-content docutils">
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">app.py</span><a class="headerlink" href="#id2" title="Permalink to this code">#</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
<span class="linenos">  2</span>
<span class="linenos">  3</span><span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">asynccontextmanager</span>
<span class="linenos">  4</span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span><span class="p">,</span> <span class="n">datetime</span>
<span class="linenos">  5</span><span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">AsyncIterator</span>
<span class="linenos">  6</span><span class="kn">from</span> <span class="nn">uuid</span> <span class="kn">import</span> <span class="n">UUID</span>
<span class="linenos">  7</span>
<span class="linenos">  8</span><span class="kn">import</span> <span class="nn">anyio</span>
<span class="linenos">  9</span><span class="kn">from</span> <span class="nn">rich</span> <span class="kn">import</span> <span class="n">get_console</span>
<span class="linenos"> 10</span><span class="kn">from</span> <span class="nn">sqlalchemy.ext.asyncio</span> <span class="kn">import</span> <span class="n">async_sessionmaker</span><span class="p">,</span> <span class="n">create_async_engine</span>
<span class="linenos"> 11</span><span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">Mapped</span>
<span class="linenos"> 12</span>
<span class="linenos"> 13</span><span class="kn">from</span> <span class="nn">litestar.contrib.sqlalchemy.base</span> <span class="kn">import</span> <span class="n">UUIDBase</span>
<span class="hll"><span class="linenos"> 14</span><span class="kn">from</span> <span class="nn">litestar.contrib.sqlalchemy.repository</span> <span class="kn">import</span> <span class="n">SQLAlchemyAsyncRepository</span>
</span><span class="linenos"> 15</span>
<span class="linenos"> 16</span><span class="n">console</span> <span class="o">=</span> <span class="n">get_console</span><span class="p">()</span>
<span class="linenos"> 17</span>
<span class="linenos"> 18</span>
<span class="linenos"> 19</span><span class="c1"># the SQLAlchemy base includes a declarative model for you to use in your models.</span>
<span class="linenos"> 20</span><span class="c1"># The `Base` class includes a `UUID` based primary key (`id`)</span>
<span class="linenos"> 21</span><span class="k">class</span> <span class="nc">Author</span><span class="p">(</span><span class="n">UUIDBase</span><span class="p">):</span>
<span class="linenos"> 22</span>    <span class="n">name</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
<span class="linenos"> 23</span>    <span class="n">dob</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">date</span><span class="p">]</span>
<span class="linenos"> 24</span>    <span class="n">dod</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">date</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]</span>
<span class="linenos"> 25</span>
<span class="linenos"> 26</span>
<span class="hll"><span class="linenos"> 27</span><span class="k">class</span> <span class="nc">AuthorRepository</span><span class="p">(</span><span class="n">SQLAlchemyAsyncRepository</span><span class="p">[</span><span class="n">Author</span><span class="p">]):</span>
</span><span class="hll"><span class="linenos"> 28</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Author repository.&quot;&quot;&quot;</span>
</span><span class="hll"><span class="linenos"> 29</span>
</span><span class="hll"><span class="linenos"> 30</span>    <span class="n">model_type</span> <span class="o">=</span> <span class="n">Author</span>
</span><span class="linenos"> 31</span>
<span class="linenos"> 32</span>
<span class="linenos"> 33</span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_async_engine</span><span class="p">(</span>
<span class="linenos"> 34</span>    <span class="s2">&quot;sqlite+aiosqlite:///test.sqlite&quot;</span><span class="p">,</span>
<span class="linenos"> 35</span>    <span class="n">future</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="linenos"> 36</span><span class="p">)</span>
<span class="linenos"> 37</span><span class="n">session_factory</span> <span class="o">=</span> <span class="n">async_sessionmaker</span><span class="p">(</span><span class="n">engine</span><span class="p">,</span> <span class="n">expire_on_commit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="linenos"> 38</span>
<span class="linenos"> 39</span>
<span class="linenos"> 40</span><span class="c1"># let&#39;s make a simple context manager as an example here.</span>
<span class="linenos"> 41</span><span class="nd">@asynccontextmanager</span>
<span class="linenos"> 42</span><span class="k">async</span> <span class="k">def</span> <span class="nf">repository_factory</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">AuthorRepository</span><span class="p">]:</span>
<span class="linenos"> 43</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">session_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">db_session</span><span class="p">:</span>
<span class="linenos"> 44</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos"> 45</span>            <span class="k">yield</span> <span class="n">AuthorRepository</span><span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="n">db_session</span><span class="p">)</span>
<span class="linenos"> 46</span>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>  <span class="c1"># noqa: BLE001</span>
<span class="linenos"> 47</span>            <span class="k">await</span> <span class="n">db_session</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
<span class="linenos"> 48</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 49</span>            <span class="k">await</span> <span class="n">db_session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="linenos"> 50</span>
<span class="linenos"> 51</span>
<span class="linenos"> 52</span><span class="k">async</span> <span class="k">def</span> <span class="nf">create_author</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Author</span><span class="p">:</span>
<span class="linenos"> 53</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">repository_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">repo</span><span class="p">:</span>
<span class="linenos"> 54</span>        <span class="n">obj</span> <span class="o">=</span> <span class="k">await</span> <span class="n">repo</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
<span class="linenos"> 55</span>            <span class="n">Author</span><span class="p">(</span>
<span class="linenos"> 56</span>                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;F. Scott Fitzgerald&quot;</span><span class="p">,</span>
<span class="linenos"> 57</span>                <span class="n">dob</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s2">&quot;1896-09-24&quot;</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">(),</span>
<span class="linenos"> 58</span>            <span class="p">)</span>
<span class="linenos"> 59</span>        <span class="p">)</span>
<span class="linenos"> 60</span>        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created Author record for </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> with primary key </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="linenos"> 61</span>        <span class="k">return</span> <span class="n">obj</span>
<span class="linenos"> 62</span>
<span class="linenos"> 63</span>
<span class="linenos"> 64</span><span class="k">async</span> <span class="k">def</span> <span class="nf">update_author</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">Author</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Author</span><span class="p">:</span>
<span class="linenos"> 65</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">repository_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">repo</span><span class="p">:</span>
<span class="linenos"> 66</span>        <span class="n">obj</span> <span class="o">=</span> <span class="k">await</span> <span class="n">repo</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="linenos"> 67</span>        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updated Author record for </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> with primary key </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="linenos"> 68</span>        <span class="k">return</span> <span class="n">obj</span>
<span class="linenos"> 69</span>
<span class="linenos"> 70</span>
<span class="linenos"> 71</span><span class="k">async</span> <span class="k">def</span> <span class="nf">remove_author</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="n">UUID</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Author</span><span class="p">:</span>
<span class="linenos"> 72</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">repository_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">repo</span><span class="p">:</span>
<span class="linenos"> 73</span>        <span class="n">obj</span> <span class="o">=</span> <span class="k">await</span> <span class="n">repo</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
<span class="linenos"> 74</span>        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Deleted Author record for </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> with primary key </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="linenos"> 75</span>        <span class="k">return</span> <span class="n">obj</span>
<span class="linenos"> 76</span>
<span class="linenos"> 77</span>
<span class="linenos"> 78</span><span class="k">async</span> <span class="k">def</span> <span class="nf">get_author_if_exists</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="n">UUID</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Author</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 79</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">repository_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">repo</span><span class="p">:</span>
<span class="linenos"> 80</span>        <span class="n">obj</span> <span class="o">=</span> <span class="k">await</span> <span class="n">repo</span><span class="o">.</span><span class="n">get_one_or_none</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span>
<span class="linenos"> 81</span>        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 82</span>            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found Author record for </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> with primary key </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="linenos"> 83</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 84</span>            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find Author with primary key </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="linenos"> 85</span>        <span class="k">return</span> <span class="n">obj</span>
<span class="linenos"> 86</span>
<span class="linenos"> 87</span>
<span class="linenos"> 88</span><span class="k">async</span> <span class="k">def</span> <span class="nf">run_script</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 89</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Load data from a fixture.&quot;&quot;&quot;</span>
<span class="linenos"> 90</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">engine</span><span class="o">.</span><span class="n">begin</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
<span class="linenos"> 91</span>        <span class="k">await</span> <span class="n">conn</span><span class="o">.</span><span class="n">run_sync</span><span class="p">(</span><span class="n">UUIDBase</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">)</span>
<span class="linenos"> 92</span>
<span class="linenos"> 93</span>    <span class="c1"># 1) create a new Author record.</span>
<span class="linenos"> 94</span>    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;1) Adding a new record&quot;</span><span class="p">)</span>
<span class="linenos"> 95</span>    <span class="n">author</span> <span class="o">=</span> <span class="k">await</span> <span class="n">create_author</span><span class="p">()</span>
<span class="linenos"> 96</span>    <span class="n">author_id</span> <span class="o">=</span> <span class="n">author</span><span class="o">.</span><span class="n">id</span>
<span class="linenos"> 97</span>
<span class="linenos"> 98</span>    <span class="c1"># 2) Let&#39;s update the Author record.</span>
<span class="linenos"> 99</span>    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;2) Updating a record.&quot;</span><span class="p">)</span>
<span class="linenos">100</span>    <span class="n">author</span><span class="o">.</span><span class="n">dod</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s2">&quot;1940-12-21&quot;</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
<span class="linenos">101</span>    <span class="k">await</span> <span class="n">update_author</span><span class="p">(</span><span class="n">author</span><span class="p">)</span>
<span class="linenos">102</span>
<span class="linenos">103</span>    <span class="c1"># 3) Let&#39;s delete the record we just created.</span>
<span class="linenos">104</span>    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;3) Removing a record.&quot;</span><span class="p">)</span>
<span class="linenos">105</span>    <span class="k">await</span> <span class="n">remove_author</span><span class="p">(</span><span class="n">author_id</span><span class="p">)</span>
<span class="linenos">106</span>
<span class="linenos">107</span>    <span class="c1"># 4) Let&#39;s verify the record no longer exists.</span>
<span class="linenos">108</span>    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;4) Select one or none.&quot;</span><span class="p">)</span>
<span class="linenos">109</span>    <span class="n">_should_be_none</span> <span class="o">=</span> <span class="k">await</span> <span class="n">get_author_if_exists</span><span class="p">(</span><span class="n">author_id</span><span class="p">)</span>
<span class="linenos">110</span>
<span class="linenos">111</span>
<span class="linenos">112</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<span class="linenos">113</span>    <span class="n">anyio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">run_script</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="repository-context-manager">
<h2>Repository Context Manager<a class="headerlink" href="#repository-context-manager" title="Permalink to this heading">#</a></h2>
<p>Since well be using the repository outside of a Litestar application in this script,
well make a simple context manager to automatically handle the creation (and cleanup)
of our Author repository.</p>
<dl class="simple">
<dt>The <code class="docutils literal notranslate"><span class="pre">repository_factory</span></code> method will do the following for us:</dt><dd><ul class="simple">
<li><p>Automatically create a new DB session from the SQLAlchemy configuration.</p></li>
<li><p>Rollback session when any exception occurs.</p></li>
<li><p>Automatically commit after function call completes.</p></li>
</ul>
</dd>
</dl>
<div class="sd-tab-set docutils">
<input id="sd-tab-item-2" name="sd-tab-set-1" type="radio">
</input><label class="sd-tab-label" data-sync-id="3.8" for="sd-tab-item-2">
Python 3.8+</label><div class="sd-tab-content docutils">
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">app.py</span><a class="headerlink" href="#id3" title="Permalink to this code">#</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
<span class="linenos">  2</span>
<span class="linenos">  3</span><span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">asynccontextmanager</span>
<span class="linenos">  4</span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span><span class="p">,</span> <span class="n">datetime</span>
<span class="linenos">  5</span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">AsyncIterator</span>
<span class="linenos">  6</span><span class="kn">from</span> <span class="nn">uuid</span> <span class="kn">import</span> <span class="n">UUID</span>
<span class="linenos">  7</span>
<span class="linenos">  8</span><span class="kn">import</span> <span class="nn">anyio</span>
<span class="linenos">  9</span><span class="kn">from</span> <span class="nn">rich</span> <span class="kn">import</span> <span class="n">get_console</span>
<span class="linenos"> 10</span><span class="kn">from</span> <span class="nn">sqlalchemy.ext.asyncio</span> <span class="kn">import</span> <span class="n">async_sessionmaker</span><span class="p">,</span> <span class="n">create_async_engine</span>
<span class="linenos"> 11</span><span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">Mapped</span>
<span class="linenos"> 12</span>
<span class="linenos"> 13</span><span class="kn">from</span> <span class="nn">litestar.contrib.sqlalchemy.base</span> <span class="kn">import</span> <span class="n">UUIDBase</span>
<span class="linenos"> 14</span><span class="kn">from</span> <span class="nn">litestar.contrib.sqlalchemy.repository</span> <span class="kn">import</span> <span class="n">SQLAlchemyAsyncRepository</span>
<span class="linenos"> 15</span>
<span class="linenos"> 16</span><span class="n">console</span> <span class="o">=</span> <span class="n">get_console</span><span class="p">()</span>
<span class="linenos"> 17</span>
<span class="linenos"> 18</span>
<span class="linenos"> 19</span><span class="c1"># the SQLAlchemy base includes a declarative model for you to use in your models.</span>
<span class="linenos"> 20</span><span class="c1"># The `Base` class includes a `UUID` based primary key (`id`)</span>
<span class="linenos"> 21</span><span class="k">class</span> <span class="nc">Author</span><span class="p">(</span><span class="n">UUIDBase</span><span class="p">):</span>
<span class="linenos"> 22</span>    <span class="n">name</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
<span class="linenos"> 23</span>    <span class="n">dob</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">date</span><span class="p">]</span>
<span class="linenos"> 24</span>    <span class="n">dod</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">date</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]</span>
<span class="linenos"> 25</span>
<span class="linenos"> 26</span>
<span class="linenos"> 27</span><span class="k">class</span> <span class="nc">AuthorRepository</span><span class="p">(</span><span class="n">SQLAlchemyAsyncRepository</span><span class="p">[</span><span class="n">Author</span><span class="p">]):</span>
<span class="linenos"> 28</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Author repository.&quot;&quot;&quot;</span>
<span class="linenos"> 29</span>
<span class="linenos"> 30</span>    <span class="n">model_type</span> <span class="o">=</span> <span class="n">Author</span>
<span class="linenos"> 31</span>
<span class="linenos"> 32</span>
<span class="linenos"> 33</span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_async_engine</span><span class="p">(</span>
<span class="linenos"> 34</span>    <span class="s2">&quot;sqlite+aiosqlite:///test.sqlite&quot;</span><span class="p">,</span>
<span class="linenos"> 35</span>    <span class="n">future</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="linenos"> 36</span><span class="p">)</span>
<span class="linenos"> 37</span><span class="n">session_factory</span> <span class="o">=</span> <span class="n">async_sessionmaker</span><span class="p">(</span><span class="n">engine</span><span class="p">,</span> <span class="n">expire_on_commit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="linenos"> 38</span>
<span class="hll"><span class="linenos"> 39</span>
</span><span class="hll"><span class="linenos"> 40</span><span class="c1"># let&#39;s make a simple context manager as an example here.</span>
</span><span class="hll"><span class="linenos"> 41</span><span class="nd">@asynccontextmanager</span>
</span><span class="hll"><span class="linenos"> 42</span><span class="k">async</span> <span class="k">def</span> <span class="nf">repository_factory</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">AuthorRepository</span><span class="p">]:</span>
</span><span class="hll"><span class="linenos"> 43</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">session_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">db_session</span><span class="p">:</span>
</span><span class="hll"><span class="linenos"> 44</span>        <span class="k">try</span><span class="p">:</span>
</span><span class="hll"><span class="linenos"> 45</span>            <span class="k">yield</span> <span class="n">AuthorRepository</span><span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="n">db_session</span><span class="p">)</span>
</span><span class="hll"><span class="linenos"> 46</span>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>  <span class="c1"># noqa: BLE001</span>
</span><span class="hll"><span class="linenos"> 47</span>            <span class="k">await</span> <span class="n">db_session</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
</span><span class="linenos"> 48</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 49</span>            <span class="k">await</span> <span class="n">db_session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="linenos"> 50</span>
<span class="linenos"> 51</span>
<span class="linenos"> 52</span><span class="k">async</span> <span class="k">def</span> <span class="nf">create_author</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Author</span><span class="p">:</span>
<span class="linenos"> 53</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">repository_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">repo</span><span class="p">:</span>
<span class="linenos"> 54</span>        <span class="n">obj</span> <span class="o">=</span> <span class="k">await</span> <span class="n">repo</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
<span class="linenos"> 55</span>            <span class="n">Author</span><span class="p">(</span>
<span class="linenos"> 56</span>                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;F. Scott Fitzgerald&quot;</span><span class="p">,</span>
<span class="linenos"> 57</span>                <span class="n">dob</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s2">&quot;1896-09-24&quot;</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">(),</span>
<span class="linenos"> 58</span>            <span class="p">)</span>
<span class="linenos"> 59</span>        <span class="p">)</span>
<span class="linenos"> 60</span>        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created Author record for </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> with primary key </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="linenos"> 61</span>        <span class="k">return</span> <span class="n">obj</span>
<span class="linenos"> 62</span>
<span class="linenos"> 63</span>
<span class="linenos"> 64</span><span class="k">async</span> <span class="k">def</span> <span class="nf">update_author</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">Author</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Author</span><span class="p">:</span>
<span class="linenos"> 65</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">repository_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">repo</span><span class="p">:</span>
<span class="linenos"> 66</span>        <span class="n">obj</span> <span class="o">=</span> <span class="k">await</span> <span class="n">repo</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="linenos"> 67</span>        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updated Author record for </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> with primary key </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="linenos"> 68</span>        <span class="k">return</span> <span class="n">obj</span>
<span class="linenos"> 69</span>
<span class="linenos"> 70</span>
<span class="linenos"> 71</span><span class="k">async</span> <span class="k">def</span> <span class="nf">remove_author</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="n">UUID</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Author</span><span class="p">:</span>
<span class="linenos"> 72</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">repository_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">repo</span><span class="p">:</span>
<span class="linenos"> 73</span>        <span class="n">obj</span> <span class="o">=</span> <span class="k">await</span> <span class="n">repo</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
<span class="linenos"> 74</span>        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Deleted Author record for </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> with primary key </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="linenos"> 75</span>        <span class="k">return</span> <span class="n">obj</span>
<span class="linenos"> 76</span>
<span class="linenos"> 77</span>
<span class="linenos"> 78</span><span class="k">async</span> <span class="k">def</span> <span class="nf">get_author_if_exists</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="n">UUID</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Author</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 79</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">repository_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">repo</span><span class="p">:</span>
<span class="linenos"> 80</span>        <span class="n">obj</span> <span class="o">=</span> <span class="k">await</span> <span class="n">repo</span><span class="o">.</span><span class="n">get_one_or_none</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span>
<span class="linenos"> 81</span>        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 82</span>            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found Author record for </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> with primary key </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="linenos"> 83</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 84</span>            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find Author with primary key </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="linenos"> 85</span>        <span class="k">return</span> <span class="n">obj</span>
<span class="linenos"> 86</span>
<span class="linenos"> 87</span>
<span class="linenos"> 88</span><span class="k">async</span> <span class="k">def</span> <span class="nf">run_script</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 89</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Load data from a fixture.&quot;&quot;&quot;</span>
<span class="linenos"> 90</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">engine</span><span class="o">.</span><span class="n">begin</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
<span class="linenos"> 91</span>        <span class="k">await</span> <span class="n">conn</span><span class="o">.</span><span class="n">run_sync</span><span class="p">(</span><span class="n">UUIDBase</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">)</span>
<span class="linenos"> 92</span>
<span class="linenos"> 93</span>    <span class="c1"># 1) create a new Author record.</span>
<span class="linenos"> 94</span>    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;1) Adding a new record&quot;</span><span class="p">)</span>
<span class="linenos"> 95</span>    <span class="n">author</span> <span class="o">=</span> <span class="k">await</span> <span class="n">create_author</span><span class="p">()</span>
<span class="linenos"> 96</span>    <span class="n">author_id</span> <span class="o">=</span> <span class="n">author</span><span class="o">.</span><span class="n">id</span>
<span class="linenos"> 97</span>
<span class="linenos"> 98</span>    <span class="c1"># 2) Let&#39;s update the Author record.</span>
<span class="linenos"> 99</span>    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;2) Updating a record.&quot;</span><span class="p">)</span>
<span class="linenos">100</span>    <span class="n">author</span><span class="o">.</span><span class="n">dod</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s2">&quot;1940-12-21&quot;</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
<span class="linenos">101</span>    <span class="k">await</span> <span class="n">update_author</span><span class="p">(</span><span class="n">author</span><span class="p">)</span>
<span class="linenos">102</span>
<span class="linenos">103</span>    <span class="c1"># 3) Let&#39;s delete the record we just created.</span>
<span class="linenos">104</span>    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;3) Removing a record.&quot;</span><span class="p">)</span>
<span class="linenos">105</span>    <span class="k">await</span> <span class="n">remove_author</span><span class="p">(</span><span class="n">author_id</span><span class="p">)</span>
<span class="linenos">106</span>
<span class="linenos">107</span>    <span class="c1"># 4) Let&#39;s verify the record no longer exists.</span>
<span class="linenos">108</span>    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;4) Select one or none.&quot;</span><span class="p">)</span>
<span class="linenos">109</span>    <span class="n">_should_be_none</span> <span class="o">=</span> <span class="k">await</span> <span class="n">get_author_if_exists</span><span class="p">(</span><span class="n">author_id</span><span class="p">)</span>
<span class="linenos">110</span>
<span class="linenos">111</span>
<span class="linenos">112</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<span class="linenos">113</span>    <span class="n">anyio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">run_script</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<input checked="checked" id="sd-tab-item-3" name="sd-tab-set-1" type="radio">
</input><label class="sd-tab-label" data-sync-id="3.9" for="sd-tab-item-3">
Python 3.9+</label><div class="sd-tab-content docutils">
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">app.py</span><a class="headerlink" href="#id4" title="Permalink to this code">#</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
<span class="linenos">  2</span>
<span class="linenos">  3</span><span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">asynccontextmanager</span>
<span class="linenos">  4</span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span><span class="p">,</span> <span class="n">datetime</span>
<span class="linenos">  5</span><span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">AsyncIterator</span>
<span class="linenos">  6</span><span class="kn">from</span> <span class="nn">uuid</span> <span class="kn">import</span> <span class="n">UUID</span>
<span class="linenos">  7</span>
<span class="linenos">  8</span><span class="kn">import</span> <span class="nn">anyio</span>
<span class="linenos">  9</span><span class="kn">from</span> <span class="nn">rich</span> <span class="kn">import</span> <span class="n">get_console</span>
<span class="linenos"> 10</span><span class="kn">from</span> <span class="nn">sqlalchemy.ext.asyncio</span> <span class="kn">import</span> <span class="n">async_sessionmaker</span><span class="p">,</span> <span class="n">create_async_engine</span>
<span class="linenos"> 11</span><span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">Mapped</span>
<span class="linenos"> 12</span>
<span class="linenos"> 13</span><span class="kn">from</span> <span class="nn">litestar.contrib.sqlalchemy.base</span> <span class="kn">import</span> <span class="n">UUIDBase</span>
<span class="linenos"> 14</span><span class="kn">from</span> <span class="nn">litestar.contrib.sqlalchemy.repository</span> <span class="kn">import</span> <span class="n">SQLAlchemyAsyncRepository</span>
<span class="linenos"> 15</span>
<span class="linenos"> 16</span><span class="n">console</span> <span class="o">=</span> <span class="n">get_console</span><span class="p">()</span>
<span class="linenos"> 17</span>
<span class="linenos"> 18</span>
<span class="linenos"> 19</span><span class="c1"># the SQLAlchemy base includes a declarative model for you to use in your models.</span>
<span class="linenos"> 20</span><span class="c1"># The `Base` class includes a `UUID` based primary key (`id`)</span>
<span class="linenos"> 21</span><span class="k">class</span> <span class="nc">Author</span><span class="p">(</span><span class="n">UUIDBase</span><span class="p">):</span>
<span class="linenos"> 22</span>    <span class="n">name</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
<span class="linenos"> 23</span>    <span class="n">dob</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">date</span><span class="p">]</span>
<span class="linenos"> 24</span>    <span class="n">dod</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">date</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]</span>
<span class="linenos"> 25</span>
<span class="linenos"> 26</span>
<span class="linenos"> 27</span><span class="k">class</span> <span class="nc">AuthorRepository</span><span class="p">(</span><span class="n">SQLAlchemyAsyncRepository</span><span class="p">[</span><span class="n">Author</span><span class="p">]):</span>
<span class="linenos"> 28</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Author repository.&quot;&quot;&quot;</span>
<span class="linenos"> 29</span>
<span class="linenos"> 30</span>    <span class="n">model_type</span> <span class="o">=</span> <span class="n">Author</span>
<span class="linenos"> 31</span>
<span class="linenos"> 32</span>
<span class="linenos"> 33</span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_async_engine</span><span class="p">(</span>
<span class="linenos"> 34</span>    <span class="s2">&quot;sqlite+aiosqlite:///test.sqlite&quot;</span><span class="p">,</span>
<span class="linenos"> 35</span>    <span class="n">future</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="linenos"> 36</span><span class="p">)</span>
<span class="linenos"> 37</span><span class="n">session_factory</span> <span class="o">=</span> <span class="n">async_sessionmaker</span><span class="p">(</span><span class="n">engine</span><span class="p">,</span> <span class="n">expire_on_commit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="linenos"> 38</span>
<span class="hll"><span class="linenos"> 39</span>
</span><span class="hll"><span class="linenos"> 40</span><span class="c1"># let&#39;s make a simple context manager as an example here.</span>
</span><span class="hll"><span class="linenos"> 41</span><span class="nd">@asynccontextmanager</span>
</span><span class="hll"><span class="linenos"> 42</span><span class="k">async</span> <span class="k">def</span> <span class="nf">repository_factory</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">AuthorRepository</span><span class="p">]:</span>
</span><span class="hll"><span class="linenos"> 43</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">session_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">db_session</span><span class="p">:</span>
</span><span class="hll"><span class="linenos"> 44</span>        <span class="k">try</span><span class="p">:</span>
</span><span class="hll"><span class="linenos"> 45</span>            <span class="k">yield</span> <span class="n">AuthorRepository</span><span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="n">db_session</span><span class="p">)</span>
</span><span class="hll"><span class="linenos"> 46</span>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>  <span class="c1"># noqa: BLE001</span>
</span><span class="hll"><span class="linenos"> 47</span>            <span class="k">await</span> <span class="n">db_session</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
</span><span class="linenos"> 48</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 49</span>            <span class="k">await</span> <span class="n">db_session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="linenos"> 50</span>
<span class="linenos"> 51</span>
<span class="linenos"> 52</span><span class="k">async</span> <span class="k">def</span> <span class="nf">create_author</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Author</span><span class="p">:</span>
<span class="linenos"> 53</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">repository_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">repo</span><span class="p">:</span>
<span class="linenos"> 54</span>        <span class="n">obj</span> <span class="o">=</span> <span class="k">await</span> <span class="n">repo</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
<span class="linenos"> 55</span>            <span class="n">Author</span><span class="p">(</span>
<span class="linenos"> 56</span>                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;F. Scott Fitzgerald&quot;</span><span class="p">,</span>
<span class="linenos"> 57</span>                <span class="n">dob</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s2">&quot;1896-09-24&quot;</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">(),</span>
<span class="linenos"> 58</span>            <span class="p">)</span>
<span class="linenos"> 59</span>        <span class="p">)</span>
<span class="linenos"> 60</span>        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created Author record for </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> with primary key </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="linenos"> 61</span>        <span class="k">return</span> <span class="n">obj</span>
<span class="linenos"> 62</span>
<span class="linenos"> 63</span>
<span class="linenos"> 64</span><span class="k">async</span> <span class="k">def</span> <span class="nf">update_author</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">Author</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Author</span><span class="p">:</span>
<span class="linenos"> 65</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">repository_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">repo</span><span class="p">:</span>
<span class="linenos"> 66</span>        <span class="n">obj</span> <span class="o">=</span> <span class="k">await</span> <span class="n">repo</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="linenos"> 67</span>        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updated Author record for </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> with primary key </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="linenos"> 68</span>        <span class="k">return</span> <span class="n">obj</span>
<span class="linenos"> 69</span>
<span class="linenos"> 70</span>
<span class="linenos"> 71</span><span class="k">async</span> <span class="k">def</span> <span class="nf">remove_author</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="n">UUID</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Author</span><span class="p">:</span>
<span class="linenos"> 72</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">repository_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">repo</span><span class="p">:</span>
<span class="linenos"> 73</span>        <span class="n">obj</span> <span class="o">=</span> <span class="k">await</span> <span class="n">repo</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
<span class="linenos"> 74</span>        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Deleted Author record for </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> with primary key </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="linenos"> 75</span>        <span class="k">return</span> <span class="n">obj</span>
<span class="linenos"> 76</span>
<span class="linenos"> 77</span>
<span class="linenos"> 78</span><span class="k">async</span> <span class="k">def</span> <span class="nf">get_author_if_exists</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="n">UUID</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Author</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 79</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">repository_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">repo</span><span class="p">:</span>
<span class="linenos"> 80</span>        <span class="n">obj</span> <span class="o">=</span> <span class="k">await</span> <span class="n">repo</span><span class="o">.</span><span class="n">get_one_or_none</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span>
<span class="linenos"> 81</span>        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 82</span>            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found Author record for </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> with primary key </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="linenos"> 83</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 84</span>            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find Author with primary key </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="linenos"> 85</span>        <span class="k">return</span> <span class="n">obj</span>
<span class="linenos"> 86</span>
<span class="linenos"> 87</span>
<span class="linenos"> 88</span><span class="k">async</span> <span class="k">def</span> <span class="nf">run_script</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 89</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Load data from a fixture.&quot;&quot;&quot;</span>
<span class="linenos"> 90</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">engine</span><span class="o">.</span><span class="n">begin</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
<span class="linenos"> 91</span>        <span class="k">await</span> <span class="n">conn</span><span class="o">.</span><span class="n">run_sync</span><span class="p">(</span><span class="n">UUIDBase</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">)</span>
<span class="linenos"> 92</span>
<span class="linenos"> 93</span>    <span class="c1"># 1) create a new Author record.</span>
<span class="linenos"> 94</span>    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;1) Adding a new record&quot;</span><span class="p">)</span>
<span class="linenos"> 95</span>    <span class="n">author</span> <span class="o">=</span> <span class="k">await</span> <span class="n">create_author</span><span class="p">()</span>
<span class="linenos"> 96</span>    <span class="n">author_id</span> <span class="o">=</span> <span class="n">author</span><span class="o">.</span><span class="n">id</span>
<span class="linenos"> 97</span>
<span class="linenos"> 98</span>    <span class="c1"># 2) Let&#39;s update the Author record.</span>
<span class="linenos"> 99</span>    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;2) Updating a record.&quot;</span><span class="p">)</span>
<span class="linenos">100</span>    <span class="n">author</span><span class="o">.</span><span class="n">dod</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s2">&quot;1940-12-21&quot;</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
<span class="linenos">101</span>    <span class="k">await</span> <span class="n">update_author</span><span class="p">(</span><span class="n">author</span><span class="p">)</span>
<span class="linenos">102</span>
<span class="linenos">103</span>    <span class="c1"># 3) Let&#39;s delete the record we just created.</span>
<span class="linenos">104</span>    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;3) Removing a record.&quot;</span><span class="p">)</span>
<span class="linenos">105</span>    <span class="k">await</span> <span class="n">remove_author</span><span class="p">(</span><span class="n">author_id</span><span class="p">)</span>
<span class="linenos">106</span>
<span class="linenos">107</span>    <span class="c1"># 4) Let&#39;s verify the record no longer exists.</span>
<span class="linenos">108</span>    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;4) Select one or none.&quot;</span><span class="p">)</span>
<span class="linenos">109</span>    <span class="n">_should_be_none</span> <span class="o">=</span> <span class="k">await</span> <span class="n">get_author_if_exists</span><span class="p">(</span><span class="n">author_id</span><span class="p">)</span>
<span class="linenos">110</span>
<span class="linenos">111</span>
<span class="linenos">112</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<span class="linenos">113</span>    <span class="n">anyio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">run_script</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="creating-updating-and-removing-data">
<h2>Creating, Updating and Removing Data<a class="headerlink" href="#creating-updating-and-removing-data" title="Permalink to this heading">#</a></h2>
<p>To illustrate a few ways you can manipulate data in your database, well go through the
various CRUD operations:</p>
<p>Creating Data: Heres a simple insert operation to populate our new Author table:</p>
<blockquote>
<div><div class="sd-tab-set docutils">
<input id="sd-tab-item-4" name="sd-tab-set-2" type="radio">
</input><label class="sd-tab-label" data-sync-id="3.8" for="sd-tab-item-4">
Python 3.8+</label><div class="sd-tab-content docutils">
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">app.py</span><a class="headerlink" href="#id5" title="Permalink to this code">#</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
<span class="linenos">  2</span>
<span class="linenos">  3</span><span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">asynccontextmanager</span>
<span class="linenos">  4</span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span><span class="p">,</span> <span class="n">datetime</span>
<span class="linenos">  5</span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">AsyncIterator</span>
<span class="linenos">  6</span><span class="kn">from</span> <span class="nn">uuid</span> <span class="kn">import</span> <span class="n">UUID</span>
<span class="linenos">  7</span>
<span class="linenos">  8</span><span class="kn">import</span> <span class="nn">anyio</span>
<span class="linenos">  9</span><span class="kn">from</span> <span class="nn">rich</span> <span class="kn">import</span> <span class="n">get_console</span>
<span class="linenos"> 10</span><span class="kn">from</span> <span class="nn">sqlalchemy.ext.asyncio</span> <span class="kn">import</span> <span class="n">async_sessionmaker</span><span class="p">,</span> <span class="n">create_async_engine</span>
<span class="linenos"> 11</span><span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">Mapped</span>
<span class="linenos"> 12</span>
<span class="linenos"> 13</span><span class="kn">from</span> <span class="nn">litestar.contrib.sqlalchemy.base</span> <span class="kn">import</span> <span class="n">UUIDBase</span>
<span class="linenos"> 14</span><span class="kn">from</span> <span class="nn">litestar.contrib.sqlalchemy.repository</span> <span class="kn">import</span> <span class="n">SQLAlchemyAsyncRepository</span>
<span class="linenos"> 15</span>
<span class="linenos"> 16</span><span class="n">console</span> <span class="o">=</span> <span class="n">get_console</span><span class="p">()</span>
<span class="linenos"> 17</span>
<span class="linenos"> 18</span>
<span class="linenos"> 19</span><span class="c1"># the SQLAlchemy base includes a declarative model for you to use in your models.</span>
<span class="linenos"> 20</span><span class="c1"># The `Base` class includes a `UUID` based primary key (`id`)</span>
<span class="linenos"> 21</span><span class="k">class</span> <span class="nc">Author</span><span class="p">(</span><span class="n">UUIDBase</span><span class="p">):</span>
<span class="linenos"> 22</span>    <span class="n">name</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
<span class="linenos"> 23</span>    <span class="n">dob</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">date</span><span class="p">]</span>
<span class="linenos"> 24</span>    <span class="n">dod</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">date</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]</span>
<span class="linenos"> 25</span>
<span class="linenos"> 26</span>
<span class="linenos"> 27</span><span class="k">class</span> <span class="nc">AuthorRepository</span><span class="p">(</span><span class="n">SQLAlchemyAsyncRepository</span><span class="p">[</span><span class="n">Author</span><span class="p">]):</span>
<span class="linenos"> 28</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Author repository.&quot;&quot;&quot;</span>
<span class="linenos"> 29</span>
<span class="linenos"> 30</span>    <span class="n">model_type</span> <span class="o">=</span> <span class="n">Author</span>
<span class="linenos"> 31</span>
<span class="linenos"> 32</span>
<span class="linenos"> 33</span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_async_engine</span><span class="p">(</span>
<span class="linenos"> 34</span>    <span class="s2">&quot;sqlite+aiosqlite:///test.sqlite&quot;</span><span class="p">,</span>
<span class="linenos"> 35</span>    <span class="n">future</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="linenos"> 36</span><span class="p">)</span>
<span class="linenos"> 37</span><span class="n">session_factory</span> <span class="o">=</span> <span class="n">async_sessionmaker</span><span class="p">(</span><span class="n">engine</span><span class="p">,</span> <span class="n">expire_on_commit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="linenos"> 38</span>
<span class="linenos"> 39</span>
<span class="linenos"> 40</span><span class="c1"># let&#39;s make a simple context manager as an example here.</span>
<span class="linenos"> 41</span><span class="nd">@asynccontextmanager</span>
<span class="linenos"> 42</span><span class="k">async</span> <span class="k">def</span> <span class="nf">repository_factory</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">AuthorRepository</span><span class="p">]:</span>
<span class="linenos"> 43</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">session_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">db_session</span><span class="p">:</span>
<span class="linenos"> 44</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos"> 45</span>            <span class="k">yield</span> <span class="n">AuthorRepository</span><span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="n">db_session</span><span class="p">)</span>
<span class="linenos"> 46</span>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>  <span class="c1"># noqa: BLE001</span>
<span class="linenos"> 47</span>            <span class="k">await</span> <span class="n">db_session</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
<span class="linenos"> 48</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 49</span>            <span class="k">await</span> <span class="n">db_session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="linenos"> 50</span>
<span class="linenos"> 51</span>
<span class="hll"><span class="linenos"> 52</span><span class="k">async</span> <span class="k">def</span> <span class="nf">create_author</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Author</span><span class="p">:</span>
</span><span class="hll"><span class="linenos"> 53</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">repository_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">repo</span><span class="p">:</span>
</span><span class="hll"><span class="linenos"> 54</span>        <span class="n">obj</span> <span class="o">=</span> <span class="k">await</span> <span class="n">repo</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
</span><span class="hll"><span class="linenos"> 55</span>            <span class="n">Author</span><span class="p">(</span>
</span><span class="hll"><span class="linenos"> 56</span>                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;F. Scott Fitzgerald&quot;</span><span class="p">,</span>
</span><span class="hll"><span class="linenos"> 57</span>                <span class="n">dob</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s2">&quot;1896-09-24&quot;</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">(),</span>
</span><span class="hll"><span class="linenos"> 58</span>            <span class="p">)</span>
</span><span class="hll"><span class="linenos"> 59</span>        <span class="p">)</span>
</span><span class="hll"><span class="linenos"> 60</span>        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created Author record for </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> with primary key </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</span><span class="hll"><span class="linenos"> 61</span>        <span class="k">return</span> <span class="n">obj</span>
</span><span class="linenos"> 62</span>
<span class="linenos"> 63</span>
<span class="linenos"> 64</span><span class="k">async</span> <span class="k">def</span> <span class="nf">update_author</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">Author</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Author</span><span class="p">:</span>
<span class="linenos"> 65</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">repository_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">repo</span><span class="p">:</span>
<span class="linenos"> 66</span>        <span class="n">obj</span> <span class="o">=</span> <span class="k">await</span> <span class="n">repo</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="linenos"> 67</span>        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updated Author record for </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> with primary key </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="linenos"> 68</span>        <span class="k">return</span> <span class="n">obj</span>
<span class="linenos"> 69</span>
<span class="linenos"> 70</span>
<span class="linenos"> 71</span><span class="k">async</span> <span class="k">def</span> <span class="nf">remove_author</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="n">UUID</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Author</span><span class="p">:</span>
<span class="linenos"> 72</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">repository_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">repo</span><span class="p">:</span>
<span class="linenos"> 73</span>        <span class="n">obj</span> <span class="o">=</span> <span class="k">await</span> <span class="n">repo</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
<span class="linenos"> 74</span>        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Deleted Author record for </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> with primary key </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="linenos"> 75</span>        <span class="k">return</span> <span class="n">obj</span>
<span class="linenos"> 76</span>
<span class="linenos"> 77</span>
<span class="linenos"> 78</span><span class="k">async</span> <span class="k">def</span> <span class="nf">get_author_if_exists</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="n">UUID</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Author</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 79</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">repository_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">repo</span><span class="p">:</span>
<span class="linenos"> 80</span>        <span class="n">obj</span> <span class="o">=</span> <span class="k">await</span> <span class="n">repo</span><span class="o">.</span><span class="n">get_one_or_none</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span>
<span class="linenos"> 81</span>        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 82</span>            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found Author record for </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> with primary key </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="linenos"> 83</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 84</span>            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find Author with primary key </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="linenos"> 85</span>        <span class="k">return</span> <span class="n">obj</span>
<span class="linenos"> 86</span>
<span class="linenos"> 87</span>
<span class="linenos"> 88</span><span class="k">async</span> <span class="k">def</span> <span class="nf">run_script</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 89</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Load data from a fixture.&quot;&quot;&quot;</span>
<span class="linenos"> 90</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">engine</span><span class="o">.</span><span class="n">begin</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
<span class="linenos"> 91</span>        <span class="k">await</span> <span class="n">conn</span><span class="o">.</span><span class="n">run_sync</span><span class="p">(</span><span class="n">UUIDBase</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">)</span>
<span class="linenos"> 92</span>
<span class="linenos"> 93</span>    <span class="c1"># 1) create a new Author record.</span>
<span class="linenos"> 94</span>    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;1) Adding a new record&quot;</span><span class="p">)</span>
<span class="linenos"> 95</span>    <span class="n">author</span> <span class="o">=</span> <span class="k">await</span> <span class="n">create_author</span><span class="p">()</span>
<span class="linenos"> 96</span>    <span class="n">author_id</span> <span class="o">=</span> <span class="n">author</span><span class="o">.</span><span class="n">id</span>
<span class="linenos"> 97</span>
<span class="linenos"> 98</span>    <span class="c1"># 2) Let&#39;s update the Author record.</span>
<span class="linenos"> 99</span>    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;2) Updating a record.&quot;</span><span class="p">)</span>
<span class="linenos">100</span>    <span class="n">author</span><span class="o">.</span><span class="n">dod</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s2">&quot;1940-12-21&quot;</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
<span class="linenos">101</span>    <span class="k">await</span> <span class="n">update_author</span><span class="p">(</span><span class="n">author</span><span class="p">)</span>
<span class="linenos">102</span>
<span class="linenos">103</span>    <span class="c1"># 3) Let&#39;s delete the record we just created.</span>
<span class="linenos">104</span>    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;3) Removing a record.&quot;</span><span class="p">)</span>
<span class="linenos">105</span>    <span class="k">await</span> <span class="n">remove_author</span><span class="p">(</span><span class="n">author_id</span><span class="p">)</span>
<span class="linenos">106</span>
<span class="linenos">107</span>    <span class="c1"># 4) Let&#39;s verify the record no longer exists.</span>
<span class="linenos">108</span>    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;4) Select one or none.&quot;</span><span class="p">)</span>
<span class="linenos">109</span>    <span class="n">_should_be_none</span> <span class="o">=</span> <span class="k">await</span> <span class="n">get_author_if_exists</span><span class="p">(</span><span class="n">author_id</span><span class="p">)</span>
<span class="linenos">110</span>
<span class="linenos">111</span>
<span class="linenos">112</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<span class="linenos">113</span>    <span class="n">anyio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">run_script</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<input checked="checked" id="sd-tab-item-5" name="sd-tab-set-2" type="radio">
</input><label class="sd-tab-label" data-sync-id="3.9" for="sd-tab-item-5">
Python 3.9+</label><div class="sd-tab-content docutils">
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text">app.py</span><a class="headerlink" href="#id6" title="Permalink to this code">#</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
<span class="linenos">  2</span>
<span class="linenos">  3</span><span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">asynccontextmanager</span>
<span class="linenos">  4</span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span><span class="p">,</span> <span class="n">datetime</span>
<span class="linenos">  5</span><span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">AsyncIterator</span>
<span class="linenos">  6</span><span class="kn">from</span> <span class="nn">uuid</span> <span class="kn">import</span> <span class="n">UUID</span>
<span class="linenos">  7</span>
<span class="linenos">  8</span><span class="kn">import</span> <span class="nn">anyio</span>
<span class="linenos">  9</span><span class="kn">from</span> <span class="nn">rich</span> <span class="kn">import</span> <span class="n">get_console</span>
<span class="linenos"> 10</span><span class="kn">from</span> <span class="nn">sqlalchemy.ext.asyncio</span> <span class="kn">import</span> <span class="n">async_sessionmaker</span><span class="p">,</span> <span class="n">create_async_engine</span>
<span class="linenos"> 11</span><span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">Mapped</span>
<span class="linenos"> 12</span>
<span class="linenos"> 13</span><span class="kn">from</span> <span class="nn">litestar.contrib.sqlalchemy.base</span> <span class="kn">import</span> <span class="n">UUIDBase</span>
<span class="linenos"> 14</span><span class="kn">from</span> <span class="nn">litestar.contrib.sqlalchemy.repository</span> <span class="kn">import</span> <span class="n">SQLAlchemyAsyncRepository</span>
<span class="linenos"> 15</span>
<span class="linenos"> 16</span><span class="n">console</span> <span class="o">=</span> <span class="n">get_console</span><span class="p">()</span>
<span class="linenos"> 17</span>
<span class="linenos"> 18</span>
<span class="linenos"> 19</span><span class="c1"># the SQLAlchemy base includes a declarative model for you to use in your models.</span>
<span class="linenos"> 20</span><span class="c1"># The `Base` class includes a `UUID` based primary key (`id`)</span>
<span class="linenos"> 21</span><span class="k">class</span> <span class="nc">Author</span><span class="p">(</span><span class="n">UUIDBase</span><span class="p">):</span>
<span class="linenos"> 22</span>    <span class="n">name</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
<span class="linenos"> 23</span>    <span class="n">dob</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">date</span><span class="p">]</span>
<span class="linenos"> 24</span>    <span class="n">dod</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">date</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]</span>
<span class="linenos"> 25</span>
<span class="linenos"> 26</span>
<span class="linenos"> 27</span><span class="k">class</span> <span class="nc">AuthorRepository</span><span class="p">(</span><span class="n">SQLAlchemyAsyncRepository</span><span class="p">[</span><span class="n">Author</span><span class="p">]):</span>
<span class="linenos"> 28</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Author repository.&quot;&quot;&quot;</span>
<span class="linenos"> 29</span>
<span class="linenos"> 30</span>    <span class="n">model_type</span> <span class="o">=</span> <span class="n">Author</span>
<span class="linenos"> 31</span>
<span class="linenos"> 32</span>
<span class="linenos"> 33</span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_async_engine</span><span class="p">(</span>
<span class="linenos"> 34</span>    <span class="s2">&quot;sqlite+aiosqlite:///test.sqlite&quot;</span><span class="p">,</span>
<span class="linenos"> 35</span>    <span class="n">future</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="linenos"> 36</span><span class="p">)</span>
<span class="linenos"> 37</span><span class="n">session_factory</span> <span class="o">=</span> <span class="n">async_sessionmaker</span><span class="p">(</span><span class="n">engine</span><span class="p">,</span> <span class="n">expire_on_commit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="linenos"> 38</span>
<span class="linenos"> 39</span>
<span class="linenos"> 40</span><span class="c1"># let&#39;s make a simple context manager as an example here.</span>
<span class="linenos"> 41</span><span class="nd">@asynccontextmanager</span>
<span class="linenos"> 42</span><span class="k">async</span> <span class="k">def</span> <span class="nf">repository_factory</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">AuthorRepository</span><span class="p">]:</span>
<span class="linenos"> 43</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">session_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">db_session</span><span class="p">:</span>
<span class="linenos"> 44</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos"> 45</span>            <span class="k">yield</span> <span class="n">AuthorRepository</span><span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="n">db_session</span><span class="p">)</span>
<span class="linenos"> 46</span>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>  <span class="c1"># noqa: BLE001</span>
<span class="linenos"> 47</span>            <span class="k">await</span> <span class="n">db_session</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
<span class="linenos"> 48</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 49</span>            <span class="k">await</span> <span class="n">db_session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="linenos"> 50</span>
<span class="linenos"> 51</span>
<span class="hll"><span class="linenos"> 52</span><span class="k">async</span> <span class="k">def</span> <span class="nf">create_author</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Author</span><span class="p">:</span>
</span><span class="hll"><span class="linenos"> 53</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">repository_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">repo</span><span class="p">:</span>
</span><span class="hll"><span class="linenos"> 54</span>        <span class="n">obj</span> <span class="o">=</span> <span class="k">await</span> <span class="n">repo</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
</span><span class="hll"><span class="linenos"> 55</span>            <span class="n">Author</span><span class="p">(</span>
</span><span class="hll"><span class="linenos"> 56</span>                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;F. Scott Fitzgerald&quot;</span><span class="p">,</span>
</span><span class="hll"><span class="linenos"> 57</span>                <span class="n">dob</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s2">&quot;1896-09-24&quot;</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">(),</span>
</span><span class="hll"><span class="linenos"> 58</span>            <span class="p">)</span>
</span><span class="hll"><span class="linenos"> 59</span>        <span class="p">)</span>
</span><span class="hll"><span class="linenos"> 60</span>        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created Author record for </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> with primary key </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</span><span class="hll"><span class="linenos"> 61</span>        <span class="k">return</span> <span class="n">obj</span>
</span><span class="linenos"> 62</span>
<span class="linenos"> 63</span>
<span class="linenos"> 64</span><span class="k">async</span> <span class="k">def</span> <span class="nf">update_author</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">Author</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Author</span><span class="p">:</span>
<span class="linenos"> 65</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">repository_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">repo</span><span class="p">:</span>
<span class="linenos"> 66</span>        <span class="n">obj</span> <span class="o">=</span> <span class="k">await</span> <span class="n">repo</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="linenos"> 67</span>        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updated Author record for </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> with primary key </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="linenos"> 68</span>        <span class="k">return</span> <span class="n">obj</span>
<span class="linenos"> 69</span>
<span class="linenos"> 70</span>
<span class="linenos"> 71</span><span class="k">async</span> <span class="k">def</span> <span class="nf">remove_author</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="n">UUID</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Author</span><span class="p">:</span>
<span class="linenos"> 72</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">repository_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">repo</span><span class="p">:</span>
<span class="linenos"> 73</span>        <span class="n">obj</span> <span class="o">=</span> <span class="k">await</span> <span class="n">repo</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
<span class="linenos"> 74</span>        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Deleted Author record for </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> with primary key </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="linenos"> 75</span>        <span class="k">return</span> <span class="n">obj</span>
<span class="linenos"> 76</span>
<span class="linenos"> 77</span>
<span class="linenos"> 78</span><span class="k">async</span> <span class="k">def</span> <span class="nf">get_author_if_exists</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="n">UUID</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Author</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 79</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">repository_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">repo</span><span class="p">:</span>
<span class="linenos"> 80</span>        <span class="n">obj</span> <span class="o">=</span> <span class="k">await</span> <span class="n">repo</span><span class="o">.</span><span class="n">get_one_or_none</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span>
<span class="linenos"> 81</span>        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 82</span>            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found Author record for </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> with primary key </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="linenos"> 83</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 84</span>            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find Author with primary key </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="linenos"> 85</span>        <span class="k">return</span> <span class="n">obj</span>
<span class="linenos"> 86</span>
<span class="linenos"> 87</span>
<span class="linenos"> 88</span><span class="k">async</span> <span class="k">def</span> <span class="nf">run_script</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 89</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Load data from a fixture.&quot;&quot;&quot;</span>
<span class="linenos"> 90</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">engine</span><span class="o">.</span><span class="n">begin</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
<span class="linenos"> 91</span>        <span class="k">await</span> <span class="n">conn</span><span class="o">.</span><span class="n">run_sync</span><span class="p">(</span><span class="n">UUIDBase</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">)</span>
<span class="linenos"> 92</span>
<span class="linenos"> 93</span>    <span class="c1"># 1) create a new Author record.</span>
<span class="linenos"> 94</span>    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;1) Adding a new record&quot;</span><span class="p">)</span>
<span class="linenos"> 95</span>    <span class="n">author</span> <span class="o">=</span> <span class="k">await</span> <span class="n">create_author</span><span class="p">()</span>
<span class="linenos"> 96</span>    <span class="n">author_id</span> <span class="o">=</span> <span class="n">author</span><span class="o">.</span><span class="n">id</span>
<span class="linenos"> 97</span>
<span class="linenos"> 98</span>    <span class="c1"># 2) Let&#39;s update the Author record.</span>
<span class="linenos"> 99</span>    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;2) Updating a record.&quot;</span><span class="p">)</span>
<span class="linenos">100</span>    <span class="n">author</span><span class="o">.</span><span class="n">dod</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s2">&quot;1940-12-21&quot;</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
<span class="linenos">101</span>    <span class="k">await</span> <span class="n">update_author</span><span class="p">(</span><span class="n">author</span><span class="p">)</span>
<span class="linenos">102</span>
<span class="linenos">103</span>    <span class="c1"># 3) Let&#39;s delete the record we just created.</span>
<span class="linenos">104</span>    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;3) Removing a record.&quot;</span><span class="p">)</span>
<span class="linenos">105</span>    <span class="k">await</span> <span class="n">remove_author</span><span class="p">(</span><span class="n">author_id</span><span class="p">)</span>
<span class="linenos">106</span>
<span class="linenos">107</span>    <span class="c1"># 4) Let&#39;s verify the record no longer exists.</span>
<span class="linenos">108</span>    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;4) Select one or none.&quot;</span><span class="p">)</span>
<span class="linenos">109</span>    <span class="n">_should_be_none</span> <span class="o">=</span> <span class="k">await</span> <span class="n">get_author_if_exists</span><span class="p">(</span><span class="n">author_id</span><span class="p">)</span>
<span class="linenos">110</span>
<span class="linenos">111</span>
<span class="linenos">112</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<span class="linenos">113</span>    <span class="n">anyio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">run_script</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div></blockquote>
<p>Updating Data: The <code class="docutils literal notranslate"><span class="pre">update</span></code> method will ensure any updates made to the model object are executed on the database:</p>
<blockquote>
<div><div class="sd-tab-set docutils">
<input id="sd-tab-item-6" name="sd-tab-set-3" type="radio">
</input><label class="sd-tab-label" data-sync-id="3.8" for="sd-tab-item-6">
Python 3.8+</label><div class="sd-tab-content docutils">
<div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-text">app.py</span><a class="headerlink" href="#id7" title="Permalink to this code">#</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
<span class="linenos">  2</span>
<span class="linenos">  3</span><span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">asynccontextmanager</span>
<span class="linenos">  4</span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span><span class="p">,</span> <span class="n">datetime</span>
<span class="linenos">  5</span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">AsyncIterator</span>
<span class="linenos">  6</span><span class="kn">from</span> <span class="nn">uuid</span> <span class="kn">import</span> <span class="n">UUID</span>
<span class="linenos">  7</span>
<span class="linenos">  8</span><span class="kn">import</span> <span class="nn">anyio</span>
<span class="linenos">  9</span><span class="kn">from</span> <span class="nn">rich</span> <span class="kn">import</span> <span class="n">get_console</span>
<span class="linenos"> 10</span><span class="kn">from</span> <span class="nn">sqlalchemy.ext.asyncio</span> <span class="kn">import</span> <span class="n">async_sessionmaker</span><span class="p">,</span> <span class="n">create_async_engine</span>
<span class="linenos"> 11</span><span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">Mapped</span>
<span class="linenos"> 12</span>
<span class="linenos"> 13</span><span class="kn">from</span> <span class="nn">litestar.contrib.sqlalchemy.base</span> <span class="kn">import</span> <span class="n">UUIDBase</span>
<span class="linenos"> 14</span><span class="kn">from</span> <span class="nn">litestar.contrib.sqlalchemy.repository</span> <span class="kn">import</span> <span class="n">SQLAlchemyAsyncRepository</span>
<span class="linenos"> 15</span>
<span class="linenos"> 16</span><span class="n">console</span> <span class="o">=</span> <span class="n">get_console</span><span class="p">()</span>
<span class="linenos"> 17</span>
<span class="linenos"> 18</span>
<span class="linenos"> 19</span><span class="c1"># the SQLAlchemy base includes a declarative model for you to use in your models.</span>
<span class="linenos"> 20</span><span class="c1"># The `Base` class includes a `UUID` based primary key (`id`)</span>
<span class="linenos"> 21</span><span class="k">class</span> <span class="nc">Author</span><span class="p">(</span><span class="n">UUIDBase</span><span class="p">):</span>
<span class="linenos"> 22</span>    <span class="n">name</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
<span class="linenos"> 23</span>    <span class="n">dob</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">date</span><span class="p">]</span>
<span class="linenos"> 24</span>    <span class="n">dod</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">date</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]</span>
<span class="linenos"> 25</span>
<span class="linenos"> 26</span>
<span class="linenos"> 27</span><span class="k">class</span> <span class="nc">AuthorRepository</span><span class="p">(</span><span class="n">SQLAlchemyAsyncRepository</span><span class="p">[</span><span class="n">Author</span><span class="p">]):</span>
<span class="linenos"> 28</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Author repository.&quot;&quot;&quot;</span>
<span class="linenos"> 29</span>
<span class="linenos"> 30</span>    <span class="n">model_type</span> <span class="o">=</span> <span class="n">Author</span>
<span class="linenos"> 31</span>
<span class="linenos"> 32</span>
<span class="linenos"> 33</span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_async_engine</span><span class="p">(</span>
<span class="linenos"> 34</span>    <span class="s2">&quot;sqlite+aiosqlite:///test.sqlite&quot;</span><span class="p">,</span>
<span class="linenos"> 35</span>    <span class="n">future</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="linenos"> 36</span><span class="p">)</span>
<span class="linenos"> 37</span><span class="n">session_factory</span> <span class="o">=</span> <span class="n">async_sessionmaker</span><span class="p">(</span><span class="n">engine</span><span class="p">,</span> <span class="n">expire_on_commit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="linenos"> 38</span>
<span class="linenos"> 39</span>
<span class="linenos"> 40</span><span class="c1"># let&#39;s make a simple context manager as an example here.</span>
<span class="linenos"> 41</span><span class="nd">@asynccontextmanager</span>
<span class="linenos"> 42</span><span class="k">async</span> <span class="k">def</span> <span class="nf">repository_factory</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">AuthorRepository</span><span class="p">]:</span>
<span class="linenos"> 43</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">session_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">db_session</span><span class="p">:</span>
<span class="linenos"> 44</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos"> 45</span>            <span class="k">yield</span> <span class="n">AuthorRepository</span><span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="n">db_session</span><span class="p">)</span>
<span class="linenos"> 46</span>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>  <span class="c1"># noqa: BLE001</span>
<span class="linenos"> 47</span>            <span class="k">await</span> <span class="n">db_session</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
<span class="linenos"> 48</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 49</span>            <span class="k">await</span> <span class="n">db_session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="linenos"> 50</span>
<span class="linenos"> 51</span>
<span class="linenos"> 52</span><span class="k">async</span> <span class="k">def</span> <span class="nf">create_author</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Author</span><span class="p">:</span>
<span class="linenos"> 53</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">repository_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">repo</span><span class="p">:</span>
<span class="linenos"> 54</span>        <span class="n">obj</span> <span class="o">=</span> <span class="k">await</span> <span class="n">repo</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
<span class="linenos"> 55</span>            <span class="n">Author</span><span class="p">(</span>
<span class="linenos"> 56</span>                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;F. Scott Fitzgerald&quot;</span><span class="p">,</span>
<span class="linenos"> 57</span>                <span class="n">dob</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s2">&quot;1896-09-24&quot;</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">(),</span>
<span class="linenos"> 58</span>            <span class="p">)</span>
<span class="linenos"> 59</span>        <span class="p">)</span>
<span class="linenos"> 60</span>        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created Author record for </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> with primary key </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="linenos"> 61</span>        <span class="k">return</span> <span class="n">obj</span>
<span class="linenos"> 62</span>
<span class="linenos"> 63</span>
<span class="hll"><span class="linenos"> 64</span><span class="k">async</span> <span class="k">def</span> <span class="nf">update_author</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">Author</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Author</span><span class="p">:</span>
</span><span class="hll"><span class="linenos"> 65</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">repository_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">repo</span><span class="p">:</span>
</span><span class="hll"><span class="linenos"> 66</span>        <span class="n">obj</span> <span class="o">=</span> <span class="k">await</span> <span class="n">repo</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</span><span class="hll"><span class="linenos"> 67</span>        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updated Author record for </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> with primary key </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</span><span class="hll"><span class="linenos"> 68</span>        <span class="k">return</span> <span class="n">obj</span>
</span><span class="linenos"> 69</span>
<span class="linenos"> 70</span>
<span class="linenos"> 71</span><span class="k">async</span> <span class="k">def</span> <span class="nf">remove_author</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="n">UUID</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Author</span><span class="p">:</span>
<span class="linenos"> 72</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">repository_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">repo</span><span class="p">:</span>
<span class="linenos"> 73</span>        <span class="n">obj</span> <span class="o">=</span> <span class="k">await</span> <span class="n">repo</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
<span class="linenos"> 74</span>        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Deleted Author record for </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> with primary key </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="linenos"> 75</span>        <span class="k">return</span> <span class="n">obj</span>
<span class="linenos"> 76</span>
<span class="linenos"> 77</span>
<span class="linenos"> 78</span><span class="k">async</span> <span class="k">def</span> <span class="nf">get_author_if_exists</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="n">UUID</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Author</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 79</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">repository_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">repo</span><span class="p">:</span>
<span class="linenos"> 80</span>        <span class="n">obj</span> <span class="o">=</span> <span class="k">await</span> <span class="n">repo</span><span class="o">.</span><span class="n">get_one_or_none</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span>
<span class="linenos"> 81</span>        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 82</span>            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found Author record for </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> with primary key </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="linenos"> 83</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 84</span>            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find Author with primary key </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="linenos"> 85</span>        <span class="k">return</span> <span class="n">obj</span>
<span class="linenos"> 86</span>
<span class="linenos"> 87</span>
<span class="linenos"> 88</span><span class="k">async</span> <span class="k">def</span> <span class="nf">run_script</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 89</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Load data from a fixture.&quot;&quot;&quot;</span>
<span class="linenos"> 90</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">engine</span><span class="o">.</span><span class="n">begin</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
<span class="linenos"> 91</span>        <span class="k">await</span> <span class="n">conn</span><span class="o">.</span><span class="n">run_sync</span><span class="p">(</span><span class="n">UUIDBase</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">)</span>
<span class="linenos"> 92</span>
<span class="linenos"> 93</span>    <span class="c1"># 1) create a new Author record.</span>
<span class="linenos"> 94</span>    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;1) Adding a new record&quot;</span><span class="p">)</span>
<span class="linenos"> 95</span>    <span class="n">author</span> <span class="o">=</span> <span class="k">await</span> <span class="n">create_author</span><span class="p">()</span>
<span class="linenos"> 96</span>    <span class="n">author_id</span> <span class="o">=</span> <span class="n">author</span><span class="o">.</span><span class="n">id</span>
<span class="linenos"> 97</span>
<span class="linenos"> 98</span>    <span class="c1"># 2) Let&#39;s update the Author record.</span>
<span class="linenos"> 99</span>    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;2) Updating a record.&quot;</span><span class="p">)</span>
<span class="linenos">100</span>    <span class="n">author</span><span class="o">.</span><span class="n">dod</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s2">&quot;1940-12-21&quot;</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
<span class="linenos">101</span>    <span class="k">await</span> <span class="n">update_author</span><span class="p">(</span><span class="n">author</span><span class="p">)</span>
<span class="linenos">102</span>
<span class="linenos">103</span>    <span class="c1"># 3) Let&#39;s delete the record we just created.</span>
<span class="linenos">104</span>    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;3) Removing a record.&quot;</span><span class="p">)</span>
<span class="linenos">105</span>    <span class="k">await</span> <span class="n">remove_author</span><span class="p">(</span><span class="n">author_id</span><span class="p">)</span>
<span class="linenos">106</span>
<span class="linenos">107</span>    <span class="c1"># 4) Let&#39;s verify the record no longer exists.</span>
<span class="linenos">108</span>    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;4) Select one or none.&quot;</span><span class="p">)</span>
<span class="linenos">109</span>    <span class="n">_should_be_none</span> <span class="o">=</span> <span class="k">await</span> <span class="n">get_author_if_exists</span><span class="p">(</span><span class="n">author_id</span><span class="p">)</span>
<span class="linenos">110</span>
<span class="linenos">111</span>
<span class="linenos">112</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<span class="linenos">113</span>    <span class="n">anyio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">run_script</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<input checked="checked" id="sd-tab-item-7" name="sd-tab-set-3" type="radio">
</input><label class="sd-tab-label" data-sync-id="3.9" for="sd-tab-item-7">
Python 3.9+</label><div class="sd-tab-content docutils">
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-text">app.py</span><a class="headerlink" href="#id8" title="Permalink to this code">#</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
<span class="linenos">  2</span>
<span class="linenos">  3</span><span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">asynccontextmanager</span>
<span class="linenos">  4</span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span><span class="p">,</span> <span class="n">datetime</span>
<span class="linenos">  5</span><span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">AsyncIterator</span>
<span class="linenos">  6</span><span class="kn">from</span> <span class="nn">uuid</span> <span class="kn">import</span> <span class="n">UUID</span>
<span class="linenos">  7</span>
<span class="linenos">  8</span><span class="kn">import</span> <span class="nn">anyio</span>
<span class="linenos">  9</span><span class="kn">from</span> <span class="nn">rich</span> <span class="kn">import</span> <span class="n">get_console</span>
<span class="linenos"> 10</span><span class="kn">from</span> <span class="nn">sqlalchemy.ext.asyncio</span> <span class="kn">import</span> <span class="n">async_sessionmaker</span><span class="p">,</span> <span class="n">create_async_engine</span>
<span class="linenos"> 11</span><span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">Mapped</span>
<span class="linenos"> 12</span>
<span class="linenos"> 13</span><span class="kn">from</span> <span class="nn">litestar.contrib.sqlalchemy.base</span> <span class="kn">import</span> <span class="n">UUIDBase</span>
<span class="linenos"> 14</span><span class="kn">from</span> <span class="nn">litestar.contrib.sqlalchemy.repository</span> <span class="kn">import</span> <span class="n">SQLAlchemyAsyncRepository</span>
<span class="linenos"> 15</span>
<span class="linenos"> 16</span><span class="n">console</span> <span class="o">=</span> <span class="n">get_console</span><span class="p">()</span>
<span class="linenos"> 17</span>
<span class="linenos"> 18</span>
<span class="linenos"> 19</span><span class="c1"># the SQLAlchemy base includes a declarative model for you to use in your models.</span>
<span class="linenos"> 20</span><span class="c1"># The `Base` class includes a `UUID` based primary key (`id`)</span>
<span class="linenos"> 21</span><span class="k">class</span> <span class="nc">Author</span><span class="p">(</span><span class="n">UUIDBase</span><span class="p">):</span>
<span class="linenos"> 22</span>    <span class="n">name</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
<span class="linenos"> 23</span>    <span class="n">dob</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">date</span><span class="p">]</span>
<span class="linenos"> 24</span>    <span class="n">dod</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">date</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]</span>
<span class="linenos"> 25</span>
<span class="linenos"> 26</span>
<span class="linenos"> 27</span><span class="k">class</span> <span class="nc">AuthorRepository</span><span class="p">(</span><span class="n">SQLAlchemyAsyncRepository</span><span class="p">[</span><span class="n">Author</span><span class="p">]):</span>
<span class="linenos"> 28</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Author repository.&quot;&quot;&quot;</span>
<span class="linenos"> 29</span>
<span class="linenos"> 30</span>    <span class="n">model_type</span> <span class="o">=</span> <span class="n">Author</span>
<span class="linenos"> 31</span>
<span class="linenos"> 32</span>
<span class="linenos"> 33</span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_async_engine</span><span class="p">(</span>
<span class="linenos"> 34</span>    <span class="s2">&quot;sqlite+aiosqlite:///test.sqlite&quot;</span><span class="p">,</span>
<span class="linenos"> 35</span>    <span class="n">future</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="linenos"> 36</span><span class="p">)</span>
<span class="linenos"> 37</span><span class="n">session_factory</span> <span class="o">=</span> <span class="n">async_sessionmaker</span><span class="p">(</span><span class="n">engine</span><span class="p">,</span> <span class="n">expire_on_commit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="linenos"> 38</span>
<span class="linenos"> 39</span>
<span class="linenos"> 40</span><span class="c1"># let&#39;s make a simple context manager as an example here.</span>
<span class="linenos"> 41</span><span class="nd">@asynccontextmanager</span>
<span class="linenos"> 42</span><span class="k">async</span> <span class="k">def</span> <span class="nf">repository_factory</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">AuthorRepository</span><span class="p">]:</span>
<span class="linenos"> 43</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">session_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">db_session</span><span class="p">:</span>
<span class="linenos"> 44</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos"> 45</span>            <span class="k">yield</span> <span class="n">AuthorRepository</span><span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="n">db_session</span><span class="p">)</span>
<span class="linenos"> 46</span>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>  <span class="c1"># noqa: BLE001</span>
<span class="linenos"> 47</span>            <span class="k">await</span> <span class="n">db_session</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
<span class="linenos"> 48</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 49</span>            <span class="k">await</span> <span class="n">db_session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="linenos"> 50</span>
<span class="linenos"> 51</span>
<span class="linenos"> 52</span><span class="k">async</span> <span class="k">def</span> <span class="nf">create_author</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Author</span><span class="p">:</span>
<span class="linenos"> 53</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">repository_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">repo</span><span class="p">:</span>
<span class="linenos"> 54</span>        <span class="n">obj</span> <span class="o">=</span> <span class="k">await</span> <span class="n">repo</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
<span class="linenos"> 55</span>            <span class="n">Author</span><span class="p">(</span>
<span class="linenos"> 56</span>                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;F. Scott Fitzgerald&quot;</span><span class="p">,</span>
<span class="linenos"> 57</span>                <span class="n">dob</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s2">&quot;1896-09-24&quot;</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">(),</span>
<span class="linenos"> 58</span>            <span class="p">)</span>
<span class="linenos"> 59</span>        <span class="p">)</span>
<span class="linenos"> 60</span>        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created Author record for </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> with primary key </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="linenos"> 61</span>        <span class="k">return</span> <span class="n">obj</span>
<span class="linenos"> 62</span>
<span class="linenos"> 63</span>
<span class="hll"><span class="linenos"> 64</span><span class="k">async</span> <span class="k">def</span> <span class="nf">update_author</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">Author</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Author</span><span class="p">:</span>
</span><span class="hll"><span class="linenos"> 65</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">repository_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">repo</span><span class="p">:</span>
</span><span class="hll"><span class="linenos"> 66</span>        <span class="n">obj</span> <span class="o">=</span> <span class="k">await</span> <span class="n">repo</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</span><span class="hll"><span class="linenos"> 67</span>        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updated Author record for </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> with primary key </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</span><span class="hll"><span class="linenos"> 68</span>        <span class="k">return</span> <span class="n">obj</span>
</span><span class="linenos"> 69</span>
<span class="linenos"> 70</span>
<span class="linenos"> 71</span><span class="k">async</span> <span class="k">def</span> <span class="nf">remove_author</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="n">UUID</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Author</span><span class="p">:</span>
<span class="linenos"> 72</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">repository_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">repo</span><span class="p">:</span>
<span class="linenos"> 73</span>        <span class="n">obj</span> <span class="o">=</span> <span class="k">await</span> <span class="n">repo</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
<span class="linenos"> 74</span>        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Deleted Author record for </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> with primary key </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="linenos"> 75</span>        <span class="k">return</span> <span class="n">obj</span>
<span class="linenos"> 76</span>
<span class="linenos"> 77</span>
<span class="linenos"> 78</span><span class="k">async</span> <span class="k">def</span> <span class="nf">get_author_if_exists</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="n">UUID</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Author</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 79</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">repository_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">repo</span><span class="p">:</span>
<span class="linenos"> 80</span>        <span class="n">obj</span> <span class="o">=</span> <span class="k">await</span> <span class="n">repo</span><span class="o">.</span><span class="n">get_one_or_none</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span>
<span class="linenos"> 81</span>        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 82</span>            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found Author record for </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> with primary key </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="linenos"> 83</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 84</span>            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find Author with primary key </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="linenos"> 85</span>        <span class="k">return</span> <span class="n">obj</span>
<span class="linenos"> 86</span>
<span class="linenos"> 87</span>
<span class="linenos"> 88</span><span class="k">async</span> <span class="k">def</span> <span class="nf">run_script</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 89</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Load data from a fixture.&quot;&quot;&quot;</span>
<span class="linenos"> 90</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">engine</span><span class="o">.</span><span class="n">begin</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
<span class="linenos"> 91</span>        <span class="k">await</span> <span class="n">conn</span><span class="o">.</span><span class="n">run_sync</span><span class="p">(</span><span class="n">UUIDBase</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">)</span>
<span class="linenos"> 92</span>
<span class="linenos"> 93</span>    <span class="c1"># 1) create a new Author record.</span>
<span class="linenos"> 94</span>    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;1) Adding a new record&quot;</span><span class="p">)</span>
<span class="linenos"> 95</span>    <span class="n">author</span> <span class="o">=</span> <span class="k">await</span> <span class="n">create_author</span><span class="p">()</span>
<span class="linenos"> 96</span>    <span class="n">author_id</span> <span class="o">=</span> <span class="n">author</span><span class="o">.</span><span class="n">id</span>
<span class="linenos"> 97</span>
<span class="linenos"> 98</span>    <span class="c1"># 2) Let&#39;s update the Author record.</span>
<span class="linenos"> 99</span>    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;2) Updating a record.&quot;</span><span class="p">)</span>
<span class="linenos">100</span>    <span class="n">author</span><span class="o">.</span><span class="n">dod</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s2">&quot;1940-12-21&quot;</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
<span class="linenos">101</span>    <span class="k">await</span> <span class="n">update_author</span><span class="p">(</span><span class="n">author</span><span class="p">)</span>
<span class="linenos">102</span>
<span class="linenos">103</span>    <span class="c1"># 3) Let&#39;s delete the record we just created.</span>
<span class="linenos">104</span>    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;3) Removing a record.&quot;</span><span class="p">)</span>
<span class="linenos">105</span>    <span class="k">await</span> <span class="n">remove_author</span><span class="p">(</span><span class="n">author_id</span><span class="p">)</span>
<span class="linenos">106</span>
<span class="linenos">107</span>    <span class="c1"># 4) Let&#39;s verify the record no longer exists.</span>
<span class="linenos">108</span>    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;4) Select one or none.&quot;</span><span class="p">)</span>
<span class="linenos">109</span>    <span class="n">_should_be_none</span> <span class="o">=</span> <span class="k">await</span> <span class="n">get_author_if_exists</span><span class="p">(</span><span class="n">author_id</span><span class="p">)</span>
<span class="linenos">110</span>
<span class="linenos">111</span>
<span class="linenos">112</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<span class="linenos">113</span>    <span class="n">anyio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">run_script</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div></blockquote>
<p>Removing Data: The <code class="docutils literal notranslate"><span class="pre">remove</span></code> method accepts the primary key of the row you want to delete:</p>
<blockquote>
<div><div class="sd-tab-set docutils">
<input id="sd-tab-item-8" name="sd-tab-set-4" type="radio">
</input><label class="sd-tab-label" data-sync-id="3.8" for="sd-tab-item-8">
Python 3.8+</label><div class="sd-tab-content docutils">
<div class="literal-block-wrapper docutils container" id="id9">
<div class="code-block-caption"><span class="caption-text">app.py</span><a class="headerlink" href="#id9" title="Permalink to this code">#</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
<span class="linenos">  2</span>
<span class="linenos">  3</span><span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">asynccontextmanager</span>
<span class="linenos">  4</span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span><span class="p">,</span> <span class="n">datetime</span>
<span class="linenos">  5</span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">AsyncIterator</span>
<span class="linenos">  6</span><span class="kn">from</span> <span class="nn">uuid</span> <span class="kn">import</span> <span class="n">UUID</span>
<span class="linenos">  7</span>
<span class="linenos">  8</span><span class="kn">import</span> <span class="nn">anyio</span>
<span class="linenos">  9</span><span class="kn">from</span> <span class="nn">rich</span> <span class="kn">import</span> <span class="n">get_console</span>
<span class="linenos"> 10</span><span class="kn">from</span> <span class="nn">sqlalchemy.ext.asyncio</span> <span class="kn">import</span> <span class="n">async_sessionmaker</span><span class="p">,</span> <span class="n">create_async_engine</span>
<span class="linenos"> 11</span><span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">Mapped</span>
<span class="linenos"> 12</span>
<span class="linenos"> 13</span><span class="kn">from</span> <span class="nn">litestar.contrib.sqlalchemy.base</span> <span class="kn">import</span> <span class="n">UUIDBase</span>
<span class="linenos"> 14</span><span class="kn">from</span> <span class="nn">litestar.contrib.sqlalchemy.repository</span> <span class="kn">import</span> <span class="n">SQLAlchemyAsyncRepository</span>
<span class="linenos"> 15</span>
<span class="linenos"> 16</span><span class="n">console</span> <span class="o">=</span> <span class="n">get_console</span><span class="p">()</span>
<span class="linenos"> 17</span>
<span class="linenos"> 18</span>
<span class="linenos"> 19</span><span class="c1"># the SQLAlchemy base includes a declarative model for you to use in your models.</span>
<span class="linenos"> 20</span><span class="c1"># The `Base` class includes a `UUID` based primary key (`id`)</span>
<span class="linenos"> 21</span><span class="k">class</span> <span class="nc">Author</span><span class="p">(</span><span class="n">UUIDBase</span><span class="p">):</span>
<span class="linenos"> 22</span>    <span class="n">name</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
<span class="linenos"> 23</span>    <span class="n">dob</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">date</span><span class="p">]</span>
<span class="linenos"> 24</span>    <span class="n">dod</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">date</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]</span>
<span class="linenos"> 25</span>
<span class="linenos"> 26</span>
<span class="linenos"> 27</span><span class="k">class</span> <span class="nc">AuthorRepository</span><span class="p">(</span><span class="n">SQLAlchemyAsyncRepository</span><span class="p">[</span><span class="n">Author</span><span class="p">]):</span>
<span class="linenos"> 28</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Author repository.&quot;&quot;&quot;</span>
<span class="linenos"> 29</span>
<span class="linenos"> 30</span>    <span class="n">model_type</span> <span class="o">=</span> <span class="n">Author</span>
<span class="linenos"> 31</span>
<span class="linenos"> 32</span>
<span class="linenos"> 33</span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_async_engine</span><span class="p">(</span>
<span class="linenos"> 34</span>    <span class="s2">&quot;sqlite+aiosqlite:///test.sqlite&quot;</span><span class="p">,</span>
<span class="linenos"> 35</span>    <span class="n">future</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="linenos"> 36</span><span class="p">)</span>
<span class="linenos"> 37</span><span class="n">session_factory</span> <span class="o">=</span> <span class="n">async_sessionmaker</span><span class="p">(</span><span class="n">engine</span><span class="p">,</span> <span class="n">expire_on_commit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="linenos"> 38</span>
<span class="linenos"> 39</span>
<span class="linenos"> 40</span><span class="c1"># let&#39;s make a simple context manager as an example here.</span>
<span class="linenos"> 41</span><span class="nd">@asynccontextmanager</span>
<span class="linenos"> 42</span><span class="k">async</span> <span class="k">def</span> <span class="nf">repository_factory</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">AuthorRepository</span><span class="p">]:</span>
<span class="linenos"> 43</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">session_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">db_session</span><span class="p">:</span>
<span class="linenos"> 44</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos"> 45</span>            <span class="k">yield</span> <span class="n">AuthorRepository</span><span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="n">db_session</span><span class="p">)</span>
<span class="linenos"> 46</span>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>  <span class="c1"># noqa: BLE001</span>
<span class="linenos"> 47</span>            <span class="k">await</span> <span class="n">db_session</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
<span class="linenos"> 48</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 49</span>            <span class="k">await</span> <span class="n">db_session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="linenos"> 50</span>
<span class="linenos"> 51</span>
<span class="linenos"> 52</span><span class="k">async</span> <span class="k">def</span> <span class="nf">create_author</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Author</span><span class="p">:</span>
<span class="linenos"> 53</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">repository_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">repo</span><span class="p">:</span>
<span class="linenos"> 54</span>        <span class="n">obj</span> <span class="o">=</span> <span class="k">await</span> <span class="n">repo</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
<span class="linenos"> 55</span>            <span class="n">Author</span><span class="p">(</span>
<span class="linenos"> 56</span>                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;F. Scott Fitzgerald&quot;</span><span class="p">,</span>
<span class="linenos"> 57</span>                <span class="n">dob</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s2">&quot;1896-09-24&quot;</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">(),</span>
<span class="linenos"> 58</span>            <span class="p">)</span>
<span class="linenos"> 59</span>        <span class="p">)</span>
<span class="linenos"> 60</span>        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created Author record for </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> with primary key </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="linenos"> 61</span>        <span class="k">return</span> <span class="n">obj</span>
<span class="linenos"> 62</span>
<span class="linenos"> 63</span>
<span class="linenos"> 64</span><span class="k">async</span> <span class="k">def</span> <span class="nf">update_author</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">Author</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Author</span><span class="p">:</span>
<span class="linenos"> 65</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">repository_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">repo</span><span class="p">:</span>
<span class="linenos"> 66</span>        <span class="n">obj</span> <span class="o">=</span> <span class="k">await</span> <span class="n">repo</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="linenos"> 67</span>        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updated Author record for </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> with primary key </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="linenos"> 68</span>        <span class="k">return</span> <span class="n">obj</span>
<span class="linenos"> 69</span>
<span class="linenos"> 70</span>
<span class="hll"><span class="linenos"> 71</span><span class="k">async</span> <span class="k">def</span> <span class="nf">remove_author</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="n">UUID</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Author</span><span class="p">:</span>
</span><span class="hll"><span class="linenos"> 72</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">repository_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">repo</span><span class="p">:</span>
</span><span class="hll"><span class="linenos"> 73</span>        <span class="n">obj</span> <span class="o">=</span> <span class="k">await</span> <span class="n">repo</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
</span><span class="hll"><span class="linenos"> 74</span>        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Deleted Author record for </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> with primary key </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</span><span class="hll"><span class="linenos"> 75</span>        <span class="k">return</span> <span class="n">obj</span>
</span><span class="linenos"> 76</span>
<span class="linenos"> 77</span>
<span class="linenos"> 78</span><span class="k">async</span> <span class="k">def</span> <span class="nf">get_author_if_exists</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="n">UUID</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Author</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 79</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">repository_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">repo</span><span class="p">:</span>
<span class="linenos"> 80</span>        <span class="n">obj</span> <span class="o">=</span> <span class="k">await</span> <span class="n">repo</span><span class="o">.</span><span class="n">get_one_or_none</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span>
<span class="linenos"> 81</span>        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 82</span>            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found Author record for </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> with primary key </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="linenos"> 83</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 84</span>            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find Author with primary key </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="linenos"> 85</span>        <span class="k">return</span> <span class="n">obj</span>
<span class="linenos"> 86</span>
<span class="linenos"> 87</span>
<span class="linenos"> 88</span><span class="k">async</span> <span class="k">def</span> <span class="nf">run_script</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 89</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Load data from a fixture.&quot;&quot;&quot;</span>
<span class="linenos"> 90</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">engine</span><span class="o">.</span><span class="n">begin</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
<span class="linenos"> 91</span>        <span class="k">await</span> <span class="n">conn</span><span class="o">.</span><span class="n">run_sync</span><span class="p">(</span><span class="n">UUIDBase</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">)</span>
<span class="linenos"> 92</span>
<span class="linenos"> 93</span>    <span class="c1"># 1) create a new Author record.</span>
<span class="linenos"> 94</span>    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;1) Adding a new record&quot;</span><span class="p">)</span>
<span class="linenos"> 95</span>    <span class="n">author</span> <span class="o">=</span> <span class="k">await</span> <span class="n">create_author</span><span class="p">()</span>
<span class="linenos"> 96</span>    <span class="n">author_id</span> <span class="o">=</span> <span class="n">author</span><span class="o">.</span><span class="n">id</span>
<span class="linenos"> 97</span>
<span class="linenos"> 98</span>    <span class="c1"># 2) Let&#39;s update the Author record.</span>
<span class="linenos"> 99</span>    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;2) Updating a record.&quot;</span><span class="p">)</span>
<span class="linenos">100</span>    <span class="n">author</span><span class="o">.</span><span class="n">dod</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s2">&quot;1940-12-21&quot;</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
<span class="linenos">101</span>    <span class="k">await</span> <span class="n">update_author</span><span class="p">(</span><span class="n">author</span><span class="p">)</span>
<span class="linenos">102</span>
<span class="linenos">103</span>    <span class="c1"># 3) Let&#39;s delete the record we just created.</span>
<span class="linenos">104</span>    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;3) Removing a record.&quot;</span><span class="p">)</span>
<span class="linenos">105</span>    <span class="k">await</span> <span class="n">remove_author</span><span class="p">(</span><span class="n">author_id</span><span class="p">)</span>
<span class="linenos">106</span>
<span class="linenos">107</span>    <span class="c1"># 4) Let&#39;s verify the record no longer exists.</span>
<span class="linenos">108</span>    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;4) Select one or none.&quot;</span><span class="p">)</span>
<span class="linenos">109</span>    <span class="n">_should_be_none</span> <span class="o">=</span> <span class="k">await</span> <span class="n">get_author_if_exists</span><span class="p">(</span><span class="n">author_id</span><span class="p">)</span>
<span class="linenos">110</span>
<span class="linenos">111</span>
<span class="linenos">112</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<span class="linenos">113</span>    <span class="n">anyio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">run_script</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<input checked="checked" id="sd-tab-item-9" name="sd-tab-set-4" type="radio">
</input><label class="sd-tab-label" data-sync-id="3.9" for="sd-tab-item-9">
Python 3.9+</label><div class="sd-tab-content docutils">
<div class="literal-block-wrapper docutils container" id="id10">
<div class="code-block-caption"><span class="caption-text">app.py</span><a class="headerlink" href="#id10" title="Permalink to this code">#</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
<span class="linenos">  2</span>
<span class="linenos">  3</span><span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">asynccontextmanager</span>
<span class="linenos">  4</span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span><span class="p">,</span> <span class="n">datetime</span>
<span class="linenos">  5</span><span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">AsyncIterator</span>
<span class="linenos">  6</span><span class="kn">from</span> <span class="nn">uuid</span> <span class="kn">import</span> <span class="n">UUID</span>
<span class="linenos">  7</span>
<span class="linenos">  8</span><span class="kn">import</span> <span class="nn">anyio</span>
<span class="linenos">  9</span><span class="kn">from</span> <span class="nn">rich</span> <span class="kn">import</span> <span class="n">get_console</span>
<span class="linenos"> 10</span><span class="kn">from</span> <span class="nn">sqlalchemy.ext.asyncio</span> <span class="kn">import</span> <span class="n">async_sessionmaker</span><span class="p">,</span> <span class="n">create_async_engine</span>
<span class="linenos"> 11</span><span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">Mapped</span>
<span class="linenos"> 12</span>
<span class="linenos"> 13</span><span class="kn">from</span> <span class="nn">litestar.contrib.sqlalchemy.base</span> <span class="kn">import</span> <span class="n">UUIDBase</span>
<span class="linenos"> 14</span><span class="kn">from</span> <span class="nn">litestar.contrib.sqlalchemy.repository</span> <span class="kn">import</span> <span class="n">SQLAlchemyAsyncRepository</span>
<span class="linenos"> 15</span>
<span class="linenos"> 16</span><span class="n">console</span> <span class="o">=</span> <span class="n">get_console</span><span class="p">()</span>
<span class="linenos"> 17</span>
<span class="linenos"> 18</span>
<span class="linenos"> 19</span><span class="c1"># the SQLAlchemy base includes a declarative model for you to use in your models.</span>
<span class="linenos"> 20</span><span class="c1"># The `Base` class includes a `UUID` based primary key (`id`)</span>
<span class="linenos"> 21</span><span class="k">class</span> <span class="nc">Author</span><span class="p">(</span><span class="n">UUIDBase</span><span class="p">):</span>
<span class="linenos"> 22</span>    <span class="n">name</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
<span class="linenos"> 23</span>    <span class="n">dob</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">date</span><span class="p">]</span>
<span class="linenos"> 24</span>    <span class="n">dod</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">date</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]</span>
<span class="linenos"> 25</span>
<span class="linenos"> 26</span>
<span class="linenos"> 27</span><span class="k">class</span> <span class="nc">AuthorRepository</span><span class="p">(</span><span class="n">SQLAlchemyAsyncRepository</span><span class="p">[</span><span class="n">Author</span><span class="p">]):</span>
<span class="linenos"> 28</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Author repository.&quot;&quot;&quot;</span>
<span class="linenos"> 29</span>
<span class="linenos"> 30</span>    <span class="n">model_type</span> <span class="o">=</span> <span class="n">Author</span>
<span class="linenos"> 31</span>
<span class="linenos"> 32</span>
<span class="linenos"> 33</span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_async_engine</span><span class="p">(</span>
<span class="linenos"> 34</span>    <span class="s2">&quot;sqlite+aiosqlite:///test.sqlite&quot;</span><span class="p">,</span>
<span class="linenos"> 35</span>    <span class="n">future</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="linenos"> 36</span><span class="p">)</span>
<span class="linenos"> 37</span><span class="n">session_factory</span> <span class="o">=</span> <span class="n">async_sessionmaker</span><span class="p">(</span><span class="n">engine</span><span class="p">,</span> <span class="n">expire_on_commit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="linenos"> 38</span>
<span class="linenos"> 39</span>
<span class="linenos"> 40</span><span class="c1"># let&#39;s make a simple context manager as an example here.</span>
<span class="linenos"> 41</span><span class="nd">@asynccontextmanager</span>
<span class="linenos"> 42</span><span class="k">async</span> <span class="k">def</span> <span class="nf">repository_factory</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">AuthorRepository</span><span class="p">]:</span>
<span class="linenos"> 43</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">session_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">db_session</span><span class="p">:</span>
<span class="linenos"> 44</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos"> 45</span>            <span class="k">yield</span> <span class="n">AuthorRepository</span><span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="n">db_session</span><span class="p">)</span>
<span class="linenos"> 46</span>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>  <span class="c1"># noqa: BLE001</span>
<span class="linenos"> 47</span>            <span class="k">await</span> <span class="n">db_session</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
<span class="linenos"> 48</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 49</span>            <span class="k">await</span> <span class="n">db_session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="linenos"> 50</span>
<span class="linenos"> 51</span>
<span class="linenos"> 52</span><span class="k">async</span> <span class="k">def</span> <span class="nf">create_author</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Author</span><span class="p">:</span>
<span class="linenos"> 53</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">repository_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">repo</span><span class="p">:</span>
<span class="linenos"> 54</span>        <span class="n">obj</span> <span class="o">=</span> <span class="k">await</span> <span class="n">repo</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
<span class="linenos"> 55</span>            <span class="n">Author</span><span class="p">(</span>
<span class="linenos"> 56</span>                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;F. Scott Fitzgerald&quot;</span><span class="p">,</span>
<span class="linenos"> 57</span>                <span class="n">dob</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s2">&quot;1896-09-24&quot;</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">(),</span>
<span class="linenos"> 58</span>            <span class="p">)</span>
<span class="linenos"> 59</span>        <span class="p">)</span>
<span class="linenos"> 60</span>        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created Author record for </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> with primary key </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="linenos"> 61</span>        <span class="k">return</span> <span class="n">obj</span>
<span class="linenos"> 62</span>
<span class="linenos"> 63</span>
<span class="linenos"> 64</span><span class="k">async</span> <span class="k">def</span> <span class="nf">update_author</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">Author</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Author</span><span class="p">:</span>
<span class="linenos"> 65</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">repository_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">repo</span><span class="p">:</span>
<span class="linenos"> 66</span>        <span class="n">obj</span> <span class="o">=</span> <span class="k">await</span> <span class="n">repo</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="linenos"> 67</span>        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updated Author record for </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> with primary key </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="linenos"> 68</span>        <span class="k">return</span> <span class="n">obj</span>
<span class="linenos"> 69</span>
<span class="linenos"> 70</span>
<span class="hll"><span class="linenos"> 71</span><span class="k">async</span> <span class="k">def</span> <span class="nf">remove_author</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="n">UUID</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Author</span><span class="p">:</span>
</span><span class="hll"><span class="linenos"> 72</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">repository_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">repo</span><span class="p">:</span>
</span><span class="hll"><span class="linenos"> 73</span>        <span class="n">obj</span> <span class="o">=</span> <span class="k">await</span> <span class="n">repo</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
</span><span class="hll"><span class="linenos"> 74</span>        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Deleted Author record for </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> with primary key </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</span><span class="hll"><span class="linenos"> 75</span>        <span class="k">return</span> <span class="n">obj</span>
</span><span class="linenos"> 76</span>
<span class="linenos"> 77</span>
<span class="linenos"> 78</span><span class="k">async</span> <span class="k">def</span> <span class="nf">get_author_if_exists</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="n">UUID</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Author</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 79</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">repository_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">repo</span><span class="p">:</span>
<span class="linenos"> 80</span>        <span class="n">obj</span> <span class="o">=</span> <span class="k">await</span> <span class="n">repo</span><span class="o">.</span><span class="n">get_one_or_none</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span>
<span class="linenos"> 81</span>        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 82</span>            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found Author record for </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> with primary key </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="linenos"> 83</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 84</span>            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find Author with primary key </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="linenos"> 85</span>        <span class="k">return</span> <span class="n">obj</span>
<span class="linenos"> 86</span>
<span class="linenos"> 87</span>
<span class="linenos"> 88</span><span class="k">async</span> <span class="k">def</span> <span class="nf">run_script</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 89</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Load data from a fixture.&quot;&quot;&quot;</span>
<span class="linenos"> 90</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">engine</span><span class="o">.</span><span class="n">begin</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
<span class="linenos"> 91</span>        <span class="k">await</span> <span class="n">conn</span><span class="o">.</span><span class="n">run_sync</span><span class="p">(</span><span class="n">UUIDBase</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">)</span>
<span class="linenos"> 92</span>
<span class="linenos"> 93</span>    <span class="c1"># 1) create a new Author record.</span>
<span class="linenos"> 94</span>    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;1) Adding a new record&quot;</span><span class="p">)</span>
<span class="linenos"> 95</span>    <span class="n">author</span> <span class="o">=</span> <span class="k">await</span> <span class="n">create_author</span><span class="p">()</span>
<span class="linenos"> 96</span>    <span class="n">author_id</span> <span class="o">=</span> <span class="n">author</span><span class="o">.</span><span class="n">id</span>
<span class="linenos"> 97</span>
<span class="linenos"> 98</span>    <span class="c1"># 2) Let&#39;s update the Author record.</span>
<span class="linenos"> 99</span>    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;2) Updating a record.&quot;</span><span class="p">)</span>
<span class="linenos">100</span>    <span class="n">author</span><span class="o">.</span><span class="n">dod</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s2">&quot;1940-12-21&quot;</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
<span class="linenos">101</span>    <span class="k">await</span> <span class="n">update_author</span><span class="p">(</span><span class="n">author</span><span class="p">)</span>
<span class="linenos">102</span>
<span class="linenos">103</span>    <span class="c1"># 3) Let&#39;s delete the record we just created.</span>
<span class="linenos">104</span>    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;3) Removing a record.&quot;</span><span class="p">)</span>
<span class="linenos">105</span>    <span class="k">await</span> <span class="n">remove_author</span><span class="p">(</span><span class="n">author_id</span><span class="p">)</span>
<span class="linenos">106</span>
<span class="linenos">107</span>    <span class="c1"># 4) Let&#39;s verify the record no longer exists.</span>
<span class="linenos">108</span>    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;4) Select one or none.&quot;</span><span class="p">)</span>
<span class="linenos">109</span>    <span class="n">_should_be_none</span> <span class="o">=</span> <span class="k">await</span> <span class="n">get_author_if_exists</span><span class="p">(</span><span class="n">author_id</span><span class="p">)</span>
<span class="linenos">110</span>
<span class="linenos">111</span>
<span class="linenos">112</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<span class="linenos">113</span>    <span class="n">anyio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">run_script</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div></blockquote>
<p>Now that weve seen how to do single-row operations, lets look at the bulk methods we
can use.</p>
</section>
</section>
<section id="working-with-bulk-data-operations">
<h1>Working with Bulk Data Operations<a class="headerlink" href="#working-with-bulk-data-operations" title="Permalink to this heading">#</a></h1>
<p>In this section, we delve into the powerful capabilities of the repository classes for
handling bulk data operations. Our example illustrates how we can efficiently manage
data in our database. Specifically, well use a JSON file containing information about
US states and their abbreviations.</p>
<p>Heres what were going to cover:</p>
<section id="fixture-data-loading">
<h2>Fixture Data Loading<a class="headerlink" href="#fixture-data-loading" title="Permalink to this heading">#</a></h2>
<p>We will introduce a method for loading fixture data. Fixture data is sample data that
populates your database and helps test the behavior of your application under realistic
conditions. This pattern can be extended and adjusted to meet your needs.</p>
<div class="literal-block-wrapper docutils container" id="id11">
<div class="code-block-caption"><span class="caption-text">app.py</span><a class="headerlink" href="#id11" title="Permalink to this code">#</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">import</span> <span class="nn">json</span>
<span class="linenos"> 2</span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="linenos"> 3</span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="kn">from</span> <span class="nn">rich</span> <span class="kn">import</span> <span class="n">get_console</span>
<span class="linenos"> 6</span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>
<span class="linenos"> 7</span><span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">Mapped</span><span class="p">,</span> <span class="n">Session</span><span class="p">,</span> <span class="n">sessionmaker</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="kn">from</span> <span class="nn">litestar.contrib.sqlalchemy.base</span> <span class="kn">import</span> <span class="n">UUIDBase</span>
<span class="linenos">10</span><span class="kn">from</span> <span class="nn">litestar.contrib.sqlalchemy.repository</span> <span class="kn">import</span> <span class="n">SQLAlchemySyncRepository</span>
<span class="linenos">11</span><span class="kn">from</span> <span class="nn">litestar.repository.filters</span> <span class="kn">import</span> <span class="n">LimitOffset</span>
<span class="linenos">12</span>
<span class="linenos">13</span><span class="n">here</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span>
<span class="linenos">14</span><span class="n">console</span> <span class="o">=</span> <span class="n">get_console</span><span class="p">()</span>
<span class="linenos">15</span>
<span class="linenos">16</span>
<span class="linenos">17</span><span class="k">class</span> <span class="nc">USState</span><span class="p">(</span><span class="n">UUIDBase</span><span class="p">):</span>
<span class="linenos">18</span>    <span class="c1"># you can optionally override the generated table name by manually setting it.</span>
<span class="linenos">19</span>    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;us_state_lookup&quot;</span>  <span class="c1"># type: ignore[assignment]</span>
<span class="linenos">20</span>    <span class="n">abbreviation</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
<span class="linenos">21</span>    <span class="n">name</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
<span class="linenos">22</span>
<span class="linenos">23</span>
<span class="linenos">24</span><span class="k">class</span> <span class="nc">USStateRepository</span><span class="p">(</span><span class="n">SQLAlchemySyncRepository</span><span class="p">[</span><span class="n">USState</span><span class="p">]):</span>
<span class="linenos">25</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;US State repository.&quot;&quot;&quot;</span>
<span class="linenos">26</span>
<span class="linenos">27</span>    <span class="n">model_type</span> <span class="o">=</span> <span class="n">USState</span>
<span class="linenos">28</span>
<span class="linenos">29</span>
<span class="linenos">30</span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span>
<span class="linenos">31</span>    <span class="s2">&quot;duckdb:///:memory:&quot;</span><span class="p">,</span>
<span class="linenos">32</span>    <span class="n">future</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="linenos">33</span><span class="p">)</span>
<span class="linenos">34</span><span class="n">session_factory</span><span class="p">:</span> <span class="n">sessionmaker</span><span class="p">[</span><span class="n">Session</span><span class="p">]</span> <span class="o">=</span> <span class="n">sessionmaker</span><span class="p">(</span><span class="n">engine</span><span class="p">,</span> <span class="n">expire_on_commit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="linenos">35</span>
<span class="linenos">36</span>
<span class="hll"><span class="linenos">37</span><span class="k">def</span> <span class="nf">open_fixture</span><span class="p">(</span><span class="n">fixtures_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">fixture_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span class="hll"><span class="linenos">38</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Loads JSON file with the specified fixture name</span>
</span><span class="hll"><span class="linenos">39</span>
</span><span class="hll"><span class="linenos">40</span><span class="sd">    Args:</span>
</span><span class="hll"><span class="linenos">41</span><span class="sd">        fixtures_path (Path): The path to look for fixtures</span>
</span><span class="hll"><span class="linenos">42</span><span class="sd">        fixture_name (str): The fixture name to load.</span>
</span><span class="hll"><span class="linenos">43</span>
</span><span class="hll"><span class="linenos">44</span><span class="sd">    Raises:</span>
</span><span class="hll"><span class="linenos">45</span><span class="sd">        FileNotFoundError: Fixtures not found.</span>
</span><span class="hll"><span class="linenos">46</span>
</span><span class="hll"><span class="linenos">47</span><span class="sd">    Returns:</span>
</span><span class="hll"><span class="linenos">48</span><span class="sd">        Any: The parsed JSON data</span>
</span><span class="hll"><span class="linenos">49</span><span class="sd">    &quot;&quot;&quot;</span>
</span><span class="hll"><span class="linenos">50</span>    <span class="n">fixture</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">fixtures_path</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fixture_name</span><span class="si">}</span><span class="s2">.json&quot;</span><span class="p">)</span>
</span><span class="hll"><span class="linenos">51</span>    <span class="k">if</span> <span class="n">fixture</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span class="hll"><span class="linenos">52</span>        <span class="k">with</span> <span class="n">fixture</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span class="hll"><span class="linenos">53</span>            <span class="n">f_data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span class="hll"><span class="linenos">54</span>        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">f_data</span><span class="p">)</span>
</span><span class="hll"><span class="linenos">55</span>    <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find the </span><span class="si">{</span><span class="n">fixture_name</span><span class="si">}</span><span class="s2"> fixture&quot;</span><span class="p">)</span>
</span><span class="linenos">56</span>
<span class="linenos">57</span>
<span class="linenos">58</span><span class="k">def</span> <span class="nf">run_script</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">59</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Load data from a fixture.&quot;&quot;&quot;</span>
<span class="linenos">60</span>
<span class="linenos">61</span>    <span class="c1"># Initializes the database.</span>
<span class="linenos">62</span>    <span class="k">with</span> <span class="n">engine</span><span class="o">.</span><span class="n">begin</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
<span class="linenos">63</span>        <span class="n">USState</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span>
<span class="linenos">64</span>
<span class="linenos">65</span>    <span class="k">with</span> <span class="n">session_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">db_session</span><span class="p">:</span>
<span class="linenos">66</span>        <span class="c1"># 1) Load the JSON data into the US States table.</span>
<span class="linenos">67</span>        <span class="n">repo</span> <span class="o">=</span> <span class="n">USStateRepository</span><span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="n">db_session</span><span class="p">)</span>
<span class="linenos">68</span>        <span class="n">fixture</span> <span class="o">=</span> <span class="n">open_fixture</span><span class="p">(</span><span class="n">here</span><span class="p">,</span> <span class="n">USStateRepository</span><span class="o">.</span><span class="n">model_type</span><span class="o">.</span><span class="n">__tablename__</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
<span class="linenos">69</span>        <span class="n">objs</span> <span class="o">=</span> <span class="n">repo</span><span class="o">.</span><span class="n">add_many</span><span class="p">([</span><span class="n">USStateRepository</span><span class="o">.</span><span class="n">model_type</span><span class="p">(</span><span class="o">**</span><span class="n">raw_obj</span><span class="p">)</span> <span class="k">for</span> <span class="n">raw_obj</span> <span class="ow">in</span> <span class="n">fixture</span><span class="p">])</span>
<span class="linenos">70</span>        <span class="n">db_session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="linenos">71</span>        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">objs</span><span class="p">)</span><span class="si">}</span><span class="s2"> new objects.&quot;</span><span class="p">)</span>
<span class="linenos">72</span>
<span class="linenos">73</span>        <span class="c1"># 2) Select paginated data and total row count.</span>
<span class="linenos">74</span>        <span class="n">created_objs</span><span class="p">,</span> <span class="n">total_objs</span> <span class="o">=</span> <span class="n">repo</span><span class="o">.</span><span class="n">list_and_count</span><span class="p">(</span><span class="n">LimitOffset</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
<span class="linenos">75</span>        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Selected </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">created_objs</span><span class="p">)</span><span class="si">}</span><span class="s2"> records out of a total of </span><span class="si">{</span><span class="n">total_objs</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="linenos">76</span>
<span class="linenos">77</span>        <span class="c1"># 3) Let&#39;s remove the batch of records selected.</span>
<span class="linenos">78</span>        <span class="n">deleted_objs</span> <span class="o">=</span> <span class="n">repo</span><span class="o">.</span><span class="n">delete_many</span><span class="p">([</span><span class="n">new_obj</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">new_obj</span> <span class="ow">in</span> <span class="n">created_objs</span><span class="p">])</span>
<span class="linenos">79</span>        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removed </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">deleted_objs</span><span class="p">)</span><span class="si">}</span><span class="s2"> records out of a total of </span><span class="si">{</span><span class="n">total_objs</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="linenos">80</span>
<span class="linenos">81</span>        <span class="c1"># 4) Let&#39;s count the remaining rows</span>
<span class="linenos">82</span>        <span class="n">remaining_count</span> <span class="o">=</span> <span class="n">repo</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="linenos">83</span>        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="n">remaining_count</span><span class="si">}</span><span class="s2"> remaining records after delete.&quot;</span><span class="p">)</span>
<span class="linenos">84</span>
<span class="linenos">85</span>
<span class="linenos">86</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<span class="linenos">87</span>    <span class="n">run_script</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>You can review the JSON source file here:</p>
<div class="literal-block-wrapper docutils container" id="id12">
<div class="code-block-caption"><span class="caption-text">us_state_lookup.json</span><a class="headerlink" href="#id12" title="Permalink to this code">#</a></div>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Alabama&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AL&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Alaska&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AK&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Arizona&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AZ&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Arkansas&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AR&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;California&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;CA&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Colorado&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;CO&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Connecticut&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;CT&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Delaware&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;DE&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;District Of Columbia&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;DC&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Florida&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;FL&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Georgia&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GA&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Guam&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GU&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Hawaii&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;HI&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Idaho&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ID&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Illinois&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;IL&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Indiana&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;IN&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Iowa&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;IA&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Kansas&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;KS&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Kentucky&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;KY&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Louisiana&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;LA&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Maine&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ME&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Maryland&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;MD&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Massachusetts&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;MA&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Michigan&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;MI&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Minnesota&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;MN&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Mississippi&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;MS&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Missouri&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;MO&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Montana&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;MT&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Nebraska&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;NE&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Nevada&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;NV&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;New Hampshire&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;NH&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;New Jersey&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;NJ&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;New Mexico&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;NM&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;New York&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;NY&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;North Carolina&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;NC&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;North Dakota&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ND&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Ohio&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;OH&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Oklahoma&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;OK&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Oregon&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;OR&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Palau&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;PW&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Pennsylvania&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;PA&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Puerto Rico&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;PR&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Rhode Island&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;RI&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;South Carolina&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;SC&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;South Dakota&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;SD&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Tennessee&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;TN&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Texas&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;TX&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Utah&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;UT&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Vermont&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;VT&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Virginia&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;VA&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Washington&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;WA&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;West Virginia&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;WV&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Wisconsin&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;WI&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Wyoming&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;abbreviation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;WY&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</section>
<section id="bulk-insert">
<h2>Bulk Insert<a class="headerlink" href="#bulk-insert" title="Permalink to this heading">#</a></h2>
<p>Well use our fixture data to demonstrate a bulk insert operation. This operation allows
you to add multiple records to your database in a single transaction, improving
performance when working with larger data sets.</p>
<div class="literal-block-wrapper docutils container" id="id13">
<div class="code-block-caption"><span class="caption-text">app.py</span><a class="headerlink" href="#id13" title="Permalink to this code">#</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">import</span> <span class="nn">json</span>
<span class="linenos"> 2</span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="linenos"> 3</span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="kn">from</span> <span class="nn">rich</span> <span class="kn">import</span> <span class="n">get_console</span>
<span class="linenos"> 6</span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>
<span class="linenos"> 7</span><span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">Mapped</span><span class="p">,</span> <span class="n">Session</span><span class="p">,</span> <span class="n">sessionmaker</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="kn">from</span> <span class="nn">litestar.contrib.sqlalchemy.base</span> <span class="kn">import</span> <span class="n">UUIDBase</span>
<span class="linenos">10</span><span class="kn">from</span> <span class="nn">litestar.contrib.sqlalchemy.repository</span> <span class="kn">import</span> <span class="n">SQLAlchemySyncRepository</span>
<span class="linenos">11</span><span class="kn">from</span> <span class="nn">litestar.repository.filters</span> <span class="kn">import</span> <span class="n">LimitOffset</span>
<span class="linenos">12</span>
<span class="linenos">13</span><span class="n">here</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span>
<span class="linenos">14</span><span class="n">console</span> <span class="o">=</span> <span class="n">get_console</span><span class="p">()</span>
<span class="linenos">15</span>
<span class="linenos">16</span>
<span class="linenos">17</span><span class="k">class</span> <span class="nc">USState</span><span class="p">(</span><span class="n">UUIDBase</span><span class="p">):</span>
<span class="linenos">18</span>    <span class="c1"># you can optionally override the generated table name by manually setting it.</span>
<span class="linenos">19</span>    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;us_state_lookup&quot;</span>  <span class="c1"># type: ignore[assignment]</span>
<span class="linenos">20</span>    <span class="n">abbreviation</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
<span class="linenos">21</span>    <span class="n">name</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
<span class="linenos">22</span>
<span class="linenos">23</span>
<span class="linenos">24</span><span class="k">class</span> <span class="nc">USStateRepository</span><span class="p">(</span><span class="n">SQLAlchemySyncRepository</span><span class="p">[</span><span class="n">USState</span><span class="p">]):</span>
<span class="linenos">25</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;US State repository.&quot;&quot;&quot;</span>
<span class="linenos">26</span>
<span class="linenos">27</span>    <span class="n">model_type</span> <span class="o">=</span> <span class="n">USState</span>
<span class="linenos">28</span>
<span class="linenos">29</span>
<span class="linenos">30</span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span>
<span class="linenos">31</span>    <span class="s2">&quot;duckdb:///:memory:&quot;</span><span class="p">,</span>
<span class="linenos">32</span>    <span class="n">future</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="linenos">33</span><span class="p">)</span>
<span class="linenos">34</span><span class="n">session_factory</span><span class="p">:</span> <span class="n">sessionmaker</span><span class="p">[</span><span class="n">Session</span><span class="p">]</span> <span class="o">=</span> <span class="n">sessionmaker</span><span class="p">(</span><span class="n">engine</span><span class="p">,</span> <span class="n">expire_on_commit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="linenos">35</span>
<span class="linenos">36</span>
<span class="linenos">37</span><span class="k">def</span> <span class="nf">open_fixture</span><span class="p">(</span><span class="n">fixtures_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">fixture_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="linenos">38</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Loads JSON file with the specified fixture name</span>
<span class="linenos">39</span>
<span class="linenos">40</span><span class="sd">    Args:</span>
<span class="linenos">41</span><span class="sd">        fixtures_path (Path): The path to look for fixtures</span>
<span class="linenos">42</span><span class="sd">        fixture_name (str): The fixture name to load.</span>
<span class="linenos">43</span>
<span class="linenos">44</span><span class="sd">    Raises:</span>
<span class="linenos">45</span><span class="sd">        FileNotFoundError: Fixtures not found.</span>
<span class="linenos">46</span>
<span class="linenos">47</span><span class="sd">    Returns:</span>
<span class="linenos">48</span><span class="sd">        Any: The parsed JSON data</span>
<span class="linenos">49</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos">50</span>    <span class="n">fixture</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">fixtures_path</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fixture_name</span><span class="si">}</span><span class="s2">.json&quot;</span><span class="p">)</span>
<span class="linenos">51</span>    <span class="k">if</span> <span class="n">fixture</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
<span class="linenos">52</span>        <span class="k">with</span> <span class="n">fixture</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="linenos">53</span>            <span class="n">f_data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="linenos">54</span>        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">f_data</span><span class="p">)</span>
<span class="linenos">55</span>    <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find the </span><span class="si">{</span><span class="n">fixture_name</span><span class="si">}</span><span class="s2"> fixture&quot;</span><span class="p">)</span>
<span class="linenos">56</span>
<span class="linenos">57</span>
<span class="linenos">58</span><span class="k">def</span> <span class="nf">run_script</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">59</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Load data from a fixture.&quot;&quot;&quot;</span>
<span class="linenos">60</span>
<span class="linenos">61</span>    <span class="c1"># Initializes the database.</span>
<span class="linenos">62</span>    <span class="k">with</span> <span class="n">engine</span><span class="o">.</span><span class="n">begin</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
<span class="linenos">63</span>        <span class="n">USState</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span>
<span class="linenos">64</span>
<span class="linenos">65</span>    <span class="k">with</span> <span class="n">session_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">db_session</span><span class="p">:</span>
<span class="hll"><span class="linenos">66</span>        <span class="c1"># 1) Load the JSON data into the US States table.</span>
</span><span class="hll"><span class="linenos">67</span>        <span class="n">repo</span> <span class="o">=</span> <span class="n">USStateRepository</span><span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="n">db_session</span><span class="p">)</span>
</span><span class="hll"><span class="linenos">68</span>        <span class="n">fixture</span> <span class="o">=</span> <span class="n">open_fixture</span><span class="p">(</span><span class="n">here</span><span class="p">,</span> <span class="n">USStateRepository</span><span class="o">.</span><span class="n">model_type</span><span class="o">.</span><span class="n">__tablename__</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span class="hll"><span class="linenos">69</span>        <span class="n">objs</span> <span class="o">=</span> <span class="n">repo</span><span class="o">.</span><span class="n">add_many</span><span class="p">([</span><span class="n">USStateRepository</span><span class="o">.</span><span class="n">model_type</span><span class="p">(</span><span class="o">**</span><span class="n">raw_obj</span><span class="p">)</span> <span class="k">for</span> <span class="n">raw_obj</span> <span class="ow">in</span> <span class="n">fixture</span><span class="p">])</span>
</span><span class="hll"><span class="linenos">70</span>        <span class="n">db_session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span><span class="hll"><span class="linenos">71</span>        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">objs</span><span class="p">)</span><span class="si">}</span><span class="s2"> new objects.&quot;</span><span class="p">)</span>
</span><span class="linenos">72</span>
<span class="linenos">73</span>        <span class="c1"># 2) Select paginated data and total row count.</span>
<span class="linenos">74</span>        <span class="n">created_objs</span><span class="p">,</span> <span class="n">total_objs</span> <span class="o">=</span> <span class="n">repo</span><span class="o">.</span><span class="n">list_and_count</span><span class="p">(</span><span class="n">LimitOffset</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
<span class="linenos">75</span>        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Selected </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">created_objs</span><span class="p">)</span><span class="si">}</span><span class="s2"> records out of a total of </span><span class="si">{</span><span class="n">total_objs</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="linenos">76</span>
<span class="linenos">77</span>        <span class="c1"># 3) Let&#39;s remove the batch of records selected.</span>
<span class="linenos">78</span>        <span class="n">deleted_objs</span> <span class="o">=</span> <span class="n">repo</span><span class="o">.</span><span class="n">delete_many</span><span class="p">([</span><span class="n">new_obj</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">new_obj</span> <span class="ow">in</span> <span class="n">created_objs</span><span class="p">])</span>
<span class="linenos">79</span>        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removed </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">deleted_objs</span><span class="p">)</span><span class="si">}</span><span class="s2"> records out of a total of </span><span class="si">{</span><span class="n">total_objs</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="linenos">80</span>
<span class="linenos">81</span>        <span class="c1"># 4) Let&#39;s count the remaining rows</span>
<span class="linenos">82</span>        <span class="n">remaining_count</span> <span class="o">=</span> <span class="n">repo</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="linenos">83</span>        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="n">remaining_count</span><span class="si">}</span><span class="s2"> remaining records after delete.&quot;</span><span class="p">)</span>
<span class="linenos">84</span>
<span class="linenos">85</span>
<span class="linenos">86</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<span class="linenos">87</span>    <span class="n">run_script</span><span class="p">()</span>
</pre></div>
</div>
</div>
</section>
<section id="paginated-data-selection">
<h2>Paginated Data Selection<a class="headerlink" href="#paginated-data-selection" title="Permalink to this heading">#</a></h2>
<p>Next, lets explore how to select multiple records with pagination. This functionality
is useful for handling large amounts of data by breaking the data into manageable
pages or subsets.  <code class="docutils literal notranslate"><span class="pre">LimitOffset</span></code> is one of several filter types you can use with the
repository.</p>
<div class="literal-block-wrapper docutils container" id="id14">
<div class="code-block-caption"><span class="caption-text">app.py</span><a class="headerlink" href="#id14" title="Permalink to this code">#</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">import</span> <span class="nn">json</span>
<span class="linenos"> 2</span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="linenos"> 3</span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="kn">from</span> <span class="nn">rich</span> <span class="kn">import</span> <span class="n">get_console</span>
<span class="linenos"> 6</span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>
<span class="linenos"> 7</span><span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">Mapped</span><span class="p">,</span> <span class="n">Session</span><span class="p">,</span> <span class="n">sessionmaker</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="kn">from</span> <span class="nn">litestar.contrib.sqlalchemy.base</span> <span class="kn">import</span> <span class="n">UUIDBase</span>
<span class="linenos">10</span><span class="kn">from</span> <span class="nn">litestar.contrib.sqlalchemy.repository</span> <span class="kn">import</span> <span class="n">SQLAlchemySyncRepository</span>
<span class="linenos">11</span><span class="kn">from</span> <span class="nn">litestar.repository.filters</span> <span class="kn">import</span> <span class="n">LimitOffset</span>
<span class="linenos">12</span>
<span class="linenos">13</span><span class="n">here</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span>
<span class="linenos">14</span><span class="n">console</span> <span class="o">=</span> <span class="n">get_console</span><span class="p">()</span>
<span class="linenos">15</span>
<span class="linenos">16</span>
<span class="linenos">17</span><span class="k">class</span> <span class="nc">USState</span><span class="p">(</span><span class="n">UUIDBase</span><span class="p">):</span>
<span class="linenos">18</span>    <span class="c1"># you can optionally override the generated table name by manually setting it.</span>
<span class="linenos">19</span>    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;us_state_lookup&quot;</span>  <span class="c1"># type: ignore[assignment]</span>
<span class="linenos">20</span>    <span class="n">abbreviation</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
<span class="linenos">21</span>    <span class="n">name</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
<span class="linenos">22</span>
<span class="linenos">23</span>
<span class="linenos">24</span><span class="k">class</span> <span class="nc">USStateRepository</span><span class="p">(</span><span class="n">SQLAlchemySyncRepository</span><span class="p">[</span><span class="n">USState</span><span class="p">]):</span>
<span class="linenos">25</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;US State repository.&quot;&quot;&quot;</span>
<span class="linenos">26</span>
<span class="linenos">27</span>    <span class="n">model_type</span> <span class="o">=</span> <span class="n">USState</span>
<span class="linenos">28</span>
<span class="linenos">29</span>
<span class="linenos">30</span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span>
<span class="linenos">31</span>    <span class="s2">&quot;duckdb:///:memory:&quot;</span><span class="p">,</span>
<span class="linenos">32</span>    <span class="n">future</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="linenos">33</span><span class="p">)</span>
<span class="linenos">34</span><span class="n">session_factory</span><span class="p">:</span> <span class="n">sessionmaker</span><span class="p">[</span><span class="n">Session</span><span class="p">]</span> <span class="o">=</span> <span class="n">sessionmaker</span><span class="p">(</span><span class="n">engine</span><span class="p">,</span> <span class="n">expire_on_commit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="linenos">35</span>
<span class="linenos">36</span>
<span class="linenos">37</span><span class="k">def</span> <span class="nf">open_fixture</span><span class="p">(</span><span class="n">fixtures_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">fixture_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="linenos">38</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Loads JSON file with the specified fixture name</span>
<span class="linenos">39</span>
<span class="linenos">40</span><span class="sd">    Args:</span>
<span class="linenos">41</span><span class="sd">        fixtures_path (Path): The path to look for fixtures</span>
<span class="linenos">42</span><span class="sd">        fixture_name (str): The fixture name to load.</span>
<span class="linenos">43</span>
<span class="linenos">44</span><span class="sd">    Raises:</span>
<span class="linenos">45</span><span class="sd">        FileNotFoundError: Fixtures not found.</span>
<span class="linenos">46</span>
<span class="linenos">47</span><span class="sd">    Returns:</span>
<span class="linenos">48</span><span class="sd">        Any: The parsed JSON data</span>
<span class="linenos">49</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos">50</span>    <span class="n">fixture</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">fixtures_path</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fixture_name</span><span class="si">}</span><span class="s2">.json&quot;</span><span class="p">)</span>
<span class="linenos">51</span>    <span class="k">if</span> <span class="n">fixture</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
<span class="linenos">52</span>        <span class="k">with</span> <span class="n">fixture</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="linenos">53</span>            <span class="n">f_data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="linenos">54</span>        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">f_data</span><span class="p">)</span>
<span class="linenos">55</span>    <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find the </span><span class="si">{</span><span class="n">fixture_name</span><span class="si">}</span><span class="s2"> fixture&quot;</span><span class="p">)</span>
<span class="linenos">56</span>
<span class="linenos">57</span>
<span class="linenos">58</span><span class="k">def</span> <span class="nf">run_script</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">59</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Load data from a fixture.&quot;&quot;&quot;</span>
<span class="linenos">60</span>
<span class="linenos">61</span>    <span class="c1"># Initializes the database.</span>
<span class="linenos">62</span>    <span class="k">with</span> <span class="n">engine</span><span class="o">.</span><span class="n">begin</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
<span class="linenos">63</span>        <span class="n">USState</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span>
<span class="linenos">64</span>
<span class="linenos">65</span>    <span class="k">with</span> <span class="n">session_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">db_session</span><span class="p">:</span>
<span class="linenos">66</span>        <span class="c1"># 1) Load the JSON data into the US States table.</span>
<span class="linenos">67</span>        <span class="n">repo</span> <span class="o">=</span> <span class="n">USStateRepository</span><span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="n">db_session</span><span class="p">)</span>
<span class="linenos">68</span>        <span class="n">fixture</span> <span class="o">=</span> <span class="n">open_fixture</span><span class="p">(</span><span class="n">here</span><span class="p">,</span> <span class="n">USStateRepository</span><span class="o">.</span><span class="n">model_type</span><span class="o">.</span><span class="n">__tablename__</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
<span class="linenos">69</span>        <span class="n">objs</span> <span class="o">=</span> <span class="n">repo</span><span class="o">.</span><span class="n">add_many</span><span class="p">([</span><span class="n">USStateRepository</span><span class="o">.</span><span class="n">model_type</span><span class="p">(</span><span class="o">**</span><span class="n">raw_obj</span><span class="p">)</span> <span class="k">for</span> <span class="n">raw_obj</span> <span class="ow">in</span> <span class="n">fixture</span><span class="p">])</span>
<span class="linenos">70</span>        <span class="n">db_session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="linenos">71</span>        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">objs</span><span class="p">)</span><span class="si">}</span><span class="s2"> new objects.&quot;</span><span class="p">)</span>
<span class="linenos">72</span>
<span class="hll"><span class="linenos">73</span>        <span class="c1"># 2) Select paginated data and total row count.</span>
</span><span class="hll"><span class="linenos">74</span>        <span class="n">created_objs</span><span class="p">,</span> <span class="n">total_objs</span> <span class="o">=</span> <span class="n">repo</span><span class="o">.</span><span class="n">list_and_count</span><span class="p">(</span><span class="n">LimitOffset</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
</span><span class="hll"><span class="linenos">75</span>        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Selected </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">created_objs</span><span class="p">)</span><span class="si">}</span><span class="s2"> records out of a total of </span><span class="si">{</span><span class="n">total_objs</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</span><span class="linenos">76</span>
<span class="linenos">77</span>        <span class="c1"># 3) Let&#39;s remove the batch of records selected.</span>
<span class="linenos">78</span>        <span class="n">deleted_objs</span> <span class="o">=</span> <span class="n">repo</span><span class="o">.</span><span class="n">delete_many</span><span class="p">([</span><span class="n">new_obj</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">new_obj</span> <span class="ow">in</span> <span class="n">created_objs</span><span class="p">])</span>
<span class="linenos">79</span>        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removed </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">deleted_objs</span><span class="p">)</span><span class="si">}</span><span class="s2"> records out of a total of </span><span class="si">{</span><span class="n">total_objs</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="linenos">80</span>
<span class="linenos">81</span>        <span class="c1"># 4) Let&#39;s count the remaining rows</span>
<span class="linenos">82</span>        <span class="n">remaining_count</span> <span class="o">=</span> <span class="n">repo</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="linenos">83</span>        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="n">remaining_count</span><span class="si">}</span><span class="s2"> remaining records after delete.&quot;</span><span class="p">)</span>
<span class="linenos">84</span>
<span class="linenos">85</span>
<span class="linenos">86</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<span class="linenos">87</span>    <span class="n">run_script</span><span class="p">()</span>
</pre></div>
</div>
</div>
</section>
<section id="bulk-delete">
<h2>Bulk Delete<a class="headerlink" href="#bulk-delete" title="Permalink to this heading">#</a></h2>
<p>Here we demonstrate how to perform a bulk delete operation. Just as with the bulk
insert, deleting multiple records with the batch record methods is more efficient than
executing row-by-row.</p>
<div class="literal-block-wrapper docutils container" id="id15">
<div class="code-block-caption"><span class="caption-text">app.py</span><a class="headerlink" href="#id15" title="Permalink to this code">#</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">import</span> <span class="nn">json</span>
<span class="linenos"> 2</span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="linenos"> 3</span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="kn">from</span> <span class="nn">rich</span> <span class="kn">import</span> <span class="n">get_console</span>
<span class="linenos"> 6</span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>
<span class="linenos"> 7</span><span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">Mapped</span><span class="p">,</span> <span class="n">Session</span><span class="p">,</span> <span class="n">sessionmaker</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="kn">from</span> <span class="nn">litestar.contrib.sqlalchemy.base</span> <span class="kn">import</span> <span class="n">UUIDBase</span>
<span class="linenos">10</span><span class="kn">from</span> <span class="nn">litestar.contrib.sqlalchemy.repository</span> <span class="kn">import</span> <span class="n">SQLAlchemySyncRepository</span>
<span class="linenos">11</span><span class="kn">from</span> <span class="nn">litestar.repository.filters</span> <span class="kn">import</span> <span class="n">LimitOffset</span>
<span class="linenos">12</span>
<span class="linenos">13</span><span class="n">here</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span>
<span class="linenos">14</span><span class="n">console</span> <span class="o">=</span> <span class="n">get_console</span><span class="p">()</span>
<span class="linenos">15</span>
<span class="linenos">16</span>
<span class="linenos">17</span><span class="k">class</span> <span class="nc">USState</span><span class="p">(</span><span class="n">UUIDBase</span><span class="p">):</span>
<span class="linenos">18</span>    <span class="c1"># you can optionally override the generated table name by manually setting it.</span>
<span class="linenos">19</span>    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;us_state_lookup&quot;</span>  <span class="c1"># type: ignore[assignment]</span>
<span class="linenos">20</span>    <span class="n">abbreviation</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
<span class="linenos">21</span>    <span class="n">name</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
<span class="linenos">22</span>
<span class="linenos">23</span>
<span class="linenos">24</span><span class="k">class</span> <span class="nc">USStateRepository</span><span class="p">(</span><span class="n">SQLAlchemySyncRepository</span><span class="p">[</span><span class="n">USState</span><span class="p">]):</span>
<span class="linenos">25</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;US State repository.&quot;&quot;&quot;</span>
<span class="linenos">26</span>
<span class="linenos">27</span>    <span class="n">model_type</span> <span class="o">=</span> <span class="n">USState</span>
<span class="linenos">28</span>
<span class="linenos">29</span>
<span class="linenos">30</span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span>
<span class="linenos">31</span>    <span class="s2">&quot;duckdb:///:memory:&quot;</span><span class="p">,</span>
<span class="linenos">32</span>    <span class="n">future</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="linenos">33</span><span class="p">)</span>
<span class="linenos">34</span><span class="n">session_factory</span><span class="p">:</span> <span class="n">sessionmaker</span><span class="p">[</span><span class="n">Session</span><span class="p">]</span> <span class="o">=</span> <span class="n">sessionmaker</span><span class="p">(</span><span class="n">engine</span><span class="p">,</span> <span class="n">expire_on_commit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="linenos">35</span>
<span class="linenos">36</span>
<span class="linenos">37</span><span class="k">def</span> <span class="nf">open_fixture</span><span class="p">(</span><span class="n">fixtures_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">fixture_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="linenos">38</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Loads JSON file with the specified fixture name</span>
<span class="linenos">39</span>
<span class="linenos">40</span><span class="sd">    Args:</span>
<span class="linenos">41</span><span class="sd">        fixtures_path (Path): The path to look for fixtures</span>
<span class="linenos">42</span><span class="sd">        fixture_name (str): The fixture name to load.</span>
<span class="linenos">43</span>
<span class="linenos">44</span><span class="sd">    Raises:</span>
<span class="linenos">45</span><span class="sd">        FileNotFoundError: Fixtures not found.</span>
<span class="linenos">46</span>
<span class="linenos">47</span><span class="sd">    Returns:</span>
<span class="linenos">48</span><span class="sd">        Any: The parsed JSON data</span>
<span class="linenos">49</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos">50</span>    <span class="n">fixture</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">fixtures_path</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fixture_name</span><span class="si">}</span><span class="s2">.json&quot;</span><span class="p">)</span>
<span class="linenos">51</span>    <span class="k">if</span> <span class="n">fixture</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
<span class="linenos">52</span>        <span class="k">with</span> <span class="n">fixture</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="linenos">53</span>            <span class="n">f_data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="linenos">54</span>        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">f_data</span><span class="p">)</span>
<span class="linenos">55</span>    <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find the </span><span class="si">{</span><span class="n">fixture_name</span><span class="si">}</span><span class="s2"> fixture&quot;</span><span class="p">)</span>
<span class="linenos">56</span>
<span class="linenos">57</span>
<span class="linenos">58</span><span class="k">def</span> <span class="nf">run_script</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">59</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Load data from a fixture.&quot;&quot;&quot;</span>
<span class="linenos">60</span>
<span class="linenos">61</span>    <span class="c1"># Initializes the database.</span>
<span class="linenos">62</span>    <span class="k">with</span> <span class="n">engine</span><span class="o">.</span><span class="n">begin</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
<span class="linenos">63</span>        <span class="n">USState</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span>
<span class="linenos">64</span>
<span class="linenos">65</span>    <span class="k">with</span> <span class="n">session_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">db_session</span><span class="p">:</span>
<span class="linenos">66</span>        <span class="c1"># 1) Load the JSON data into the US States table.</span>
<span class="linenos">67</span>        <span class="n">repo</span> <span class="o">=</span> <span class="n">USStateRepository</span><span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="n">db_session</span><span class="p">)</span>
<span class="linenos">68</span>        <span class="n">fixture</span> <span class="o">=</span> <span class="n">open_fixture</span><span class="p">(</span><span class="n">here</span><span class="p">,</span> <span class="n">USStateRepository</span><span class="o">.</span><span class="n">model_type</span><span class="o">.</span><span class="n">__tablename__</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
<span class="linenos">69</span>        <span class="n">objs</span> <span class="o">=</span> <span class="n">repo</span><span class="o">.</span><span class="n">add_many</span><span class="p">([</span><span class="n">USStateRepository</span><span class="o">.</span><span class="n">model_type</span><span class="p">(</span><span class="o">**</span><span class="n">raw_obj</span><span class="p">)</span> <span class="k">for</span> <span class="n">raw_obj</span> <span class="ow">in</span> <span class="n">fixture</span><span class="p">])</span>
<span class="linenos">70</span>        <span class="n">db_session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="linenos">71</span>        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">objs</span><span class="p">)</span><span class="si">}</span><span class="s2"> new objects.&quot;</span><span class="p">)</span>
<span class="linenos">72</span>
<span class="linenos">73</span>        <span class="c1"># 2) Select paginated data and total row count.</span>
<span class="linenos">74</span>        <span class="n">created_objs</span><span class="p">,</span> <span class="n">total_objs</span> <span class="o">=</span> <span class="n">repo</span><span class="o">.</span><span class="n">list_and_count</span><span class="p">(</span><span class="n">LimitOffset</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
<span class="linenos">75</span>        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Selected </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">created_objs</span><span class="p">)</span><span class="si">}</span><span class="s2"> records out of a total of </span><span class="si">{</span><span class="n">total_objs</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="linenos">76</span>
<span class="hll"><span class="linenos">77</span>        <span class="c1"># 3) Let&#39;s remove the batch of records selected.</span>
</span><span class="hll"><span class="linenos">78</span>        <span class="n">deleted_objs</span> <span class="o">=</span> <span class="n">repo</span><span class="o">.</span><span class="n">delete_many</span><span class="p">([</span><span class="n">new_obj</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">new_obj</span> <span class="ow">in</span> <span class="n">created_objs</span><span class="p">])</span>
</span><span class="hll"><span class="linenos">79</span>        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removed </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">deleted_objs</span><span class="p">)</span><span class="si">}</span><span class="s2"> records out of a total of </span><span class="si">{</span><span class="n">total_objs</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</span><span class="linenos">80</span>
<span class="linenos">81</span>        <span class="c1"># 4) Let&#39;s count the remaining rows</span>
<span class="linenos">82</span>        <span class="n">remaining_count</span> <span class="o">=</span> <span class="n">repo</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="linenos">83</span>        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="n">remaining_count</span><span class="si">}</span><span class="s2"> remaining records after delete.&quot;</span><span class="p">)</span>
<span class="linenos">84</span>
<span class="linenos">85</span>
<span class="linenos">86</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<span class="linenos">87</span>    <span class="n">run_script</span><span class="p">()</span>
</pre></div>
</div>
</div>
</section>
<section id="counts">
<h2>Counts<a class="headerlink" href="#counts" title="Permalink to this heading">#</a></h2>
<p>Finally, well demonstrate how to count the number of records remaining in the database.</p>
<div class="literal-block-wrapper docutils container" id="id16">
<div class="code-block-caption"><span class="caption-text">app.py</span><a class="headerlink" href="#id16" title="Permalink to this code">#</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">import</span> <span class="nn">json</span>
<span class="linenos"> 2</span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="linenos"> 3</span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="kn">from</span> <span class="nn">rich</span> <span class="kn">import</span> <span class="n">get_console</span>
<span class="linenos"> 6</span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>
<span class="linenos"> 7</span><span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">Mapped</span><span class="p">,</span> <span class="n">Session</span><span class="p">,</span> <span class="n">sessionmaker</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="kn">from</span> <span class="nn">litestar.contrib.sqlalchemy.base</span> <span class="kn">import</span> <span class="n">UUIDBase</span>
<span class="linenos">10</span><span class="kn">from</span> <span class="nn">litestar.contrib.sqlalchemy.repository</span> <span class="kn">import</span> <span class="n">SQLAlchemySyncRepository</span>
<span class="linenos">11</span><span class="kn">from</span> <span class="nn">litestar.repository.filters</span> <span class="kn">import</span> <span class="n">LimitOffset</span>
<span class="linenos">12</span>
<span class="linenos">13</span><span class="n">here</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span>
<span class="linenos">14</span><span class="n">console</span> <span class="o">=</span> <span class="n">get_console</span><span class="p">()</span>
<span class="linenos">15</span>
<span class="linenos">16</span>
<span class="linenos">17</span><span class="k">class</span> <span class="nc">USState</span><span class="p">(</span><span class="n">UUIDBase</span><span class="p">):</span>
<span class="linenos">18</span>    <span class="c1"># you can optionally override the generated table name by manually setting it.</span>
<span class="linenos">19</span>    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;us_state_lookup&quot;</span>  <span class="c1"># type: ignore[assignment]</span>
<span class="linenos">20</span>    <span class="n">abbreviation</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
<span class="linenos">21</span>    <span class="n">name</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
<span class="linenos">22</span>
<span class="linenos">23</span>
<span class="linenos">24</span><span class="k">class</span> <span class="nc">USStateRepository</span><span class="p">(</span><span class="n">SQLAlchemySyncRepository</span><span class="p">[</span><span class="n">USState</span><span class="p">]):</span>
<span class="linenos">25</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;US State repository.&quot;&quot;&quot;</span>
<span class="linenos">26</span>
<span class="linenos">27</span>    <span class="n">model_type</span> <span class="o">=</span> <span class="n">USState</span>
<span class="linenos">28</span>
<span class="linenos">29</span>
<span class="linenos">30</span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span>
<span class="linenos">31</span>    <span class="s2">&quot;duckdb:///:memory:&quot;</span><span class="p">,</span>
<span class="linenos">32</span>    <span class="n">future</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="linenos">33</span><span class="p">)</span>
<span class="linenos">34</span><span class="n">session_factory</span><span class="p">:</span> <span class="n">sessionmaker</span><span class="p">[</span><span class="n">Session</span><span class="p">]</span> <span class="o">=</span> <span class="n">sessionmaker</span><span class="p">(</span><span class="n">engine</span><span class="p">,</span> <span class="n">expire_on_commit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="linenos">35</span>
<span class="linenos">36</span>
<span class="linenos">37</span><span class="k">def</span> <span class="nf">open_fixture</span><span class="p">(</span><span class="n">fixtures_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">fixture_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="linenos">38</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Loads JSON file with the specified fixture name</span>
<span class="linenos">39</span>
<span class="linenos">40</span><span class="sd">    Args:</span>
<span class="linenos">41</span><span class="sd">        fixtures_path (Path): The path to look for fixtures</span>
<span class="linenos">42</span><span class="sd">        fixture_name (str): The fixture name to load.</span>
<span class="linenos">43</span>
<span class="linenos">44</span><span class="sd">    Raises:</span>
<span class="linenos">45</span><span class="sd">        FileNotFoundError: Fixtures not found.</span>
<span class="linenos">46</span>
<span class="linenos">47</span><span class="sd">    Returns:</span>
<span class="linenos">48</span><span class="sd">        Any: The parsed JSON data</span>
<span class="linenos">49</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos">50</span>    <span class="n">fixture</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">fixtures_path</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fixture_name</span><span class="si">}</span><span class="s2">.json&quot;</span><span class="p">)</span>
<span class="linenos">51</span>    <span class="k">if</span> <span class="n">fixture</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
<span class="linenos">52</span>        <span class="k">with</span> <span class="n">fixture</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="linenos">53</span>            <span class="n">f_data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="linenos">54</span>        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">f_data</span><span class="p">)</span>
<span class="linenos">55</span>    <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find the </span><span class="si">{</span><span class="n">fixture_name</span><span class="si">}</span><span class="s2"> fixture&quot;</span><span class="p">)</span>
<span class="linenos">56</span>
<span class="linenos">57</span>
<span class="linenos">58</span><span class="k">def</span> <span class="nf">run_script</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">59</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Load data from a fixture.&quot;&quot;&quot;</span>
<span class="linenos">60</span>
<span class="linenos">61</span>    <span class="c1"># Initializes the database.</span>
<span class="linenos">62</span>    <span class="k">with</span> <span class="n">engine</span><span class="o">.</span><span class="n">begin</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
<span class="linenos">63</span>        <span class="n">USState</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span>
<span class="linenos">64</span>
<span class="linenos">65</span>    <span class="k">with</span> <span class="n">session_factory</span><span class="p">()</span> <span class="k">as</span> <span class="n">db_session</span><span class="p">:</span>
<span class="linenos">66</span>        <span class="c1"># 1) Load the JSON data into the US States table.</span>
<span class="linenos">67</span>        <span class="n">repo</span> <span class="o">=</span> <span class="n">USStateRepository</span><span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="n">db_session</span><span class="p">)</span>
<span class="linenos">68</span>        <span class="n">fixture</span> <span class="o">=</span> <span class="n">open_fixture</span><span class="p">(</span><span class="n">here</span><span class="p">,</span> <span class="n">USStateRepository</span><span class="o">.</span><span class="n">model_type</span><span class="o">.</span><span class="n">__tablename__</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
<span class="linenos">69</span>        <span class="n">objs</span> <span class="o">=</span> <span class="n">repo</span><span class="o">.</span><span class="n">add_many</span><span class="p">([</span><span class="n">USStateRepository</span><span class="o">.</span><span class="n">model_type</span><span class="p">(</span><span class="o">**</span><span class="n">raw_obj</span><span class="p">)</span> <span class="k">for</span> <span class="n">raw_obj</span> <span class="ow">in</span> <span class="n">fixture</span><span class="p">])</span>
<span class="linenos">70</span>        <span class="n">db_session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="linenos">71</span>        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">objs</span><span class="p">)</span><span class="si">}</span><span class="s2"> new objects.&quot;</span><span class="p">)</span>
<span class="linenos">72</span>
<span class="linenos">73</span>        <span class="c1"># 2) Select paginated data and total row count.</span>
<span class="linenos">74</span>        <span class="n">created_objs</span><span class="p">,</span> <span class="n">total_objs</span> <span class="o">=</span> <span class="n">repo</span><span class="o">.</span><span class="n">list_and_count</span><span class="p">(</span><span class="n">LimitOffset</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
<span class="linenos">75</span>        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Selected </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">created_objs</span><span class="p">)</span><span class="si">}</span><span class="s2"> records out of a total of </span><span class="si">{</span><span class="n">total_objs</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="linenos">76</span>
<span class="linenos">77</span>        <span class="c1"># 3) Let&#39;s remove the batch of records selected.</span>
<span class="linenos">78</span>        <span class="n">deleted_objs</span> <span class="o">=</span> <span class="n">repo</span><span class="o">.</span><span class="n">delete_many</span><span class="p">([</span><span class="n">new_obj</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">new_obj</span> <span class="ow">in</span> <span class="n">created_objs</span><span class="p">])</span>
<span class="linenos">79</span>        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removed </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">deleted_objs</span><span class="p">)</span><span class="si">}</span><span class="s2"> records out of a total of </span><span class="si">{</span><span class="n">total_objs</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="linenos">80</span>
<span class="hll"><span class="linenos">81</span>        <span class="c1"># 4) Let&#39;s count the remaining rows</span>
</span><span class="hll"><span class="linenos">82</span>        <span class="n">remaining_count</span> <span class="o">=</span> <span class="n">repo</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</span><span class="hll"><span class="linenos">83</span>        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="n">remaining_count</span><span class="si">}</span><span class="s2"> remaining records after delete.&quot;</span><span class="p">)</span>
</span><span class="linenos">84</span>
<span class="linenos">85</span>
<span class="linenos">86</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<span class="linenos">87</span>    <span class="n">run_script</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>Now that we have demonstrated how to interact with the repository objects outside of a
Litestar application, our next example will use dependency injection to add this
functionality to a <a class="reference internal" href="../../reference/controller.html#litestar.controller.Controller" title="litestar.controller.Controller"><code class="xref py py-class docutils literal notranslate"><span class="pre">Controller</span></code></a>!</p>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="01-modeling-and-features.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Introduction to Database Modeling and Repository Features</p>
      </div>
    </a>
    <a class="right-next"
       href="03-repository-controller.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Working with Controllers and Repositories</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Interacting with repositories</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#model-repository">Model Repository</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#repository-context-manager">Repository Context Manager</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-updating-and-removing-data">Creating, Updating and Removing Data</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#working-with-bulk-data-operations">Working with Bulk Data Operations</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fixture-data-loading">Fixture Data Loading</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#bulk-insert">Bulk Insert</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#paginated-data-selection">Paginated Data Selection</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#bulk-delete">Bulk Delete</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#counts">Counts</a></li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=ac02cc09edc035673794"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=ac02cc09edc035673794"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">
  <p class="copyright">
    
       Copyright 2023, Litestar-Org.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">
  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.1.2.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.14.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>